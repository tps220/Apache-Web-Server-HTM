\hypertarget{util__xml_8c}{}\section{/usr/local/src/github/\+Codebase/httpd-\/2.4.29/server/util\+\_\+xml.c File Reference}
\label{util__xml_8c}\index{/usr/local/src/github/\+Codebase/httpd-\/2.\+4.\+29/server/util\+\_\+xml.\+c@{/usr/local/src/github/\+Codebase/httpd-\/2.\+4.\+29/server/util\+\_\+xml.\+c}}
{\ttfamily \#include \char`\"{}apr\+\_\+xml.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}httpd.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}http\+\_\+protocol.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}http\+\_\+log.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}http\+\_\+core.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}util\+\_\+charset.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}util\+\_\+xml.\+h\char`\"{}}\\*
Include dependency graph for util\+\_\+xml.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{util__xml_8c__incl}
\end{center}
\end{figure}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{util__xml_8c_a154f7d68b355ecc80a0dea093b8efd0f}{R\+E\+A\+D\+\_\+\+B\+L\+O\+C\+K\+S\+I\+ZE}~2048
\item 
\#define \hyperlink{util__xml_8c_ae75325996d1b2cf6120dded4cb153a22}{A\+P\+L\+O\+G\+\_\+\+M\+O\+D\+U\+L\+E\+\_\+\+I\+N\+D\+EX}~\hyperlink{group__APACHE__CORE__HTTPD_gaf1cdaac5f4562d9d20bae417471ad422}{A\+P\+\_\+\+C\+O\+R\+E\+\_\+\+M\+O\+D\+U\+L\+E\+\_\+\+I\+N\+D\+EX}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{util__xml_8c_ace56382e8c8bdfffe9ffc8dbab06d36c}{A\+P\+\_\+\+D\+E\+C\+L\+A\+RE} (\hyperlink{pcre_8txt_a42dfa4ff673c82d8efe7144098fbc198}{int})
\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\index{util\+\_\+xml.\+c@{util\+\_\+xml.\+c}!A\+P\+L\+O\+G\+\_\+\+M\+O\+D\+U\+L\+E\+\_\+\+I\+N\+D\+EX@{A\+P\+L\+O\+G\+\_\+\+M\+O\+D\+U\+L\+E\+\_\+\+I\+N\+D\+EX}}
\index{A\+P\+L\+O\+G\+\_\+\+M\+O\+D\+U\+L\+E\+\_\+\+I\+N\+D\+EX@{A\+P\+L\+O\+G\+\_\+\+M\+O\+D\+U\+L\+E\+\_\+\+I\+N\+D\+EX}!util\+\_\+xml.\+c@{util\+\_\+xml.\+c}}
\subsubsection[{\texorpdfstring{A\+P\+L\+O\+G\+\_\+\+M\+O\+D\+U\+L\+E\+\_\+\+I\+N\+D\+EX}{APLOG_MODULE_INDEX}}]{\setlength{\rightskip}{0pt plus 5cm}\#define A\+P\+L\+O\+G\+\_\+\+M\+O\+D\+U\+L\+E\+\_\+\+I\+N\+D\+EX~{\bf A\+P\+\_\+\+C\+O\+R\+E\+\_\+\+M\+O\+D\+U\+L\+E\+\_\+\+I\+N\+D\+EX}}\hypertarget{util__xml_8c_ae75325996d1b2cf6120dded4cb153a22}{}\label{util__xml_8c_ae75325996d1b2cf6120dded4cb153a22}
\index{util\+\_\+xml.\+c@{util\+\_\+xml.\+c}!R\+E\+A\+D\+\_\+\+B\+L\+O\+C\+K\+S\+I\+ZE@{R\+E\+A\+D\+\_\+\+B\+L\+O\+C\+K\+S\+I\+ZE}}
\index{R\+E\+A\+D\+\_\+\+B\+L\+O\+C\+K\+S\+I\+ZE@{R\+E\+A\+D\+\_\+\+B\+L\+O\+C\+K\+S\+I\+ZE}!util\+\_\+xml.\+c@{util\+\_\+xml.\+c}}
\subsubsection[{\texorpdfstring{R\+E\+A\+D\+\_\+\+B\+L\+O\+C\+K\+S\+I\+ZE}{READ_BLOCKSIZE}}]{\setlength{\rightskip}{0pt plus 5cm}\#define R\+E\+A\+D\+\_\+\+B\+L\+O\+C\+K\+S\+I\+ZE~2048}\hypertarget{util__xml_8c_a154f7d68b355ecc80a0dea093b8efd0f}{}\label{util__xml_8c_a154f7d68b355ecc80a0dea093b8efd0f}


\subsection{Function Documentation}
\index{util\+\_\+xml.\+c@{util\+\_\+xml.\+c}!A\+P\+\_\+\+D\+E\+C\+L\+A\+RE@{A\+P\+\_\+\+D\+E\+C\+L\+A\+RE}}
\index{A\+P\+\_\+\+D\+E\+C\+L\+A\+RE@{A\+P\+\_\+\+D\+E\+C\+L\+A\+RE}!util\+\_\+xml.\+c@{util\+\_\+xml.\+c}}
\subsubsection[{\texorpdfstring{A\+P\+\_\+\+D\+E\+C\+L\+A\+R\+E(int)}{AP_DECLARE(int)}}]{\setlength{\rightskip}{0pt plus 5cm}A\+P\+\_\+\+D\+E\+C\+L\+A\+RE (
\begin{DoxyParamCaption}
\item[{{\bf int}}]{}
\end{DoxyParamCaption}
)}\hypertarget{util__xml_8c_ace56382e8c8bdfffe9ffc8dbab06d36c}{}\label{util__xml_8c_ace56382e8c8bdfffe9ffc8dbab06d36c}

\begin{DoxyCode}
37 \{
38     \hyperlink{structapr__xml__parser}{apr\_xml\_parser} *\hyperlink{group__APR__Util__XML_ga770a26ab91fad38f2253d5450d6e600e}{parser};
39     \hyperlink{structapr__bucket__brigade}{apr\_bucket\_brigade} *\hyperlink{group__MOD__PROXY_ga0a451b56abc335df106dcebf36975b0f}{brigade};
40     \textcolor{keywordtype}{int} seen\_eos;
41     \hyperlink{group__apr__errno_gaa5105fa83cc322f09382292db8b47593}{apr\_status\_t} \hyperlink{group__APACHE__CORE__HTTPD_ga6e27f49150e9a14580fb313cc2777e00}{status};
42     \textcolor{keywordtype}{char} \hyperlink{ap__regex_8h_af77b5f4c5b211e29e7b9e265b1420aa7}{errbuf}[200];
43     \hyperlink{group__apr__platform_gaaa72b2253f6f3032cefea5712a27540e}{apr\_size\_t} total\_read = 0;
44     \hyperlink{group__apr__platform_gaaa72b2253f6f3032cefea5712a27540e}{apr\_size\_t} limit\_xml\_body = ap\_get\_limit\_xml\_body(\hyperlink{group__APACHE__CORE__CONFIG_ga091cdd45984e865a888a4f8bb8fe107a}{r});
45     \textcolor{keywordtype}{int} \hyperlink{group__APACHE__CORE__MPM_ga9f5959dd76d5c83e775dcf44de684686}{result} = \hyperlink{group__HTTP__Status_ga0c1fdbbb10800664989907cbd3a5a023}{HTTP\_BAD\_REQUEST};
46 
47     parser = apr\_xml\_parser\_create(\hyperlink{group__APACHE__CORE__CONFIG_ga091cdd45984e865a888a4f8bb8fe107a}{r}->\hyperlink{structrequest__rec_aa0a0c16f9a9ab3901cdb3f3c9c9d83d0}{pool});
48     brigade = apr\_brigade\_create(\hyperlink{group__APACHE__CORE__CONFIG_ga091cdd45984e865a888a4f8bb8fe107a}{r}->\hyperlink{structrequest__rec_aa0a0c16f9a9ab3901cdb3f3c9c9d83d0}{pool}, \hyperlink{group__APACHE__CORE__CONFIG_ga091cdd45984e865a888a4f8bb8fe107a}{r}->\hyperlink{structrequest__rec_a0924aae55826638314f76952ca5d60b1}{connection}->bucket\_alloc);
49 
50     seen\_eos = 0;
51     total\_read = 0;
52 
53     \textcolor{keywordflow}{do} \{
54         \hyperlink{structapr__bucket}{apr\_bucket} *\hyperlink{group__APACHE__CORE__FILTER_ga6550e0bd0ee31e160be60d67874dbcbc}{bucket};
55 
56         \textcolor{comment}{/* read the body, stuffing it into the parser */}
57         status = ap\_get\_brigade(\hyperlink{group__APACHE__CORE__CONFIG_ga091cdd45984e865a888a4f8bb8fe107a}{r}->\hyperlink{structrequest__rec_ab07868ed8240b6236a51aa1e7b198d3e}{input\_filters}, brigade,
58                                 \hyperlink{util__filter_8h_ab570898d09fbbe5b6d838e28b90134e0a2d8e63e1da380c3909ac0a1325339de4}{AP\_MODE\_READBYTES}, 
      \hyperlink{group__APR__Util__Bucket__Brigades_gga756973fb6392bd1026c3d96b4519776da2d983f5b7fd996434e0dded171c261d8}{APR\_BLOCK\_READ},
59                                 \hyperlink{util__xml_8c_a154f7d68b355ecc80a0dea093b8efd0f}{READ\_BLOCKSIZE});
60 
61         \textcolor{keywordflow}{if} (status != \hyperlink{group__apr__errno_ga9ee311b7bf1c691dc521d721339ee2a6}{APR\_SUCCESS}) \{
62             result = ap\_map\_http\_request\_error(status, \hyperlink{group__HTTP__Status_ga0c1fdbbb10800664989907cbd3a5a023}{HTTP\_BAD\_REQUEST});
63             \textcolor{keywordflow}{goto} read\_error;
64         \}
65 
66         \textcolor{keywordflow}{for} (bucket = \hyperlink{group__APR__Util__Bucket__Brigades_gab5826a11eb6ba90786a94282f806c230}{APR\_BRIGADE\_FIRST}(brigade);
67              bucket != \hyperlink{group__APR__Util__Bucket__Brigades_ga858da66dccab1e063415678bb115788a}{APR\_BRIGADE\_SENTINEL}(brigade);
68              bucket = \hyperlink{group__APR__Util__Bucket__Brigades_ga7171f690b203d548a5b6ae0b079068d8}{APR\_BUCKET\_NEXT}(bucket))
69         \{
70             \textcolor{keyword}{const} \textcolor{keywordtype}{char} *\hyperlink{group__APACHE__CORE__LOG_gae4950db1dbfff8459a712737063b61aa}{data};
71             \hyperlink{group__apr__platform_gaaa72b2253f6f3032cefea5712a27540e}{apr\_size\_t} \hyperlink{group__APACHE__CORE__LOG_gab5a43233d60ef05c5b5bf5cba3d74468}{len};
72 
73             \textcolor{keywordflow}{if} (\hyperlink{group__APR__Util__Bucket__Brigades_ga89b225e1c08473766eec719b985ca0d6}{APR\_BUCKET\_IS\_EOS}(bucket)) \{
74                 seen\_eos = 1;
75                 \textcolor{keywordflow}{break};
76             \}
77 
78             \textcolor{keywordflow}{if} (\hyperlink{group__APR__Util__Bucket__Brigades_ga506cb29cc1ec1abeb487e01b122bd4d9}{APR\_BUCKET\_IS\_METADATA}(bucket)) \{
79                 \textcolor{keywordflow}{continue};
80             \}
81 
82             status = \hyperlink{group__APR__Util__Bucket__Brigades_gae44ae938c6c60e148430fdb098dcf28f}{apr\_bucket\_read}(bucket, &data, &len, 
      \hyperlink{group__APR__Util__Bucket__Brigades_gga756973fb6392bd1026c3d96b4519776da2d983f5b7fd996434e0dded171c261d8}{APR\_BLOCK\_READ});
83             \textcolor{keywordflow}{if} (status != \hyperlink{group__apr__errno_ga9ee311b7bf1c691dc521d721339ee2a6}{APR\_SUCCESS}) \{
84                 \textcolor{keywordflow}{goto} read\_error;
85             \}
86 
87             total\_read += \hyperlink{group__APACHE__CORE__LOG_gab5a43233d60ef05c5b5bf5cba3d74468}{len};
88             \textcolor{keywordflow}{if} (limit\_xml\_body && total\_read > limit\_xml\_body) \{
89                 \hyperlink{group__APACHE__CORE__LOG_ga4c112558ccffd6b363da102b2052d2a6}{ap\_log\_rerror}(\hyperlink{group__APACHE__CORE__LOG_ga655e126996849bcb82e4e5a14c616f4a}{APLOG\_MARK}, \hyperlink{group__APACHE__CORE__LOG_ga57ad94ed8c92c4306de90479251a5d58}{APLOG\_ERR}, 0, 
      \hyperlink{group__APACHE__CORE__CONFIG_ga091cdd45984e865a888a4f8bb8fe107a}{r}, \hyperlink{group__APACHE__CORE__LOG_ga1dee8a07e06bc5b3de8b89662c2cd666}{APLOGNO}(00539)
90                               \textcolor{stringliteral}{"XML request body is larger than the configured "}
91                               \textcolor{stringliteral}{"limit of %lu"}, (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long})limit\_xml\_body);
92                 result = \hyperlink{group__HTTP__Status_ga93fd8ea184f2b91b69c000f86d2e35bf}{HTTP\_REQUEST\_ENTITY\_TOO\_LARGE};
93                 \textcolor{keywordflow}{goto} read\_error;
94             \}
95 
96             status = apr\_xml\_parser\_feed(parser, data, len);
97             \textcolor{keywordflow}{if} (status) \{
98                 \textcolor{keywordflow}{goto} parser\_error;
99             \}
100         \}
101 
102         apr\_brigade\_cleanup(brigade);
103     \} \textcolor{keywordflow}{while} (!seen\_eos);
104 
105     apr\_brigade\_destroy(brigade);
106 
107     \textcolor{comment}{/* tell the parser that we're done */}
108     status = apr\_xml\_parser\_done(parser, \hyperlink{group__APACHE__CORE__XML_gad270a53cb15625305f196ee848a7ef4e}{pdoc});
109     \textcolor{keywordflow}{if} (status) \{
110         \textcolor{comment}{/* Some parsers are stupid and return an error on blank documents. */}
111         \textcolor{keywordflow}{if} (!total\_read) \{
112             *\hyperlink{group__APACHE__CORE__XML_gad270a53cb15625305f196ee848a7ef4e}{pdoc} = \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL};
113             \textcolor{keywordflow}{return} \hyperlink{group__APACHE__CORE__DAEMON_gaba51915c87d64af47fb1cc59348961c9}{OK};
114         \}
115         \hyperlink{group__APACHE__CORE__LOG_ga4c112558ccffd6b363da102b2052d2a6}{ap\_log\_rerror}(\hyperlink{group__APACHE__CORE__LOG_ga655e126996849bcb82e4e5a14c616f4a}{APLOG\_MARK}, \hyperlink{group__APACHE__CORE__LOG_ga57ad94ed8c92c4306de90479251a5d58}{APLOG\_ERR}, 0, 
      \hyperlink{group__APACHE__CORE__CONFIG_ga091cdd45984e865a888a4f8bb8fe107a}{r}, \hyperlink{group__APACHE__CORE__LOG_ga1dee8a07e06bc5b3de8b89662c2cd666}{APLOGNO}(00540)
116                       \textcolor{stringliteral}{"XML parser error (at end). status=%d"}, status);
117         \textcolor{keywordflow}{return} \hyperlink{group__HTTP__Status_ga0c1fdbbb10800664989907cbd3a5a023}{HTTP\_BAD\_REQUEST};
118     \}
119 
120 \textcolor{preprocessor}{#if APR\_CHARSET\_EBCDIC}
121     apr\_xml\_parser\_convert\_doc(\hyperlink{group__APACHE__CORE__CONFIG_ga091cdd45984e865a888a4f8bb8fe107a}{r}->\hyperlink{structrequest__rec_aa0a0c16f9a9ab3901cdb3f3c9c9d83d0}{pool}, *\hyperlink{group__APACHE__CORE__XML_gad270a53cb15625305f196ee848a7ef4e}{pdoc}, ap\_hdrs\_from\_ascii);
122 \textcolor{preprocessor}{#endif}
123     \textcolor{keywordflow}{return} \hyperlink{group__APACHE__CORE__DAEMON_gaba51915c87d64af47fb1cc59348961c9}{OK};
124 
125   parser\_error:
126     (\hyperlink{group__MOD__ISAPI_gacd6cdbf73df3d9eed42fa493d9b621a6}{void}) apr\_xml\_parser\_geterror(parser, errbuf, \textcolor{keyword}{sizeof}(errbuf));
127     \hyperlink{group__APACHE__CORE__LOG_ga4c112558ccffd6b363da102b2052d2a6}{ap\_log\_rerror}(\hyperlink{group__APACHE__CORE__LOG_ga655e126996849bcb82e4e5a14c616f4a}{APLOG\_MARK}, \hyperlink{group__APACHE__CORE__LOG_ga57ad94ed8c92c4306de90479251a5d58}{APLOG\_ERR}, 0, \hyperlink{group__APACHE__CORE__CONFIG_ga091cdd45984e865a888a4f8bb8fe107a}{r}, 
      \hyperlink{group__APACHE__CORE__LOG_ga1dee8a07e06bc5b3de8b89662c2cd666}{APLOGNO}(00541)
128                   \textcolor{stringliteral}{"XML Parser Error: %s"}, errbuf);
129 
130     \textcolor{comment}{/* FALLTHRU */}
131 
132   read\_error:
133     \textcolor{comment}{/* make sure the parser is terminated */}
134     (\hyperlink{group__MOD__ISAPI_gacd6cdbf73df3d9eed42fa493d9b621a6}{void}) apr\_xml\_parser\_done(parser, \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL});
135 
136     apr\_brigade\_destroy(brigade);
137 
138     \textcolor{comment}{/* Apache will supply a default error, plus the error log above. */}
139     \textcolor{keywordflow}{return} \hyperlink{group__APACHE__CORE__MPM_ga9f5959dd76d5c83e775dcf44de684686}{result};
140 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=234pt]{util__xml_8c_ace56382e8c8bdfffe9ffc8dbab06d36c_cgraph}
\end{center}
\end{figure}


