\hypertarget{h2__h2_8c}{}\section{/usr/local/src/github/\+Codebase/httpd-\/2.4.29/modules/http2/h2\+\_\+h2.c File Reference}
\label{h2__h2_8c}\index{/usr/local/src/github/\+Codebase/httpd-\/2.\+4.\+29/modules/http2/h2\+\_\+h2.\+c@{/usr/local/src/github/\+Codebase/httpd-\/2.\+4.\+29/modules/http2/h2\+\_\+h2.\+c}}
{\ttfamily \#include $<$assert.\+h$>$}\\*
{\ttfamily \#include $<$apr\+\_\+strings.\+h$>$}\\*
{\ttfamily \#include $<$apr\+\_\+optional.\+h$>$}\\*
{\ttfamily \#include $<$apr\+\_\+optional\+\_\+hooks.\+h$>$}\\*
{\ttfamily \#include $<$httpd.\+h$>$}\\*
{\ttfamily \#include $<$http\+\_\+core.\+h$>$}\\*
{\ttfamily \#include $<$http\+\_\+config.\+h$>$}\\*
{\ttfamily \#include $<$http\+\_\+connection.\+h$>$}\\*
{\ttfamily \#include $<$http\+\_\+protocol.\+h$>$}\\*
{\ttfamily \#include $<$http\+\_\+request.\+h$>$}\\*
{\ttfamily \#include $<$http\+\_\+log.\+h$>$}\\*
{\ttfamily \#include \char`\"{}mod\+\_\+ssl.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}mod\+\_\+http2.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}h2\+\_\+private.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}h2\+\_\+bucket\+\_\+beam.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}h2\+\_\+stream.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}h2\+\_\+task.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}h2\+\_\+config.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}h2\+\_\+ctx.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}h2\+\_\+conn.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}h2\+\_\+filter.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}h2\+\_\+request.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}h2\+\_\+headers.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}h2\+\_\+session.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}h2\+\_\+util.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}h2\+\_\+h2.\+h\char`\"{}}\\*
Include dependency graph for h2\+\_\+h2.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{h2__h2_8c__incl}
\end{center}
\end{figure}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
const char $\ast$ \hyperlink{h2__h2_8c_a7389e3f2c590bc08b5c8010a3f3fed1f}{h2\+\_\+h2\+\_\+err\+\_\+description} (unsigned \hyperlink{pcre_8txt_a42dfa4ff673c82d8efe7144098fbc198}{int} h2\+\_\+error)
\item 
\hyperlink{group__apr__errno_gaa5105fa83cc322f09382292db8b47593}{apr\+\_\+status\+\_\+t} \hyperlink{h2__h2_8c_ae3bb00cb4322e14981c678f3c16582db}{h2\+\_\+h2\+\_\+init} (\hyperlink{structapr__pool__t}{apr\+\_\+pool\+\_\+t} $\ast$\hyperlink{group__APR__XLATE_gabb3cd978f04c73d0b763c391e9bfde73}{pool}, \hyperlink{structserver__rec}{server\+\_\+rec} $\ast$\hyperlink{pcretest_8txt_a062597889ba244b72877454b1d3adecf}{s})
\item 
\hyperlink{pcre_8txt_a42dfa4ff673c82d8efe7144098fbc198}{int} \hyperlink{h2__h2_8c_a12023c300181338f92ad597347c0b0b7}{h2\+\_\+h2\+\_\+is\+\_\+tls} (\hyperlink{structconn__rec}{conn\+\_\+rec} $\ast$\hyperlink{pcregrep_8txt_aef720ae5f62fa015619d00171d917416}{c})
\item 
\hyperlink{pcre_8txt_a42dfa4ff673c82d8efe7144098fbc198}{int} \hyperlink{h2__h2_8c_a10ac5d94730f9852a030b4eb0336fab2}{h2\+\_\+is\+\_\+acceptable\+\_\+connection} (\hyperlink{structconn__rec}{conn\+\_\+rec} $\ast$\hyperlink{pcregrep_8txt_aef720ae5f62fa015619d00171d917416}{c}, \hyperlink{pcre_8txt_a42dfa4ff673c82d8efe7144098fbc198}{int} require\+\_\+all)
\item 
\hyperlink{pcre_8txt_a42dfa4ff673c82d8efe7144098fbc198}{int} \hyperlink{h2__h2_8c_a8a49bee17fbf415cbad8a7fd3cc62e81}{h2\+\_\+allows\+\_\+h2\+\_\+direct} (\hyperlink{structconn__rec}{conn\+\_\+rec} $\ast$\hyperlink{pcregrep_8txt_aef720ae5f62fa015619d00171d917416}{c})
\item 
\hyperlink{pcre_8txt_a42dfa4ff673c82d8efe7144098fbc198}{int} \hyperlink{h2__h2_8c_ab2dffa2c97f73b3433d0a61ee4793907}{h2\+\_\+allows\+\_\+h2\+\_\+upgrade} (\hyperlink{structconn__rec}{conn\+\_\+rec} $\ast$\hyperlink{pcregrep_8txt_aef720ae5f62fa015619d00171d917416}{c})
\item 
\hyperlink{group__MOD__ISAPI_gacd6cdbf73df3d9eed42fa493d9b621a6}{void} \hyperlink{h2__h2_8c_aac14f8417f6f939dc7e7988dc355e364}{h2\+\_\+h2\+\_\+register\+\_\+hooks} (\hyperlink{group__MOD__ISAPI_gacd6cdbf73df3d9eed42fa493d9b621a6}{void})
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
const char $\ast$ \hyperlink{h2__h2_8c_a667a4bcd5c5655103e7f73a395646688}{h2\+\_\+tls\+\_\+protos} \mbox{[}$\,$\mbox{]}
\item 
const char $\ast$ \hyperlink{h2__h2_8c_a1c3fe66619da3130ba6a37fb81beb6c2}{h2\+\_\+clear\+\_\+protos} \mbox{[}$\,$\mbox{]}
\item 
const char $\ast$ \hyperlink{h2__h2_8c_ae95dae0898b935e38b4697323d3c455c}{H2\+\_\+\+M\+A\+G\+I\+C\+\_\+\+T\+O\+K\+EN} = \char`\"{}P\+RI $\ast$ H\+T\+TP/2.\+0\textbackslash{}\hyperlink{pcregrep_8txt_ab232d334efb9173a12ae2940d035f460}{r\textbackslash{}n\textbackslash{}r\textbackslash{}n\+S\+M\textbackslash{}r\textbackslash{}n\textbackslash{}r\textbackslash{}n}\char`\"{}
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\index{h2\+\_\+h2.\+c@{h2\+\_\+h2.\+c}!h2\+\_\+allows\+\_\+h2\+\_\+direct@{h2\+\_\+allows\+\_\+h2\+\_\+direct}}
\index{h2\+\_\+allows\+\_\+h2\+\_\+direct@{h2\+\_\+allows\+\_\+h2\+\_\+direct}!h2\+\_\+h2.\+c@{h2\+\_\+h2.\+c}}
\subsubsection[{\texorpdfstring{h2\+\_\+allows\+\_\+h2\+\_\+direct(conn\+\_\+rec $\ast$c)}{h2_allows_h2_direct(conn_rec *c)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf int} h2\+\_\+allows\+\_\+h2\+\_\+direct (
\begin{DoxyParamCaption}
\item[{{\bf conn\+\_\+rec} $\ast$}]{c}
\end{DoxyParamCaption}
)}\hypertarget{h2__h2_8c_a8a49bee17fbf415cbad8a7fd3cc62e81}{}\label{h2__h2_8c_a8a49bee17fbf415cbad8a7fd3cc62e81}
Check if the \char`\"{}direct\char`\"{} H\+T\+T\+P/2 mode of protocol handling is enabled for the given connection. 
\begin{DoxyParams}{Parameters}
{\em c} & the connection to check \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
!= 0 iff direct mode is enabled 
\end{DoxyReturn}

\begin{DoxyCode}
526 \{
527     \textcolor{keyword}{const} \hyperlink{structh2__config}{h2\_config} *cfg = \hyperlink{h2__config_8c_ac97ca2f2308ef90b2506673564f9352a}{h2\_config\_get}(c);
528     \textcolor{keywordtype}{int} is\_tls = \hyperlink{h2__h2_8c_a12023c300181338f92ad597347c0b0b7}{h2\_h2\_is\_tls}(c);
529     \textcolor{keyword}{const} \textcolor{keywordtype}{char} *needed\_protocol = is\_tls? \textcolor{stringliteral}{"h2"} : \textcolor{stringliteral}{"h2c"};
530     \textcolor{keywordtype}{int} h2\_direct = \hyperlink{h2__config_8c_a22d672856fe674becba5e4e07ba0ae04}{h2\_config\_geti}(cfg, \hyperlink{h2__config_8h_a9ba9f682e77cb3b39514432a14fce8d4af0a5d9b715761a16c9b4b6729f44468b}{H2\_CONF\_DIRECT});
531     
532     \textcolor{keywordflow}{if} (h2\_direct < 0) \{
533         h2\_direct = is\_tls? 0 : 1;
534     \}
535     \textcolor{keywordflow}{return} (h2\_direct 
536             && ap\_is\_allowed\_protocol(c, \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL}, \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL}, needed\_protocol));
537 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{h2__h2_8c_a8a49bee17fbf415cbad8a7fd3cc62e81_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=333pt]{h2__h2_8c_a8a49bee17fbf415cbad8a7fd3cc62e81_icgraph}
\end{center}
\end{figure}


\index{h2\+\_\+h2.\+c@{h2\+\_\+h2.\+c}!h2\+\_\+allows\+\_\+h2\+\_\+upgrade@{h2\+\_\+allows\+\_\+h2\+\_\+upgrade}}
\index{h2\+\_\+allows\+\_\+h2\+\_\+upgrade@{h2\+\_\+allows\+\_\+h2\+\_\+upgrade}!h2\+\_\+h2.\+c@{h2\+\_\+h2.\+c}}
\subsubsection[{\texorpdfstring{h2\+\_\+allows\+\_\+h2\+\_\+upgrade(conn\+\_\+rec $\ast$c)}{h2_allows_h2_upgrade(conn_rec *c)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf int} h2\+\_\+allows\+\_\+h2\+\_\+upgrade (
\begin{DoxyParamCaption}
\item[{{\bf conn\+\_\+rec} $\ast$}]{c}
\end{DoxyParamCaption}
)}\hypertarget{h2__h2_8c_ab2dffa2c97f73b3433d0a61ee4793907}{}\label{h2__h2_8c_ab2dffa2c97f73b3433d0a61ee4793907}
Check if the \char`\"{}\+Upgrade\char`\"{} H\+T\+T\+P/1.\+1 mode of protocol switching is enabled for the given connection. 
\begin{DoxyParams}{Parameters}
{\em c} & the connection to check \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
!= 0 iff Upgrade switching is enabled 
\end{DoxyReturn}

\begin{DoxyCode}
540 \{
541     \textcolor{keyword}{const} \hyperlink{structh2__config}{h2\_config} *cfg = \hyperlink{h2__config_8c_ac97ca2f2308ef90b2506673564f9352a}{h2\_config\_get}(c);
542     \textcolor{keywordtype}{int} h2\_upgrade = \hyperlink{h2__config_8c_a22d672856fe674becba5e4e07ba0ae04}{h2\_config\_geti}(cfg, \hyperlink{h2__config_8h_a9ba9f682e77cb3b39514432a14fce8d4a9b68d59580ef9c791891729aca51accf}{H2\_CONF\_UPGRADE});
543     
544     \textcolor{keywordflow}{return} h2\_upgrade > 0 || (h2\_upgrade < 0 && !\hyperlink{h2__h2_8c_a12023c300181338f92ad597347c0b0b7}{h2\_h2\_is\_tls}(c));
545 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{h2__h2_8c_ab2dffa2c97f73b3433d0a61ee4793907_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=311pt]{h2__h2_8c_ab2dffa2c97f73b3433d0a61ee4793907_icgraph}
\end{center}
\end{figure}


\index{h2\+\_\+h2.\+c@{h2\+\_\+h2.\+c}!h2\+\_\+h2\+\_\+err\+\_\+description@{h2\+\_\+h2\+\_\+err\+\_\+description}}
\index{h2\+\_\+h2\+\_\+err\+\_\+description@{h2\+\_\+h2\+\_\+err\+\_\+description}!h2\+\_\+h2.\+c@{h2\+\_\+h2.\+c}}
\subsubsection[{\texorpdfstring{h2\+\_\+h2\+\_\+err\+\_\+description(unsigned int h2\+\_\+error)}{h2_h2_err_description(unsigned int h2_error)}}]{\setlength{\rightskip}{0pt plus 5cm}const char$\ast$ h2\+\_\+h2\+\_\+err\+\_\+description (
\begin{DoxyParamCaption}
\item[{unsigned {\bf int}}]{h2\+\_\+error}
\end{DoxyParamCaption}
)}\hypertarget{h2__h2_8c_a7389e3f2c590bc08b5c8010a3f3fed1f}{}\label{h2__h2_8c_a7389e3f2c590bc08b5c8010a3f3fed1f}
Provide a user readable description of the H\+T\+T\+P/2 error code-\/ 
\begin{DoxyParams}{Parameters}
{\em h2\+\_\+error} & http/2 error code, as in rfc 7540, ch. 7 \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
textual description of code or that it is unknown. 
\end{DoxyReturn}

\begin{DoxyCode}
88 \{
89     \textcolor{keywordflow}{if} (h2\_error < (\textcolor{keyword}{sizeof}(h2\_err\_descr)/\textcolor{keyword}{sizeof}(h2\_err\_descr[0]))) \{
90         \textcolor{keywordflow}{return} h2\_err\_descr[h2\_error];
91     \}
92     \textcolor{keywordflow}{return} \textcolor{stringliteral}{"unknown http/2 error code"};
93 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=323pt]{h2__h2_8c_a7389e3f2c590bc08b5c8010a3f3fed1f_icgraph}
\end{center}
\end{figure}


\index{h2\+\_\+h2.\+c@{h2\+\_\+h2.\+c}!h2\+\_\+h2\+\_\+init@{h2\+\_\+h2\+\_\+init}}
\index{h2\+\_\+h2\+\_\+init@{h2\+\_\+h2\+\_\+init}!h2\+\_\+h2.\+c@{h2\+\_\+h2.\+c}}
\subsubsection[{\texorpdfstring{h2\+\_\+h2\+\_\+init(apr\+\_\+pool\+\_\+t $\ast$pool, server\+\_\+rec $\ast$s)}{h2_h2_init(apr_pool_t *pool, server_rec *s)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf apr\+\_\+status\+\_\+t} h2\+\_\+h2\+\_\+init (
\begin{DoxyParamCaption}
\item[{{\bf apr\+\_\+pool\+\_\+t} $\ast$}]{pool, }
\item[{{\bf server\+\_\+rec} $\ast$}]{s}
\end{DoxyParamCaption}
)}\hypertarget{h2__h2_8c_ae3bb00cb4322e14981c678f3c16582db}{}\label{h2__h2_8c_ae3bb00cb4322e14981c678f3c16582db}

\begin{DoxyCode}
445 \{
446     (\hyperlink{group__MOD__ISAPI_gacd6cdbf73df3d9eed42fa493d9b621a6}{void})pool;
447     \hyperlink{group__APACHE__CORE__LOG_ga5e6676c87418af7a1d323a116c78ecb4}{ap\_log\_error}(\hyperlink{group__APACHE__CORE__LOG_ga655e126996849bcb82e4e5a14c616f4a}{APLOG\_MARK}, \hyperlink{group__APACHE__CORE__LOG_gab08ab6d0e9ab24707ce7baeaecf1f551}{APLOG\_TRACE1}, 0, s, \textcolor{stringliteral}{"h2\_h2, child\_init"});
448     opt\_ssl\_engine\_disable = \hyperlink{group__APR__Util__Opt_ga35f2df25ca06248d2fdd3e7463446418}{APR\_RETRIEVE\_OPTIONAL\_FN}(
      \hyperlink{group__MOD__SSL__PRIVATE_ga9e7bf408b385a57ebf50196312adb023}{ssl\_engine\_disable});
449     opt\_ssl\_is\_https = \hyperlink{group__APR__Util__Opt_ga35f2df25ca06248d2fdd3e7463446418}{APR\_RETRIEVE\_OPTIONAL\_FN}(ssl\_is\_https);
450     opt\_ssl\_var\_lookup = \hyperlink{group__APR__Util__Opt_ga35f2df25ca06248d2fdd3e7463446418}{APR\_RETRIEVE\_OPTIONAL\_FN}(
      \hyperlink{group__MOD__SSL__PRIVATE_ga42e6f981345c92e377fc830d91667fa5}{ssl\_var\_lookup});
451     
452     \textcolor{keywordflow}{if} (!opt\_ssl\_is\_https || !opt\_ssl\_var\_lookup) \{
453         \hyperlink{group__APACHE__CORE__LOG_ga5e6676c87418af7a1d323a116c78ecb4}{ap\_log\_error}(\hyperlink{group__APACHE__CORE__LOG_ga655e126996849bcb82e4e5a14c616f4a}{APLOG\_MARK}, \hyperlink{group__APACHE__CORE__LOG_ga73e14aeff380a8a01c66d528162026fe}{APLOG\_WARNING}, 0, s,
454                      \hyperlink{group__APACHE__CORE__LOG_ga1dee8a07e06bc5b3de8b89662c2cd666}{APLOGNO}(02951) \textcolor{stringliteral}{"mod\_ssl does not seem to be enabled"});
455     \}
456     
457     cipher\_init(pool);
458     
459     \textcolor{keywordflow}{return} \hyperlink{group__apr__errno_ga9ee311b7bf1c691dc521d721339ee2a6}{APR\_SUCCESS};
460 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=276pt]{h2__h2_8c_ae3bb00cb4322e14981c678f3c16582db_cgraph}
\end{center}
\end{figure}


\index{h2\+\_\+h2.\+c@{h2\+\_\+h2.\+c}!h2\+\_\+h2\+\_\+is\+\_\+tls@{h2\+\_\+h2\+\_\+is\+\_\+tls}}
\index{h2\+\_\+h2\+\_\+is\+\_\+tls@{h2\+\_\+h2\+\_\+is\+\_\+tls}!h2\+\_\+h2.\+c@{h2\+\_\+h2.\+c}}
\subsubsection[{\texorpdfstring{h2\+\_\+h2\+\_\+is\+\_\+tls(conn\+\_\+rec $\ast$c)}{h2_h2_is_tls(conn_rec *c)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf int} h2\+\_\+h2\+\_\+is\+\_\+tls (
\begin{DoxyParamCaption}
\item[{{\bf conn\+\_\+rec} $\ast$}]{c}
\end{DoxyParamCaption}
)}\hypertarget{h2__h2_8c_a12023c300181338f92ad597347c0b0b7}{}\label{h2__h2_8c_a12023c300181338f92ad597347c0b0b7}

\begin{DoxyCode}
463 \{
464     \textcolor{keywordflow}{return} opt\_ssl\_is\_https && opt\_ssl\_is\_https(c);
465 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{h2__h2_8c_a12023c300181338f92ad597347c0b0b7_icgraph}
\end{center}
\end{figure}


\index{h2\+\_\+h2.\+c@{h2\+\_\+h2.\+c}!h2\+\_\+h2\+\_\+register\+\_\+hooks@{h2\+\_\+h2\+\_\+register\+\_\+hooks}}
\index{h2\+\_\+h2\+\_\+register\+\_\+hooks@{h2\+\_\+h2\+\_\+register\+\_\+hooks}!h2\+\_\+h2.\+c@{h2\+\_\+h2.\+c}}
\subsubsection[{\texorpdfstring{h2\+\_\+h2\+\_\+register\+\_\+hooks(void)}{h2_h2_register_hooks(void)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} h2\+\_\+h2\+\_\+register\+\_\+hooks (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)}\hypertarget{h2__h2_8c_aac14f8417f6f939dc7e7988dc355e364}{}\label{h2__h2_8c_aac14f8417f6f939dc7e7988dc355e364}

\begin{DoxyCode}
554 \{
555     \textcolor{comment}{/* Our main processing needs to run quite late. Definitely after mod\_ssl,}
556 \textcolor{comment}{     * as we need its connection filters, but also before reqtimeout as its}
557 \textcolor{comment}{     * method of timeouts is specific to HTTP/1.1 (as of now).}
558 \textcolor{comment}{     * The core HTTP/1 processing run as REALLY\_LAST, so we will have}
559 \textcolor{comment}{     * a chance to take over before it.}
560 \textcolor{comment}{     */}
561     ap\_hook\_process\_connection(h2\_h2\_process\_conn, 
562                                mod\_ssl, mod\_reqtimeout, \hyperlink{group__APR__Util__Hook_gaa610a95f03d7b4aee922c28b0919f028}{APR\_HOOK\_LAST});
563     
564     \textcolor{comment}{/* One last chance to properly say goodbye if we have not done so}
565 \textcolor{comment}{     * already. */}
566     ap\_hook\_pre\_close\_connection(h2\_h2\_pre\_close\_conn, \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL}, mod\_ssl, 
      \hyperlink{group__APR__Util__Hook_gaa610a95f03d7b4aee922c28b0919f028}{APR\_HOOK\_LAST});
567 
568     \textcolor{comment}{/* With "H2SerializeHeaders On", we install the filter in this hook}
569 \textcolor{comment}{     * that parses the response. This needs to happen before any other post}
570 \textcolor{comment}{     * read function terminates the request with an error. Otherwise we will}
571 \textcolor{comment}{     * never see the response.}
572 \textcolor{comment}{     */}
573     ap\_hook\_post\_read\_request(h2\_h2\_post\_read\_req, \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL}, \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL}, 
      \hyperlink{group__APR__Util__Hook_gab004dcbfff32997deb15040e48f07e92}{APR\_HOOK\_REALLY\_FIRST});
574     ap\_hook\_fixups(h2\_h2\_late\_fixups, \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL}, \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL}, \hyperlink{group__APR__Util__Hook_gaa610a95f03d7b4aee922c28b0919f028}{APR\_HOOK\_LAST});
575 
576     \textcolor{comment}{/* special bucket type transfer through a h2\_bucket\_beam */}
577     \hyperlink{h2__bucket__beam_8c_ae852d6fa1e8a9c1e23531c224acdede1}{h2\_register\_bucket\_beamer}(\hyperlink{h2__headers_8c_a098b5c7d00f998aef8e99e99f6884616}{h2\_bucket\_headers\_beam});
578     \hyperlink{h2__bucket__beam_8c_ae852d6fa1e8a9c1e23531c224acdede1}{h2\_register\_bucket\_beamer}(\hyperlink{h2__filter_8c_ab3bd5a1630af5762487a01bfb486d198}{h2\_bucket\_observer\_beam});
579 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{h2__h2_8c_aac14f8417f6f939dc7e7988dc355e364_cgraph}
\end{center}
\end{figure}


\index{h2\+\_\+h2.\+c@{h2\+\_\+h2.\+c}!h2\+\_\+is\+\_\+acceptable\+\_\+connection@{h2\+\_\+is\+\_\+acceptable\+\_\+connection}}
\index{h2\+\_\+is\+\_\+acceptable\+\_\+connection@{h2\+\_\+is\+\_\+acceptable\+\_\+connection}!h2\+\_\+h2.\+c@{h2\+\_\+h2.\+c}}
\subsubsection[{\texorpdfstring{h2\+\_\+is\+\_\+acceptable\+\_\+connection(conn\+\_\+rec $\ast$c, int require\+\_\+all)}{h2_is_acceptable_connection(conn_rec *c, int require_all)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf int} h2\+\_\+is\+\_\+acceptable\+\_\+connection (
\begin{DoxyParamCaption}
\item[{{\bf conn\+\_\+rec} $\ast$}]{c, }
\item[{{\bf int}}]{require\+\_\+all}
\end{DoxyParamCaption}
)}\hypertarget{h2__h2_8c_a10ac5d94730f9852a030b4eb0336fab2}{}\label{h2__h2_8c_a10ac5d94730f9852a030b4eb0336fab2}
Check if the given connection fulfills the requirements as configured. 
\begin{DoxyParams}{Parameters}
{\em c} & the connection \\
\hline
{\em require\+\_\+all} & != 0 iff any missing connection properties make the test fail. For example, a cipher might not have been selected while the handshake is still ongoing. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
!= 0 iff connection requirements are met 
\end{DoxyReturn}

\begin{DoxyCode}
468 \{
469     \textcolor{keywordtype}{int} is\_tls = \hyperlink{h2__h2_8c_a12023c300181338f92ad597347c0b0b7}{h2\_h2\_is\_tls}(c);
470     \textcolor{keyword}{const} \hyperlink{structh2__config}{h2\_config} *cfg = \hyperlink{h2__config_8c_ac97ca2f2308ef90b2506673564f9352a}{h2\_config\_get}(c);
471 
472     \textcolor{keywordflow}{if} (is\_tls && \hyperlink{h2__config_8c_a22d672856fe674becba5e4e07ba0ae04}{h2\_config\_geti}(cfg, \hyperlink{h2__config_8h_a9ba9f682e77cb3b39514432a14fce8d4a7c44d5673cef84c1cd4164808c54d508}{H2\_CONF\_MODERN\_TLS\_ONLY}) > 0) \{
473         \textcolor{comment}{/* Check TLS connection for modern TLS parameters, as defined in}
474 \textcolor{comment}{         * RFC 7540 and https://wiki.mozilla.org/Security/Server\_Side\_TLS#Modern\_compatibility}
475 \textcolor{comment}{         */}
476         \hyperlink{structapr__pool__t}{apr\_pool\_t} *\hyperlink{group__APACHE__CORE__MUTEX_ga8fea43b485988aa6df5dced9dddbe733}{pool} = c->\hyperlink{structconn__rec_a1dc5f31c7afc4a6f9c4ede0daea8cd1d}{pool};
477         \hyperlink{structserver__rec}{server\_rec} *\hyperlink{group__APACHE__CORE__LISTEN_ga9359ed159c8b295541e3770172d34550}{s} = c->\hyperlink{structconn__rec_a1e199eb6e4e1617e94dd03b9cfaa83c8}{base\_server};
478         \textcolor{keywordtype}{char} *\hyperlink{group__APACHE__CORE__CONFIG_gae553dcb033cb5c1e269683855e4f676a}{val};
479         
480         \textcolor{keywordflow}{if} (!opt\_ssl\_var\_lookup) \{
481             \textcolor{comment}{/* unable to check */}
482             \textcolor{keywordflow}{return} 0;
483         \}
484         
485         \textcolor{comment}{/* Need Tlsv1.2 or higher, rfc 7540, ch. 9.2}
486 \textcolor{comment}{         */}
487         val = opt\_ssl\_var\_lookup(pool, s, c, \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL}, (\textcolor{keywordtype}{char}*)\textcolor{stringliteral}{"SSL\_PROTOCOL"});
488         \textcolor{keywordflow}{if} (val && *val) \{
489             \textcolor{keywordflow}{if} (strncmp(\textcolor{stringliteral}{"TLS"}, val, 3) 
490                 || !strcmp(\textcolor{stringliteral}{"TLSv1"}, val) 
491                 || !strcmp(\textcolor{stringliteral}{"TLSv1.1"}, val)) \{
492                 \hyperlink{group__APACHE__CORE__LOG_ga60ef6919b8e1b691b0c1ac4d67c9449f}{ap\_log\_cerror}(\hyperlink{group__APACHE__CORE__LOG_ga655e126996849bcb82e4e5a14c616f4a}{APLOG\_MARK}, \hyperlink{group__APACHE__CORE__LOG_gadfcef90537539cf2b7d35cfbbbafeb93}{APLOG\_DEBUG}, 0, c, 
      \hyperlink{group__APACHE__CORE__LOG_ga1dee8a07e06bc5b3de8b89662c2cd666}{APLOGNO}(03050)
493                               \textcolor{stringliteral}{"h2\_h2(%ld): tls protocol not suitable: %s"}, 
494                               (\textcolor{keywordtype}{long})c->\hyperlink{structconn__rec_af90d018c333fca6f3ef0f29375b86dc1}{id}, val);
495                 \textcolor{keywordflow}{return} 0;
496             \}
497         \}
498         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (require\_all) \{
499             \hyperlink{group__APACHE__CORE__LOG_ga60ef6919b8e1b691b0c1ac4d67c9449f}{ap\_log\_cerror}(\hyperlink{group__APACHE__CORE__LOG_ga655e126996849bcb82e4e5a14c616f4a}{APLOG\_MARK}, \hyperlink{group__APACHE__CORE__LOG_gadfcef90537539cf2b7d35cfbbbafeb93}{APLOG\_DEBUG}, 0, c, 
      \hyperlink{group__APACHE__CORE__LOG_ga1dee8a07e06bc5b3de8b89662c2cd666}{APLOGNO}(03051)
500                           \textcolor{stringliteral}{"h2\_h2(%ld): tls protocol is indetermined"}, (\textcolor{keywordtype}{long})c->
      \hyperlink{structconn__rec_af90d018c333fca6f3ef0f29375b86dc1}{id});
501             \textcolor{keywordflow}{return} 0;
502         \}
503 
504         \textcolor{comment}{/* Check TLS cipher blacklist}
505 \textcolor{comment}{         */}
506         val = opt\_ssl\_var\_lookup(pool, s, c, \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL}, (\textcolor{keywordtype}{char}*)\textcolor{stringliteral}{"SSL\_CIPHER"});
507         \textcolor{keywordflow}{if} (val && *val) \{
508             \textcolor{keyword}{const} \textcolor{keywordtype}{char} *\hyperlink{group__AP__EXPR_ga0e8eb33ac3362aea4e83d2c415b2dc17}{source};
509             \textcolor{keywordflow}{if} (cipher\_is\_blacklisted(val, &source)) \{
510                 \hyperlink{group__APACHE__CORE__LOG_ga60ef6919b8e1b691b0c1ac4d67c9449f}{ap\_log\_cerror}(\hyperlink{group__APACHE__CORE__LOG_ga655e126996849bcb82e4e5a14c616f4a}{APLOG\_MARK}, \hyperlink{group__APACHE__CORE__LOG_gadfcef90537539cf2b7d35cfbbbafeb93}{APLOG\_DEBUG}, 0, c, 
      \hyperlink{group__APACHE__CORE__LOG_ga1dee8a07e06bc5b3de8b89662c2cd666}{APLOGNO}(03052)
511                               \textcolor{stringliteral}{"h2\_h2(%ld): tls cipher %s blacklisted by %s"}, 
512                               (\textcolor{keywordtype}{long})c->\hyperlink{structconn__rec_af90d018c333fca6f3ef0f29375b86dc1}{id}, val, source);
513                 \textcolor{keywordflow}{return} 0;
514             \}
515         \}
516         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (require\_all) \{
517             \hyperlink{group__APACHE__CORE__LOG_ga60ef6919b8e1b691b0c1ac4d67c9449f}{ap\_log\_cerror}(\hyperlink{group__APACHE__CORE__LOG_ga655e126996849bcb82e4e5a14c616f4a}{APLOG\_MARK}, \hyperlink{group__APACHE__CORE__LOG_gadfcef90537539cf2b7d35cfbbbafeb93}{APLOG\_DEBUG}, 0, c, 
      \hyperlink{group__APACHE__CORE__LOG_ga1dee8a07e06bc5b3de8b89662c2cd666}{APLOGNO}(03053)
518                           \textcolor{stringliteral}{"h2\_h2(%ld): tls cipher is indetermined"}, (\textcolor{keywordtype}{long})c->\hyperlink{structconn__rec_af90d018c333fca6f3ef0f29375b86dc1}{id});
519             \textcolor{keywordflow}{return} 0;
520         \}
521     \}
522     \textcolor{keywordflow}{return} 1;
523 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{h2__h2_8c_a10ac5d94730f9852a030b4eb0336fab2_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{h2__h2_8c_a10ac5d94730f9852a030b4eb0336fab2_icgraph}
\end{center}
\end{figure}




\subsection{Variable Documentation}
\index{h2\+\_\+h2.\+c@{h2\+\_\+h2.\+c}!h2\+\_\+clear\+\_\+protos@{h2\+\_\+clear\+\_\+protos}}
\index{h2\+\_\+clear\+\_\+protos@{h2\+\_\+clear\+\_\+protos}!h2\+\_\+h2.\+c@{h2\+\_\+h2.\+c}}
\subsubsection[{\texorpdfstring{h2\+\_\+clear\+\_\+protos}{h2_clear_protos}}]{\setlength{\rightskip}{0pt plus 5cm}const char$\ast$ h2\+\_\+clear\+\_\+protos\mbox{[}$\,$\mbox{]}}\hypertarget{h2__h2_8c_a1c3fe66619da3130ba6a37fb81beb6c2}{}\label{h2__h2_8c_a1c3fe66619da3130ba6a37fb81beb6c2}
{\bfseries Initial value\+:}
\begin{DoxyCode}
= \{
    \textcolor{stringliteral}{"h2c"}, \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL}
\}
\end{DoxyCode}
List of A\+L\+PN protocol identifiers that we support in cleartext negotiations. N\+U\+LL terminated. \index{h2\+\_\+h2.\+c@{h2\+\_\+h2.\+c}!H2\+\_\+\+M\+A\+G\+I\+C\+\_\+\+T\+O\+K\+EN@{H2\+\_\+\+M\+A\+G\+I\+C\+\_\+\+T\+O\+K\+EN}}
\index{H2\+\_\+\+M\+A\+G\+I\+C\+\_\+\+T\+O\+K\+EN@{H2\+\_\+\+M\+A\+G\+I\+C\+\_\+\+T\+O\+K\+EN}!h2\+\_\+h2.\+c@{h2\+\_\+h2.\+c}}
\subsubsection[{\texorpdfstring{H2\+\_\+\+M\+A\+G\+I\+C\+\_\+\+T\+O\+K\+EN}{H2_MAGIC_TOKEN}}]{\setlength{\rightskip}{0pt plus 5cm}const char$\ast$ H2\+\_\+\+M\+A\+G\+I\+C\+\_\+\+T\+O\+K\+EN = \char`\"{}P\+RI $\ast$ H\+T\+TP/2.\+0\textbackslash{}{\bf r\textbackslash{}n\textbackslash{}r\textbackslash{}n\+S\+M\textbackslash{}r\textbackslash{}n\textbackslash{}r\textbackslash{}n}\char`\"{}}\hypertarget{h2__h2_8c_ae95dae0898b935e38b4697323d3c455c}{}\label{h2__h2_8c_ae95dae0898b935e38b4697323d3c455c}
The magic P\+R\+Iamble of R\+FC 7540 that is always sent when starting a h2 communication. \index{h2\+\_\+h2.\+c@{h2\+\_\+h2.\+c}!h2\+\_\+tls\+\_\+protos@{h2\+\_\+tls\+\_\+protos}}
\index{h2\+\_\+tls\+\_\+protos@{h2\+\_\+tls\+\_\+protos}!h2\+\_\+h2.\+c@{h2\+\_\+h2.\+c}}
\subsubsection[{\texorpdfstring{h2\+\_\+tls\+\_\+protos}{h2_tls_protos}}]{\setlength{\rightskip}{0pt plus 5cm}const char$\ast$ h2\+\_\+tls\+\_\+protos\mbox{[}$\,$\mbox{]}}\hypertarget{h2__h2_8c_a667a4bcd5c5655103e7f73a395646688}{}\label{h2__h2_8c_a667a4bcd5c5655103e7f73a395646688}
{\bfseries Initial value\+:}
\begin{DoxyCode}
= \{
    \textcolor{stringliteral}{"h2"}, \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL}
\}
\end{DoxyCode}
List of A\+L\+PN protocol identifiers that we support in T\+LS encrypted negotiations. N\+U\+LL terminated. 