\hypertarget{util__cookies_8c}{}\section{/usr/local/src/github/\+Codebase/httpd-\/2.4.29/server/util\+\_\+cookies.c File Reference}
\label{util__cookies_8c}\index{/usr/local/src/github/\+Codebase/httpd-\/2.\+4.\+29/server/util\+\_\+cookies.\+c@{/usr/local/src/github/\+Codebase/httpd-\/2.\+4.\+29/server/util\+\_\+cookies.\+c}}
{\ttfamily \#include \char`\"{}util\+\_\+cookies.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}apr\+\_\+lib.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}apr\+\_\+strings.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}http\+\_\+config.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}http\+\_\+core.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}http\+\_\+log.\+h\char`\"{}}\\*
Include dependency graph for util\+\_\+cookies.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{util__cookies_8c__incl}
\end{center}
\end{figure}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{util__cookies_8c_aae1d11681b36518afb9413f4194b18a6}{L\+O\+G\+\_\+\+P\+R\+E\+F\+IX}~\char`\"{}ap\+\_\+cookie\+: \char`\"{}
\item 
\#define \hyperlink{util__cookies_8c_ae75325996d1b2cf6120dded4cb153a22}{A\+P\+L\+O\+G\+\_\+\+M\+O\+D\+U\+L\+E\+\_\+\+I\+N\+D\+EX}~\hyperlink{group__APACHE__CORE__HTTPD_gaf1cdaac5f4562d9d20bae417471ad422}{A\+P\+\_\+\+C\+O\+R\+E\+\_\+\+M\+O\+D\+U\+L\+E\+\_\+\+I\+N\+D\+EX}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{util__cookies_8c_ad4e49a371518f348d13b2d4e83b79b9e}{A\+P\+\_\+\+D\+E\+C\+L\+A\+RE} (\hyperlink{group__apr__errno_gaa5105fa83cc322f09382292db8b47593}{apr\+\_\+status\+\_\+t})
\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\index{util\+\_\+cookies.\+c@{util\+\_\+cookies.\+c}!A\+P\+L\+O\+G\+\_\+\+M\+O\+D\+U\+L\+E\+\_\+\+I\+N\+D\+EX@{A\+P\+L\+O\+G\+\_\+\+M\+O\+D\+U\+L\+E\+\_\+\+I\+N\+D\+EX}}
\index{A\+P\+L\+O\+G\+\_\+\+M\+O\+D\+U\+L\+E\+\_\+\+I\+N\+D\+EX@{A\+P\+L\+O\+G\+\_\+\+M\+O\+D\+U\+L\+E\+\_\+\+I\+N\+D\+EX}!util\+\_\+cookies.\+c@{util\+\_\+cookies.\+c}}
\subsubsection[{\texorpdfstring{A\+P\+L\+O\+G\+\_\+\+M\+O\+D\+U\+L\+E\+\_\+\+I\+N\+D\+EX}{APLOG_MODULE_INDEX}}]{\setlength{\rightskip}{0pt plus 5cm}\#define A\+P\+L\+O\+G\+\_\+\+M\+O\+D\+U\+L\+E\+\_\+\+I\+N\+D\+EX~{\bf A\+P\+\_\+\+C\+O\+R\+E\+\_\+\+M\+O\+D\+U\+L\+E\+\_\+\+I\+N\+D\+EX}}\hypertarget{util__cookies_8c_ae75325996d1b2cf6120dded4cb153a22}{}\label{util__cookies_8c_ae75325996d1b2cf6120dded4cb153a22}
\index{util\+\_\+cookies.\+c@{util\+\_\+cookies.\+c}!L\+O\+G\+\_\+\+P\+R\+E\+F\+IX@{L\+O\+G\+\_\+\+P\+R\+E\+F\+IX}}
\index{L\+O\+G\+\_\+\+P\+R\+E\+F\+IX@{L\+O\+G\+\_\+\+P\+R\+E\+F\+IX}!util\+\_\+cookies.\+c@{util\+\_\+cookies.\+c}}
\subsubsection[{\texorpdfstring{L\+O\+G\+\_\+\+P\+R\+E\+F\+IX}{LOG_PREFIX}}]{\setlength{\rightskip}{0pt plus 5cm}\#define L\+O\+G\+\_\+\+P\+R\+E\+F\+IX~\char`\"{}ap\+\_\+cookie\+: \char`\"{}}\hypertarget{util__cookies_8c_aae1d11681b36518afb9413f4194b18a6}{}\label{util__cookies_8c_aae1d11681b36518afb9413f4194b18a6}


\subsection{Function Documentation}
\index{util\+\_\+cookies.\+c@{util\+\_\+cookies.\+c}!A\+P\+\_\+\+D\+E\+C\+L\+A\+RE@{A\+P\+\_\+\+D\+E\+C\+L\+A\+RE}}
\index{A\+P\+\_\+\+D\+E\+C\+L\+A\+RE@{A\+P\+\_\+\+D\+E\+C\+L\+A\+RE}!util\+\_\+cookies.\+c@{util\+\_\+cookies.\+c}}
\subsubsection[{\texorpdfstring{A\+P\+\_\+\+D\+E\+C\+L\+A\+R\+E(apr\+\_\+status\+\_\+t)}{AP_DECLARE(apr_status_t)}}]{\setlength{\rightskip}{0pt plus 5cm}A\+P\+\_\+\+D\+E\+C\+L\+A\+RE (
\begin{DoxyParamCaption}
\item[{{\bf apr\+\_\+status\+\_\+t}}]{}
\end{DoxyParamCaption}
)}\hypertarget{util__cookies_8c_ad4e49a371518f348d13b2d4e83b79b9e}{}\label{util__cookies_8c_ad4e49a371518f348d13b2d4e83b79b9e}
Write an R\+F\+C2109 compliant cookie.


\begin{DoxyParams}{Parameters}
{\em r} & The request \\
\hline
{\em name} & The name of the cookie. \\
\hline
{\em val} & The value to place in the cookie. \\
\hline
{\em attrs} & The string containing additional cookie attributes. If N\+U\+LL, the D\+E\+F\+A\+U\+L\+T\+\_\+\+A\+T\+T\+RS will be used. \\
\hline
{\em maxage} & If non zero, a Max-\/\+Age header will be added to the cookie.\\
\hline
\end{DoxyParams}
Write an R\+F\+C2965 compliant cookie.


\begin{DoxyParams}{Parameters}
{\em r} & The request \\
\hline
{\em name2} & The name of the cookie. \\
\hline
{\em val} & The value to place in the cookie. \\
\hline
{\em attrs2} & The string containing additional cookie attributes. If N\+U\+LL, the D\+E\+F\+A\+U\+L\+T\+\_\+\+A\+T\+T\+RS will be used. \\
\hline
{\em maxage} & If non zero, a Max-\/\+Age header will be added to the cookie.\\
\hline
\end{DoxyParams}
Remove an R\+F\+C2109 compliant cookie.


\begin{DoxyParams}{Parameters}
{\em r} & The request \\
\hline
{\em name} & The name of the cookie.\\
\hline
\end{DoxyParams}
Remove an R\+F\+C2965 compliant cookie.


\begin{DoxyParams}{Parameters}
{\em r} & The request \\
\hline
{\em name2} & The name of the cookie.\\
\hline
\end{DoxyParams}
Read a cookie called name, placing its value in val.

Both the Cookie and Cookie2 headers are scanned for the cookie.

If the cookie is duplicated, this function returns A\+P\+R\+\_\+\+E\+G\+E\+N\+E\+R\+AL. If found, and if remove is non zero, the cookie will be removed from the headers, and thus kept private from the backend.

Sanity check a given string that it exists, is not empty, and does not contain the special characters \textquotesingle{}=\textquotesingle{}, \textquotesingle{};\textquotesingle{} and \textquotesingle{}\&\textquotesingle{}.

It is used to sanity check the cookie names. 
\begin{DoxyCode}
42 \{
43 
44     \textcolor{keyword}{const} \textcolor{keywordtype}{char} *\hyperlink{group__APACHE__CORE__PROTO_gabd91b1aab0a10c5027ca2eb5577f759f}{buffer};
45     \textcolor{keyword}{const} \textcolor{keywordtype}{char} *rfc2109;
46     \hyperlink{structapr__table__t}{apr\_table\_t} *\hyperlink{group__APACHE__CORE__DAEMON_gabfa74bb4f05f3b2de1a89160025e5400}{t};
47     va\_list \hyperlink{group__apr__tables_ga8ca169f10741c89e389d179f952e4dc9}{vp};
48 
49     \textcolor{comment}{/* handle expiry */}
50     buffer = \textcolor{stringliteral}{""};
51     \textcolor{keywordflow}{if} (\hyperlink{group__APACHE__CORE__COOKIE_ga846f24530366d967942121cbfdca1ea7}{maxage}) \{
52         buffer = apr\_pstrcat(\hyperlink{group__APACHE__CORE__CONFIG_ga091cdd45984e865a888a4f8bb8fe107a}{r}->\hyperlink{structrequest__rec_aa0a0c16f9a9ab3901cdb3f3c9c9d83d0}{pool}, \textcolor{stringliteral}{"Max-Age="}, apr\_ltoa(\hyperlink{group__APACHE__CORE__CONFIG_ga091cdd45984e865a888a4f8bb8fe107a}{r}->\hyperlink{structrequest__rec_aa0a0c16f9a9ab3901cdb3f3c9c9d83d0}{pool}, 
      \hyperlink{group__APACHE__CORE__COOKIE_ga846f24530366d967942121cbfdca1ea7}{maxage}), \textcolor{stringliteral}{";"}, \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL});
53     \}
54 
55     \textcolor{comment}{/* create RFC2109 compliant cookie */}
56     rfc2109 = apr\_pstrcat(\hyperlink{group__APACHE__CORE__CONFIG_ga091cdd45984e865a888a4f8bb8fe107a}{r}->\hyperlink{structrequest__rec_aa0a0c16f9a9ab3901cdb3f3c9c9d83d0}{pool}, \hyperlink{group__APACHE__CORE__CONFIG_ga06e97fb366205b8f170da3c7562a8677}{name}, \textcolor{stringliteral}{"="}, \hyperlink{group__APACHE__CORE__CONFIG_gae553dcb033cb5c1e269683855e4f676a}{val}, \textcolor{stringliteral}{";"}, buffer,
57                           \hyperlink{group__APACHE__CORE__COOKIE_ga15763078452b250115cbc4984012a3c5}{attrs} && *\hyperlink{group__APACHE__CORE__COOKIE_ga15763078452b250115cbc4984012a3c5}{attrs} ? \hyperlink{group__APACHE__CORE__COOKIE_ga15763078452b250115cbc4984012a3c5}{attrs} : \hyperlink{group__APACHE__CORE__COOKIE_ga5637644ceca6966eee1ad8be41ebd664}{DEFAULT\_ATTRS}, 
      \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL});
58     \hyperlink{group__APACHE__CORE__LOG_ga4c112558ccffd6b363da102b2052d2a6}{ap\_log\_rerror}(\hyperlink{group__APACHE__CORE__LOG_ga655e126996849bcb82e4e5a14c616f4a}{APLOG\_MARK}, \hyperlink{group__APACHE__CORE__LOG_gadfcef90537539cf2b7d35cfbbbafeb93}{APLOG\_DEBUG}, 0, 
      \hyperlink{group__APACHE__CORE__CONFIG_ga091cdd45984e865a888a4f8bb8fe107a}{r}, \hyperlink{group__APACHE__CORE__LOG_ga1dee8a07e06bc5b3de8b89662c2cd666}{APLOGNO}(00007) \hyperlink{util__cookies_8c_aae1d11681b36518afb9413f4194b18a6}{LOG\_PREFIX}
59                   \textcolor{stringliteral}{"user '%s' set cookie: '%s'"}, \hyperlink{group__APACHE__CORE__CONFIG_ga091cdd45984e865a888a4f8bb8fe107a}{r}->\hyperlink{structrequest__rec_a63f3abd83f53633f9d0069bc39aeb424}{user}, rfc2109);
60 
61     \textcolor{comment}{/* write the cookie to the header table(s) provided */}
62     va\_start(vp, \hyperlink{group__APACHE__CORE__COOKIE_ga846f24530366d967942121cbfdca1ea7}{maxage});
63     \textcolor{keywordflow}{while} ((t = va\_arg(vp, \hyperlink{structapr__table__t}{apr\_table\_t} *))) \{
64         apr\_table\_addn(t, \hyperlink{group__APACHE__CORE__COOKIE_ga5fa19bea1553c0dd82e5c88916f51e5b}{SET\_COOKIE}, rfc2109);
65     \}
66     va\_end(vp);
67 
68     \textcolor{keywordflow}{return} \hyperlink{group__apr__errno_ga9ee311b7bf1c691dc521d721339ee2a6}{APR\_SUCCESS};
69 
70 \}
\end{DoxyCode}
