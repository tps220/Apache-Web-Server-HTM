\hypertarget{win32_2filestat_8c}{}\section{/usr/local/src/github/\+Codebase/httpd-\/2.4.29/srclib/apr/file\+\_\+io/win32/filestat.c File Reference}
\label{win32_2filestat_8c}\index{/usr/local/src/github/\+Codebase/httpd-\/2.\+4.\+29/srclib/apr/file\+\_\+io/win32/filestat.\+c@{/usr/local/src/github/\+Codebase/httpd-\/2.\+4.\+29/srclib/apr/file\+\_\+io/win32/filestat.\+c}}
{\ttfamily \#include \char`\"{}apr.\+h\char`\"{}}\\*
{\ttfamily \#include $<$aclapi.\+h$>$}\\*
{\ttfamily \#include \char`\"{}apr\+\_\+private.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}apr\+\_\+arch\+\_\+file\+\_\+io.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}apr\+\_\+file\+\_\+io.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}apr\+\_\+general.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}apr\+\_\+strings.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}apr\+\_\+errno.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}apr\+\_\+time.\+h\char`\"{}}\\*
{\ttfamily \#include $<$sys/stat.\+h$>$}\\*
{\ttfamily \#include \char`\"{}apr\+\_\+arch\+\_\+atime.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}apr\+\_\+arch\+\_\+misc.\+h\char`\"{}}\\*
Include dependency graph for filestat.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{win32_2filestat_8c__incl}
\end{center}
\end{figure}
\subsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef enum \hyperlink{win32_2filestat_8c_a95d070427a23d0aa6a313a7e31183865}{prot\+\_\+scope\+\_\+e} \hyperlink{win32_2filestat_8c_a69290cd2da46232453f04150d5944a37}{prot\+\_\+scope\+\_\+e}
\end{DoxyCompactItemize}
\subsection*{Enumerations}
\begin{DoxyCompactItemize}
\item 
enum \hyperlink{win32_2filestat_8c_a95d070427a23d0aa6a313a7e31183865}{prot\+\_\+scope\+\_\+e} \{ \hyperlink{win32_2filestat_8c_a95d070427a23d0aa6a313a7e31183865a33992c31ae9a4a5ed38e0a631f74d365}{prot\+\_\+scope\+\_\+world} = 0, 
\hyperlink{win32_2filestat_8c_a95d070427a23d0aa6a313a7e31183865a0a80eb70b0c0b5b75290033af8e8c3ee}{prot\+\_\+scope\+\_\+group} = 4, 
\hyperlink{win32_2filestat_8c_a95d070427a23d0aa6a313a7e31183865a4e83117058ed31526a347d0e1c4e2197}{prot\+\_\+scope\+\_\+user} = 8
 \}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{group__apr__errno_gaa5105fa83cc322f09382292db8b47593}{apr\+\_\+status\+\_\+t} \hyperlink{win32_2filestat_8c_a49bfa82debf69dc3b85fe94ee9167bc7}{more\+\_\+finfo} (\hyperlink{structapr__finfo__t}{apr\+\_\+finfo\+\_\+t} $\ast$finfo, const \hyperlink{group__MOD__ISAPI_gacd6cdbf73df3d9eed42fa493d9b621a6}{void} $\ast$ufile, \hyperlink{group__apr__platform_ga21ef1e35fd3ff9be386f3cb20164ff02}{apr\+\_\+int32\+\_\+t} \hyperlink{group__apr__file__io_ga48805d2a6845252444835c7809c73ade}{wanted}, \hyperlink{pcre_8txt_a42dfa4ff673c82d8efe7144098fbc198}{int} whatfile)
\item 
\hyperlink{pcre_8txt_a42dfa4ff673c82d8efe7144098fbc198}{int} \hyperlink{win32_2filestat_8c_a1d405eab7eb9bec59a5ee1deb4146aa7}{fillin\+\_\+fileinfo} (\hyperlink{structapr__finfo__t}{apr\+\_\+finfo\+\_\+t} $\ast$finfo, W\+I\+N32\+\_\+\+F\+I\+L\+E\+\_\+\+A\+T\+T\+R\+I\+B\+U\+T\+E\+\_\+\+D\+A\+TA $\ast$wininfo, \hyperlink{pcre_8txt_a42dfa4ff673c82d8efe7144098fbc198}{int} byhandle, \hyperlink{group__apr__platform_ga21ef1e35fd3ff9be386f3cb20164ff02}{apr\+\_\+int32\+\_\+t} \hyperlink{group__apr__file__io_ga48805d2a6845252444835c7809c73ade}{wanted})
\item 
\hyperlink{group__apr__allocator_ga9cb19a118179bbd8625eacfec66a9ab8}{A\+P\+R\+\_\+\+D\+E\+C\+L\+A\+RE} (\hyperlink{group__apr__errno_gaa5105fa83cc322f09382292db8b47593}{apr\+\_\+status\+\_\+t})
\end{DoxyCompactItemize}


\subsection{Typedef Documentation}
\index{win32/filestat.\+c@{win32/filestat.\+c}!prot\+\_\+scope\+\_\+e@{prot\+\_\+scope\+\_\+e}}
\index{prot\+\_\+scope\+\_\+e@{prot\+\_\+scope\+\_\+e}!win32/filestat.\+c@{win32/filestat.\+c}}
\subsubsection[{\texorpdfstring{prot\+\_\+scope\+\_\+e}{prot_scope_e}}]{\setlength{\rightskip}{0pt plus 5cm}typedef enum {\bf prot\+\_\+scope\+\_\+e}  {\bf prot\+\_\+scope\+\_\+e}}\hypertarget{win32_2filestat_8c_a69290cd2da46232453f04150d5944a37}{}\label{win32_2filestat_8c_a69290cd2da46232453f04150d5944a37}


\subsection{Enumeration Type Documentation}
\index{win32/filestat.\+c@{win32/filestat.\+c}!prot\+\_\+scope\+\_\+e@{prot\+\_\+scope\+\_\+e}}
\index{prot\+\_\+scope\+\_\+e@{prot\+\_\+scope\+\_\+e}!win32/filestat.\+c@{win32/filestat.\+c}}
\subsubsection[{\texorpdfstring{prot\+\_\+scope\+\_\+e}{prot_scope_e}}]{\setlength{\rightskip}{0pt plus 5cm}enum {\bf prot\+\_\+scope\+\_\+e}}\hypertarget{win32_2filestat_8c_a95d070427a23d0aa6a313a7e31183865}{}\label{win32_2filestat_8c_a95d070427a23d0aa6a313a7e31183865}
\begin{Desc}
\item[Enumerator]\par
\begin{description}
\index{prot\+\_\+scope\+\_\+world@{prot\+\_\+scope\+\_\+world}!win32/filestat.\+c@{win32/filestat.\+c}}\index{win32/filestat.\+c@{win32/filestat.\+c}!prot\+\_\+scope\+\_\+world@{prot\+\_\+scope\+\_\+world}}\item[{\em 
prot\+\_\+scope\+\_\+world\hypertarget{win32_2filestat_8c_a95d070427a23d0aa6a313a7e31183865a33992c31ae9a4a5ed38e0a631f74d365}{}\label{win32_2filestat_8c_a95d070427a23d0aa6a313a7e31183865a33992c31ae9a4a5ed38e0a631f74d365}
}]\index{prot\+\_\+scope\+\_\+group@{prot\+\_\+scope\+\_\+group}!win32/filestat.\+c@{win32/filestat.\+c}}\index{win32/filestat.\+c@{win32/filestat.\+c}!prot\+\_\+scope\+\_\+group@{prot\+\_\+scope\+\_\+group}}\item[{\em 
prot\+\_\+scope\+\_\+group\hypertarget{win32_2filestat_8c_a95d070427a23d0aa6a313a7e31183865a0a80eb70b0c0b5b75290033af8e8c3ee}{}\label{win32_2filestat_8c_a95d070427a23d0aa6a313a7e31183865a0a80eb70b0c0b5b75290033af8e8c3ee}
}]\index{prot\+\_\+scope\+\_\+user@{prot\+\_\+scope\+\_\+user}!win32/filestat.\+c@{win32/filestat.\+c}}\index{win32/filestat.\+c@{win32/filestat.\+c}!prot\+\_\+scope\+\_\+user@{prot\+\_\+scope\+\_\+user}}\item[{\em 
prot\+\_\+scope\+\_\+user\hypertarget{win32_2filestat_8c_a95d070427a23d0aa6a313a7e31183865a4e83117058ed31526a347d0e1c4e2197}{}\label{win32_2filestat_8c_a95d070427a23d0aa6a313a7e31183865a4e83117058ed31526a347d0e1c4e2197}
}]\end{description}
\end{Desc}

\begin{DoxyCode}
69                           \{
70     \hyperlink{win32_2filestat_8c_a95d070427a23d0aa6a313a7e31183865a33992c31ae9a4a5ed38e0a631f74d365}{prot\_scope\_world} = 0,
71     \hyperlink{win32_2filestat_8c_a95d070427a23d0aa6a313a7e31183865a0a80eb70b0c0b5b75290033af8e8c3ee}{prot\_scope\_group} = 4,
72     \hyperlink{win32_2filestat_8c_a95d070427a23d0aa6a313a7e31183865a4e83117058ed31526a347d0e1c4e2197}{prot\_scope\_user} =  8
73 \} \hyperlink{win32_2filestat_8c_a95d070427a23d0aa6a313a7e31183865}{prot\_scope\_e};
\end{DoxyCode}


\subsection{Function Documentation}
\index{win32/filestat.\+c@{win32/filestat.\+c}!fillin\+\_\+fileinfo@{fillin\+\_\+fileinfo}}
\index{fillin\+\_\+fileinfo@{fillin\+\_\+fileinfo}!win32/filestat.\+c@{win32/filestat.\+c}}
\subsubsection[{\texorpdfstring{fillin\+\_\+fileinfo(apr\+\_\+finfo\+\_\+t $\ast$finfo, W\+I\+N32\+\_\+\+F\+I\+L\+E\+\_\+\+A\+T\+T\+R\+I\+B\+U\+T\+E\+\_\+\+D\+A\+T\+A $\ast$wininfo, int byhandle, apr\+\_\+int32\+\_\+t wanted)}{fillin_fileinfo(apr_finfo_t *finfo, WIN32_FILE_ATTRIBUTE_DATA *wininfo, int byhandle, apr_int32_t wanted)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf int} fillin\+\_\+fileinfo (
\begin{DoxyParamCaption}
\item[{{\bf apr\+\_\+finfo\+\_\+t} $\ast$}]{finfo, }
\item[{W\+I\+N32\+\_\+\+F\+I\+L\+E\+\_\+\+A\+T\+T\+R\+I\+B\+U\+T\+E\+\_\+\+D\+A\+TA $\ast$}]{wininfo, }
\item[{{\bf int}}]{byhandle, }
\item[{{\bf apr\+\_\+int32\+\_\+t}}]{wanted}
\end{DoxyParamCaption}
)}\hypertarget{win32_2filestat_8c_a1d405eab7eb9bec59a5ee1deb4146aa7}{}\label{win32_2filestat_8c_a1d405eab7eb9bec59a5ee1deb4146aa7}

\begin{DoxyCode}
355 \{
356     DWORD *sizes = &wininfo->nFileSizeHigh + byhandle;
357     \textcolor{keywordtype}{int} warn = 0;
358 
359     memset(finfo, \textcolor{charliteral}{'\(\backslash\)0'}, \textcolor{keyword}{sizeof}(*finfo));
360 
361     FileTimeToAprTime(&finfo->\hyperlink{structapr__finfo__t_ad78874e5751e9bba30debb0826eb96a7}{atime}, &wininfo->ftLastAccessTime);
362     FileTimeToAprTime(&finfo->\hyperlink{structapr__finfo__t_aebbdb3dc755d825de3dce901cfba0883}{ctime}, &wininfo->ftCreationTime);
363     FileTimeToAprTime(&finfo->\hyperlink{structapr__finfo__t_afc3bec0f6b3b10160428ba5602a41c60}{mtime}, &wininfo->ftLastWriteTime);
364 
365 \textcolor{preprocessor}{#if APR\_HAS\_LARGE\_FILES}
366     finfo->\hyperlink{structapr__finfo__t_a3e47a673c5b82a25a783a732dee6f946}{size} =  (\hyperlink{group__apr__platform_ga6938af9075cec15c88299109381aa984}{apr\_off\_t})sizes[1]
367                 | ((\hyperlink{group__apr__platform_ga6938af9075cec15c88299109381aa984}{apr\_off\_t})sizes[0] << 32);
368 \textcolor{preprocessor}{#else}
369     finfo->\hyperlink{structapr__finfo__t_a3e47a673c5b82a25a783a732dee6f946}{size} = (\hyperlink{group__apr__platform_ga6938af9075cec15c88299109381aa984}{apr\_off\_t})sizes[1];
370     \textcolor{keywordflow}{if} (finfo->\hyperlink{structapr__finfo__t_a3e47a673c5b82a25a783a732dee6f946}{size} < 0 || sizes[0])
371         finfo->\hyperlink{structapr__finfo__t_a3e47a673c5b82a25a783a732dee6f946}{size} = 0x7fffffff;
372 \textcolor{preprocessor}{#endif}
373 
374     \textcolor{keywordflow}{if} (\hyperlink{group__apr__file__stat_ga48805d2a6845252444835c7809c73ade}{wanted} & \hyperlink{group__apr__file__stat_ga9b0c1d02401b845f928f836fdd3c6712}{APR\_FINFO\_LINK} &&
375         wininfo->dwFileAttributes & \hyperlink{win32_2apr__arch__file__io_8h_a4a9bd536541986a80226c350f89997ba}{FILE\_ATTRIBUTE\_REPARSE\_POINT}) \{
376         finfo->\hyperlink{structapr__finfo__t_a274ae0dd60b59182c2e0134bc9a09a20}{filetype} = \hyperlink{group__apr__file__info_ggae3f0ce3014337a52b39852f8bf81ca7ca2b55a6db64d814bf08d5a56b026a8176}{APR\_LNK};
377     \}
378     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (wininfo->dwFileAttributes & FILE\_ATTRIBUTE\_DIRECTORY) \{
379         finfo->\hyperlink{structapr__finfo__t_a274ae0dd60b59182c2e0134bc9a09a20}{filetype} = \hyperlink{group__apr__file__info_ggae3f0ce3014337a52b39852f8bf81ca7cae2ee810fa994ae64b8fcc6b68d3ae540}{APR\_DIR};
380     \}
381     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (wininfo->dwFileAttributes & \hyperlink{win32_2apr__arch__file__io_8h_aacf8e3610f58598b1cb40df6d3e216a9}{FILE\_ATTRIBUTE\_DEVICE}) \{
382         \textcolor{comment}{/* Warning: This test only succeeds on Win9x, on NT these files}
383 \textcolor{comment}{         * (con, aux, nul, lpt#, com# etc) escape early detection!}
384 \textcolor{comment}{         */}
385         finfo->\hyperlink{structapr__finfo__t_a274ae0dd60b59182c2e0134bc9a09a20}{filetype} = \hyperlink{group__apr__file__info_ggae3f0ce3014337a52b39852f8bf81ca7cadb769ffbe8659cbecf7ebf376d098d37}{APR\_CHR};
386     \}
387     \textcolor{keywordflow}{else} \{
388         \textcolor{comment}{/* Warning: Short of opening the handle to the file, the 'FileType'}
389 \textcolor{comment}{         * appears to be unknowable (in any trustworthy or consistent sense)}
390 \textcolor{comment}{         * on WinNT/2K as far as PIPE, CHR, etc are concerned.}
391 \textcolor{comment}{         */}
392         \textcolor{keywordflow}{if} (!wininfo->ftLastWriteTime.dwLowDateTime 
393                 && !wininfo->ftLastWriteTime.dwHighDateTime 
394                 && !finfo->\hyperlink{structapr__finfo__t_a3e47a673c5b82a25a783a732dee6f946}{size})
395             warn = 1;
396         finfo->\hyperlink{structapr__finfo__t_a274ae0dd60b59182c2e0134bc9a09a20}{filetype} = \hyperlink{group__apr__file__info_ggae3f0ce3014337a52b39852f8bf81ca7ca9a2849ad21618c937683c1ffe13a6257}{APR\_REG};
397     \}
398 
399     \textcolor{comment}{/* The following flags are [for this moment] private to Win32.}
400 \textcolor{comment}{     * That's the only excuse for not toggling valid bits to reflect them.}
401 \textcolor{comment}{     */}
402     \textcolor{keywordflow}{if} (wininfo->dwFileAttributes & FILE\_ATTRIBUTE\_READONLY)
403         finfo->\hyperlink{structapr__finfo__t_a7c09d73ad1957e2c0e6c6b77d94e90ab}{protection} = \hyperlink{win32_2apr__arch__file__io_8h_a8e89857011d54a7d2fdb274eef1d7ecd}{APR\_FREADONLY};
404     
405     finfo->\hyperlink{structapr__finfo__t_aff0cdf06637edec63c4701e582792019}{valid} = \hyperlink{group__apr__file__stat_ga17d7656d02a35ffc05afe22032a8da15}{APR\_FINFO\_ATIME} | \hyperlink{group__apr__file__stat_ga98bef78baf71fa63b06352704f128bca}{APR\_FINFO\_CTIME} | 
      \hyperlink{group__apr__file__stat_ga992ce1f4f75d519fd2a9d241c5a12515}{APR\_FINFO\_MTIME}
406                  | \hyperlink{group__apr__file__stat_gadf72493da450c0b1e3d279e98a973120}{APR\_FINFO\_SIZE}  | \hyperlink{group__apr__file__stat_gad5d25f25527ee77c08bb20aae141306c}{APR\_FINFO\_TYPE};   \textcolor{comment}{/* == APR\_FINFO\_MIN */}
407 
408     \textcolor{comment}{/* Only byhandle optionally tests link targets, so tell that caller}
409 \textcolor{comment}{     * what it wants to hear, otherwise the byattributes is never}
410 \textcolor{comment}{     * reporting anything but the link.}
411 \textcolor{comment}{     */}
412     \textcolor{keywordflow}{if} (!byhandle || (\hyperlink{group__apr__file__stat_ga48805d2a6845252444835c7809c73ade}{wanted} & \hyperlink{group__apr__file__stat_ga9b0c1d02401b845f928f836fdd3c6712}{APR\_FINFO\_LINK}))
413         finfo->\hyperlink{structapr__finfo__t_aff0cdf06637edec63c4701e582792019}{valid} |= APR\_FINFO\_LINK;
414     \textcolor{keywordflow}{return} warn;
415 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=275pt]{win32_2filestat_8c_a1d405eab7eb9bec59a5ee1deb4146aa7_icgraph}
\end{center}
\end{figure}


\index{win32/filestat.\+c@{win32/filestat.\+c}!more\+\_\+finfo@{more\+\_\+finfo}}
\index{more\+\_\+finfo@{more\+\_\+finfo}!win32/filestat.\+c@{win32/filestat.\+c}}
\subsubsection[{\texorpdfstring{more\+\_\+finfo(apr\+\_\+finfo\+\_\+t $\ast$finfo, const void $\ast$ufile, apr\+\_\+int32\+\_\+t wanted, int whatfile)}{more_finfo(apr_finfo_t *finfo, const void *ufile, apr_int32_t wanted, int whatfile)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf apr\+\_\+status\+\_\+t} more\+\_\+finfo (
\begin{DoxyParamCaption}
\item[{{\bf apr\+\_\+finfo\+\_\+t} $\ast$}]{finfo, }
\item[{const {\bf void} $\ast$}]{ufile, }
\item[{{\bf apr\+\_\+int32\+\_\+t}}]{wanted, }
\item[{{\bf int}}]{whatfile}
\end{DoxyParamCaption}
)}\hypertarget{win32_2filestat_8c_a49bfa82debf69dc3b85fe94ee9167bc7}{}\label{win32_2filestat_8c_a49bfa82debf69dc3b85fe94ee9167bc7}

\begin{DoxyCode}
215 \{
216     PSID user = \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL}, grp = \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL};
217     PACL dacl = \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL};
218     \hyperlink{group__apr__errno_gaa5105fa83cc322f09382292db8b47593}{apr\_status\_t} rv;
219 
220     \textcolor{keywordflow}{if} (\hyperlink{win32_2apr__arch__misc_8h_a6f3751edc39de5f80b87c6ec5ebe0a07}{apr\_os\_level} < \hyperlink{win32_2apr__arch__misc_8h_a7d104c1993f4306484d5fc6795257402a0b489165a9ea56e1b242a8e2d5882a18}{APR\_WIN\_NT})
221         \textcolor{keywordflow}{return} guess\_protection\_bits(finfo, \hyperlink{group__apr__file__stat_ga48805d2a6845252444835c7809c73ade}{wanted});
222 
223     \textcolor{keywordflow}{if} (\hyperlink{group__apr__file__stat_ga48805d2a6845252444835c7809c73ade}{wanted} & (\hyperlink{group__apr__file__stat_gad902be0636860cb3f8ad76a59abbcd7c}{APR\_FINFO\_PROT} | \hyperlink{group__apr__file__stat_ga27dee9407b38a459c57618098c3920b0}{APR\_FINFO\_OWNER}))
224     \{
225         \textcolor{comment}{/* On NT this request is incredibly expensive, but accurate.}
226 \textcolor{comment}{         * Since the WinNT-only functions below are protected by the}
227 \textcolor{comment}{         * (apr\_os\_level < APR\_WIN\_NT) case above, we need no extra}
228 \textcolor{comment}{         * tests, but remember GetNamedSecurityInfo & GetSecurityInfo}
229 \textcolor{comment}{         * are not supported on 9x.}
230 \textcolor{comment}{         */}
231         SECURITY\_INFORMATION sinf = 0;
232         PSECURITY\_DESCRIPTOR pdesc = \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL};
233         \textcolor{keywordflow}{if} (\hyperlink{group__apr__file__stat_ga48805d2a6845252444835c7809c73ade}{wanted} & (\hyperlink{group__apr__file__stat_ga599d92111a5cca379a06980025044e12}{APR\_FINFO\_USER} | \hyperlink{group__apr__file__stat_gac85e4335fcf91881b11b3e8a4b224aca}{APR\_FINFO\_UPROT}))
234             sinf |= OWNER\_SECURITY\_INFORMATION;
235         \textcolor{keywordflow}{if} (\hyperlink{group__apr__file__stat_ga48805d2a6845252444835c7809c73ade}{wanted} & (\hyperlink{group__apr__file__stat_ga8420798139d34a88678498aa848803ff}{APR\_FINFO\_GROUP} | \hyperlink{group__apr__file__stat_gadfa294303e34528b1fcae1bc009140c1}{APR\_FINFO\_GPROT}))
236             sinf |= GROUP\_SECURITY\_INFORMATION;
237         \textcolor{keywordflow}{if} (\hyperlink{group__apr__file__stat_ga48805d2a6845252444835c7809c73ade}{wanted} & \hyperlink{group__apr__file__stat_gad902be0636860cb3f8ad76a59abbcd7c}{APR\_FINFO\_PROT})
238             sinf |= DACL\_SECURITY\_INFORMATION;
239         \textcolor{keywordflow}{if} (whatfile == \hyperlink{win32_2apr__arch__file__io_8h_a72970499a331b3039b3cd64769674b97}{MORE\_OF\_WFSPEC}) \{
240             \hyperlink{apr__arch__utf8_8h_a72c93c6f539bceb60f263635adeb71b6}{apr\_wchar\_t} *wfile = (\hyperlink{apr__arch__utf8_8h_a72c93c6f539bceb60f263635adeb71b6}{apr\_wchar\_t}*) ufile;
241             \textcolor{keywordtype}{int} fix = 0;
242             \textcolor{keywordflow}{if} (wcsncmp(wfile, \hyperlink{mod__lua_8h_a62f94dfc0036bec0c14106c2f15caf3e}{L}\textcolor{stringliteral}{"\(\backslash\)\(\backslash\)\(\backslash\)\(\backslash\)?\(\backslash\)\(\backslash\)"}, 4) == 0) \{
243                 fix = 4;
244                 \textcolor{keywordflow}{if} (wcsncmp(wfile + fix, \hyperlink{mod__lua_8h_a62f94dfc0036bec0c14106c2f15caf3e}{L}\textcolor{stringliteral}{"UNC\(\backslash\)\(\backslash\)"}, 4) == 0)
245                     wfile[6] = \hyperlink{mod__lua_8h_a62f94dfc0036bec0c14106c2f15caf3e}{L}\textcolor{charliteral}{'\(\backslash\)\(\backslash\)'}, fix = 6;
246             \}
247             rv = \hyperlink{win32_2apr__arch__misc_8h_a0fc06ac97313512c4ea1e7f2c1786baa}{GetNamedSecurityInfoW}(wfile + fix, 
248                                  SE\_FILE\_OBJECT, sinf,
249                                  ((\hyperlink{group__apr__file__stat_ga48805d2a6845252444835c7809c73ade}{wanted} & (\hyperlink{group__apr__file__stat_ga599d92111a5cca379a06980025044e12}{APR\_FINFO\_USER} | 
      \hyperlink{group__apr__file__stat_gac85e4335fcf91881b11b3e8a4b224aca}{APR\_FINFO\_UPROT})) ? &user : \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL}),
250                                  ((\hyperlink{group__apr__file__stat_ga48805d2a6845252444835c7809c73ade}{wanted} & (\hyperlink{group__apr__file__stat_ga8420798139d34a88678498aa848803ff}{APR\_FINFO\_GROUP} | 
      \hyperlink{group__apr__file__stat_gadfa294303e34528b1fcae1bc009140c1}{APR\_FINFO\_GPROT})) ? &grp : NULL),
251                                  ((\hyperlink{group__apr__file__stat_ga48805d2a6845252444835c7809c73ade}{wanted} & APR\_FINFO\_PROT) ? &dacl : NULL),
252                                  NULL, &pdesc);
253             \textcolor{keywordflow}{if} (fix == 6)
254                 wfile[6] = \hyperlink{mod__lua_8h_a62f94dfc0036bec0c14106c2f15caf3e}{L}\textcolor{charliteral}{'C'};
255         \}
256         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (whatfile == \hyperlink{win32_2apr__arch__file__io_8h_a70ed393d5dd2d328c4c70d3a349e917b}{MORE\_OF\_FSPEC})
257             rv = \hyperlink{win32_2apr__arch__misc_8h_a904dbc234f2148cc87fd51686f365a40}{GetNamedSecurityInfoA}((\textcolor{keywordtype}{char}*)ufile, 
258                                  SE\_FILE\_OBJECT, sinf,
259                                  ((\hyperlink{group__apr__file__stat_ga48805d2a6845252444835c7809c73ade}{wanted} & (\hyperlink{group__apr__file__stat_ga599d92111a5cca379a06980025044e12}{APR\_FINFO\_USER} | 
      \hyperlink{group__apr__file__stat_gac85e4335fcf91881b11b3e8a4b224aca}{APR\_FINFO\_UPROT})) ? &user : NULL),
260                                  ((\hyperlink{group__apr__file__stat_ga48805d2a6845252444835c7809c73ade}{wanted} & (\hyperlink{group__apr__file__stat_ga8420798139d34a88678498aa848803ff}{APR\_FINFO\_GROUP} | 
      \hyperlink{group__apr__file__stat_gadfa294303e34528b1fcae1bc009140c1}{APR\_FINFO\_GPROT})) ? &grp : NULL),
261                                  ((\hyperlink{group__apr__file__stat_ga48805d2a6845252444835c7809c73ade}{wanted} & APR\_FINFO\_PROT) ? &dacl : NULL),
262                                  NULL, &pdesc);
263         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (whatfile == \hyperlink{win32_2apr__arch__file__io_8h_a5e5d984afdd0b21fe0b0900347beef54}{MORE\_OF\_HANDLE})
264             rv = \hyperlink{win32_2apr__arch__misc_8h_a45d53c6898aeb773720a1a941e4a5230}{GetSecurityInfo}((HANDLE)ufile, 
265                                  SE\_FILE\_OBJECT, sinf,
266                                  ((\hyperlink{group__apr__file__stat_ga48805d2a6845252444835c7809c73ade}{wanted} & (\hyperlink{group__apr__file__stat_ga599d92111a5cca379a06980025044e12}{APR\_FINFO\_USER} | 
      \hyperlink{group__apr__file__stat_gac85e4335fcf91881b11b3e8a4b224aca}{APR\_FINFO\_UPROT})) ? &user : NULL),
267                                  ((\hyperlink{group__apr__file__stat_ga48805d2a6845252444835c7809c73ade}{wanted} & (\hyperlink{group__apr__file__stat_ga8420798139d34a88678498aa848803ff}{APR\_FINFO\_GROUP} | 
      \hyperlink{group__apr__file__stat_gadfa294303e34528b1fcae1bc009140c1}{APR\_FINFO\_GPROT})) ? &grp : NULL),
268                                  ((\hyperlink{group__apr__file__stat_ga48805d2a6845252444835c7809c73ade}{wanted} & APR\_FINFO\_PROT) ? &dacl : NULL),
269                                  NULL, &pdesc);
270         \textcolor{keywordflow}{else}
271             \textcolor{keywordflow}{return} \hyperlink{group__APR__Error_ga64dff43b83bcefd3f3c751be6b864ca1}{APR\_INCOMPLETE}; \textcolor{comment}{/* should not occur */}
272         \textcolor{keywordflow}{if} (rv == \hyperlink{group__MOD__ISAPI_gaea0ae801b7d25c979655a7eb20d034af}{ERROR\_SUCCESS})
273             apr\_pool\_cleanup\_register(finfo->\hyperlink{structapr__finfo__t_a71496f86b5489c87e58e9c03fe468fb8}{pool}, pdesc, free\_localheap, 
274                                  apr\_pool\_cleanup\_null);
275         \textcolor{keywordflow}{else}
276             user = grp = dacl = \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL};
277 
278         \textcolor{keywordflow}{if} (user) \{
279             finfo->\hyperlink{structapr__finfo__t_ab79d14bd50f50662d29ad433166c4bc5}{user} = user;
280             finfo->\hyperlink{structapr__finfo__t_aff0cdf06637edec63c4701e582792019}{valid} |= \hyperlink{group__apr__file__stat_ga599d92111a5cca379a06980025044e12}{APR\_FINFO\_USER};
281         \}
282 
283         \textcolor{keywordflow}{if} (grp) \{
284             finfo->\hyperlink{structapr__finfo__t_a15c9c056330308de4dafb3826a9b02bc}{group} = grp;
285             finfo->\hyperlink{structapr__finfo__t_aff0cdf06637edec63c4701e582792019}{valid} |= \hyperlink{group__apr__file__stat_ga8420798139d34a88678498aa848803ff}{APR\_FINFO\_GROUP};
286         \}
287 
288         \textcolor{keywordflow}{if} (dacl) \{
289             \textcolor{comment}{/* Retrieved the discresionary access list */}
290             resolve\_prot(finfo, \hyperlink{group__apr__file__stat_ga48805d2a6845252444835c7809c73ade}{wanted}, dacl);
291         \}
292         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{group__apr__file__stat_ga48805d2a6845252444835c7809c73ade}{wanted} & APR\_FINFO\_PROT)
293             guess\_protection\_bits(finfo, \hyperlink{group__apr__file__stat_ga48805d2a6845252444835c7809c73ade}{wanted});
294     \}
295 
296     \textcolor{keywordflow}{if} ((\hyperlink{win32_2apr__arch__misc_8h_a6f3751edc39de5f80b87c6ec5ebe0a07}{apr\_os\_level} >= \hyperlink{win32_2apr__arch__misc_8h_a7d104c1993f4306484d5fc6795257402aa671d1d921e5dd75518dfd6fba2ce5b5}{APR\_WIN\_2000}) && (\hyperlink{group__apr__file__stat_ga48805d2a6845252444835c7809c73ade}{wanted} & 
      \hyperlink{group__apr__file__stat_gaf87a09b89935d730cb1ade80d5b6ada0}{APR\_FINFO\_CSIZE})
297                                        && (finfo->\hyperlink{structapr__finfo__t_a274ae0dd60b59182c2e0134bc9a09a20}{filetype} == \hyperlink{group__apr__file__info_ggae3f0ce3014337a52b39852f8bf81ca7ca9a2849ad21618c937683c1ffe13a6257}{APR\_REG}))
298     \{
299         DWORD sizelo, sizehi;
300         \textcolor{keywordflow}{if} (whatfile == \hyperlink{win32_2apr__arch__file__io_8h_a5e5d984afdd0b21fe0b0900347beef54}{MORE\_OF\_HANDLE}) \{
301             \textcolor{comment}{/* Not available for development and implementation under}
302 \textcolor{comment}{             * a reasonable license; if you review the licensing}
303 \textcolor{comment}{             * terms and conditions of;}
304 \textcolor{comment}{             *   http://go.microsoft.com/fwlink/?linkid=84083}
305 \textcolor{comment}{             * you probably understand why APR chooses not to implement.}
306 \textcolor{comment}{             */}
307             \hyperlink{structIOSB}{IOSB} sb;
308             \hyperlink{structFSI}{FSI} \hyperlink{pcre__exec_8c_ad4fc2abd8f65bfb50ef452d359f38802}{fi};
309             \textcolor{keywordflow}{if} ((\hyperlink{win32_2apr__arch__misc_8h_a84e7010d21e799361749d317120056f8}{ZwQueryInformationFile}((HANDLE)ufile, &sb, 
310                                        &fi, \textcolor{keyword}{sizeof}(fi), 5) == 0) 
311                     && (sb.\hyperlink{structIOSB_a2b17ec69f3b2eeec3baa6e195c117e2b}{Status} == 0)) \{
312                 finfo->\hyperlink{structapr__finfo__t_aeaa4a4def98ad4f162e05c2e2292321d}{csize} = fi.\hyperlink{structFSI_ad4c33115c6f5c1077bcdc8cb1fb6d599}{AllocationSize};
313                 finfo->\hyperlink{structapr__finfo__t_aff0cdf06637edec63c4701e582792019}{valid} |= \hyperlink{group__apr__file__stat_gaf87a09b89935d730cb1ade80d5b6ada0}{APR\_FINFO\_CSIZE};
314             \}
315         \}
316         \textcolor{keywordflow}{else} \{
317             SetLastError(NO\_ERROR);
318             \textcolor{keywordflow}{if} (whatfile == \hyperlink{win32_2apr__arch__file__io_8h_a72970499a331b3039b3cd64769674b97}{MORE\_OF\_WFSPEC})
319                 sizelo = \hyperlink{win32_2apr__arch__misc_8h_ae68bf28e7c96ef22d1a622e1357477b2}{GetCompressedFileSizeW}((
      \hyperlink{apr__arch__utf8_8h_a72c93c6f539bceb60f263635adeb71b6}{apr\_wchar\_t}*)ufile, &sizehi);
320             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (whatfile == \hyperlink{win32_2apr__arch__file__io_8h_a70ed393d5dd2d328c4c70d3a349e917b}{MORE\_OF\_FSPEC})
321                 sizelo = \hyperlink{win32_2apr__arch__misc_8h_a7862c9e6fe0d655cf678ab3d513ffc00}{GetCompressedFileSizeA}((\textcolor{keywordtype}{char}*)ufile, &sizehi);
322             \textcolor{keywordflow}{else}
323                 \textcolor{keywordflow}{return} \hyperlink{group__APR__Error_ga18f5678bea0c2c704a2b6a186c9e158b}{APR\_EGENERAL}; \textcolor{comment}{/* should not occur */}
324         
325             \textcolor{keywordflow}{if} (sizelo != INVALID\_FILE\_SIZE || GetLastError() == NO\_ERROR) \{
326 \textcolor{preprocessor}{#if APR\_HAS\_LARGE\_FILES}
327                 finfo->\hyperlink{structapr__finfo__t_aeaa4a4def98ad4f162e05c2e2292321d}{csize} =  (\hyperlink{group__apr__platform_ga6938af9075cec15c88299109381aa984}{apr\_off\_t})sizelo
328                              | ((\hyperlink{group__apr__platform_ga6938af9075cec15c88299109381aa984}{apr\_off\_t})sizehi << 32);
329 \textcolor{preprocessor}{#else}
330                 finfo->\hyperlink{structapr__finfo__t_aeaa4a4def98ad4f162e05c2e2292321d}{csize} = (\hyperlink{group__apr__platform_ga6938af9075cec15c88299109381aa984}{apr\_off\_t})sizelo;
331                 \textcolor{keywordflow}{if} (finfo->\hyperlink{structapr__finfo__t_aeaa4a4def98ad4f162e05c2e2292321d}{csize} < 0 || sizehi)
332                     finfo->\hyperlink{structapr__finfo__t_aeaa4a4def98ad4f162e05c2e2292321d}{csize} = 0x7fffffff;
333 \textcolor{preprocessor}{#endif}
334                 finfo->\hyperlink{structapr__finfo__t_aff0cdf06637edec63c4701e582792019}{valid} |= \hyperlink{group__apr__file__stat_gaf87a09b89935d730cb1ade80d5b6ada0}{APR\_FINFO\_CSIZE};
335             \}
336         \}
337     \}
338     \textcolor{keywordflow}{return} ((\hyperlink{group__apr__file__stat_ga48805d2a6845252444835c7809c73ade}{wanted} & ~finfo->\hyperlink{structapr__finfo__t_aff0cdf06637edec63c4701e582792019}{valid}) ? \hyperlink{group__APR__Error_ga64dff43b83bcefd3f3c751be6b864ca1}{APR\_INCOMPLETE} : 
      \hyperlink{group__apr__errno_ga9ee311b7bf1c691dc521d721339ee2a6}{APR\_SUCCESS});
339 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=269pt]{win32_2filestat_8c_a49bfa82debf69dc3b85fe94ee9167bc7_icgraph}
\end{center}
\end{figure}


