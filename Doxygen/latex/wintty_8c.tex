\hypertarget{wintty_8c}{}\section{/usr/local/src/github/\+Codebase/httpd-\/2.4.29/support/win32/wintty.c File Reference}
\label{wintty_8c}\index{/usr/local/src/github/\+Codebase/httpd-\/2.\+4.\+29/support/win32/wintty.\+c@{/usr/local/src/github/\+Codebase/httpd-\/2.\+4.\+29/support/win32/wintty.\+c}}
{\ttfamily \#include $<$windows.\+h$>$}\\*
{\ttfamily \#include $<$stdlib.\+h$>$}\\*
{\ttfamily \#include $<$stdio.\+h$>$}\\*
Include dependency graph for wintty.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=274pt]{wintty_8c__incl}
\end{center}
\end{figure}
\subsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structfeedback__args__t}{feedback\+\_\+args\+\_\+t}
\end{DoxyCompactItemize}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{wintty_8c_ac7bef5d85e3dcd73eef56ad39ffc84a9}{W\+I\+N32\+\_\+\+L\+E\+A\+N\+\_\+\+A\+N\+D\+\_\+\+M\+E\+AN}
\end{DoxyCompactItemize}
\subsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef struct \hyperlink{structfeedback__args__t}{feedback\+\_\+args\+\_\+t} \hyperlink{wintty_8c_a998da5eca90ca0d877edae17b40a3612}{feedback\+\_\+args\+\_\+t}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{group__MOD__ISAPI_gacd6cdbf73df3d9eed42fa493d9b621a6}{void} \hyperlink{wintty_8c_acbaa5978703f6f7019c1b2981a7b8597}{printerr} (char $\ast$\hyperlink{group__APR__Util__Bucket__Brigades_ga8356c67426e3ca8df15ac6756f1fd0a7}{fmt},...)
\item 
D\+W\+O\+RD W\+I\+N\+A\+PI \hyperlink{wintty_8c_a1c5747038fd5235500e99a74a49fbfec}{feedback} (L\+P\+V\+O\+ID \hyperlink{group__APR__Util__DBD_ga6b6dfca544bdc17e0e73e3ca56c2363d}{args})
\item 
\hyperlink{pcre_8txt_a42dfa4ff673c82d8efe7144098fbc198}{int} \hyperlink{wintty_8c_a3c04138a5bfe5d72780bb7e82a18e627}{main} (\hyperlink{pcre_8txt_a42dfa4ff673c82d8efe7144098fbc198}{int} \hyperlink{group__apr__getopt_ga6bdebf9385dc069c90aa21989641be02}{argc}, char $\ast$$\ast$\hyperlink{group__apr__getopt_ga675a108e956f4e2ea74dae8d26e6273e}{argv})
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
const char $\ast$ \hyperlink{wintty_8c_a0ce029c8445f3334f925e47366467e34}{options}
\item 
\hyperlink{pcre__internal_8h_a050c65e107f0c828f856a231f4b4e788}{B\+O\+OL} \hyperlink{wintty_8c_ad023bbf13e60f8caee82c26f70e0f0a5}{verbose} = \hyperlink{pcregrep_8c_aa93f0eb578d23995850d61f7d61c55c1}{F\+A\+L\+SE}
\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\index{wintty.\+c@{wintty.\+c}!W\+I\+N32\+\_\+\+L\+E\+A\+N\+\_\+\+A\+N\+D\+\_\+\+M\+E\+AN@{W\+I\+N32\+\_\+\+L\+E\+A\+N\+\_\+\+A\+N\+D\+\_\+\+M\+E\+AN}}
\index{W\+I\+N32\+\_\+\+L\+E\+A\+N\+\_\+\+A\+N\+D\+\_\+\+M\+E\+AN@{W\+I\+N32\+\_\+\+L\+E\+A\+N\+\_\+\+A\+N\+D\+\_\+\+M\+E\+AN}!wintty.\+c@{wintty.\+c}}
\subsubsection[{\texorpdfstring{W\+I\+N32\+\_\+\+L\+E\+A\+N\+\_\+\+A\+N\+D\+\_\+\+M\+E\+AN}{WIN32_LEAN_AND_MEAN}}]{\setlength{\rightskip}{0pt plus 5cm}\#define W\+I\+N32\+\_\+\+L\+E\+A\+N\+\_\+\+A\+N\+D\+\_\+\+M\+E\+AN}\hypertarget{wintty_8c_ac7bef5d85e3dcd73eef56ad39ffc84a9}{}\label{wintty_8c_ac7bef5d85e3dcd73eef56ad39ffc84a9}


\subsection{Typedef Documentation}
\index{wintty.\+c@{wintty.\+c}!feedback\+\_\+args\+\_\+t@{feedback\+\_\+args\+\_\+t}}
\index{feedback\+\_\+args\+\_\+t@{feedback\+\_\+args\+\_\+t}!wintty.\+c@{wintty.\+c}}
\subsubsection[{\texorpdfstring{feedback\+\_\+args\+\_\+t}{feedback_args_t}}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf feedback\+\_\+args\+\_\+t}  {\bf feedback\+\_\+args\+\_\+t}}\hypertarget{wintty_8c_a998da5eca90ca0d877edae17b40a3612}{}\label{wintty_8c_a998da5eca90ca0d877edae17b40a3612}


\subsection{Function Documentation}
\index{wintty.\+c@{wintty.\+c}!feedback@{feedback}}
\index{feedback@{feedback}!wintty.\+c@{wintty.\+c}}
\subsubsection[{\texorpdfstring{feedback(\+L\+P\+V\+O\+I\+D args)}{feedback(LPVOID args)}}]{\setlength{\rightskip}{0pt plus 5cm}D\+W\+O\+RD W\+I\+N\+A\+PI feedback (
\begin{DoxyParamCaption}
\item[{L\+P\+V\+O\+ID}]{args}
\end{DoxyParamCaption}
)}\hypertarget{wintty_8c_a1c5747038fd5235500e99a74a49fbfec}{}\label{wintty_8c_a1c5747038fd5235500e99a74a49fbfec}

\begin{DoxyCode}
362 \{
363     \hyperlink{structfeedback__args__t}{feedback\_args\_t} *feed = (\hyperlink{structfeedback__args__t}{feedback\_args\_t}*)\hyperlink{group__APACHE__CORE__LISTEN_ga71f9d4c76ff7cd8f3db5697a5cfa7b08}{arg};
364     \textcolor{keywordtype}{char} *\hyperlink{group__MOD__DAV_gaab9226fe8f632e1f998e24276d478f30}{str}[1024];
365     DWORD \hyperlink{group__APACHE__CORE__LOG_gab5a43233d60ef05c5b5bf5cba3d74468}{len};
366 
367     \textcolor{keywordflow}{while} (ReadFile(feed->\hyperlink{structfeedback__args__t_a5f9548d0f1f6feec0db1b75db26f75df}{in}, str, \textcolor{keyword}{sizeof}(str), &len, \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL}))
368         \textcolor{keywordflow}{if} (!len || !WriteFile(feed->\hyperlink{structfeedback__args__t_a29c6e9f0c5de7561f99f7303e3ddb4ca}{out}, str, len, &len, \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL}))
369             \textcolor{keywordflow}{break};
370 
371     \hyperlink{wintty_8c_acbaa5978703f6f7019c1b2981a7b8597}{printerr}(\textcolor{stringliteral}{"[EOF] from Console (%d)\(\backslash\)n"}, GetLastError());
372 
373     \textcolor{keywordflow}{return} 0;
374 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=219pt]{wintty_8c_a1c5747038fd5235500e99a74a49fbfec_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=293pt]{wintty_8c_a1c5747038fd5235500e99a74a49fbfec_icgraph}
\end{center}
\end{figure}


\index{wintty.\+c@{wintty.\+c}!main@{main}}
\index{main@{main}!wintty.\+c@{wintty.\+c}}
\subsubsection[{\texorpdfstring{main(int argc, char $\ast$$\ast$argv)}{main(int argc, char **argv)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf int} main (
\begin{DoxyParamCaption}
\item[{{\bf int}}]{argc, }
\item[{char $\ast$$\ast$}]{argv}
\end{DoxyParamCaption}
)}\hypertarget{wintty_8c_a3c04138a5bfe5d72780bb7e82a18e627}{}\label{wintty_8c_a3c04138a5bfe5d72780bb7e82a18e627}

\begin{DoxyCode}
83 \{
84     \textcolor{keywordtype}{char} \hyperlink{group__MOD__DAV_gaab9226fe8f632e1f998e24276d478f30}{str}[1024], *contitle = \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL};
85     HANDLE hproc, \hyperlink{group__apr__thread__proc_ga188dd007cf9d8f4d1f258aaf0bc2c2c9}{thread};
86     HANDLE hwinsta = \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL}, hsavewinsta;
87     HANDLE hdesk = \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL}, hsavedesk = \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL};
88     HANDLE conin, conout;
89     HANDLE hstdin, hstdout, hstderr, hdup;
90     \hyperlink{structfeedback__args__t}{feedback\_args\_t} feed;
91     DWORD conmode;
92     DWORD newinmode = 0, notinmode = 0;
93     DWORD newoutmode = 0, notoutmode = 0;
94     DWORD tid;
95     DWORD \hyperlink{group__APACHE__CORE__LOG_gab5a43233d60ef05c5b5bf5cba3d74468}{len};
96     DWORD \hyperlink{group__APACHE__CORE__DAEMON_ga48b7aa88e5841c0fe69f7d9a88646af3}{timeout} = INFINITE;
97     \hyperlink{pcre__internal_8h_a050c65e107f0c828f856a231f4b4e788}{BOOL} isservice = \hyperlink{group__MOD__SSL__PRIVATE_gaa93f0eb578d23995850d61f7d61c55c1}{FALSE};
98     \textcolor{keywordtype}{char} *arg0 = \hyperlink{group__APACHE__CORE__LISTEN_ga7af4ef3a08f923773e59081c357d9adf}{argv}[0];
99 
100     \textcolor{keywordflow}{while} (--\hyperlink{group__APACHE__CORE__LISTEN_ga073cc653debb351b563a84ac72c49614}{argc}) \{
101         ++\hyperlink{group__APACHE__CORE__LISTEN_ga7af4ef3a08f923773e59081c357d9adf}{argv};
102         \textcolor{keywordflow}{if} (**\hyperlink{group__APACHE__CORE__LISTEN_ga7af4ef3a08f923773e59081c357d9adf}{argv} == \textcolor{charliteral}{'/'} || **\hyperlink{group__APACHE__CORE__LISTEN_ga7af4ef3a08f923773e59081c357d9adf}{argv} == \textcolor{charliteral}{'-'}) \{
103             \textcolor{keywordflow}{switch} (tolower((*\hyperlink{group__APACHE__CORE__LISTEN_ga7af4ef3a08f923773e59081c357d9adf}{argv})[1])) \{
104                 \textcolor{keywordflow}{case} \textcolor{charliteral}{'c'}:
105                     notinmode |= ENABLE\_LINE\_INPUT;          \textcolor{keywordflow}{break};
106                 \textcolor{keywordflow}{case} \textcolor{charliteral}{'l'}:
107                     newinmode |= ENABLE\_LINE\_INPUT;          \textcolor{keywordflow}{break};
108                 \textcolor{keywordflow}{case} \textcolor{charliteral}{'q'}:
109                     notinmode |= ENABLE\_ECHO\_INPUT;          \textcolor{keywordflow}{break};
110                 \textcolor{keywordflow}{case} \textcolor{charliteral}{'e'}:
111                     newinmode |= ENABLE\_ECHO\_INPUT;          \textcolor{keywordflow}{break};
112                 \textcolor{keywordflow}{case} \textcolor{charliteral}{'u'}:
113                     notinmode |= ENABLE\_PROCESSED\_INPUT;     \textcolor{keywordflow}{break};
114                 \textcolor{keywordflow}{case} \textcolor{charliteral}{'p'}:
115                     newinmode |= ENABLE\_PROCESSED\_INPUT;     \textcolor{keywordflow}{break};
116                 \textcolor{keywordflow}{case} \textcolor{charliteral}{'n'}:
117                     notoutmode |= ENABLE\_WRAP\_AT\_EOL\_OUTPUT; \textcolor{keywordflow}{break};
118                 \textcolor{keywordflow}{case} \textcolor{charliteral}{'w'}:
119                     newoutmode |= ENABLE\_WRAP\_AT\_EOL\_OUTPUT; \textcolor{keywordflow}{break};
120                 \textcolor{keywordflow}{case} \textcolor{charliteral}{'r'}:
121                     notoutmode |= ENABLE\_PROCESSED\_OUTPUT;   \textcolor{keywordflow}{break};
122                 \textcolor{keywordflow}{case} \textcolor{charliteral}{'f'}:
123                     newoutmode |= ENABLE\_PROCESSED\_OUTPUT;   \textcolor{keywordflow}{break};
124                 \textcolor{keywordflow}{case} \textcolor{charliteral}{'o'}:
125                     \textcolor{keywordflow}{if} (*(\hyperlink{group__APACHE__CORE__LISTEN_ga7af4ef3a08f923773e59081c357d9adf}{argv} + 1) && *(\hyperlink{group__APACHE__CORE__LISTEN_ga7af4ef3a08f923773e59081c357d9adf}{argv} + 1)[0] != \textcolor{charliteral}{'-'}) \{
126                         *(++\hyperlink{group__APACHE__CORE__LISTEN_ga7af4ef3a08f923773e59081c357d9adf}{argv});
127                         timeout = atoi(*\hyperlink{group__APACHE__CORE__LISTEN_ga7af4ef3a08f923773e59081c357d9adf}{argv}) / 1000;
128                         --\hyperlink{group__APACHE__CORE__LISTEN_ga073cc653debb351b563a84ac72c49614}{argc};
129                     \}
130                     \textcolor{keywordflow}{else} \{
131                         timeout = 0;
132                     \}
133                     \textcolor{keywordflow}{break};
134                 \textcolor{keywordflow}{case} \textcolor{charliteral}{'v'}:
135                     \hyperlink{wintty_8c_ad023bbf13e60f8caee82c26f70e0f0a5}{verbose} = \hyperlink{group__MOD__SSL__PRIVATE_gaa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
136                     \textcolor{keywordflow}{break};
137                 \textcolor{keywordflow}{case} \textcolor{charliteral}{'t'}:
138                     contitle = *(++\hyperlink{group__APACHE__CORE__LISTEN_ga7af4ef3a08f923773e59081c357d9adf}{argv});
139                     --\hyperlink{group__APACHE__CORE__LISTEN_ga073cc653debb351b563a84ac72c49614}{argc};
140                     \textcolor{keywordflow}{break};
141                 \textcolor{keywordflow}{case} \textcolor{charliteral}{'?'}:
142                     printf(\hyperlink{wintty_8c_a0ce029c8445f3334f925e47366467e34}{options}, arg0);
143                     \hyperlink{group__APACHE__OS__NETWARE_gaac7f3a566d7243651a356db3fcfef6b1}{exit}(1);
144                 \textcolor{keywordflow}{default}:
145                     printf(\textcolor{stringliteral}{"wintty option %s not recognized, use -? for help.\(\backslash\)n\(\backslash\)n"}, *
      \hyperlink{group__APACHE__CORE__LISTEN_ga7af4ef3a08f923773e59081c357d9adf}{argv});
146                     \hyperlink{group__APACHE__OS__NETWARE_gaac7f3a566d7243651a356db3fcfef6b1}{exit}(1);
147             \}
148         \}
149         \textcolor{keywordflow}{else} \{
150             printf(\textcolor{stringliteral}{"wintty argument %s not understood, use -? for help.\(\backslash\)n\(\backslash\)n"}, *
      \hyperlink{group__APACHE__CORE__LISTEN_ga7af4ef3a08f923773e59081c357d9adf}{argv});
151             \hyperlink{group__APACHE__OS__NETWARE_gaac7f3a566d7243651a356db3fcfef6b1}{exit}(1);
152         \}
153     \}
154 
155     hproc = \hyperlink{apr__dbg__win32__handles_8h_a8bc60b5c4580a54ee5a07107eb49f38d}{GetCurrentProcess}();
156     hsavewinsta = GetProcessWindowStation();
157     \textcolor{keywordflow}{if} (!hsavewinsta || hsavewinsta == INVALID\_HANDLE\_VALUE) \{
158         \hyperlink{wintty_8c_acbaa5978703f6f7019c1b2981a7b8597}{printerr}(\textcolor{stringliteral}{"GetProcessWindowStation() failed (%d)\(\backslash\)n"}, GetLastError());
159     \}
160     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (!GetUserObjectInformation(hsavewinsta, UOI\_NAME, str, \textcolor{keyword}{sizeof}(str), &len)) \{
161         \hyperlink{wintty_8c_acbaa5978703f6f7019c1b2981a7b8597}{printerr}(\textcolor{stringliteral}{"GetUserObjectInfoformation(hWinSta) failed (%d)\(\backslash\)n"}, GetLastError());
162     \}
163     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (strnicmp(str, \textcolor{stringliteral}{"Service-"}, 8) == 0) \{
164         \hyperlink{wintty_8c_acbaa5978703f6f7019c1b2981a7b8597}{printerr}(\textcolor{stringliteral}{"WindowStation Name %s is a service\(\backslash\)n"}, str);
165         isservice = \hyperlink{group__MOD__SSL__PRIVATE_gaa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
166     \}
167     SetLastError(0);
168 
169     hstdin = \hyperlink{apr__dbg__win32__handles_8h_a16fcc45598adb71ea9a265ce05b200bb}{GetStdHandle}(STD\_INPUT\_HANDLE);
170     \textcolor{keywordflow}{if} (!hstdin || hstdin == INVALID\_HANDLE\_VALUE) \{
171         \hyperlink{wintty_8c_acbaa5978703f6f7019c1b2981a7b8597}{printerr}(\textcolor{stringliteral}{"GetStdHandle(STD\_INPUT\_HANDLE) failed (%d)\(\backslash\)n"},
172                  GetLastError());
173     \}
174     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{apr__dbg__win32__handles_8h_ad1a84fa9bd5957fc2f64dbd48bb66da5}{DuplicateHandle}(hproc, hstdin, hproc, &hdup, 0,
175                              isservice, DUPLICATE\_SAME\_ACCESS)) \{
176         \hyperlink{apr__dbg__win32__handles_8h_af89311c05c734797c91f635e50bec804}{CloseHandle}(hstdin);
177         hstdin = hdup;
178     \}
179     \textcolor{keywordflow}{else} \{
180         \hyperlink{wintty_8c_acbaa5978703f6f7019c1b2981a7b8597}{printerr}(\textcolor{stringliteral}{"DupHandle(stdin [%x]) failed (%d)\(\backslash\)n"},
181                  hstdin, GetLastError());
182     \}
183 
184     hstdout = \hyperlink{apr__dbg__win32__handles_8h_a16fcc45598adb71ea9a265ce05b200bb}{GetStdHandle}(STD\_OUTPUT\_HANDLE);
185     \textcolor{keywordflow}{if} (!hstdout || hstdout == INVALID\_HANDLE\_VALUE) \{
186         \hyperlink{wintty_8c_acbaa5978703f6f7019c1b2981a7b8597}{printerr}(\textcolor{stringliteral}{"GetStdHandle(STD\_OUTPUT\_HANDLE) failed (%d)\(\backslash\)n"},
187                  GetLastError());
188     \}
189     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{apr__dbg__win32__handles_8h_ad1a84fa9bd5957fc2f64dbd48bb66da5}{DuplicateHandle}(hproc, hstdout, hproc, &hdup, 0,
190                              isservice, DUPLICATE\_SAME\_ACCESS)) \{
191         \hyperlink{apr__dbg__win32__handles_8h_af89311c05c734797c91f635e50bec804}{CloseHandle}(hstdout);
192         hstdout = hdup;
193     \}
194     \textcolor{keywordflow}{else} \{
195         \hyperlink{wintty_8c_acbaa5978703f6f7019c1b2981a7b8597}{printerr}(\textcolor{stringliteral}{"DupHandle(stdout [%x]) failed (%d)\(\backslash\)n"},
196                  hstdout, GetLastError());
197     \}
198 
199     hstderr = \hyperlink{apr__dbg__win32__handles_8h_a16fcc45598adb71ea9a265ce05b200bb}{GetStdHandle}(STD\_ERROR\_HANDLE);
200     \textcolor{keywordflow}{if} (!hstderr || hstderr == INVALID\_HANDLE\_VALUE) \{
201         \hyperlink{wintty_8c_acbaa5978703f6f7019c1b2981a7b8597}{printerr}(\textcolor{stringliteral}{"GetStdHandle(STD\_ERROR\_HANDLE) failed (%d)\(\backslash\)n"},
202                  GetLastError());
203     \}
204     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{apr__dbg__win32__handles_8h_ad1a84fa9bd5957fc2f64dbd48bb66da5}{DuplicateHandle}(hproc, hstderr, hproc, &hdup, 0,
205                              isservice, DUPLICATE\_SAME\_ACCESS)) \{
206         \hyperlink{apr__dbg__win32__handles_8h_af89311c05c734797c91f635e50bec804}{CloseHandle}(hstderr);
207         hstderr = hdup;
208     \}
209     \textcolor{keywordflow}{else} \{
210         \hyperlink{wintty_8c_acbaa5978703f6f7019c1b2981a7b8597}{printerr}(\textcolor{stringliteral}{"DupHandle(stderr [%x]) failed (%d)\(\backslash\)n"},
211                  hstderr, GetLastError());
212     \}
213 
214     \textcolor{comment}{/* You can't close the console till all the handles above were}
215 \textcolor{comment}{     * rescued by DuplicateHandle()}
216 \textcolor{comment}{     */}
217     \textcolor{keywordflow}{if} (!FreeConsole())
218         \hyperlink{wintty_8c_acbaa5978703f6f7019c1b2981a7b8597}{printerr}(\textcolor{stringliteral}{"FreeConsole() failed (%d)\(\backslash\)n"}, GetLastError());
219 
220     \textcolor{keywordflow}{if} (isservice) \{
221 \textcolor{preprocessor}{#ifdef WE\_EVER\_FIGURE\_OUT\_WHY\_THIS\_DOESNT\_WORK}
222         hsavedesk = GetThreadDesktop(GetCurrentThreadId());
223         \textcolor{keywordflow}{if} (!hsavedesk || hsavedesk == INVALID\_HANDLE\_VALUE) \{
224             \hyperlink{wintty_8c_acbaa5978703f6f7019c1b2981a7b8597}{printerr}(\textcolor{stringliteral}{"GetThreadDesktop(GetTID()) failed (%d)\(\backslash\)n"}, GetLastError());
225         \}
226         CloseWindowStation(hwinsta);
227         hwinsta = OpenWindowStation(\textcolor{stringliteral}{"WinSta0"}, \hyperlink{group__MOD__SSL__PRIVATE_gaa8cecfc5c5c054d2875c03e77b7be15d}{TRUE}, MAXIMUM\_ALLOWED);
228         \textcolor{keywordflow}{if} (!hwinsta || hwinsta == INVALID\_HANDLE\_VALUE) \{
229             \hyperlink{wintty_8c_acbaa5978703f6f7019c1b2981a7b8597}{printerr}(\textcolor{stringliteral}{"OpenWinSta(WinSta0) failed (%d)\(\backslash\)n"}, GetLastError());
230         \}
231         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (!SetProcessWindowStation(hwinsta)) \{
232             \hyperlink{wintty_8c_acbaa5978703f6f7019c1b2981a7b8597}{printerr}(\textcolor{stringliteral}{"SetProcWinSta(WinSta0) failed (%d)\(\backslash\)n"}, GetLastError());
233         \}
234         hdesk = OpenDesktop(\textcolor{stringliteral}{"Default"}, 0, \hyperlink{group__MOD__SSL__PRIVATE_gaa8cecfc5c5c054d2875c03e77b7be15d}{TRUE}, MAXIMUM\_ALLOWED);
235         \textcolor{keywordflow}{if} (!hdesk || hdesk == INVALID\_HANDLE\_VALUE) \{
236             \hyperlink{wintty_8c_acbaa5978703f6f7019c1b2981a7b8597}{printerr}(\textcolor{stringliteral}{"OpenDesktop(Default) failed (%d)\(\backslash\)n"}, GetLastError());
237         \}
238         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (!SetThreadDesktop(hdesk)) \{
239             \hyperlink{wintty_8c_acbaa5978703f6f7019c1b2981a7b8597}{printerr}(\textcolor{stringliteral}{"SetThreadDesktop(Default) failed (%d)\(\backslash\)n"}, GetLastError());
240         \}
241 \textcolor{preprocessor}{#else}
242         PROCESS\_INFORMATION pi;
243         STARTUPINFO si;
244         DWORD \hyperlink{group__APACHE__MPM_gae3500b4b917090c23a483eef038d3307}{exitcode} = 1;
245         \textcolor{keywordtype}{char} appbuff[MAX\_PATH];
246         \textcolor{keywordtype}{char} *appname = \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL};
247         \textcolor{keywordtype}{char} *cmdline = GetCommandLine();
248 
249         \textcolor{keywordflow}{if} (!GetModuleFileName(\hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL}, appbuff, \textcolor{keyword}{sizeof}(appbuff))) \{
250             appname = appbuff;
251         \}
252 
253         memset(&si, 0, \textcolor{keyword}{sizeof}(si));
254         si.cb = \textcolor{keyword}{sizeof}(si);
255         si.dwFlags     = STARTF\_USESHOWWINDOW
256                        | STARTF\_USESTDHANDLES;
257         si.lpDesktop   = \textcolor{stringliteral}{"WinSta0\(\backslash\)\(\backslash\)Default"};
258         si.wShowWindow = 1;  \textcolor{comment}{/* SW\_SHOWNORMAL */}
259         si.hStdInput   = hstdin;
260         si.hStdOutput  = hstdout;
261         si.hStdError   = hstderr;
262 
263         \textcolor{comment}{/* Instantly, upon creating the new process, we will close our}
264 \textcolor{comment}{         * copies of the handles so our parent isn't confused when the}
265 \textcolor{comment}{         * child closes their copy of the handle.  Without this action,}
266 \textcolor{comment}{         * we would hold a copy of the handle, and the parent would not}
267 \textcolor{comment}{         * receive their EOF notification.}
268 \textcolor{comment}{         */}
269         \textcolor{keywordflow}{if} (CreateProcess(appname, cmdline, \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL}, \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL}, \hyperlink{group__MOD__SSL__PRIVATE_gaa8cecfc5c5c054d2875c03e77b7be15d}{TRUE},
270                           CREATE\_SUSPENDED | CREATE\_NEW\_CONSOLE,
271                           \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL}, \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL}, &si, &pi)) \{
272             \hyperlink{apr__dbg__win32__handles_8h_af89311c05c734797c91f635e50bec804}{CloseHandle}(si.hStdInput);
273             \hyperlink{apr__dbg__win32__handles_8h_af89311c05c734797c91f635e50bec804}{CloseHandle}(si.hStdOutput);
274             \hyperlink{apr__dbg__win32__handles_8h_af89311c05c734797c91f635e50bec804}{CloseHandle}(si.hStdError);
275             ResumeThread(pi.hThread);
276             \hyperlink{apr__dbg__win32__handles_8h_af89311c05c734797c91f635e50bec804}{CloseHandle}(pi.hThread);
277             \hyperlink{apr__dbg__win32__handles_8h_afc860bc74827299798af7532aab62924}{WaitForSingleObject}(pi.hProcess, INFINITE);
278             GetExitCodeProcess(pi.hProcess, &exitcode);
279             \hyperlink{apr__dbg__win32__handles_8h_af89311c05c734797c91f635e50bec804}{CloseHandle}(pi.hProcess);
280             \textcolor{keywordflow}{return} \hyperlink{group__APACHE__MPM_gae3500b4b917090c23a483eef038d3307}{exitcode};
281         \}
282         \textcolor{keywordflow}{return} 1;
283 \textcolor{preprocessor}{#endif}
284     \}
285 
286     \textcolor{keywordflow}{if} (!AllocConsole()) \{
287         \hyperlink{wintty_8c_acbaa5978703f6f7019c1b2981a7b8597}{printerr}(\textcolor{stringliteral}{"AllocConsole(Default) failed (%d)\(\backslash\)n"}, GetLastError());
288     \}
289 
290     \textcolor{keywordflow}{if} (contitle && !SetConsoleTitle(contitle)) \{
291         \hyperlink{wintty_8c_acbaa5978703f6f7019c1b2981a7b8597}{printerr}(\textcolor{stringliteral}{"SetConsoleTitle() failed (%d)\(\backslash\)n"}, GetLastError());
292     \}
293 
294     conout = CreateFile(\textcolor{stringliteral}{"CONOUT$"}, GENERIC\_READ | GENERIC\_WRITE,
295                         FILE\_SHARE\_READ | FILE\_SHARE\_WRITE,
296                         \hyperlink{group__MOD__SSL__PRIVATE_gaa93f0eb578d23995850d61f7d61c55c1}{FALSE}, OPEN\_EXISTING, 0, \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL});
297     \textcolor{keywordflow}{if} (!conout || conout == INVALID\_HANDLE\_VALUE) \{
298         \hyperlink{wintty_8c_acbaa5978703f6f7019c1b2981a7b8597}{printerr}(\textcolor{stringliteral}{"CreateFile(CONOUT$) failed (%d)\(\backslash\)n"}, GetLastError());
299     \}
300     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (!GetConsoleMode(conout, &conmode)) \{
301         \hyperlink{wintty_8c_acbaa5978703f6f7019c1b2981a7b8597}{printerr}(\textcolor{stringliteral}{"GetConsoleMode(CONOUT) failed (%d)\(\backslash\)n"}, GetLastError());
302     \}
303     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (!SetConsoleMode(conout, conmode = ((conmode | newoutmode)
304                                                          & ~notoutmode))) \{
305         \hyperlink{wintty_8c_acbaa5978703f6f7019c1b2981a7b8597}{printerr}(\textcolor{stringliteral}{"SetConsoleMode(CONOUT, 0x%x) failed (%d)\(\backslash\)n"},
306                  conmode, GetLastError());
307     \}
308 
309     conin = CreateFile(\textcolor{stringliteral}{"CONIN$"}, GENERIC\_READ | GENERIC\_WRITE,
310                        FILE\_SHARE\_READ | FILE\_SHARE\_WRITE,
311                        \hyperlink{group__MOD__SSL__PRIVATE_gaa93f0eb578d23995850d61f7d61c55c1}{FALSE}, OPEN\_EXISTING, 0, \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL});
312     \textcolor{keywordflow}{if} (!conin || conin == INVALID\_HANDLE\_VALUE) \{
313         \hyperlink{wintty_8c_acbaa5978703f6f7019c1b2981a7b8597}{printerr}(\textcolor{stringliteral}{"CreateFile(CONIN$) failed (%d)\(\backslash\)n"}, GetLastError());
314     \}
315     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (!GetConsoleMode(conin, &conmode)) \{
316         \hyperlink{wintty_8c_acbaa5978703f6f7019c1b2981a7b8597}{printerr}(\textcolor{stringliteral}{"GetConsoleMode(CONIN) failed (%d)\(\backslash\)n"}, GetLastError());
317     \}
318     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (!SetConsoleMode(conin, conmode = ((conmode | newinmode)
319                                                         & ~notinmode))) \{
320         \hyperlink{wintty_8c_acbaa5978703f6f7019c1b2981a7b8597}{printerr}(\textcolor{stringliteral}{"SetConsoleMode(CONIN, 0x%x) failed (%d)\(\backslash\)n"},
321                  conmode, GetLastError());
322     \}
323 
324     feed.\hyperlink{structfeedback__args__t_a5f9548d0f1f6feec0db1b75db26f75df}{in} = conin;
325     feed.\hyperlink{structfeedback__args__t_a29c6e9f0c5de7561f99f7303e3ddb4ca}{out} = hstdout;
326     thread = \hyperlink{apr__dbg__win32__handles_8h_a4b0e5453079adac42d3589f948d8b81e}{CreateThread}(\hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL}, 0, \hyperlink{wintty_8c_a1c5747038fd5235500e99a74a49fbfec}{feedback}, (LPVOID)&feed, 0, &tid);
327 
328     \textcolor{keywordflow}{while} (ReadFile(hstdin, str, \textcolor{keyword}{sizeof}(str), &len, \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL}))
329         \textcolor{keywordflow}{if} (!len || !WriteFile(conout, str, len, &len, \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL}))
330            \textcolor{keywordflow}{break};
331 
332     \hyperlink{wintty_8c_acbaa5978703f6f7019c1b2981a7b8597}{printerr}(\textcolor{stringliteral}{"[EOF] from stdin (%d)\(\backslash\)n"}, GetLastError());
333 
334     \hyperlink{apr__dbg__win32__handles_8h_af89311c05c734797c91f635e50bec804}{CloseHandle}(\hyperlink{pcretest_8txt_a23d7bb711442e83ff18e0effa4729bdf}{stdout});
335     \textcolor{keywordflow}{if} (!GetConsoleTitle(str, \textcolor{keyword}{sizeof}(str))) \{
336         \hyperlink{wintty_8c_acbaa5978703f6f7019c1b2981a7b8597}{printerr}(\textcolor{stringliteral}{"SetConsoleTitle() failed (%d)\(\backslash\)n"}, GetLastError());
337     \}
338     \textcolor{keywordflow}{else} \{
339         strcat(str, \textcolor{stringliteral}{" - [Finished]"});
340         \textcolor{keywordflow}{if} (!SetConsoleTitle(str)) \{
341             \hyperlink{wintty_8c_acbaa5978703f6f7019c1b2981a7b8597}{printerr}(\textcolor{stringliteral}{"SetConsoleTitle() failed (%d)\(\backslash\)n"}, GetLastError());
342         \}
343     \}
344 
345     \hyperlink{apr__dbg__win32__handles_8h_afc860bc74827299798af7532aab62924}{WaitForSingleObject}(thread, timeout);
346     FreeConsole();
347     \textcolor{keywordflow}{if} (isservice) \{
348         \textcolor{keywordflow}{if} (!SetProcessWindowStation(hsavewinsta)) \{
349             len = GetLastError();
350         \}
351         \textcolor{keywordflow}{if} (!SetThreadDesktop(hsavedesk)) \{
352             len = GetLastError();
353         \}
354         CloseDesktop(hdesk);
355         CloseWindowStation(hwinsta);
356     \}
357     \textcolor{keywordflow}{return} 0;
358 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=293pt]{wintty_8c_a3c04138a5bfe5d72780bb7e82a18e627_cgraph}
\end{center}
\end{figure}


\index{wintty.\+c@{wintty.\+c}!printerr@{printerr}}
\index{printerr@{printerr}!wintty.\+c@{wintty.\+c}}
\subsubsection[{\texorpdfstring{printerr(char $\ast$fmt,...)}{printerr(char *fmt,...)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} printerr (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{fmt, }
\item[{}]{...}
\end{DoxyParamCaption}
)}\hypertarget{wintty_8c_acbaa5978703f6f7019c1b2981a7b8597}{}\label{wintty_8c_acbaa5978703f6f7019c1b2981a7b8597}

\begin{DoxyCode}
65 \{
66     \textcolor{keywordtype}{char} \hyperlink{group__MOD__DAV_gaab9226fe8f632e1f998e24276d478f30}{str}[1024];
67     va\_list \hyperlink{group__APACHE__CORE__MPM_gaa72bdc340ae9df68cd6f4afa28f1fd81}{args};
68     \textcolor{keywordflow}{if} (!\hyperlink{wintty_8c_ad023bbf13e60f8caee82c26f70e0f0a5}{verbose})
69         \textcolor{keywordflow}{return};
70     va\_start(args, \hyperlink{group__APACHE__CORE__LOG_gaacca67646a119f459e8e6eecb7f5e7ac}{fmt});
71     wvsprintf(str, \hyperlink{group__APACHE__CORE__LOG_gaacca67646a119f459e8e6eecb7f5e7ac}{fmt}, args);
72     OutputDebugString(str);
73 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=219pt]{wintty_8c_acbaa5978703f6f7019c1b2981a7b8597_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=293pt]{wintty_8c_acbaa5978703f6f7019c1b2981a7b8597_icgraph}
\end{center}
\end{figure}




\subsection{Variable Documentation}
\index{wintty.\+c@{wintty.\+c}!options@{options}}
\index{options@{options}!wintty.\+c@{wintty.\+c}}
\subsubsection[{\texorpdfstring{options}{options}}]{\setlength{\rightskip}{0pt plus 5cm}const char$\ast$ options}\hypertarget{wintty_8c_a0ce029c8445f3334f925e47366467e34}{}\label{wintty_8c_a0ce029c8445f3334f925e47366467e34}
{\bfseries Initial value\+:}
\begin{DoxyCode}
=
\textcolor{stringliteral}{"\(\backslash\)nwintty: a utility for echoing the stdin stream to a new console window,\(\backslash\)n"}
\textcolor{stringliteral}{"\(\backslash\)teven when invoked from within a service (such as the Apache server.)\(\backslash\)n"}
\textcolor{stringliteral}{"\(\backslash\)tAlso reflects the console input back to the stdout stream, allowing\(\backslash\)n"}
\textcolor{stringliteral}{"\(\backslash\)tthe operator to respond to prompts from the context of a service.\(\backslash\)n\(\backslash\)n"}
\textcolor{stringliteral}{"Syntax: %s [opts] [-t \(\backslash\)"Window Title\(\backslash\)"]\(\backslash\)n\(\backslash\)n"}
\textcolor{stringliteral}{"  opts: -c\{haracter\}   or -l\{ine\} input\(\backslash\)n"}
\textcolor{stringliteral}{"\(\backslash\)t-q\{uiet\}       or -e\{cho\} input\(\backslash\)n"}
\textcolor{stringliteral}{"\(\backslash\)t-u\{nprocessed\} or -p\{rocessed\} input\(\backslash\)n"}
\textcolor{stringliteral}{"\(\backslash\)t-n\{owrap\}      or -w\{rap\} output lines\(\backslash\)n"}
\textcolor{stringliteral}{"\(\backslash\)t-f\{ormatted\}   or -r\{aw\} output lines\(\backslash\)n"}
\textcolor{stringliteral}{"\(\backslash\)t-O\{output\} [number of seconds]\(\backslash\)n"}
\textcolor{stringliteral}{"\(\backslash\)t-v\{erbose\} error reporting (for debugging)\(\backslash\)n"}
\textcolor{stringliteral}{"\(\backslash\)t-? for this message\(\backslash\)n\(\backslash\)n"}
\end{DoxyCode}
\index{wintty.\+c@{wintty.\+c}!verbose@{verbose}}
\index{verbose@{verbose}!wintty.\+c@{wintty.\+c}}
\subsubsection[{\texorpdfstring{verbose}{verbose}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf B\+O\+OL} verbose = {\bf F\+A\+L\+SE}}\hypertarget{wintty_8c_ad023bbf13e60f8caee82c26f70e0f0a5}{}\label{wintty_8c_ad023bbf13e60f8caee82c26f70e0f0a5}
