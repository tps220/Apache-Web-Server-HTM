\hypertarget{h2__from__h1_8c}{}\section{/usr/local/src/github/\+Codebase/httpd-\/2.4.29/modules/http2/h2\+\_\+from\+\_\+h1.c File Reference}
\label{h2__from__h1_8c}\index{/usr/local/src/github/\+Codebase/httpd-\/2.\+4.\+29/modules/http2/h2\+\_\+from\+\_\+h1.\+c@{/usr/local/src/github/\+Codebase/httpd-\/2.\+4.\+29/modules/http2/h2\+\_\+from\+\_\+h1.\+c}}
{\ttfamily \#include $<$assert.\+h$>$}\\*
{\ttfamily \#include $<$stdio.\+h$>$}\\*
{\ttfamily \#include $<$apr\+\_\+date.\+h$>$}\\*
{\ttfamily \#include $<$apr\+\_\+lib.\+h$>$}\\*
{\ttfamily \#include $<$apr\+\_\+strings.\+h$>$}\\*
{\ttfamily \#include $<$httpd.\+h$>$}\\*
{\ttfamily \#include $<$http\+\_\+core.\+h$>$}\\*
{\ttfamily \#include $<$http\+\_\+log.\+h$>$}\\*
{\ttfamily \#include $<$http\+\_\+connection.\+h$>$}\\*
{\ttfamily \#include $<$http\+\_\+protocol.\+h$>$}\\*
{\ttfamily \#include $<$http\+\_\+request.\+h$>$}\\*
{\ttfamily \#include $<$util\+\_\+time.\+h$>$}\\*
{\ttfamily \#include \char`\"{}h2\+\_\+private.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}h2\+\_\+headers.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}h2\+\_\+from\+\_\+h1.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}h2\+\_\+task.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}h2\+\_\+util.\+h\char`\"{}}\\*
Include dependency graph for h2\+\_\+from\+\_\+h1.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{h2__from__h1_8c__incl}
\end{center}
\end{figure}
\subsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structh2__response__parser}{h2\+\_\+response\+\_\+parser}
\end{DoxyCompactItemize}
\subsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef struct \hyperlink{structh2__response__parser}{h2\+\_\+response\+\_\+parser} \hyperlink{h2__from__h1_8c_a4a7104d05fc28f04a8c51d8062756e4d}{h2\+\_\+response\+\_\+parser}
\end{DoxyCompactItemize}
\subsection*{Enumerations}
\begin{DoxyCompactItemize}
\item 
enum \hyperlink{h2__from__h1_8c_ab57c457e2d72c3fee19ac0cd13e114c2}{h2\+\_\+rp\+\_\+state\+\_\+t} \{ \hyperlink{h2__from__h1_8c_ab57c457e2d72c3fee19ac0cd13e114c2af5482c1671774dabd5cabfeb99ec2d63}{H2\+\_\+\+R\+P\+\_\+\+S\+T\+A\+T\+U\+S\+\_\+\+L\+I\+NE}, 
\hyperlink{h2__from__h1_8c_ab57c457e2d72c3fee19ac0cd13e114c2aa0ed69d5cfe7ceef778af9c7d9b09839}{H2\+\_\+\+R\+P\+\_\+\+H\+E\+A\+D\+E\+R\+\_\+\+L\+I\+NE}, 
\hyperlink{h2__from__h1_8c_ab57c457e2d72c3fee19ac0cd13e114c2ad96a67bbc199ec20c76d4b2c381671b1}{H2\+\_\+\+R\+P\+\_\+\+D\+O\+NE}
 \}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{group__apr__errno_gaa5105fa83cc322f09382292db8b47593}{apr\+\_\+status\+\_\+t} \hyperlink{h2__from__h1_8c_a6a5a64e8257b75422c6d8e19b308bc41}{h2\+\_\+from\+\_\+h1\+\_\+parse\+\_\+response} (\hyperlink{structh2__task}{h2\+\_\+task} $\ast$task, \hyperlink{structap__filter__t}{ap\+\_\+filter\+\_\+t} $\ast$\hyperlink{pcregrep_8txt_a588c778c1c1509e472f22dc36efb005e}{f}, \hyperlink{structapr__bucket__brigade}{apr\+\_\+bucket\+\_\+brigade} $\ast$\hyperlink{group__MOD__PROXY_ga9313a8a2814cff280d5d780c723def3c}{bb})
\item 
\hyperlink{group__apr__errno_gaa5105fa83cc322f09382292db8b47593}{apr\+\_\+status\+\_\+t} \hyperlink{h2__from__h1_8c_abb9cb62ee677a68259dace031821f7bc}{h2\+\_\+filter\+\_\+headers\+\_\+out} (\hyperlink{structap__filter__t}{ap\+\_\+filter\+\_\+t} $\ast$\hyperlink{pcregrep_8txt_a588c778c1c1509e472f22dc36efb005e}{f}, \hyperlink{structapr__bucket__brigade}{apr\+\_\+bucket\+\_\+brigade} $\ast$\hyperlink{group__MOD__PROXY_ga9313a8a2814cff280d5d780c723def3c}{bb})
\item 
\hyperlink{group__apr__errno_gaa5105fa83cc322f09382292db8b47593}{apr\+\_\+status\+\_\+t} \hyperlink{h2__from__h1_8c_a37a0aadc67f7bb5c8eddc60fe1c77d9f}{h2\+\_\+filter\+\_\+request\+\_\+in} (\hyperlink{structap__filter__t}{ap\+\_\+filter\+\_\+t} $\ast$\hyperlink{pcregrep_8txt_a588c778c1c1509e472f22dc36efb005e}{f}, \hyperlink{structapr__bucket__brigade}{apr\+\_\+bucket\+\_\+brigade} $\ast$\hyperlink{group__MOD__PROXY_ga9313a8a2814cff280d5d780c723def3c}{bb}, \hyperlink{util__filter_8h_ab570898d09fbbe5b6d838e28b90134e0}{ap\+\_\+input\+\_\+mode\+\_\+t} \hyperlink{pcregrep_8txt_ad194431669b7d1f96d2dacfb7be21261}{mode}, \hyperlink{group__APR__Util__Bucket__Brigades_ga756973fb6392bd1026c3d96b4519776d}{apr\+\_\+read\+\_\+type\+\_\+e} \hyperlink{pcretest_8txt_aebde0006968e3c574305c604c927277a}{block}, \hyperlink{group__apr__platform_ga6938af9075cec15c88299109381aa984}{apr\+\_\+off\+\_\+t} \hyperlink{group__APACHE__CORE__FILTER_ga0ce3dc88443223a04b0d1a3167356aee}{readbytes})
\item 
\hyperlink{group__apr__errno_gaa5105fa83cc322f09382292db8b47593}{apr\+\_\+status\+\_\+t} \hyperlink{h2__from__h1_8c_a6b193a2cf6997ed24315bbdaf409d5c8}{h2\+\_\+filter\+\_\+trailers\+\_\+out} (\hyperlink{structap__filter__t}{ap\+\_\+filter\+\_\+t} $\ast$\hyperlink{pcregrep_8txt_a588c778c1c1509e472f22dc36efb005e}{f}, \hyperlink{structapr__bucket__brigade}{apr\+\_\+bucket\+\_\+brigade} $\ast$\hyperlink{group__MOD__PROXY_ga9313a8a2814cff280d5d780c723def3c}{bb})
\end{DoxyCompactItemize}


\subsection{Typedef Documentation}
\index{h2\+\_\+from\+\_\+h1.\+c@{h2\+\_\+from\+\_\+h1.\+c}!h2\+\_\+response\+\_\+parser@{h2\+\_\+response\+\_\+parser}}
\index{h2\+\_\+response\+\_\+parser@{h2\+\_\+response\+\_\+parser}!h2\+\_\+from\+\_\+h1.\+c@{h2\+\_\+from\+\_\+h1.\+c}}
\subsubsection[{\texorpdfstring{h2\+\_\+response\+\_\+parser}{h2_response_parser}}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf h2\+\_\+response\+\_\+parser}  {\bf h2\+\_\+response\+\_\+parser}}\hypertarget{h2__from__h1_8c_a4a7104d05fc28f04a8c51d8062756e4d}{}\label{h2__from__h1_8c_a4a7104d05fc28f04a8c51d8062756e4d}


\subsection{Enumeration Type Documentation}
\index{h2\+\_\+from\+\_\+h1.\+c@{h2\+\_\+from\+\_\+h1.\+c}!h2\+\_\+rp\+\_\+state\+\_\+t@{h2\+\_\+rp\+\_\+state\+\_\+t}}
\index{h2\+\_\+rp\+\_\+state\+\_\+t@{h2\+\_\+rp\+\_\+state\+\_\+t}!h2\+\_\+from\+\_\+h1.\+c@{h2\+\_\+from\+\_\+h1.\+c}}
\subsubsection[{\texorpdfstring{h2\+\_\+rp\+\_\+state\+\_\+t}{h2_rp_state_t}}]{\setlength{\rightskip}{0pt plus 5cm}enum {\bf h2\+\_\+rp\+\_\+state\+\_\+t}}\hypertarget{h2__from__h1_8c_ab57c457e2d72c3fee19ac0cd13e114c2}{}\label{h2__from__h1_8c_ab57c457e2d72c3fee19ac0cd13e114c2}
\begin{Desc}
\item[Enumerator]\par
\begin{description}
\index{H2\+\_\+\+R\+P\+\_\+\+S\+T\+A\+T\+U\+S\+\_\+\+L\+I\+NE@{H2\+\_\+\+R\+P\+\_\+\+S\+T\+A\+T\+U\+S\+\_\+\+L\+I\+NE}!h2\+\_\+from\+\_\+h1.\+c@{h2\+\_\+from\+\_\+h1.\+c}}\index{h2\+\_\+from\+\_\+h1.\+c@{h2\+\_\+from\+\_\+h1.\+c}!H2\+\_\+\+R\+P\+\_\+\+S\+T\+A\+T\+U\+S\+\_\+\+L\+I\+NE@{H2\+\_\+\+R\+P\+\_\+\+S\+T\+A\+T\+U\+S\+\_\+\+L\+I\+NE}}\item[{\em 
H2\+\_\+\+R\+P\+\_\+\+S\+T\+A\+T\+U\+S\+\_\+\+L\+I\+NE\hypertarget{h2__from__h1_8c_ab57c457e2d72c3fee19ac0cd13e114c2af5482c1671774dabd5cabfeb99ec2d63}{}\label{h2__from__h1_8c_ab57c457e2d72c3fee19ac0cd13e114c2af5482c1671774dabd5cabfeb99ec2d63}
}]\index{H2\+\_\+\+R\+P\+\_\+\+H\+E\+A\+D\+E\+R\+\_\+\+L\+I\+NE@{H2\+\_\+\+R\+P\+\_\+\+H\+E\+A\+D\+E\+R\+\_\+\+L\+I\+NE}!h2\+\_\+from\+\_\+h1.\+c@{h2\+\_\+from\+\_\+h1.\+c}}\index{h2\+\_\+from\+\_\+h1.\+c@{h2\+\_\+from\+\_\+h1.\+c}!H2\+\_\+\+R\+P\+\_\+\+H\+E\+A\+D\+E\+R\+\_\+\+L\+I\+NE@{H2\+\_\+\+R\+P\+\_\+\+H\+E\+A\+D\+E\+R\+\_\+\+L\+I\+NE}}\item[{\em 
H2\+\_\+\+R\+P\+\_\+\+H\+E\+A\+D\+E\+R\+\_\+\+L\+I\+NE\hypertarget{h2__from__h1_8c_ab57c457e2d72c3fee19ac0cd13e114c2aa0ed69d5cfe7ceef778af9c7d9b09839}{}\label{h2__from__h1_8c_ab57c457e2d72c3fee19ac0cd13e114c2aa0ed69d5cfe7ceef778af9c7d9b09839}
}]\index{H2\+\_\+\+R\+P\+\_\+\+D\+O\+NE@{H2\+\_\+\+R\+P\+\_\+\+D\+O\+NE}!h2\+\_\+from\+\_\+h1.\+c@{h2\+\_\+from\+\_\+h1.\+c}}\index{h2\+\_\+from\+\_\+h1.\+c@{h2\+\_\+from\+\_\+h1.\+c}!H2\+\_\+\+R\+P\+\_\+\+D\+O\+NE@{H2\+\_\+\+R\+P\+\_\+\+D\+O\+NE}}\item[{\em 
H2\+\_\+\+R\+P\+\_\+\+D\+O\+NE\hypertarget{h2__from__h1_8c_ab57c457e2d72c3fee19ac0cd13e114c2ad96a67bbc199ec20c76d4b2c381671b1}{}\label{h2__from__h1_8c_ab57c457e2d72c3fee19ac0cd13e114c2ad96a67bbc199ec20c76d4b2c381671b1}
}]\end{description}
\end{Desc}

\begin{DoxyCode}
297              \{
298     \hyperlink{h2__from__h1_8c_ab57c457e2d72c3fee19ac0cd13e114c2af5482c1671774dabd5cabfeb99ec2d63}{H2\_RP\_STATUS\_LINE},
299     \hyperlink{h2__from__h1_8c_ab57c457e2d72c3fee19ac0cd13e114c2aa0ed69d5cfe7ceef778af9c7d9b09839}{H2\_RP\_HEADER\_LINE},
300     \hyperlink{h2__from__h1_8c_ab57c457e2d72c3fee19ac0cd13e114c2ad96a67bbc199ec20c76d4b2c381671b1}{H2\_RP\_DONE}
301 \} \hyperlink{h2__from__h1_8c_ab57c457e2d72c3fee19ac0cd13e114c2}{h2\_rp\_state\_t};
\end{DoxyCode}


\subsection{Function Documentation}
\index{h2\+\_\+from\+\_\+h1.\+c@{h2\+\_\+from\+\_\+h1.\+c}!h2\+\_\+filter\+\_\+headers\+\_\+out@{h2\+\_\+filter\+\_\+headers\+\_\+out}}
\index{h2\+\_\+filter\+\_\+headers\+\_\+out@{h2\+\_\+filter\+\_\+headers\+\_\+out}!h2\+\_\+from\+\_\+h1.\+c@{h2\+\_\+from\+\_\+h1.\+c}}
\subsubsection[{\texorpdfstring{h2\+\_\+filter\+\_\+headers\+\_\+out(ap\+\_\+filter\+\_\+t $\ast$f, apr\+\_\+bucket\+\_\+brigade $\ast$bb)}{h2_filter_headers_out(ap_filter_t *f, apr_bucket_brigade *bb)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf apr\+\_\+status\+\_\+t} h2\+\_\+filter\+\_\+headers\+\_\+out (
\begin{DoxyParamCaption}
\item[{{\bf ap\+\_\+filter\+\_\+t} $\ast$}]{f, }
\item[{{\bf apr\+\_\+bucket\+\_\+brigade} $\ast$}]{bb}
\end{DoxyParamCaption}
)}\hypertarget{h2__from__h1_8c_abb9cb62ee677a68259dace031821f7bc}{}\label{h2__from__h1_8c_abb9cb62ee677a68259dace031821f7bc}

\begin{DoxyCode}
517 \{
518     \hyperlink{structh2__task}{h2\_task} *task = f->\hyperlink{structap__filter__t_aef5a2ef40157f704d2b573b8737a6a70}{ctx};
519     \hyperlink{structrequest__rec}{request\_rec} *\hyperlink{group__APACHE__CORE__CONFIG_ga091cdd45984e865a888a4f8bb8fe107a}{r} = f->\hyperlink{structap__filter__t_a2d6537780c4059697c1f168a1121d62c}{r};
520     \hyperlink{structapr__bucket}{apr\_bucket} *\hyperlink{group__APACHE__CORE__PROTO_ga7fa09c5c80a7d25b74511944f5949e31}{b}, *bresp, *body\_bucket = \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL}, *next;
521     \hyperlink{structap__bucket__error}{ap\_bucket\_error} *eb = \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL};
522     \hyperlink{structh2__headers}{h2\_headers} *\hyperlink{group__MOD__DAV_ga61a23706db0e2c726e15a7a081345de7}{response} = \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL};
523     \textcolor{keywordtype}{int} headers\_passing = 0;
524     \hyperlink{group__APACHE__CORE__LOG_ga60ef6919b8e1b691b0c1ac4d67c9449f}{ap\_log\_cerror}(\hyperlink{group__APACHE__CORE__LOG_ga655e126996849bcb82e4e5a14c616f4a}{APLOG\_MARK}, \hyperlink{group__APACHE__CORE__LOG_gab08ab6d0e9ab24707ce7baeaecf1f551}{APLOG\_TRACE1}, 0, f->
      \hyperlink{structap__filter__t_afb039953f0c62d8455aa9f4bdd3ef487}{c},
525                   \textcolor{stringliteral}{"h2\_task(%s): output\_filter called"}, task->\hyperlink{structh2__task_ad51ebc1a6948a168b5b8c0b589e3d3cd}{id});
526     
527     \textcolor{keywordflow}{if} (!task->\hyperlink{structh2__task_a3681f0a2c396a3e027ad2dc9b50c15ef}{output}.\hyperlink{structh2__task_a747d4493551a9e0d1da76a22cbc5c45a}{sent\_response} && !f->\hyperlink{structap__filter__t_afb039953f0c62d8455aa9f4bdd3ef487}{c}->\hyperlink{structconn__rec_aead9e56515e09e4f4b32a543e988e123}{aborted}) \{
528         \textcolor{comment}{/* check, if we need to send the response now. Until we actually}
529 \textcolor{comment}{         * see a DATA bucket or some EOS/EOR, we do not do so. */}
530         \textcolor{keywordflow}{for} (b = \hyperlink{group__APR__Util__Bucket__Brigades_gab5826a11eb6ba90786a94282f806c230}{APR\_BRIGADE\_FIRST}(bb);
531              b != \hyperlink{group__APR__Util__Bucket__Brigades_ga858da66dccab1e063415678bb115788a}{APR\_BRIGADE\_SENTINEL}(bb);
532              b = \hyperlink{group__APR__Util__Bucket__Brigades_ga7171f690b203d548a5b6ae0b079068d8}{APR\_BUCKET\_NEXT}(b))
533         \{
534             \textcolor{keywordflow}{if} (\hyperlink{group__APACHE__CORE__PROTO_gaab791518d091322fdc35b084f5b9f642}{AP\_BUCKET\_IS\_ERROR}(b) && !eb) \{
535                 eb = b->\hyperlink{structapr__bucket_a7fc4604750889b3f762bda1a786d276a}{data};
536             \}
537             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{group__APACHE__CORE__CONNECTION_ga6ae3ca117a7265de04b91849d6b5acb1}{AP\_BUCKET\_IS\_EOC}(b)) \{
538                 \textcolor{comment}{/* If we see an EOC bucket it is a signal that we should get out}
539 \textcolor{comment}{                 * of the way doing nothing.}
540 \textcolor{comment}{                 */}
541                 ap\_remove\_output\_filter(f);
542                 \hyperlink{group__APACHE__CORE__LOG_ga60ef6919b8e1b691b0c1ac4d67c9449f}{ap\_log\_cerror}(\hyperlink{group__APACHE__CORE__LOG_ga655e126996849bcb82e4e5a14c616f4a}{APLOG\_MARK}, \hyperlink{group__APACHE__CORE__LOG_gaaa69603638ba4a5d83b8727a1ca5b76a}{APLOG\_TRACE2}, 0, f->
      \hyperlink{structap__filter__t_afb039953f0c62d8455aa9f4bdd3ef487}{c},
543                               \textcolor{stringliteral}{"h2\_task(%s): eoc bucket passed"}, task->\hyperlink{structh2__task_ad51ebc1a6948a168b5b8c0b589e3d3cd}{id});
544                 \textcolor{keywordflow}{return} ap\_pass\_brigade(f->\hyperlink{structap__filter__t_af4835ed2c41734061dc374d92ba401a2}{next}, bb);
545             \}
546             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{h2__headers_8h_a0ef06152a1dafd1d37105ef5a838b2a0}{H2\_BUCKET\_IS\_HEADERS}(b)) \{
547                 headers\_passing = 1;
548             \}
549             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (!\hyperlink{group__APR__Util__Bucket__Brigades_ga24105da0bb755a775c4b2a519d7c25f9}{APR\_BUCKET\_IS\_FLUSH}(b)) \{ 
550                 body\_bucket = \hyperlink{group__APACHE__CORE__PROTO_ga7fa09c5c80a7d25b74511944f5949e31}{b};
551                 \textcolor{keywordflow}{break};
552             \}
553         \}
554         
555         \textcolor{keywordflow}{if} (eb) \{
556             \textcolor{keywordtype}{int} st = eb->\hyperlink{structap__bucket__error_a7866fe685d7b0a09232731025c001976}{status};
557             \hyperlink{group__APACHE__CORE__LOG_ga60ef6919b8e1b691b0c1ac4d67c9449f}{ap\_log\_cerror}(\hyperlink{group__APACHE__CORE__LOG_ga655e126996849bcb82e4e5a14c616f4a}{APLOG\_MARK}, \hyperlink{group__APACHE__CORE__LOG_gadfcef90537539cf2b7d35cfbbbafeb93}{APLOG\_DEBUG}, 0, f->
      \hyperlink{structap__filter__t_afb039953f0c62d8455aa9f4bdd3ef487}{c}, \hyperlink{group__APACHE__CORE__LOG_ga1dee8a07e06bc5b3de8b89662c2cd666}{APLOGNO}(03047)
558                           \textcolor{stringliteral}{"h2\_task(%s): err bucket status=%d"}, task->\hyperlink{structh2__task_ad51ebc1a6948a168b5b8c0b589e3d3cd}{id}, st);
559             \textcolor{comment}{/* throw everything away and replace it with the error response}
560 \textcolor{comment}{             * generated by ap\_die() */}
561             apr\_brigade\_cleanup(bb);
562             ap\_die(st, r);
563             \textcolor{keywordflow}{return} \hyperlink{group__APACHE__CORE__DAEMON_ga571664f1af74affc2b898a892f335b82}{AP\_FILTER\_ERROR};
564         \}
565         
566         \textcolor{keywordflow}{if} (body\_bucket || !headers\_passing) \{
567             \textcolor{comment}{/* time to insert the response bucket before the body or if}
568 \textcolor{comment}{             * no h2\_headers is passed, e.g. the response is empty */}
569             response = create\_response(task, r);
570             \textcolor{keywordflow}{if} (response == \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL}) \{
571                 \hyperlink{group__APACHE__CORE__LOG_ga60ef6919b8e1b691b0c1ac4d67c9449f}{ap\_log\_cerror}(\hyperlink{group__APACHE__CORE__LOG_ga655e126996849bcb82e4e5a14c616f4a}{APLOG\_MARK}, \hyperlink{group__APACHE__CORE__LOG_ga23239084d07266623cf5f5830fd28c8c}{APLOG\_NOTICE}, 0, f->
      \hyperlink{structap__filter__t_afb039953f0c62d8455aa9f4bdd3ef487}{c}, \hyperlink{group__APACHE__CORE__LOG_ga1dee8a07e06bc5b3de8b89662c2cd666}{APLOGNO}(03048)
572                               \textcolor{stringliteral}{"h2\_task(%s): unable to create response"}, task->\hyperlink{structh2__task_ad51ebc1a6948a168b5b8c0b589e3d3cd}{id});
573                 \textcolor{keywordflow}{return} \hyperlink{group__APR__Error_ga6a453e60000000609a95817efabebf4f}{APR\_ENOMEM};
574             \}
575             
576             bresp = \hyperlink{h2__headers_8c_a12a65836d69f5bd8cba891e30eced0a0}{h2\_bucket\_headers\_create}(f->\hyperlink{structap__filter__t_afb039953f0c62d8455aa9f4bdd3ef487}{c}->
      \hyperlink{structconn__rec_a5a9ee4911c5a655131f76a04036fb4c0}{bucket\_alloc}, response);
577             \textcolor{keywordflow}{if} (body\_bucket) \{
578                 \hyperlink{group__APR__Util__Bucket__Brigades_gae012adeccda754eabc42b7855bec081e}{APR\_BUCKET\_INSERT\_BEFORE}(body\_bucket, bresp);
579             \}
580             \textcolor{keywordflow}{else} \{
581                 \hyperlink{group__APR__Util__Bucket__Brigades_ga6dc39d8757e18941a6fb069b0c18fbd3}{APR\_BRIGADE\_INSERT\_HEAD}(bb, bresp);
582             \}
583             task->\hyperlink{structh2__task_a3681f0a2c396a3e027ad2dc9b50c15ef}{output}.\hyperlink{structh2__task_a747d4493551a9e0d1da76a22cbc5c45a}{sent\_response} = 1;
584             r->\hyperlink{structrequest__rec_ae8efe02c7668a4eaa7c714a41cc30b0e}{sent\_bodyct} = 1;
585         \}
586     \}
587     
588     \textcolor{keywordflow}{if} (r->\hyperlink{structrequest__rec_a3eaeb9ca893c14921b8bf98e3d9b4a11}{header\_only}) \{
589         \hyperlink{group__APACHE__CORE__LOG_ga60ef6919b8e1b691b0c1ac4d67c9449f}{ap\_log\_cerror}(\hyperlink{group__APACHE__CORE__LOG_ga655e126996849bcb82e4e5a14c616f4a}{APLOG\_MARK}, \hyperlink{group__APACHE__CORE__LOG_gab08ab6d0e9ab24707ce7baeaecf1f551}{APLOG\_TRACE1}, 0, f->
      \hyperlink{structap__filter__t_afb039953f0c62d8455aa9f4bdd3ef487}{c},
590                       \textcolor{stringliteral}{"h2\_task(%s): header\_only, cleanup output brigade"}, 
591                       task->\hyperlink{structh2__task_ad51ebc1a6948a168b5b8c0b589e3d3cd}{id});
592         b = body\_bucket? body\_bucket : \hyperlink{group__APR__Util__Bucket__Brigades_gab5826a11eb6ba90786a94282f806c230}{APR\_BRIGADE\_FIRST}(bb);
593         \textcolor{keywordflow}{while} (b != \hyperlink{group__APR__Util__Bucket__Brigades_ga858da66dccab1e063415678bb115788a}{APR\_BRIGADE\_SENTINEL}(bb)) \{
594             next = \hyperlink{group__APR__Util__Bucket__Brigades_ga7171f690b203d548a5b6ae0b079068d8}{APR\_BUCKET\_NEXT}(b);
595             \textcolor{keywordflow}{if} (\hyperlink{group__APR__Util__Bucket__Brigades_ga89b225e1c08473766eec719b985ca0d6}{APR\_BUCKET\_IS\_EOS}(b) || \hyperlink{group__APACHE__CORE__REQ_ga8318214baeaec5af97903afeef38f253}{AP\_BUCKET\_IS\_EOR}(b)) \{
596                 \textcolor{keywordflow}{break};
597             \} 
598             \hyperlink{group__APR__Util__Bucket__Brigades_ga2c46a1b717a87b68bd98b425e0c64977}{APR\_BUCKET\_REMOVE}(b);
599             \hyperlink{group__APR__Util__Bucket__Brigades_gafc0dae1e90a798284ed777a0c9e90ec6}{apr\_bucket\_destroy}(b);
600             b = next;
601         \}
602     \}
603     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (task->\hyperlink{structh2__task_a3681f0a2c396a3e027ad2dc9b50c15ef}{output}.\hyperlink{structh2__task_a747d4493551a9e0d1da76a22cbc5c45a}{sent\_response}) \{
604         \textcolor{comment}{/* lets get out of the way, our task is done */}
605         ap\_remove\_output\_filter(f);
606     \}
607     \textcolor{keywordflow}{return} ap\_pass\_brigade(f->\hyperlink{structap__filter__t_af4835ed2c41734061dc374d92ba401a2}{next}, bb);
608 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{h2__from__h1_8c_abb9cb62ee677a68259dace031821f7bc_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{h2__from__h1_8c_abb9cb62ee677a68259dace031821f7bc_icgraph}
\end{center}
\end{figure}


\index{h2\+\_\+from\+\_\+h1.\+c@{h2\+\_\+from\+\_\+h1.\+c}!h2\+\_\+filter\+\_\+request\+\_\+in@{h2\+\_\+filter\+\_\+request\+\_\+in}}
\index{h2\+\_\+filter\+\_\+request\+\_\+in@{h2\+\_\+filter\+\_\+request\+\_\+in}!h2\+\_\+from\+\_\+h1.\+c@{h2\+\_\+from\+\_\+h1.\+c}}
\subsubsection[{\texorpdfstring{h2\+\_\+filter\+\_\+request\+\_\+in(ap\+\_\+filter\+\_\+t $\ast$f, apr\+\_\+bucket\+\_\+brigade $\ast$bb, ap\+\_\+input\+\_\+mode\+\_\+t mode, apr\+\_\+read\+\_\+type\+\_\+e block, apr\+\_\+off\+\_\+t readbytes)}{h2_filter_request_in(ap_filter_t *f, apr_bucket_brigade *bb, ap_input_mode_t mode, apr_read_type_e block, apr_off_t readbytes)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf apr\+\_\+status\+\_\+t} h2\+\_\+filter\+\_\+request\+\_\+in (
\begin{DoxyParamCaption}
\item[{{\bf ap\+\_\+filter\+\_\+t} $\ast$}]{f, }
\item[{{\bf apr\+\_\+bucket\+\_\+brigade} $\ast$}]{bb, }
\item[{{\bf ap\+\_\+input\+\_\+mode\+\_\+t}}]{mode, }
\item[{{\bf apr\+\_\+read\+\_\+type\+\_\+e}}]{block, }
\item[{{\bf apr\+\_\+off\+\_\+t}}]{readbytes}
\end{DoxyParamCaption}
)}\hypertarget{h2__from__h1_8c_a37a0aadc67f7bb5c8eddc60fe1c77d9f}{}\label{h2__from__h1_8c_a37a0aadc67f7bb5c8eddc60fe1c77d9f}

\begin{DoxyCode}
744 \{
745     \hyperlink{structh2__task}{h2\_task} *task = f->\hyperlink{structap__filter__t_aef5a2ef40157f704d2b573b8737a6a70}{ctx};
746     \hyperlink{structrequest__rec}{request\_rec} *\hyperlink{group__APACHE__CORE__CONFIG_ga091cdd45984e865a888a4f8bb8fe107a}{r} = f->\hyperlink{structap__filter__t_a2d6537780c4059697c1f168a1121d62c}{r};
747     \hyperlink{group__apr__errno_gaa5105fa83cc322f09382292db8b47593}{apr\_status\_t} \hyperlink{group__APACHE__CORE__HTTPD_ga6e27f49150e9a14580fb313cc2777e00}{status} = \hyperlink{group__apr__errno_ga9ee311b7bf1c691dc521d721339ee2a6}{APR\_SUCCESS};
748     \hyperlink{structapr__bucket}{apr\_bucket} *\hyperlink{group__APACHE__CORE__PROTO_ga7fa09c5c80a7d25b74511944f5949e31}{b}, *next;
749     \hyperlink{structcore__server__config}{core\_server\_config} *\hyperlink{group__APACHE__CORE__HTTPD_ga7be6dfd9155648f64d6e9abcd78c38cd}{conf} =
750         (\hyperlink{structcore__server__config}{core\_server\_config} *) \hyperlink{group__APACHE__CORE__CONFIG_ga1093a5908a384eacc929b028c79f2a02}{ap\_get\_module\_config}(r->
      \hyperlink{structrequest__rec_a4a8059930ce9409cb885fdeef6921b7b}{server}->module\_config,
751                                                     &\hyperlink{group__APACHE__CORE__HTTPD_gafebd5dacd393edc6b65481d68544c59a}{core\_module});
752 
753     \hyperlink{group__APACHE__CORE__LOG_ga4c112558ccffd6b363da102b2052d2a6}{ap\_log\_rerror}(\hyperlink{group__APACHE__CORE__LOG_ga655e126996849bcb82e4e5a14c616f4a}{APLOG\_MARK}, \hyperlink{group__APACHE__CORE__LOG_gaaa69603638ba4a5d83b8727a1ca5b76a}{APLOG\_TRACE2}, 0, f->
      \hyperlink{structap__filter__t_a2d6537780c4059697c1f168a1121d62c}{r},
754                   \textcolor{stringliteral}{"h2\_task(%s): request filter, exp=%d"}, task->\hyperlink{structh2__task_ad51ebc1a6948a168b5b8c0b589e3d3cd}{id}, r->
      \hyperlink{structrequest__rec_a58f8821d9463cfded49110353ced165d}{expecting\_100});
755     \textcolor{keywordflow}{if} (!task->\hyperlink{structh2__task_a2b29ed50bdcfa0549416978b8048cb78}{request}->\hyperlink{structh2__request_a3dde46ef74e22353622855f1fda1f6ef}{chunked}) \{
756         status = ap\_get\_brigade(f->\hyperlink{structap__filter__t_af4835ed2c41734061dc374d92ba401a2}{next}, bb, \hyperlink{group__APACHE__CORE__FILTER_gad194431669b7d1f96d2dacfb7be21261}{mode}, \hyperlink{group__APACHE__CORE__FILTER_gafe0ebf200b97a61a45c0513334da9ab6}{block}, \hyperlink{group__APACHE__CORE__FILTER_ga0ce3dc88443223a04b0d1a3167356aee}{readbytes});
757         \textcolor{comment}{/* pipe data through, just take care of trailers */}
758         \textcolor{keywordflow}{for} (b = \hyperlink{group__APR__Util__Bucket__Brigades_gab5826a11eb6ba90786a94282f806c230}{APR\_BRIGADE\_FIRST}(bb); 
759              b != \hyperlink{group__APR__Util__Bucket__Brigades_ga858da66dccab1e063415678bb115788a}{APR\_BRIGADE\_SENTINEL}(bb); b = next) \{
760             next = \hyperlink{group__APR__Util__Bucket__Brigades_ga7171f690b203d548a5b6ae0b079068d8}{APR\_BUCKET\_NEXT}(b);
761             \textcolor{keywordflow}{if} (\hyperlink{h2__headers_8h_a0ef06152a1dafd1d37105ef5a838b2a0}{H2\_BUCKET\_IS\_HEADERS}(b)) \{
762                 \hyperlink{structh2__headers}{h2\_headers} *\hyperlink{group__APACHE__CORE__PROTO_gad27a8cead3a9e245c2e63cbf9a15f8c1}{headers} = \hyperlink{h2__headers_8c_a3f558a0fa1dca03ad53cf32abbf92a10}{h2\_bucket\_headers\_get}(b);
763                 \hyperlink{group__APACHE__CORE__DAEMON_gace52c7d9cc135b00b6e686236c0095a7}{ap\_assert}(headers);
764                 \hyperlink{group__APACHE__CORE__LOG_ga4c112558ccffd6b363da102b2052d2a6}{ap\_log\_rerror}(\hyperlink{group__APACHE__CORE__LOG_ga655e126996849bcb82e4e5a14c616f4a}{APLOG\_MARK}, \hyperlink{group__APACHE__CORE__LOG_gaaa69603638ba4a5d83b8727a1ca5b76a}{APLOG\_TRACE2}, 0, r,
765                               \textcolor{stringliteral}{"h2\_task(%s): receiving trailers"}, task->\hyperlink{structh2__task_ad51ebc1a6948a168b5b8c0b589e3d3cd}{id});
766                 r->\hyperlink{structrequest__rec_a262f0dcdb72654d48b075baa8c5421c3}{trailers\_in} = headers->\hyperlink{structh2__headers_a6b07b460b8fb9e98c8cfdeff2f9b116c}{headers};
767                 \textcolor{keywordflow}{if} (conf && conf->\hyperlink{structcore__server__config_a2608fe3794c66bb783bff4af1191446a}{merge\_trailers} == 
      \hyperlink{http__core_8h_ac1483475c601d9d111a63ddfee3fddc8}{AP\_MERGE\_TRAILERS\_ENABLE}) \{
768                     r->\hyperlink{structrequest__rec_a5497da6c01af49acf70a4a9b975c1c83}{headers\_in} = apr\_table\_overlay(r->\hyperlink{structrequest__rec_aa0a0c16f9a9ab3901cdb3f3c9c9d83d0}{pool}, r->
      \hyperlink{structrequest__rec_a5497da6c01af49acf70a4a9b975c1c83}{headers\_in},
769                                                       r->\hyperlink{structrequest__rec_a262f0dcdb72654d48b075baa8c5421c3}{trailers\_in});                    
770                 \}
771                 \hyperlink{group__APR__Util__Bucket__Brigades_ga2c46a1b717a87b68bd98b425e0c64977}{APR\_BUCKET\_REMOVE}(b);
772                 \hyperlink{group__APR__Util__Bucket__Brigades_gafc0dae1e90a798284ed777a0c9e90ec6}{apr\_bucket\_destroy}(b);
773                 ap\_remove\_input\_filter(f);
774                 \textcolor{keywordflow}{break};
775             \}
776         \}
777         \textcolor{keywordflow}{return} \hyperlink{group__APACHE__CORE__HTTPD_ga6e27f49150e9a14580fb313cc2777e00}{status};
778     \}
779 
780     \textcolor{comment}{/* Things are more complicated. The standard HTTP input filter, which}
781 \textcolor{comment}{     * does a lot what we do not want to duplicate, also cares about chunked}
782 \textcolor{comment}{     * transfer encoding and trailers.}
783 \textcolor{comment}{     * We need to simulate chunked encoding for it to be happy.}
784 \textcolor{comment}{     */}
785     \textcolor{keywordflow}{if} ((status = read\_and\_chunk(f, task, \hyperlink{group__APACHE__CORE__FILTER_gafe0ebf200b97a61a45c0513334da9ab6}{block})) != \hyperlink{group__apr__errno_ga9ee311b7bf1c691dc521d721339ee2a6}{APR\_SUCCESS}) \{
786         \textcolor{keywordflow}{return} \hyperlink{group__APACHE__CORE__HTTPD_ga6e27f49150e9a14580fb313cc2777e00}{status};
787     \}
788     
789     \textcolor{keywordflow}{if} (\hyperlink{group__APACHE__CORE__FILTER_gad194431669b7d1f96d2dacfb7be21261}{mode} == \hyperlink{util__filter_8h_ab570898d09fbbe5b6d838e28b90134e0a4765fdaba2fdf4c349a78a8a3e2a0404}{AP\_MODE\_EXHAUSTIVE}) \{
790         \textcolor{comment}{/* return all we have */}
791         \hyperlink{group__APR__Util__Bucket__Brigades_ga7cecbc89be912ce9ab24c889eb8f955b}{APR\_BRIGADE\_CONCAT}(bb, task->\hyperlink{structh2__task_ace591dda78eb3f521ceab4a6c76e72a7}{input}.\hyperlink{structh2__task_a56210dd30d8de269972b8b52019dcd4a}{bbchunk});
792     \}
793     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{group__APACHE__CORE__FILTER_gad194431669b7d1f96d2dacfb7be21261}{mode} == \hyperlink{util__filter_8h_ab570898d09fbbe5b6d838e28b90134e0a2d8e63e1da380c3909ac0a1325339de4}{AP\_MODE\_READBYTES}) \{
794         status = \hyperlink{h2__util_8c_a6a39c5ca11bad5eada495111613d5e88}{h2\_brigade\_concat\_length}(bb, task->
      \hyperlink{structh2__task_ace591dda78eb3f521ceab4a6c76e72a7}{input}.\hyperlink{structh2__task_a56210dd30d8de269972b8b52019dcd4a}{bbchunk}, \hyperlink{group__APACHE__CORE__FILTER_ga0ce3dc88443223a04b0d1a3167356aee}{readbytes});
795     \}
796     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{group__APACHE__CORE__FILTER_gad194431669b7d1f96d2dacfb7be21261}{mode} == \hyperlink{util__filter_8h_ab570898d09fbbe5b6d838e28b90134e0a172cd500372b39626bc718a82690edab}{AP\_MODE\_SPECULATIVE}) \{
797         status = \hyperlink{h2__util_8c_a1e85392ff9bcbcffcc9ae34aa48ad534}{h2\_brigade\_copy\_length}(bb, task->\hyperlink{structh2__task_ace591dda78eb3f521ceab4a6c76e72a7}{input}.
      \hyperlink{structh2__task_a56210dd30d8de269972b8b52019dcd4a}{bbchunk}, \hyperlink{group__APACHE__CORE__FILTER_ga0ce3dc88443223a04b0d1a3167356aee}{readbytes});
798     \}
799     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{group__APACHE__CORE__FILTER_gad194431669b7d1f96d2dacfb7be21261}{mode} == \hyperlink{util__filter_8h_ab570898d09fbbe5b6d838e28b90134e0ae223ad325ff670d0c1dd98d3c9dcad2d}{AP\_MODE\_GETLINE}) \{
800         \textcolor{comment}{/* we are reading a single LF line, e.g. the HTTP headers. }
801 \textcolor{comment}{         * this has the nasty side effect to split the bucket, even}
802 \textcolor{comment}{         * though it ends with CRLF and creates a 0 length bucket */}
803         status = apr\_brigade\_split\_line(bb, task->\hyperlink{structh2__task_ace591dda78eb3f521ceab4a6c76e72a7}{input}.\hyperlink{structh2__task_a56210dd30d8de269972b8b52019dcd4a}{bbchunk}, 
      \hyperlink{group__APACHE__CORE__FILTER_gafe0ebf200b97a61a45c0513334da9ab6}{block}, 
804                                         \hyperlink{group__APACHE__CORE__DAEMON_ga0c9dd98f46b90b5bcd4cbf75e252d0da}{HUGE\_STRING\_LEN});
805         \textcolor{keywordflow}{if} (\hyperlink{group__APACHE__CORE__LOG_gabbb273571a341789872b65a758aa01e1}{APLOGctrace1}(f->\hyperlink{structap__filter__t_afb039953f0c62d8455aa9f4bdd3ef487}{c})) \{
806             \textcolor{keywordtype}{char} \hyperlink{group__APACHE__CORE__PROTO_gabd91b1aab0a10c5027ca2eb5577f759f}{buffer}[1024];
807             \hyperlink{group__apr__platform_gaaa72b2253f6f3032cefea5712a27540e}{apr\_size\_t} \hyperlink{group__APACHE__CORE__LOG_gab5a43233d60ef05c5b5bf5cba3d74468}{len} = \textcolor{keyword}{sizeof}(\hyperlink{group__APACHE__CORE__PROTO_gabd91b1aab0a10c5027ca2eb5577f759f}{buffer})-1;
808             apr\_brigade\_flatten(bb, buffer, &len);
809             buffer[\hyperlink{group__APACHE__CORE__LOG_gab5a43233d60ef05c5b5bf5cba3d74468}{len}] = 0;
810             \hyperlink{group__APACHE__CORE__LOG_ga60ef6919b8e1b691b0c1ac4d67c9449f}{ap\_log\_cerror}(\hyperlink{group__APACHE__CORE__LOG_ga655e126996849bcb82e4e5a14c616f4a}{APLOG\_MARK}, \hyperlink{group__APACHE__CORE__LOG_gab08ab6d0e9ab24707ce7baeaecf1f551}{APLOG\_TRACE1}, status, f->
      \hyperlink{structap__filter__t_afb039953f0c62d8455aa9f4bdd3ef487}{c},
811                           \textcolor{stringliteral}{"h2\_task(%s): getline: %s"},
812                           task->\hyperlink{structh2__task_ad51ebc1a6948a168b5b8c0b589e3d3cd}{id}, buffer);
813         \}
814     \}
815     \textcolor{keywordflow}{else} \{
816         \textcolor{comment}{/* Hmm, well. There is mode AP\_MODE\_EATCRLF, but we chose not}
817 \textcolor{comment}{         * to support it. Seems to work. */}
818         \hyperlink{group__APACHE__CORE__LOG_ga60ef6919b8e1b691b0c1ac4d67c9449f}{ap\_log\_cerror}(\hyperlink{group__APACHE__CORE__LOG_ga655e126996849bcb82e4e5a14c616f4a}{APLOG\_MARK}, \hyperlink{group__APACHE__CORE__LOG_ga57ad94ed8c92c4306de90479251a5d58}{APLOG\_ERR}, 
      \hyperlink{group__APR__Error_ga939ddb834a30bc9a5a0a329b13000161}{APR\_ENOTIMPL}, f->\hyperlink{structap__filter__t_afb039953f0c62d8455aa9f4bdd3ef487}{c},
819                       \hyperlink{group__APACHE__CORE__LOG_ga1dee8a07e06bc5b3de8b89662c2cd666}{APLOGNO}(02942) 
820                       \textcolor{stringliteral}{"h2\_task, unsupported READ mode %d"}, \hyperlink{group__APACHE__CORE__FILTER_gad194431669b7d1f96d2dacfb7be21261}{mode});
821         status = \hyperlink{group__APR__Error_ga939ddb834a30bc9a5a0a329b13000161}{APR\_ENOTIMPL};
822     \}
823     
824     \hyperlink{h2__util_8h_a0f49e15250569f7359526957b614ce88}{h2\_util\_bb\_log}(f->\hyperlink{structap__filter__t_afb039953f0c62d8455aa9f4bdd3ef487}{c}, task->\hyperlink{structh2__task_a09e7e9f9e5fdb61206c344f2272d9f20}{stream\_id}, \hyperlink{group__APACHE__CORE__LOG_gaaa69603638ba4a5d83b8727a1ca5b76a}{APLOG\_TRACE2}, \textcolor{stringliteral}{"forwarding
       input"}, bb);
825     \textcolor{keywordflow}{return} \hyperlink{group__APACHE__CORE__HTTPD_ga6e27f49150e9a14580fb313cc2777e00}{status};
826 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=347pt]{h2__from__h1_8c_a37a0aadc67f7bb5c8eddc60fe1c77d9f_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{h2__from__h1_8c_a37a0aadc67f7bb5c8eddc60fe1c77d9f_icgraph}
\end{center}
\end{figure}


\index{h2\+\_\+from\+\_\+h1.\+c@{h2\+\_\+from\+\_\+h1.\+c}!h2\+\_\+filter\+\_\+trailers\+\_\+out@{h2\+\_\+filter\+\_\+trailers\+\_\+out}}
\index{h2\+\_\+filter\+\_\+trailers\+\_\+out@{h2\+\_\+filter\+\_\+trailers\+\_\+out}!h2\+\_\+from\+\_\+h1.\+c@{h2\+\_\+from\+\_\+h1.\+c}}
\subsubsection[{\texorpdfstring{h2\+\_\+filter\+\_\+trailers\+\_\+out(ap\+\_\+filter\+\_\+t $\ast$f, apr\+\_\+bucket\+\_\+brigade $\ast$bb)}{h2_filter_trailers_out(ap_filter_t *f, apr_bucket_brigade *bb)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf apr\+\_\+status\+\_\+t} h2\+\_\+filter\+\_\+trailers\+\_\+out (
\begin{DoxyParamCaption}
\item[{{\bf ap\+\_\+filter\+\_\+t} $\ast$}]{f, }
\item[{{\bf apr\+\_\+bucket\+\_\+brigade} $\ast$}]{bb}
\end{DoxyParamCaption}
)}\hypertarget{h2__from__h1_8c_a6b193a2cf6997ed24315bbdaf409d5c8}{}\label{h2__from__h1_8c_a6b193a2cf6997ed24315bbdaf409d5c8}

\begin{DoxyCode}
829 \{
830     \hyperlink{structh2__task}{h2\_task} *task = f->\hyperlink{structap__filter__t_aef5a2ef40157f704d2b573b8737a6a70}{ctx};
831     \hyperlink{structrequest__rec}{request\_rec} *\hyperlink{group__APACHE__CORE__CONFIG_ga091cdd45984e865a888a4f8bb8fe107a}{r} = f->\hyperlink{structap__filter__t_a2d6537780c4059697c1f168a1121d62c}{r};
832     \hyperlink{structapr__bucket}{apr\_bucket} *\hyperlink{group__APACHE__CORE__PROTO_ga7fa09c5c80a7d25b74511944f5949e31}{b}, *\hyperlink{group__APR__Util__Bucket__Brigades_gacd90314acb2c2e5cd19681136c08efac}{e};
833  
834     \textcolor{keywordflow}{if} (task && r) \{
835         \textcolor{comment}{/* Detect the EOS/EOR bucket and forward any trailers that may have}
836 \textcolor{comment}{         * been set to our h2\_headers.}
837 \textcolor{comment}{         */}
838         \textcolor{keywordflow}{for} (b = \hyperlink{group__APR__Util__Bucket__Brigades_gab5826a11eb6ba90786a94282f806c230}{APR\_BRIGADE\_FIRST}(bb);
839              b != \hyperlink{group__APR__Util__Bucket__Brigades_ga858da66dccab1e063415678bb115788a}{APR\_BRIGADE\_SENTINEL}(bb);
840              b = \hyperlink{group__APR__Util__Bucket__Brigades_ga7171f690b203d548a5b6ae0b079068d8}{APR\_BUCKET\_NEXT}(b))
841         \{
842             \textcolor{keywordflow}{if} ((\hyperlink{group__APR__Util__Bucket__Brigades_ga89b225e1c08473766eec719b985ca0d6}{APR\_BUCKET\_IS\_EOS}(b) || \hyperlink{group__APACHE__CORE__REQ_ga8318214baeaec5af97903afeef38f253}{AP\_BUCKET\_IS\_EOR}(b))
843                 && r->\hyperlink{structrequest__rec_afb188ac7ef36e5da871eb7d3fb428bc0}{trailers\_out} && !apr\_is\_empty\_table(r->
      \hyperlink{structrequest__rec_afb188ac7ef36e5da871eb7d3fb428bc0}{trailers\_out})) \{
844                 \hyperlink{structh2__headers}{h2\_headers} *\hyperlink{group__APACHE__CORE__PROTO_gad27a8cead3a9e245c2e63cbf9a15f8c1}{headers};
845                 \hyperlink{structapr__table__t}{apr\_table\_t} *trailers;
846                 
847                 \hyperlink{group__APACHE__CORE__LOG_ga60ef6919b8e1b691b0c1ac4d67c9449f}{ap\_log\_cerror}(\hyperlink{group__APACHE__CORE__LOG_ga655e126996849bcb82e4e5a14c616f4a}{APLOG\_MARK}, \hyperlink{group__APACHE__CORE__LOG_gadfcef90537539cf2b7d35cfbbbafeb93}{APLOG\_DEBUG}, 0, f->
      \hyperlink{structap__filter__t_afb039953f0c62d8455aa9f4bdd3ef487}{c}, \hyperlink{group__APACHE__CORE__LOG_ga1dee8a07e06bc5b3de8b89662c2cd666}{APLOGNO}(03049)
848                               \textcolor{stringliteral}{"h2\_task(%s): sending trailers"}, task->\hyperlink{structh2__task_ad51ebc1a6948a168b5b8c0b589e3d3cd}{id});
849                 trailers = apr\_table\_clone(r->\hyperlink{structrequest__rec_aa0a0c16f9a9ab3901cdb3f3c9c9d83d0}{pool}, r->\hyperlink{structrequest__rec_afb188ac7ef36e5da871eb7d3fb428bc0}{trailers\_out});
850                 headers = \hyperlink{h2__headers_8c_a6d4cff7bab0dfbc453137ad8e8231e96}{h2\_headers\_rcreate}(r, \hyperlink{group__HTTP__Status_ga02e6d59009dee759528ec81fc9a8eeff}{HTTP\_OK}, trailers, r->
      \hyperlink{structrequest__rec_aa0a0c16f9a9ab3901cdb3f3c9c9d83d0}{pool});
851                 e = \hyperlink{h2__headers_8c_a12a65836d69f5bd8cba891e30eced0a0}{h2\_bucket\_headers\_create}(bb->
      \hyperlink{structapr__bucket__brigade_a9f58f90a088f02ebb6f935f004092aaa}{bucket\_alloc}, headers);
852                 \hyperlink{group__APR__Util__Bucket__Brigades_gae012adeccda754eabc42b7855bec081e}{APR\_BUCKET\_INSERT\_BEFORE}(b, e);
853                 apr\_table\_clear(r->\hyperlink{structrequest__rec_afb188ac7ef36e5da871eb7d3fb428bc0}{trailers\_out});
854                 ap\_remove\_output\_filter(f);
855                 \textcolor{keywordflow}{break};
856             \}
857         \}     
858     \}
859      
860     \textcolor{keywordflow}{return} ap\_pass\_brigade(f->\hyperlink{structap__filter__t_af4835ed2c41734061dc374d92ba401a2}{next}, bb);
861 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{h2__from__h1_8c_a6b193a2cf6997ed24315bbdaf409d5c8_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{h2__from__h1_8c_a6b193a2cf6997ed24315bbdaf409d5c8_icgraph}
\end{center}
\end{figure}


\index{h2\+\_\+from\+\_\+h1.\+c@{h2\+\_\+from\+\_\+h1.\+c}!h2\+\_\+from\+\_\+h1\+\_\+parse\+\_\+response@{h2\+\_\+from\+\_\+h1\+\_\+parse\+\_\+response}}
\index{h2\+\_\+from\+\_\+h1\+\_\+parse\+\_\+response@{h2\+\_\+from\+\_\+h1\+\_\+parse\+\_\+response}!h2\+\_\+from\+\_\+h1.\+c@{h2\+\_\+from\+\_\+h1.\+c}}
\subsubsection[{\texorpdfstring{h2\+\_\+from\+\_\+h1\+\_\+parse\+\_\+response(h2\+\_\+task $\ast$task, ap\+\_\+filter\+\_\+t $\ast$f, apr\+\_\+bucket\+\_\+brigade $\ast$bb)}{h2_from_h1_parse_response(h2_task *task, ap_filter_t *f, apr_bucket_brigade *bb)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf apr\+\_\+status\+\_\+t} h2\+\_\+from\+\_\+h1\+\_\+parse\+\_\+response (
\begin{DoxyParamCaption}
\item[{{\bf h2\+\_\+task} $\ast$}]{task, }
\item[{{\bf ap\+\_\+filter\+\_\+t} $\ast$}]{f, }
\item[{{\bf apr\+\_\+bucket\+\_\+brigade} $\ast$}]{bb}
\end{DoxyParamCaption}
)}\hypertarget{h2__from__h1_8c_a6a5a64e8257b75422c6d8e19b308bc41}{}\label{h2__from__h1_8c_a6a5a64e8257b75422c6d8e19b308bc41}

\begin{DoxyCode}
467 \{
468     \hyperlink{structh2__response__parser}{h2\_response\_parser} *\hyperlink{group__APR__Util__XML_ga770a26ab91fad38f2253d5450d6e600e}{parser} = task->\hyperlink{structh2__task_a3681f0a2c396a3e027ad2dc9b50c15ef}{output}.
      \hyperlink{structh2__task_a5e084710fc474d46f4033d7600eb9443}{rparser};
469     \textcolor{keywordtype}{char} \hyperlink{group__APACHE__CORE__LOG_gaa843820216dea79b53a16310cb08e8dd}{line}[\hyperlink{group__APACHE__CORE__DAEMON_ga0c9dd98f46b90b5bcd4cbf75e252d0da}{HUGE\_STRING\_LEN}];
470     \hyperlink{group__apr__errno_gaa5105fa83cc322f09382292db8b47593}{apr\_status\_t} \hyperlink{group__APACHE__CORE__HTTPD_ga6e27f49150e9a14580fb313cc2777e00}{status} = \hyperlink{group__apr__errno_ga9ee311b7bf1c691dc521d721339ee2a6}{APR\_SUCCESS};
471 
472     \textcolor{keywordflow}{if} (!parser) \{
473         parser = \hyperlink{group__apr__pools_gad214fc0160de3c22b6435e29ea20fce8}{apr\_pcalloc}(task->\hyperlink{structh2__task_a49fad74f9497dd0ede7236b13a59f228}{pool}, \textcolor{keyword}{sizeof}(*parser));
474         parser->\hyperlink{structh2__response__parser_a884c4a419a3bdc78b5f60c15b62f07e0}{task} = task;
475         parser->\hyperlink{structh2__response__parser_a2dca95fd3da88f6198a4a0ee29273ae3}{state} = \hyperlink{h2__from__h1_8c_ab57c457e2d72c3fee19ac0cd13e114c2af5482c1671774dabd5cabfeb99ec2d63}{H2\_RP\_STATUS\_LINE};
476         parser->\hyperlink{structh2__response__parser_af9174b48d6064ff9e262fb315ff650af}{hlines} = apr\_array\_make(task->\hyperlink{structh2__task_a49fad74f9497dd0ede7236b13a59f228}{pool}, 10, \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{char} *));
477         task->\hyperlink{structh2__task_a3681f0a2c396a3e027ad2dc9b50c15ef}{output}.\hyperlink{structh2__task_a5e084710fc474d46f4033d7600eb9443}{rparser} = \hyperlink{group__APR__Util__XML_ga770a26ab91fad38f2253d5450d6e600e}{parser};
478     \}
479     
480     \textcolor{keywordflow}{while} (!\hyperlink{group__APR__Util__Bucket__Brigades_ga836f61da6cce15074eff257ce4b6fc0f}{APR\_BRIGADE\_EMPTY}(bb) && status == \hyperlink{group__apr__errno_ga9ee311b7bf1c691dc521d721339ee2a6}{APR\_SUCCESS}) \{
481         \textcolor{keywordflow}{switch} (parser->\hyperlink{structh2__response__parser_a2dca95fd3da88f6198a4a0ee29273ae3}{state}) \{
482             \textcolor{keywordflow}{case} \hyperlink{h2__from__h1_8c_ab57c457e2d72c3fee19ac0cd13e114c2af5482c1671774dabd5cabfeb99ec2d63}{H2\_RP\_STATUS\_LINE}:
483             \textcolor{keywordflow}{case} \hyperlink{h2__from__h1_8c_ab57c457e2d72c3fee19ac0cd13e114c2aa0ed69d5cfe7ceef778af9c7d9b09839}{H2\_RP\_HEADER\_LINE}:
484                 status = get\_line(parser, bb, line, \textcolor{keyword}{sizeof}(line));
485                 \textcolor{keywordflow}{if} (status == \hyperlink{group__APR__Error_ga0b2a5ebb819de5ce93d326939b586578}{APR\_EAGAIN}) \{
486                     \textcolor{comment}{/* need more data */}
487                     \textcolor{keywordflow}{return} \hyperlink{group__apr__errno_ga9ee311b7bf1c691dc521d721339ee2a6}{APR\_SUCCESS};
488                 \}
489                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (status != \hyperlink{group__apr__errno_ga9ee311b7bf1c691dc521d721339ee2a6}{APR\_SUCCESS}) \{
490                     \textcolor{keywordflow}{return} \hyperlink{group__APACHE__CORE__HTTPD_ga6e27f49150e9a14580fb313cc2777e00}{status};
491                 \}
492                 \textcolor{keywordflow}{if} (parser->\hyperlink{structh2__response__parser_a2dca95fd3da88f6198a4a0ee29273ae3}{state} == \hyperlink{h2__from__h1_8c_ab57c457e2d72c3fee19ac0cd13e114c2af5482c1671774dabd5cabfeb99ec2d63}{H2\_RP\_STATUS\_LINE}) \{
493                     \textcolor{comment}{/* instead of parsing, just take it directly */}
494                     status = parse\_status(task, line);
495                 \}
496                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (line[0] == \textcolor{charliteral}{'\(\backslash\)0'}) \{
497                     \textcolor{comment}{/* end of headers, pass response onward */}
498                     \hyperlink{group__APACHE__CORE__LOG_ga60ef6919b8e1b691b0c1ac4d67c9449f}{ap\_log\_cerror}(\hyperlink{group__APACHE__CORE__LOG_ga655e126996849bcb82e4e5a14c616f4a}{APLOG\_MARK}, 
      \hyperlink{group__APACHE__CORE__LOG_gab08ab6d0e9ab24707ce7baeaecf1f551}{APLOG\_TRACE1}, 0, f->\hyperlink{structap__filter__t_afb039953f0c62d8455aa9f4bdd3ef487}{c},
499                                   \textcolor{stringliteral}{"h2\_task(%s): end of response"}, task->\hyperlink{structh2__task_ad51ebc1a6948a168b5b8c0b589e3d3cd}{id});
500                     \textcolor{keywordflow}{return} pass\_response(task, f, parser);
501                 \}
502                 \textcolor{keywordflow}{else} \{
503                     \hyperlink{group__APACHE__CORE__LOG_ga60ef6919b8e1b691b0c1ac4d67c9449f}{ap\_log\_cerror}(\hyperlink{group__APACHE__CORE__LOG_ga655e126996849bcb82e4e5a14c616f4a}{APLOG\_MARK}, 
      \hyperlink{group__APACHE__CORE__LOG_gab08ab6d0e9ab24707ce7baeaecf1f551}{APLOG\_TRACE1}, 0, f->\hyperlink{structap__filter__t_afb039953f0c62d8455aa9f4bdd3ef487}{c},
504                                   \textcolor{stringliteral}{"h2\_task(%s): response header %s"}, task->\hyperlink{structh2__task_ad51ebc1a6948a168b5b8c0b589e3d3cd}{id}, line);
505                     status = parse\_header(parser, line);
506                 \}
507                 \textcolor{keywordflow}{break};
508                 
509             \textcolor{keywordflow}{default}:
510                 \textcolor{keywordflow}{return} \hyperlink{group__APACHE__CORE__HTTPD_ga6e27f49150e9a14580fb313cc2777e00}{status};
511         \}
512     \}
513     \textcolor{keywordflow}{return} \hyperlink{group__APACHE__CORE__HTTPD_ga6e27f49150e9a14580fb313cc2777e00}{status};
514 \}
\end{DoxyCode}
