\hypertarget{http__request_8c}{}\section{/usr/local/src/github/\+Codebase/httpd-\/2.4.29/modules/http/http\+\_\+request.c File Reference}
\label{http__request_8c}\index{/usr/local/src/github/\+Codebase/httpd-\/2.\+4.\+29/modules/http/http\+\_\+request.\+c@{/usr/local/src/github/\+Codebase/httpd-\/2.\+4.\+29/modules/http/http\+\_\+request.\+c}}
{\ttfamily \#include \char`\"{}apr\+\_\+strings.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}apr\+\_\+file\+\_\+io.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}apr\+\_\+fnmatch.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}apr\+\_\+want.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}ap\+\_\+config.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}httpd.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}http\+\_\+config.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}http\+\_\+request.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}http\+\_\+core.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}http\+\_\+protocol.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}http\+\_\+log.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}http\+\_\+main.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}util\+\_\+filter.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}util\+\_\+charset.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}scoreboard.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}mod\+\_\+core.\+h\char`\"{}}\\*
Include dependency graph for http\+\_\+request.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{http__request_8c__incl}
\end{center}
\end{figure}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{http__request_8c_a88a4bf7f483aad3f3945773f3383e713}{A\+P\+R\+\_\+\+W\+A\+N\+T\+\_\+\+S\+T\+R\+F\+U\+NC}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{http__request_8c_a37ae841b95b3db4fe711e6d0009a891c}{A\+P\+L\+O\+G\+\_\+\+U\+S\+E\+\_\+\+M\+O\+D\+U\+LE} (\hyperlink{NON-AUTOTOOLS-BUILD_8txt_a09b6b093e95da29ef33ae68c3a1dc9aa}{http})
\item 
\hyperlink{group__hooks_ga2991c49e63464ffbc0a6d82f1878f0cd}{A\+P\+\_\+\+D\+E\+C\+L\+A\+RE} (\hyperlink{group__MOD__ISAPI_gacd6cdbf73df3d9eed42fa493d9b621a6}{void})
\item 
\hyperlink{http__request_8c_ad4e49a371518f348d13b2d4e83b79b9e}{A\+P\+\_\+\+D\+E\+C\+L\+A\+RE} (\hyperlink{group__apr__errno_gaa5105fa83cc322f09382292db8b47593}{apr\+\_\+status\+\_\+t})
\item 
\hyperlink{group__MOD__ISAPI_gacd6cdbf73df3d9eed42fa493d9b621a6}{void} \hyperlink{group__APACHE__CORE__REQ_gac4b59de5959473d7a72f98f8a274e50e}{ap\+\_\+process\+\_\+async\+\_\+request} (\hyperlink{structrequest__rec}{request\+\_\+rec} $\ast$\hyperlink{pcregrep_8txt_a2e9e9438b26c0bb4425367a7e4f75eb3}{r})
\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\index{http\+\_\+request.\+c@{http\+\_\+request.\+c}!A\+P\+R\+\_\+\+W\+A\+N\+T\+\_\+\+S\+T\+R\+F\+U\+NC@{A\+P\+R\+\_\+\+W\+A\+N\+T\+\_\+\+S\+T\+R\+F\+U\+NC}}
\index{A\+P\+R\+\_\+\+W\+A\+N\+T\+\_\+\+S\+T\+R\+F\+U\+NC@{A\+P\+R\+\_\+\+W\+A\+N\+T\+\_\+\+S\+T\+R\+F\+U\+NC}!http\+\_\+request.\+c@{http\+\_\+request.\+c}}
\subsubsection[{\texorpdfstring{A\+P\+R\+\_\+\+W\+A\+N\+T\+\_\+\+S\+T\+R\+F\+U\+NC}{APR_WANT_STRFUNC}}]{\setlength{\rightskip}{0pt plus 5cm}\#define A\+P\+R\+\_\+\+W\+A\+N\+T\+\_\+\+S\+T\+R\+F\+U\+NC}\hypertarget{http__request_8c_a88a4bf7f483aad3f3945773f3383e713}{}\label{http__request_8c_a88a4bf7f483aad3f3945773f3383e713}


\subsection{Function Documentation}
\index{http\+\_\+request.\+c@{http\+\_\+request.\+c}!A\+P\+\_\+\+D\+E\+C\+L\+A\+RE@{A\+P\+\_\+\+D\+E\+C\+L\+A\+RE}}
\index{A\+P\+\_\+\+D\+E\+C\+L\+A\+RE@{A\+P\+\_\+\+D\+E\+C\+L\+A\+RE}!http\+\_\+request.\+c@{http\+\_\+request.\+c}}
\subsubsection[{\texorpdfstring{A\+P\+\_\+\+D\+E\+C\+L\+A\+R\+E(apr\+\_\+status\+\_\+t)}{AP_DECLARE(apr_status_t)}}]{\setlength{\rightskip}{0pt plus 5cm}A\+P\+\_\+\+D\+E\+C\+L\+A\+RE (
\begin{DoxyParamCaption}
\item[{{\bf apr\+\_\+status\+\_\+t}}]{}
\end{DoxyParamCaption}
)}\hypertarget{http__request_8c_ad4e49a371518f348d13b2d4e83b79b9e}{}\label{http__request_8c_ad4e49a371518f348d13b2d4e83b79b9e}

\begin{DoxyCode}
233 \{
234     \hyperlink{group__apr__errno_gaa5105fa83cc322f09382292db8b47593}{apr\_status\_t} rv = \hyperlink{group__APR__Error_ga35d9dca2514c522a2840aca0f3e2ebd3}{APR\_EOF};
235     \hyperlink{util__filter_8h_ab570898d09fbbe5b6d838e28b90134e0}{ap\_input\_mode\_t} \hyperlink{group__APACHE__CORE__FILTER_gad194431669b7d1f96d2dacfb7be21261}{mode} = \hyperlink{util__filter_8h_ab570898d09fbbe5b6d838e28b90134e0a172cd500372b39626bc718a82690edab}{AP\_MODE\_SPECULATIVE};
236     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} num\_blank\_lines = 0;
237     \hyperlink{group__apr__platform_gaaa72b2253f6f3032cefea5712a27540e}{apr\_size\_t} \hyperlink{pcre_8txt_a95c3ea910546409284e31a4373d89c95}{cr} = 0;
238     \textcolor{keywordtype}{char} \hyperlink{group__APACHE__CORE__PROTO_ga17bc47ccf1b618ed082a4ff4f2cc7f7e}{buf}[2];
239 
240     \textcolor{keywordflow}{while} (\hyperlink{group__APACHE__CORE__HTTPD_ga7cce37ef8558e46f408cb4d0f555605b}{c}->\hyperlink{structconn__rec_a1e310dc6cfa709f96db50472a0d2382b}{keepalive} != \hyperlink{group__APACHE__CORE__DAEMON_gga0fc39bb8f47f9c1f418f28354416db79ac991e8ec951fe03c8c2f36495859034d}{AP\_CONN\_CLOSE} && !\hyperlink{group__APACHE__CORE__HTTPD_ga7cce37ef8558e46f408cb4d0f555605b}{c}->\hyperlink{structconn__rec_aead9e56515e09e4f4b32a543e988e123}{aborted}) \{
241         \hyperlink{group__apr__platform_gaaa72b2253f6f3032cefea5712a27540e}{apr\_size\_t} \hyperlink{group__APACHE__CORE__LOG_gab5a43233d60ef05c5b5bf5cba3d74468}{len} = cr + 1;
242 
243         apr\_brigade\_cleanup(\hyperlink{group__APACHE__CORE__PROTO_gaa3f67fb4e98cad3cf7b1633f8d7be67a}{bb});
244         rv = ap\_get\_brigade(\hyperlink{group__APACHE__CORE__HTTPD_ga7cce37ef8558e46f408cb4d0f555605b}{c}->\hyperlink{structconn__rec_a27bcfa99aac415734fedbb540ab7a3e7}{input\_filters}, \hyperlink{group__APACHE__CORE__PROTO_gaa3f67fb4e98cad3cf7b1633f8d7be67a}{bb}, mode,
245                             \hyperlink{group__APR__Util__Bucket__Brigades_gga756973fb6392bd1026c3d96b4519776da42b97663ca71fbbf2e2af7c8192e5dd8}{APR\_NONBLOCK\_READ}, len);
246         \textcolor{keywordflow}{if} (rv != \hyperlink{group__apr__errno_ga9ee311b7bf1c691dc521d721339ee2a6}{APR\_SUCCESS} || \hyperlink{group__APR__Util__Bucket__Brigades_ga836f61da6cce15074eff257ce4b6fc0f}{APR\_BRIGADE\_EMPTY}(
      \hyperlink{group__APACHE__CORE__PROTO_gaa3f67fb4e98cad3cf7b1633f8d7be67a}{bb}) || !\hyperlink{group__APACHE__CORE__REQ_ga8981c00bd5fdeab9cb31b1ce3c0d9d7e}{max\_blank\_lines}) \{
247             \textcolor{keywordflow}{if} (mode == \hyperlink{util__filter_8h_ab570898d09fbbe5b6d838e28b90134e0a2d8e63e1da380c3909ac0a1325339de4}{AP\_MODE\_READBYTES}) \{
248                 \textcolor{comment}{/* Unexpected error, stop with this connection */}
249                 \hyperlink{group__APACHE__CORE__LOG_ga60ef6919b8e1b691b0c1ac4d67c9449f}{ap\_log\_cerror}(\hyperlink{group__APACHE__CORE__LOG_ga655e126996849bcb82e4e5a14c616f4a}{APLOG\_MARK}, \hyperlink{group__APACHE__CORE__LOG_ga57ad94ed8c92c4306de90479251a5d58}{APLOG\_ERR}, rv, 
      \hyperlink{group__APACHE__CORE__HTTPD_ga7cce37ef8558e46f408cb4d0f555605b}{c}, \hyperlink{group__APACHE__CORE__LOG_ga1dee8a07e06bc5b3de8b89662c2cd666}{APLOGNO}(02967)
250                               \textcolor{stringliteral}{"Can't consume pipelined empty lines"});
251                 \hyperlink{group__APACHE__CORE__HTTPD_ga7cce37ef8558e46f408cb4d0f555605b}{c}->\hyperlink{structconn__rec_a1e310dc6cfa709f96db50472a0d2382b}{keepalive} = \hyperlink{group__APACHE__CORE__DAEMON_gga0fc39bb8f47f9c1f418f28354416db79ac991e8ec951fe03c8c2f36495859034d}{AP\_CONN\_CLOSE};
252                 rv = \hyperlink{group__APR__Error_ga18f5678bea0c2c704a2b6a186c9e158b}{APR\_EGENERAL};
253             \}
254             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (rv != \hyperlink{group__apr__errno_ga9ee311b7bf1c691dc521d721339ee2a6}{APR\_SUCCESS} || \hyperlink{group__APR__Util__Bucket__Brigades_ga836f61da6cce15074eff257ce4b6fc0f}{APR\_BRIGADE\_EMPTY}(
      \hyperlink{group__APACHE__CORE__PROTO_gaa3f67fb4e98cad3cf7b1633f8d7be67a}{bb})) \{
255                 \textcolor{keywordflow}{if} (rv != \hyperlink{group__apr__errno_ga9ee311b7bf1c691dc521d721339ee2a6}{APR\_SUCCESS} && !\hyperlink{group__APR__STATUS__IS_ga9dd578bfcd76a2d997395608ae5b3a4e}{APR\_STATUS\_IS\_EAGAIN}(rv)) \{
256                     \textcolor{comment}{/* Pipe is dead */}
257                     \hyperlink{group__APACHE__CORE__HTTPD_ga7cce37ef8558e46f408cb4d0f555605b}{c}->\hyperlink{structconn__rec_a1e310dc6cfa709f96db50472a0d2382b}{keepalive} = \hyperlink{group__APACHE__CORE__DAEMON_gga0fc39bb8f47f9c1f418f28354416db79ac991e8ec951fe03c8c2f36495859034d}{AP\_CONN\_CLOSE};
258                 \}
259                 \textcolor{keywordflow}{else} \{
260                     \textcolor{comment}{/* Pipe is up and empty */}
261                     rv = \hyperlink{group__APR__Error_ga0b2a5ebb819de5ce93d326939b586578}{APR\_EAGAIN};
262                 \}
263             \}
264             \textcolor{keywordflow}{else} \{
265                 \hyperlink{group__apr__platform_ga6938af9075cec15c88299109381aa984}{apr\_off\_t} \hyperlink{group__APACHE__CORE__PROTO_gad484edfd58b9127caa8f0f59b4004d09}{n} = 0;
266                 \textcolor{comment}{/* Single read asked, (non-meta-)data available? */}
267                 rv = apr\_brigade\_length(\hyperlink{group__APACHE__CORE__PROTO_gaa3f67fb4e98cad3cf7b1633f8d7be67a}{bb}, 0, &n);
268                 \textcolor{keywordflow}{if} (rv == \hyperlink{group__apr__errno_ga9ee311b7bf1c691dc521d721339ee2a6}{APR\_SUCCESS} && n <= 0) \{
269                     rv = \hyperlink{group__APR__Error_ga0b2a5ebb819de5ce93d326939b586578}{APR\_EAGAIN};
270                 \}
271             \}
272             \textcolor{keywordflow}{break};
273         \}
274 
275         \textcolor{comment}{/* Lookup and consume blank lines */}
276         rv = apr\_brigade\_flatten(\hyperlink{group__APACHE__CORE__PROTO_gaa3f67fb4e98cad3cf7b1633f8d7be67a}{bb}, buf, &len);
277         \textcolor{keywordflow}{if} (rv != \hyperlink{group__apr__errno_ga9ee311b7bf1c691dc521d721339ee2a6}{APR\_SUCCESS} || len != cr + 1) \{
278             \textcolor{keywordtype}{int} log\_level;
279             \textcolor{keywordflow}{if} (mode == \hyperlink{util__filter_8h_ab570898d09fbbe5b6d838e28b90134e0a2d8e63e1da380c3909ac0a1325339de4}{AP\_MODE\_READBYTES}) \{
280                 \textcolor{comment}{/* Unexpected error, stop with this connection */}
281                 \hyperlink{group__APACHE__CORE__HTTPD_ga7cce37ef8558e46f408cb4d0f555605b}{c}->\hyperlink{structconn__rec_a1e310dc6cfa709f96db50472a0d2382b}{keepalive} = \hyperlink{group__APACHE__CORE__DAEMON_gga0fc39bb8f47f9c1f418f28354416db79ac991e8ec951fe03c8c2f36495859034d}{AP\_CONN\_CLOSE};
282                 log\_level = \hyperlink{group__APACHE__CORE__LOG_ga57ad94ed8c92c4306de90479251a5d58}{APLOG\_ERR};
283                 rv = \hyperlink{group__APR__Error_ga18f5678bea0c2c704a2b6a186c9e158b}{APR\_EGENERAL};
284             \}
285             \textcolor{keywordflow}{else} \{
286                 \textcolor{comment}{/* Let outside (non-speculative/blocking) read determine}
287 \textcolor{comment}{                 * where this possible failure comes from (metadata,}
288 \textcolor{comment}{                 * morphed EOF socket, ...). Debug only here.}
289 \textcolor{comment}{                 */}
290                 log\_level = \hyperlink{group__APACHE__CORE__LOG_gadfcef90537539cf2b7d35cfbbbafeb93}{APLOG\_DEBUG};
291                 rv = \hyperlink{group__apr__errno_ga9ee311b7bf1c691dc521d721339ee2a6}{APR\_SUCCESS};
292             \}
293             \hyperlink{group__APACHE__CORE__LOG_ga60ef6919b8e1b691b0c1ac4d67c9449f}{ap\_log\_cerror}(\hyperlink{group__APACHE__CORE__LOG_ga655e126996849bcb82e4e5a14c616f4a}{APLOG\_MARK}, log\_level, rv, \hyperlink{group__APACHE__CORE__HTTPD_ga7cce37ef8558e46f408cb4d0f555605b}{c}, 
      \hyperlink{group__APACHE__CORE__LOG_ga1dee8a07e06bc5b3de8b89662c2cd666}{APLOGNO}(02968)
294                           \textcolor{stringliteral}{"Can't check pipelined data"});
295             \textcolor{keywordflow}{break};
296         \}
297 
298         \textcolor{keywordflow}{if} (mode == \hyperlink{util__filter_8h_ab570898d09fbbe5b6d838e28b90134e0a2d8e63e1da380c3909ac0a1325339de4}{AP\_MODE\_READBYTES}) \{
299             \textcolor{comment}{/* [CR]LF consumed, try next */}
300             mode = \hyperlink{util__filter_8h_ab570898d09fbbe5b6d838e28b90134e0a172cd500372b39626bc718a82690edab}{AP\_MODE\_SPECULATIVE};
301             cr = 0;
302         \}
303         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (cr) \{
304             \hyperlink{group__APACHE__CORE__DAEMON_ga85dbc1e4d9600422461f815193f8ace8}{AP\_DEBUG\_ASSERT}(len == 2 && buf[0] == \hyperlink{group__apr__general_ga91c14ef7f03e82c07f4d3d56f63f8b6a}{APR\_ASCII\_CR});
305             \textcolor{keywordflow}{if} (buf[1] == \hyperlink{group__apr__general_ga9e76601cef56a7a5b25f73fe6d57d7d9}{APR\_ASCII\_LF}) \{
306                 \textcolor{comment}{/* consume this CRLF */}
307                 mode = \hyperlink{util__filter_8h_ab570898d09fbbe5b6d838e28b90134e0a2d8e63e1da380c3909ac0a1325339de4}{AP\_MODE\_READBYTES};
308                 num\_blank\_lines++;
309             \}
310             \textcolor{keywordflow}{else} \{
311                 \textcolor{comment}{/* CR(?!LF) is data */}
312                 \textcolor{keywordflow}{break};
313             \}
314         \}
315         \textcolor{keywordflow}{else} \{
316             \textcolor{keywordflow}{if} (buf[0] == \hyperlink{group__apr__general_ga9e76601cef56a7a5b25f73fe6d57d7d9}{APR\_ASCII\_LF}) \{
317                 \textcolor{comment}{/* consume this LF */}
318                 mode = \hyperlink{util__filter_8h_ab570898d09fbbe5b6d838e28b90134e0a2d8e63e1da380c3909ac0a1325339de4}{AP\_MODE\_READBYTES};
319                 num\_blank\_lines++;
320             \}
321             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (buf[0] == \hyperlink{group__apr__general_ga91c14ef7f03e82c07f4d3d56f63f8b6a}{APR\_ASCII\_CR}) \{
322                 cr = 1;
323             \}
324             \textcolor{keywordflow}{else} \{
325                 \textcolor{comment}{/* Not [CR]LF, some data */}
326                 \textcolor{keywordflow}{break};
327             \}
328         \}
329         \textcolor{keywordflow}{if} (num\_blank\_lines > \hyperlink{group__APACHE__CORE__REQ_ga8981c00bd5fdeab9cb31b1ce3c0d9d7e}{max\_blank\_lines}) \{
330             \textcolor{comment}{/* Enough blank lines with this connection,}
331 \textcolor{comment}{             * stop and don't recycle it.}
332 \textcolor{comment}{             */}
333             \hyperlink{group__APACHE__CORE__HTTPD_ga7cce37ef8558e46f408cb4d0f555605b}{c}->\hyperlink{structconn__rec_a1e310dc6cfa709f96db50472a0d2382b}{keepalive} = \hyperlink{group__APACHE__CORE__DAEMON_gga0fc39bb8f47f9c1f418f28354416db79ac991e8ec951fe03c8c2f36495859034d}{AP\_CONN\_CLOSE};
334             rv = \hyperlink{group__APR__Error_ga9bd83273ff02f31f71fb4dc6f29df4a9}{APR\_NOTFOUND};
335             \textcolor{keywordflow}{break};
336         \}
337     \}
338 
339     \textcolor{keywordflow}{return} rv;
340 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=282pt]{http__request_8c_ad4e49a371518f348d13b2d4e83b79b9e_cgraph}
\end{center}
\end{figure}


\index{http\+\_\+request.\+c@{http\+\_\+request.\+c}!A\+P\+L\+O\+G\+\_\+\+U\+S\+E\+\_\+\+M\+O\+D\+U\+LE@{A\+P\+L\+O\+G\+\_\+\+U\+S\+E\+\_\+\+M\+O\+D\+U\+LE}}
\index{A\+P\+L\+O\+G\+\_\+\+U\+S\+E\+\_\+\+M\+O\+D\+U\+LE@{A\+P\+L\+O\+G\+\_\+\+U\+S\+E\+\_\+\+M\+O\+D\+U\+LE}!http\+\_\+request.\+c@{http\+\_\+request.\+c}}
\subsubsection[{\texorpdfstring{A\+P\+L\+O\+G\+\_\+\+U\+S\+E\+\_\+\+M\+O\+D\+U\+L\+E(http)}{APLOG_USE_MODULE(http)}}]{\setlength{\rightskip}{0pt plus 5cm}A\+P\+L\+O\+G\+\_\+\+U\+S\+E\+\_\+\+M\+O\+D\+U\+LE (
\begin{DoxyParamCaption}
\item[{{\bf http}}]{}
\end{DoxyParamCaption}
)}\hypertarget{http__request_8c_a37ae841b95b3db4fe711e6d0009a891c}{}\label{http__request_8c_a37ae841b95b3db4fe711e6d0009a891c}
