\hypertarget{proxy__util_8c}{}\section{/usr/local/src/github/\+Codebase/httpd-\/2.4.29/modules/proxy/proxy\+\_\+util.c File Reference}
\label{proxy__util_8c}\index{/usr/local/src/github/\+Codebase/httpd-\/2.\+4.\+29/modules/proxy/proxy\+\_\+util.\+c@{/usr/local/src/github/\+Codebase/httpd-\/2.\+4.\+29/modules/proxy/proxy\+\_\+util.\+c}}
{\ttfamily \#include \char`\"{}mod\+\_\+proxy.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}ap\+\_\+mpm.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}scoreboard.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}apr\+\_\+version.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}apr\+\_\+hash.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}proxy\+\_\+util.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}ajp.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}scgi.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}apr\+\_\+support.\+h\char`\"{}}\\*
Include dependency graph for proxy\+\_\+util.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{proxy__util_8c__incl}
\end{center}
\end{figure}
\subsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structforward__info}{forward\+\_\+info}
\item 
struct \hyperlink{structheader__connection}{header\+\_\+connection}
\item 
struct \hyperlink{structproxy__schemes__t}{proxy\+\_\+schemes\+\_\+t}
\end{DoxyCompactItemize}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{proxy__util_8c_ad650fae448b62e217bcf3f0f8ddc52ef}{apr\+\_\+socket\+\_\+create}~apr\+\_\+socket\+\_\+create\+\_\+ex
\item 
\#define \hyperlink{proxy__util_8c_ac60a0619319528d607d18ab47a007103}{M\+A\+X\+\_\+\+I\+P\+\_\+\+S\+T\+R\+\_\+\+L\+EN}~(46)
\item 
\#define \hyperlink{proxy__util_8c_ace6f65d3c5e25044b1b655efbc52c9f3}{P\+R\+O\+X\+Y\+\_\+\+U\+N\+S\+E\+T\+\_\+\+N\+O\+N\+CE}~\textquotesingle{}\textbackslash{}\hyperlink{pcregrep_8txt_ab232d334efb9173a12ae2940d035f460}{n}\textquotesingle{}
\item 
\#define \hyperlink{proxy__util_8c_a110deb1c7cdf0fe2300c9e034b2ce7c8}{U\+S\+E\+\_\+\+A\+L\+T\+E\+R\+N\+A\+T\+E\+\_\+\+I\+S\+\_\+\+C\+O\+N\+N\+E\+C\+T\+ED}~1
\end{DoxyCompactItemize}
\subsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef struct \hyperlink{structheader__connection}{header\+\_\+connection} \hyperlink{proxy__util_8c_ae0f1aba1d09e67d1464361264869b2d8}{header\+\_\+connection}
\item 
typedef struct \hyperlink{structproxy__schemes__t}{proxy\+\_\+schemes\+\_\+t} \hyperlink{proxy__util_8c_a2f1e225efe81b8029285451fa3c90374}{proxy\+\_\+schemes\+\_\+t}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{proxy__util_8c_aee811a1f31a5fa14ab95b0c83df0cf2a}{A\+P\+L\+O\+G\+\_\+\+U\+S\+E\+\_\+\+M\+O\+D\+U\+LE} (proxy)
\item 
\hyperlink{proxy__util_8c_a35e77ebd2481f040c75b5d246b5c487c}{A\+P\+R\+\_\+\+I\+M\+P\+L\+E\+M\+E\+N\+T\+\_\+\+O\+P\+T\+I\+O\+N\+A\+L\+\_\+\+H\+O\+O\+K\+\_\+\+R\+U\+N\+\_\+\+A\+LL} (proxy, \hyperlink{group__MOD__PROXY_ga8a2d0523d70a5ec877fe8d89ef4ecd96}{P\+R\+O\+XY}, \hyperlink{pcre_8txt_a42dfa4ff673c82d8efe7144098fbc198}{int}, create\+\_\+req,(\hyperlink{structrequest__rec}{request\+\_\+rec} $\ast$\hyperlink{pcregrep_8txt_a2e9e9438b26c0bb4425367a7e4f75eb3}{r}, \hyperlink{structrequest__rec}{request\+\_\+rec} $\ast$pr),(\hyperlink{pcregrep_8txt_a2e9e9438b26c0bb4425367a7e4f75eb3}{r}, pr), \hyperlink{group__APACHE__CORE__DAEMON_gaba51915c87d64af47fb1cc59348961c9}{OK}, \hyperlink{group__APACHE__CORE__DAEMON_ga9eba11ca86461a3ae319311d64682dda}{D\+E\+C\+L\+I\+N\+ED})
\item 
\hyperlink{proxy__util_8c_ab8b131b879f2da190de9e2d128450143}{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE} (\hyperlink{pcre_8txt_a42dfa4ff673c82d8efe7144098fbc198}{int})
\item 
\hyperlink{proxy__util_8c_a9ced80174d35950697817a36a655de23}{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE} (\hyperlink{group__MOD__ISAPI_gacd6cdbf73df3d9eed42fa493d9b621a6}{void})
\item 
\hyperlink{proxy__util_8c_a1c03b3f7f69d399a646d84db4caaed65}{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE} (char $\ast$)
\item 
\hyperlink{proxy__util_8c_ae17d5feb294b5544536dba5e9b8a02ee}{ap\+\_\+proxy\+\_\+canon\+\_\+netloc} (\hyperlink{structapr__pool__t}{apr\+\_\+pool\+\_\+t} $\ast$\hyperlink{group__APACHE__CORE__MPM_ga5cd91701e5c167f2b1a38e70ab57817e}{p}, char $\ast$$\ast$const \hyperlink{group__MOD__PROXY_ga974d9b4d643e6776a5a12061b88b3ae3}{urlp}, char $\ast$$\ast$\hyperlink{group__MOD__PROXY_gafab7f01dc92afd3e79a59fe3a2ea5932}{userp}, char $\ast$$\ast$\hyperlink{group__MOD__PROXY_ga93be1099b442eb117913f581e856e788}{passwordp}, char $\ast$$\ast$\hyperlink{group__MOD__PROXY_ga85ac436260ffb27bcf16dae08faaebd4}{hostp}, \hyperlink{group__apr__network__io_gaa670a71960f6eb4fe0d0de2a1e7aba03}{apr\+\_\+port\+\_\+t} $\ast$\hyperlink{ab_8c_ab3bdaca3e004f9926a8c2530f1d9e9dc}{port})
\item 
\hyperlink{proxy__util_8c_a994976c3ebd4838c2112ff7cbdb15547}{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE} (const char $\ast$)
\item 
\hyperlink{proxy__util_8c_a79099e6d2f71bcc882b6b64ecd59fe8c}{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE} (\hyperlink{structproxy__balancer}{proxy\+\_\+balancer} $\ast$)
\item 
\hyperlink{proxy__util_8c_a43277b2a3035c3bb12ff3588a58a01e4}{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE} (\hyperlink{structproxy__worker}{proxy\+\_\+worker} $\ast$)
\item 
\hyperlink{proxy__util_8c_ade616416cb4f3a7356fa87cd3011325c}{ap\+\_\+proxy\+\_\+determine\+\_\+connection} (\hyperlink{structapr__pool__t}{apr\+\_\+pool\+\_\+t} $\ast$\hyperlink{group__APACHE__CORE__MPM_ga5cd91701e5c167f2b1a38e70ab57817e}{p}, \hyperlink{structrequest__rec}{request\+\_\+rec} $\ast$\hyperlink{pcregrep_8txt_a2e9e9438b26c0bb4425367a7e4f75eb3}{r}, \hyperlink{structproxy__server__conf}{proxy\+\_\+server\+\_\+conf} $\ast$\hyperlink{group__MOD__PROXY_ga4d7edd451c4bb8ed9ce9012e5dea2b14}{conf}, \hyperlink{structproxy__worker}{proxy\+\_\+worker} $\ast$\hyperlink{group__MOD__PROXY_gad62a732febc2b789c7a84e2fdb3c5aa8}{worker}, \hyperlink{structproxy__conn__rec}{proxy\+\_\+conn\+\_\+rec} $\ast$\hyperlink{group__MOD__PROXY_gaf26a520a5f2c0d567cd7732f04c925c2}{conn}, \hyperlink{structapr__uri__t}{apr\+\_\+uri\+\_\+t} $\ast$\hyperlink{group__APR__Util__XML_ga69ec24fb2d0a5f5e532deb9adaab81d6}{uri}, char $\ast$$\ast$\hyperlink{group__APR__Util__Escaping_gaec657bef26e5ff27b9442563a591d9ec}{url}, const char $\ast$\hyperlink{group__MOD__PROXY_gaa1c038713fefa564c88a58477a1b2001}{proxyname}, \hyperlink{group__apr__network__io_gaa670a71960f6eb4fe0d0de2a1e7aba03}{apr\+\_\+port\+\_\+t} \hyperlink{ab_8c_aafd282ad1fd2b2937f45c1cd22f143da}{proxyport}, char $\ast$\hyperlink{group__MOD__PROXY_ga802fad35b3c2f0228598874c678130a6}{server\+\_\+portstr}, \hyperlink{pcre_8txt_a42dfa4ff673c82d8efe7144098fbc198}{int} \hyperlink{group__MOD__PROXY_gace3850b28542570d38229df96ad5cdb8}{server\+\_\+portstr\+\_\+size})
\item 
\hyperlink{pcre_8txt_a42dfa4ff673c82d8efe7144098fbc198}{int} \hyperlink{group__MOD__PROXY_gaaec2ac8c37bf0cede6cbe1628a60a59a}{ap\+\_\+proxy\+\_\+lb\+\_\+workers} (\hyperlink{group__MOD__ISAPI_gacd6cdbf73df3d9eed42fa493d9b621a6}{void})
\item 
\hyperlink{proxy__util_8c_a894a8f960939418e2122523aa81b5dd0}{ap\+\_\+proxy\+\_\+hashfunc} (const char $\ast$\hyperlink{group__APR__Util__Bucket__Brigades_ga6a62b60443be1d042194af15ce934193}{str}, \hyperlink{group__MOD__PROXY_gad04e421d409d5c4b460cd62694ada47c}{proxy\+\_\+hash\+\_\+t} \hyperlink{ab_8c_a77deaf9d3339f8d07d067fa3c685023e}{method})
\item 
\hyperlink{proxy__util_8c_a1beab2264f256cb4c71d873d7ca3ff26}{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE} (\hyperlink{structproxy__worker__shared}{proxy\+\_\+worker\+\_\+shared} $\ast$)
\item 
\hyperlink{proxy__util_8c_a0f3cbd83fd7551835af4b1e11ded1e4a}{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE} (\hyperlink{structproxy__balancer__shared}{proxy\+\_\+balancer\+\_\+shared} $\ast$)
\item 
\hyperlink{proxy__util_8c_ac3c014c25a18c7216833afbd3e8498c5}{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE} (\hyperlink{group__apr__network__io_gaa670a71960f6eb4fe0d0de2a1e7aba03}{apr\+\_\+port\+\_\+t})
\item 
\hyperlink{group__MOD__ISAPI_gacd6cdbf73df3d9eed42fa493d9b621a6}{void} \hyperlink{group__MOD__PROXY__PRIVATE_ga8c7cf405b2ffa890bad1419c0a6fd5ca}{proxy\+\_\+util\+\_\+register\+\_\+hooks} (\hyperlink{structapr__pool__t}{apr\+\_\+pool\+\_\+t} $\ast$\hyperlink{group__APACHE__CORE__MPM_ga5cd91701e5c167f2b1a38e70ab57817e}{p})
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hyperlink{pcre_8txt_a42dfa4ff673c82d8efe7144098fbc198}{int} \hyperlink{group__MOD__PROXY_ga0446e2d44d50898071a7dcb4fd9172b0}{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+R\+E\+\_\+\+D\+A\+TA} \hyperlink{group__MOD__PROXY__PRIVATE_ga748653e1e5c4afc14fca2a4b57136259}{proxy\+\_\+lb\+\_\+workers} = 0
\item 
const \hyperlink{structapr__strmatch__pattern}{apr\+\_\+strmatch\+\_\+pattern} \hyperlink{group__MOD__PROXY_ga0446e2d44d50898071a7dcb4fd9172b0}{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+R\+E\+\_\+\+D\+A\+TA} $\ast$ \hyperlink{group__MOD__PROXY__PRIVATE_ga18e4b565b0367b56f721343a9cb1b583}{ap\+\_\+proxy\+\_\+strmatch\+\_\+path}
\item 
const \hyperlink{structapr__strmatch__pattern}{apr\+\_\+strmatch\+\_\+pattern} \hyperlink{group__MOD__PROXY_ga0446e2d44d50898071a7dcb4fd9172b0}{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+R\+E\+\_\+\+D\+A\+TA} $\ast$ \hyperlink{group__MOD__PROXY__PRIVATE_ga51ea3d4bbbae6e20c70369b859365103}{ap\+\_\+proxy\+\_\+strmatch\+\_\+domain}
\item 
\hyperlink{structapr__global__mutex__t}{apr\+\_\+global\+\_\+mutex\+\_\+t} $\ast$ \hyperlink{proxy__util_8c_a93b0fcd14bd51e35876e3ed7ec589d85}{proxy\+\_\+mutex}
\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\index{proxy\+\_\+util.\+c@{proxy\+\_\+util.\+c}!apr\+\_\+socket\+\_\+create@{apr\+\_\+socket\+\_\+create}}
\index{apr\+\_\+socket\+\_\+create@{apr\+\_\+socket\+\_\+create}!proxy\+\_\+util.\+c@{proxy\+\_\+util.\+c}}
\subsubsection[{\texorpdfstring{apr\+\_\+socket\+\_\+create}{apr_socket_create}}]{\setlength{\rightskip}{0pt plus 5cm}\#define apr\+\_\+socket\+\_\+create~apr\+\_\+socket\+\_\+create\+\_\+ex}\hypertarget{proxy__util_8c_ad650fae448b62e217bcf3f0f8ddc52ef}{}\label{proxy__util_8c_ad650fae448b62e217bcf3f0f8ddc52ef}
\index{proxy\+\_\+util.\+c@{proxy\+\_\+util.\+c}!M\+A\+X\+\_\+\+I\+P\+\_\+\+S\+T\+R\+\_\+\+L\+EN@{M\+A\+X\+\_\+\+I\+P\+\_\+\+S\+T\+R\+\_\+\+L\+EN}}
\index{M\+A\+X\+\_\+\+I\+P\+\_\+\+S\+T\+R\+\_\+\+L\+EN@{M\+A\+X\+\_\+\+I\+P\+\_\+\+S\+T\+R\+\_\+\+L\+EN}!proxy\+\_\+util.\+c@{proxy\+\_\+util.\+c}}
\subsubsection[{\texorpdfstring{M\+A\+X\+\_\+\+I\+P\+\_\+\+S\+T\+R\+\_\+\+L\+EN}{MAX_IP_STR_LEN}}]{\setlength{\rightskip}{0pt plus 5cm}\#define M\+A\+X\+\_\+\+I\+P\+\_\+\+S\+T\+R\+\_\+\+L\+EN~(46)}\hypertarget{proxy__util_8c_ac60a0619319528d607d18ab47a007103}{}\label{proxy__util_8c_ac60a0619319528d607d18ab47a007103}
\index{proxy\+\_\+util.\+c@{proxy\+\_\+util.\+c}!P\+R\+O\+X\+Y\+\_\+\+U\+N\+S\+E\+T\+\_\+\+N\+O\+N\+CE@{P\+R\+O\+X\+Y\+\_\+\+U\+N\+S\+E\+T\+\_\+\+N\+O\+N\+CE}}
\index{P\+R\+O\+X\+Y\+\_\+\+U\+N\+S\+E\+T\+\_\+\+N\+O\+N\+CE@{P\+R\+O\+X\+Y\+\_\+\+U\+N\+S\+E\+T\+\_\+\+N\+O\+N\+CE}!proxy\+\_\+util.\+c@{proxy\+\_\+util.\+c}}
\subsubsection[{\texorpdfstring{P\+R\+O\+X\+Y\+\_\+\+U\+N\+S\+E\+T\+\_\+\+N\+O\+N\+CE}{PROXY_UNSET_NONCE}}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\+R\+O\+X\+Y\+\_\+\+U\+N\+S\+E\+T\+\_\+\+N\+O\+N\+CE~\textquotesingle{}\textbackslash{}{\bf n}\textquotesingle{}}\hypertarget{proxy__util_8c_ace6f65d3c5e25044b1b655efbc52c9f3}{}\label{proxy__util_8c_ace6f65d3c5e25044b1b655efbc52c9f3}
\index{proxy\+\_\+util.\+c@{proxy\+\_\+util.\+c}!U\+S\+E\+\_\+\+A\+L\+T\+E\+R\+N\+A\+T\+E\+\_\+\+I\+S\+\_\+\+C\+O\+N\+N\+E\+C\+T\+ED@{U\+S\+E\+\_\+\+A\+L\+T\+E\+R\+N\+A\+T\+E\+\_\+\+I\+S\+\_\+\+C\+O\+N\+N\+E\+C\+T\+ED}}
\index{U\+S\+E\+\_\+\+A\+L\+T\+E\+R\+N\+A\+T\+E\+\_\+\+I\+S\+\_\+\+C\+O\+N\+N\+E\+C\+T\+ED@{U\+S\+E\+\_\+\+A\+L\+T\+E\+R\+N\+A\+T\+E\+\_\+\+I\+S\+\_\+\+C\+O\+N\+N\+E\+C\+T\+ED}!proxy\+\_\+util.\+c@{proxy\+\_\+util.\+c}}
\subsubsection[{\texorpdfstring{U\+S\+E\+\_\+\+A\+L\+T\+E\+R\+N\+A\+T\+E\+\_\+\+I\+S\+\_\+\+C\+O\+N\+N\+E\+C\+T\+ED}{USE_ALTERNATE_IS_CONNECTED}}]{\setlength{\rightskip}{0pt plus 5cm}\#define U\+S\+E\+\_\+\+A\+L\+T\+E\+R\+N\+A\+T\+E\+\_\+\+I\+S\+\_\+\+C\+O\+N\+N\+E\+C\+T\+ED~1}\hypertarget{proxy__util_8c_a110deb1c7cdf0fe2300c9e034b2ce7c8}{}\label{proxy__util_8c_a110deb1c7cdf0fe2300c9e034b2ce7c8}


\subsection{Typedef Documentation}
\index{proxy\+\_\+util.\+c@{proxy\+\_\+util.\+c}!header\+\_\+connection@{header\+\_\+connection}}
\index{header\+\_\+connection@{header\+\_\+connection}!proxy\+\_\+util.\+c@{proxy\+\_\+util.\+c}}
\subsubsection[{\texorpdfstring{header\+\_\+connection}{header_connection}}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf header\+\_\+connection}  {\bf header\+\_\+connection}}\hypertarget{proxy__util_8c_ae0f1aba1d09e67d1464361264869b2d8}{}\label{proxy__util_8c_ae0f1aba1d09e67d1464361264869b2d8}
\index{proxy\+\_\+util.\+c@{proxy\+\_\+util.\+c}!proxy\+\_\+schemes\+\_\+t@{proxy\+\_\+schemes\+\_\+t}}
\index{proxy\+\_\+schemes\+\_\+t@{proxy\+\_\+schemes\+\_\+t}!proxy\+\_\+util.\+c@{proxy\+\_\+util.\+c}}
\subsubsection[{\texorpdfstring{proxy\+\_\+schemes\+\_\+t}{proxy_schemes_t}}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf proxy\+\_\+schemes\+\_\+t}  {\bf proxy\+\_\+schemes\+\_\+t}}\hypertarget{proxy__util_8c_a2f1e225efe81b8029285451fa3c90374}{}\label{proxy__util_8c_a2f1e225efe81b8029285451fa3c90374}


\subsection{Function Documentation}
\index{proxy\+\_\+util.\+c@{proxy\+\_\+util.\+c}!ap\+\_\+proxy\+\_\+canon\+\_\+netloc@{ap\+\_\+proxy\+\_\+canon\+\_\+netloc}}
\index{ap\+\_\+proxy\+\_\+canon\+\_\+netloc@{ap\+\_\+proxy\+\_\+canon\+\_\+netloc}!proxy\+\_\+util.\+c@{proxy\+\_\+util.\+c}}
\subsubsection[{\texorpdfstring{ap\+\_\+proxy\+\_\+canon\+\_\+netloc(apr\+\_\+pool\+\_\+t $\ast$p, char $\ast$$\ast$const urlp, char $\ast$$\ast$userp, char $\ast$$\ast$passwordp, char $\ast$$\ast$hostp, apr\+\_\+port\+\_\+t $\ast$port)}{ap_proxy_canon_netloc(apr_pool_t *p, char **const urlp, char **userp, char **passwordp, char **hostp, apr_port_t *port)}}]{\setlength{\rightskip}{0pt plus 5cm}ap\+\_\+proxy\+\_\+canon\+\_\+netloc (
\begin{DoxyParamCaption}
\item[{{\bf apr\+\_\+pool\+\_\+t} $\ast$}]{p, }
\item[{char $\ast$$\ast$const}]{urlp, }
\item[{char $\ast$$\ast$}]{userp, }
\item[{char $\ast$$\ast$}]{passwordp, }
\item[{char $\ast$$\ast$}]{hostp, }
\item[{{\bf apr\+\_\+port\+\_\+t} $\ast$}]{port}
\end{DoxyParamCaption}
)}\hypertarget{proxy__util_8c_ae17d5feb294b5544536dba5e9b8a02ee}{}\label{proxy__util_8c_ae17d5feb294b5544536dba5e9b8a02ee}

\begin{DoxyCode}
294 \{
295     \textcolor{keywordtype}{char} *\hyperlink{group__MOD__PROXY_ga6d5ecaf37baca2c5cd2dfca34109da7e}{addr}, *\hyperlink{group__apr__network__io_gac03f4c1705dcf958f913d4fdcaab00b5}{scope\_id}, *strp, *\hyperlink{group__APACHE__CORE__VHOST_ga8c8ad0616f1a1fed66e67a90a116a76c}{host}, *\hyperlink{group__MOD__PROXY_ga05d2db9f2dd75d18170f192bd1cc9b4e}{url} = *\hyperlink{group__MOD__PROXY_ga974d9b4d643e6776a5a12061b88b3ae3}{urlp};
296     \textcolor{keywordtype}{char} *user = \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL}, *\hyperlink{group__APACHE__CORE__PROTO_ga69b970a42043daa64861aba281a1e6f0}{password} = \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL};
297     \hyperlink{group__apr__network__io_gaa670a71960f6eb4fe0d0de2a1e7aba03}{apr\_port\_t} tmp\_port;
298     \hyperlink{group__apr__errno_gaa5105fa83cc322f09382292db8b47593}{apr\_status\_t} rv;
299 
300     \textcolor{keywordflow}{if} (url[0] != \textcolor{charliteral}{'/'} || url[1] != \textcolor{charliteral}{'/'}) \{
301         \textcolor{keywordflow}{return} \textcolor{stringliteral}{"Malformed URL"};
302     \}
303     host = url + 2;
304     url = strchr(host, \textcolor{charliteral}{'/'});
305     \textcolor{keywordflow}{if} (url == \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL}) \{
306         url = \textcolor{stringliteral}{""};
307     \}
308     \textcolor{keywordflow}{else} \{
309         *(url++) = \textcolor{charliteral}{'\(\backslash\)0'};    \textcolor{comment}{/* skip separating '/' */}
310     \}
311 
312     \textcolor{comment}{/* find \_last\_ '@' since it might occur in user/password part */}
313     strp = strrchr(host, \textcolor{charliteral}{'@'});
314 
315     \textcolor{keywordflow}{if} (strp != \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL}) \{
316         *strp = \textcolor{charliteral}{'\(\backslash\)0'};
317         user = \hyperlink{group__APACHE__CORE__VHOST_ga8c8ad0616f1a1fed66e67a90a116a76c}{host};
318         host = strp + 1;
319 
320 \textcolor{comment}{/* find password */}
321         strp = strchr(user, \textcolor{charliteral}{':'});
322         \textcolor{keywordflow}{if} (strp != \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL}) \{
323             *strp = \textcolor{charliteral}{'\(\backslash\)0'};
324             password = ap\_proxy\_canonenc(p, strp + 1, strlen(strp + 1), \hyperlink{group__MOD__PROXY_gga4484631c7debf2a3a8d82d27273eb629a1d653a7e4cd137d0274990adf74b9efb}{enc\_user}, 1, 0);
325             \textcolor{keywordflow}{if} (password == \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL}) \{
326                 \textcolor{keywordflow}{return} \textcolor{stringliteral}{"Bad %-escape in URL (password)"};
327             \}
328         \}
329 
330         user = ap\_proxy\_canonenc(p, user, strlen(user), \hyperlink{group__MOD__PROXY_gga4484631c7debf2a3a8d82d27273eb629a1d653a7e4cd137d0274990adf74b9efb}{enc\_user}, 1, 0);
331         \textcolor{keywordflow}{if} (user == \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL}) \{
332             \textcolor{keywordflow}{return} \textcolor{stringliteral}{"Bad %-escape in URL (username)"};
333         \}
334     \}
335     \textcolor{keywordflow}{if} (\hyperlink{group__MOD__PROXY_gafab7f01dc92afd3e79a59fe3a2ea5932}{userp} != \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL}) \{
336         *\hyperlink{group__MOD__PROXY_gafab7f01dc92afd3e79a59fe3a2ea5932}{userp} = user;
337     \}
338     \textcolor{keywordflow}{if} (\hyperlink{group__MOD__PROXY_ga93be1099b442eb117913f581e856e788}{passwordp} != \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL}) \{
339         *\hyperlink{group__MOD__PROXY_ga93be1099b442eb117913f581e856e788}{passwordp} = \hyperlink{group__APACHE__CORE__PROTO_ga69b970a42043daa64861aba281a1e6f0}{password};
340     \}
341 
342     \textcolor{comment}{/*}
343 \textcolor{comment}{     * Parse the host string to separate host portion from optional port.}
344 \textcolor{comment}{     * Perform range checking on port.}
345 \textcolor{comment}{     */}
346     rv = apr\_parse\_addr\_port(&addr, &scope\_id, &tmp\_port, host, p);
347     \textcolor{keywordflow}{if} (rv != \hyperlink{group__apr__errno_ga9ee311b7bf1c691dc521d721339ee2a6}{APR\_SUCCESS} || addr == \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL} || scope\_id != \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL}) \{
348         \textcolor{keywordflow}{return} \textcolor{stringliteral}{"Invalid host/port"};
349     \}
350     \textcolor{keywordflow}{if} (tmp\_port != 0) \{ \textcolor{comment}{/* only update caller's port if port was specified */}
351         *\hyperlink{group__APACHE__CORE__VHOST_ga225c76c246a5cc263c5a2628eb99353e}{port} = tmp\_port;
352     \}
353 
354     ap\_str\_tolower(addr); \textcolor{comment}{/* DNS names are case-insensitive */}
355 
356     *\hyperlink{group__MOD__PROXY_ga974d9b4d643e6776a5a12061b88b3ae3}{urlp} = \hyperlink{group__MOD__PROXY_ga05d2db9f2dd75d18170f192bd1cc9b4e}{url};
357     *\hyperlink{group__MOD__PROXY_ga85ac436260ffb27bcf16dae08faaebd4}{hostp} = \hyperlink{group__MOD__PROXY_ga6d5ecaf37baca2c5cd2dfca34109da7e}{addr};
358 
359     \textcolor{keywordflow}{return} \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL};
360 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{proxy__util_8c_ae17d5feb294b5544536dba5e9b8a02ee_cgraph}
\end{center}
\end{figure}


\index{proxy\+\_\+util.\+c@{proxy\+\_\+util.\+c}!ap\+\_\+proxy\+\_\+determine\+\_\+connection@{ap\+\_\+proxy\+\_\+determine\+\_\+connection}}
\index{ap\+\_\+proxy\+\_\+determine\+\_\+connection@{ap\+\_\+proxy\+\_\+determine\+\_\+connection}!proxy\+\_\+util.\+c@{proxy\+\_\+util.\+c}}
\subsubsection[{\texorpdfstring{ap\+\_\+proxy\+\_\+determine\+\_\+connection(apr\+\_\+pool\+\_\+t $\ast$p, request\+\_\+rec $\ast$r, proxy\+\_\+server\+\_\+conf $\ast$conf, proxy\+\_\+worker $\ast$worker, proxy\+\_\+conn\+\_\+rec $\ast$conn, apr\+\_\+uri\+\_\+t $\ast$uri, char $\ast$$\ast$url, const char $\ast$proxyname, apr\+\_\+port\+\_\+t proxyport, char $\ast$server\+\_\+portstr, int server\+\_\+portstr\+\_\+size)}{ap_proxy_determine_connection(apr_pool_t *p, request_rec *r, proxy_server_conf *conf, proxy_worker *worker, proxy_conn_rec *conn, apr_uri_t *uri, char **url, const char *proxyname, apr_port_t proxyport, char *server_portstr, int server_portstr_size)}}]{\setlength{\rightskip}{0pt plus 5cm}ap\+\_\+proxy\+\_\+determine\+\_\+connection (
\begin{DoxyParamCaption}
\item[{{\bf apr\+\_\+pool\+\_\+t} $\ast$}]{p, }
\item[{{\bf request\+\_\+rec} $\ast$}]{r, }
\item[{{\bf proxy\+\_\+server\+\_\+conf} $\ast$}]{conf, }
\item[{{\bf proxy\+\_\+worker} $\ast$}]{worker, }
\item[{{\bf proxy\+\_\+conn\+\_\+rec} $\ast$}]{conn, }
\item[{{\bf apr\+\_\+uri\+\_\+t} $\ast$}]{uri, }
\item[{char $\ast$$\ast$}]{url, }
\item[{const char $\ast$}]{proxyname, }
\item[{{\bf apr\+\_\+port\+\_\+t}}]{proxyport, }
\item[{char $\ast$}]{server\+\_\+portstr, }
\item[{{\bf int}}]{server\+\_\+portstr\+\_\+size}
\end{DoxyParamCaption}
)}\hypertarget{proxy__util_8c_ade616416cb4f3a7356fa87cd3011325c}{}\label{proxy__util_8c_ade616416cb4f3a7356fa87cd3011325c}

\begin{DoxyCode}
2188 \{
2189     \textcolor{keywordtype}{int} server\_port;
2190     \hyperlink{group__apr__errno_gaa5105fa83cc322f09382292db8b47593}{apr\_status\_t} \hyperlink{group__AP__EXPR_gaccebe6c638c552d2845014cf8bdea8d8}{err} = \hyperlink{group__apr__errno_ga9ee311b7bf1c691dc521d721339ee2a6}{APR\_SUCCESS};
2191     \hyperlink{group__apr__errno_gaa5105fa83cc322f09382292db8b47593}{apr\_status\_t} uerr = \hyperlink{group__apr__errno_ga9ee311b7bf1c691dc521d721339ee2a6}{APR\_SUCCESS};
2192     \textcolor{keyword}{const} \textcolor{keywordtype}{char} *\hyperlink{group__MOD__PROXY_ga46b82947aff7f666d626b556a8378392}{uds\_path};
2193 
2194     \textcolor{comment}{/*}
2195 \textcolor{comment}{     * Break up the URL to determine the host to connect to}
2196 \textcolor{comment}{     */}
2197 
2198     \textcolor{comment}{/* we break the URL into host, port, uri */}
2199     \textcolor{keywordflow}{if} (\hyperlink{group__apr__errno_ga9ee311b7bf1c691dc521d721339ee2a6}{APR\_SUCCESS} != apr\_uri\_parse(p, *\hyperlink{group__MOD__PROXY_ga05d2db9f2dd75d18170f192bd1cc9b4e}{url}, uri)) \{
2200         \textcolor{keywordflow}{return} ap\_proxyerror(r, \hyperlink{group__HTTP__Status_ga0c1fdbbb10800664989907cbd3a5a023}{HTTP\_BAD\_REQUEST},
2201                              apr\_pstrcat(p,\textcolor{stringliteral}{"URI cannot be parsed: "}, *\hyperlink{group__MOD__PROXY_ga05d2db9f2dd75d18170f192bd1cc9b4e}{url},
2202                                          \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL}));
2203     \}
2204     \textcolor{keywordflow}{if} (!uri->\hyperlink{structapr__uri__t_a6e6e858ce56b5d58389287c1cc1134fa}{port}) \{
2205         uri->\hyperlink{structapr__uri__t_a6e6e858ce56b5d58389287c1cc1134fa}{port} = ap\_proxy\_port\_of\_scheme(uri->\hyperlink{structapr__uri__t_a5d62fa370265b6bc956aa86d36024a5d}{scheme});
2206     \}
2207 
2208     \hyperlink{group__APACHE__CORE__LOG_ga4c112558ccffd6b363da102b2052d2a6}{ap\_log\_rerror}(\hyperlink{group__APACHE__CORE__LOG_ga655e126996849bcb82e4e5a14c616f4a}{APLOG\_MARK}, \hyperlink{group__APACHE__CORE__LOG_gadfcef90537539cf2b7d35cfbbbafeb93}{APLOG\_DEBUG}, 0, r, 
      \hyperlink{group__APACHE__CORE__LOG_ga1dee8a07e06bc5b3de8b89662c2cd666}{APLOGNO}(00944)
2209                  \textcolor{stringliteral}{"connecting %s to %s:%d"}, *\hyperlink{group__MOD__PROXY_ga05d2db9f2dd75d18170f192bd1cc9b4e}{url}, uri->\hyperlink{structapr__uri__t_a8c6bf3dfca3d159f091377d9f7228aec}{hostname}, uri->
      \hyperlink{structapr__uri__t_a6e6e858ce56b5d58389287c1cc1134fa}{port});
2210 
2211     \textcolor{comment}{/*}
2212 \textcolor{comment}{     * allocate these out of the specified connection pool}
2213 \textcolor{comment}{     * The scheme handler decides if this is permanent or}
2214 \textcolor{comment}{     * short living pool.}
2215 \textcolor{comment}{     */}
2216     \textcolor{comment}{/* Unless we are connecting the backend via a (forward Proxy)Remote, we}
2217 \textcolor{comment}{     * have to use the original form of the URI (non absolute), but this is}
2218 \textcolor{comment}{     * also the case via a remote proxy using the CONNECT method since the}
2219 \textcolor{comment}{     * original request (and URI) is to be embedded in the body.}
2220 \textcolor{comment}{     */}
2221     \textcolor{keywordflow}{if} (!\hyperlink{group__MOD__PROXY_gaa1c038713fefa564c88a58477a1b2001}{proxyname} || conn->\hyperlink{structproxy__conn__rec_aa94e7ad5ae965ab446679e42a3f9b0ab}{is\_ssl}) \{
2222         *\hyperlink{group__MOD__PROXY_ga05d2db9f2dd75d18170f192bd1cc9b4e}{url} = apr\_pstrcat(p, uri->\hyperlink{structapr__uri__t_a61cff1baadb3c1b52a34b502c25bba7f}{path}, uri->\hyperlink{structapr__uri__t_a88d889bcda9e95696022f04ffb470678}{query} ? \textcolor{stringliteral}{"?"} : \textcolor{stringliteral}{""},
2223                            uri->\hyperlink{structapr__uri__t_a88d889bcda9e95696022f04ffb470678}{query} ? uri->\hyperlink{structapr__uri__t_a88d889bcda9e95696022f04ffb470678}{query} : \textcolor{stringliteral}{""},
2224                            uri->\hyperlink{structapr__uri__t_a0e4abeaa1379c79dcc6fdac01d76715a}{fragment} ? \textcolor{stringliteral}{"#"} : \textcolor{stringliteral}{""},
2225                            uri->\hyperlink{structapr__uri__t_a0e4abeaa1379c79dcc6fdac01d76715a}{fragment} ? uri->\hyperlink{structapr__uri__t_a0e4abeaa1379c79dcc6fdac01d76715a}{fragment} : \textcolor{stringliteral}{""}, 
      \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL});
2226     \}
2227     \textcolor{comment}{/*}
2228 \textcolor{comment}{     * Figure out if our passed in proxy\_conn\_rec has a usable}
2229 \textcolor{comment}{     * address cached.}
2230 \textcolor{comment}{     *}
2231 \textcolor{comment}{     * TODO: Handle this much better... }
2232 \textcolor{comment}{     *}
2233 \textcolor{comment}{     * XXX: If generic workers are ever address-reusable, we need }
2234 \textcolor{comment}{     *      to check host and port on the conn and be careful about}
2235 \textcolor{comment}{     *      spilling the cached addr from the worker.}
2236 \textcolor{comment}{     */}
2237     uds\_path = (*worker->\hyperlink{structproxy__worker_abeaebad014908a4f108fba27313187aa}{s}->\hyperlink{structproxy__worker__shared_a2a079addb146a66a1246eb8518b7b299}{uds\_path} ? worker->\hyperlink{structproxy__worker_abeaebad014908a4f108fba27313187aa}{s}->\hyperlink{structproxy__worker__shared_a2a079addb146a66a1246eb8518b7b299}{uds\_path} : apr\_table\_get(r->
      \hyperlink{structrequest__rec_a8be66d4328766cf1da8913c9b51e0e30}{notes}, \textcolor{stringliteral}{"uds\_path"}));
2238     \textcolor{keywordflow}{if} (uds\_path) \{
2239         \textcolor{keywordflow}{if} (conn->\hyperlink{structproxy__conn__rec_a05cf8ee2b1f688ca7bc107d64d9b1e5c}{uds\_path} == \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL}) \{
2240             \textcolor{comment}{/* use (*conn)->pool instead of worker->cp->pool to match lifetime */}
2241             conn->\hyperlink{structproxy__conn__rec_a05cf8ee2b1f688ca7bc107d64d9b1e5c}{uds\_path} = apr\_pstrdup(conn->\hyperlink{structproxy__conn__rec_a1e898616b25ea637fc7bbfdb9bc8a04e}{pool}, uds\_path);
2242         \}
2243         \textcolor{keywordflow}{if} (conn->\hyperlink{structproxy__conn__rec_a05cf8ee2b1f688ca7bc107d64d9b1e5c}{uds\_path}) \{
2244             \hyperlink{group__APACHE__CORE__LOG_ga4c112558ccffd6b363da102b2052d2a6}{ap\_log\_rerror}(\hyperlink{group__APACHE__CORE__LOG_ga655e126996849bcb82e4e5a14c616f4a}{APLOG\_MARK}, \hyperlink{group__APACHE__CORE__LOG_gadfcef90537539cf2b7d35cfbbbafeb93}{APLOG\_DEBUG}, 0, r, 
      \hyperlink{group__APACHE__CORE__LOG_ga1dee8a07e06bc5b3de8b89662c2cd666}{APLOGNO}(02545)
2245                          \textcolor{stringliteral}{"%s: has determined UDS as %s"},
2246                          uri->\hyperlink{structapr__uri__t_a5d62fa370265b6bc956aa86d36024a5d}{scheme}, conn->\hyperlink{structproxy__conn__rec_a05cf8ee2b1f688ca7bc107d64d9b1e5c}{uds\_path});
2247         \}
2248         \textcolor{keywordflow}{else} \{
2249             \textcolor{comment}{/* should never happen */}
2250             \hyperlink{group__APACHE__CORE__LOG_ga4c112558ccffd6b363da102b2052d2a6}{ap\_log\_rerror}(\hyperlink{group__APACHE__CORE__LOG_ga655e126996849bcb82e4e5a14c616f4a}{APLOG\_MARK}, \hyperlink{group__APACHE__CORE__LOG_gadfcef90537539cf2b7d35cfbbbafeb93}{APLOG\_DEBUG}, 0, r, 
      \hyperlink{group__APACHE__CORE__LOG_ga1dee8a07e06bc5b3de8b89662c2cd666}{APLOGNO}(02546)
2251                          \textcolor{stringliteral}{"%s: cannot determine UDS (%s)"},
2252                          uri->\hyperlink{structapr__uri__t_a5d62fa370265b6bc956aa86d36024a5d}{scheme}, uds\_path);
2253 
2254         \}
2255         \textcolor{comment}{/*}
2256 \textcolor{comment}{         * In UDS cases, some structs are NULL. Protect from de-refs}
2257 \textcolor{comment}{         * and provide info for logging at the same time.}
2258 \textcolor{comment}{         */}
2259         \textcolor{keywordflow}{if} (!conn->\hyperlink{structproxy__conn__rec_a743a0aac62712d38e0a7f55675dfaa98}{addr}) \{
2260             \hyperlink{structapr__sockaddr__t}{apr\_sockaddr\_t} *\hyperlink{group__apr__network__io_ga5dc1cb3876df6ab646ee9b3d528cbd9f}{sa};
2261             apr\_sockaddr\_info\_get(&sa, \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL}, \hyperlink{group__apr__network__io_gaa7a33b17a7d0820b09ef489bd3328f85}{APR\_UNSPEC}, 0, 0, conn->
      \hyperlink{structproxy__conn__rec_a1e898616b25ea637fc7bbfdb9bc8a04e}{pool});
2262             conn->\hyperlink{structproxy__conn__rec_a743a0aac62712d38e0a7f55675dfaa98}{addr} = \hyperlink{group__apr__network__io_ga5dc1cb3876df6ab646ee9b3d528cbd9f}{sa};
2263         \}
2264         conn->\hyperlink{structproxy__conn__rec_a1ab19f0a00dd603547746818640ce583}{hostname} = \textcolor{stringliteral}{"httpd-UDS"};
2265         conn->\hyperlink{structproxy__conn__rec_aa3e507bc0bd0e23c0bedaae83b0307c7}{port} = 0;
2266     \}
2267     \textcolor{keywordflow}{else} \{
2268         \textcolor{keywordtype}{int} will\_reuse = worker->\hyperlink{structproxy__worker_abeaebad014908a4f108fba27313187aa}{s}->\hyperlink{structproxy__worker__shared_aca8efb07ebb639cf52fdc9b6524b6327}{is\_address\_reusable} && !worker->
      \hyperlink{structproxy__worker_abeaebad014908a4f108fba27313187aa}{s}->\hyperlink{structproxy__worker__shared_ad4a4cca9ea31d862d7ef4e41c97af257}{disablereuse};
2269         \textcolor{keywordflow}{if} (!conn->\hyperlink{structproxy__conn__rec_a1ab19f0a00dd603547746818640ce583}{hostname} || !will\_reuse) \{
2270             \textcolor{keywordflow}{if} (\hyperlink{group__MOD__PROXY_gaa1c038713fefa564c88a58477a1b2001}{proxyname}) \{
2271                 conn->\hyperlink{structproxy__conn__rec_a1ab19f0a00dd603547746818640ce583}{hostname} = apr\_pstrdup(conn->\hyperlink{structproxy__conn__rec_a1e898616b25ea637fc7bbfdb9bc8a04e}{pool}, \hyperlink{group__MOD__PROXY_gaa1c038713fefa564c88a58477a1b2001}{proxyname});
2272                 conn->\hyperlink{structproxy__conn__rec_aa3e507bc0bd0e23c0bedaae83b0307c7}{port} = \hyperlink{group__MOD__PROXY_ga9913582faaffe156d1b3b9330f5d0e6e}{proxyport};
2273                 \textcolor{comment}{/*}
2274 \textcolor{comment}{                 * If we have a forward proxy and the protocol is HTTPS,}
2275 \textcolor{comment}{                 * then we need to prepend a HTTP CONNECT request before}
2276 \textcolor{comment}{                 * sending our actual HTTPS requests.}
2277 \textcolor{comment}{                 * Save our real backend data for using it later during HTTP CONNECT.}
2278 \textcolor{comment}{                 */}
2279                 \textcolor{keywordflow}{if} (conn->\hyperlink{structproxy__conn__rec_aa94e7ad5ae965ab446679e42a3f9b0ab}{is\_ssl}) \{
2280                     \textcolor{keyword}{const} \textcolor{keywordtype}{char} *proxy\_auth;
2281 
2282                     \hyperlink{structforward__info}{forward\_info} *forward = \hyperlink{group__apr__pools_gad214fc0160de3c22b6435e29ea20fce8}{apr\_pcalloc}(conn->
      \hyperlink{structproxy__conn__rec_a1e898616b25ea637fc7bbfdb9bc8a04e}{pool}, \textcolor{keyword}{sizeof}(\hyperlink{structforward__info}{forward\_info}));
2283                     conn->\hyperlink{structproxy__conn__rec_a27586ca1faf991d81e6bd3dc2f769240}{forward} = forward;
2284                     forward->\hyperlink{structforward__info_a2470d137feb904af212a5d9e524d5d3a}{use\_http\_connect} = 1;
2285                     forward->\hyperlink{structforward__info_aead08ba3b9577d3735a465be340dbea7}{target\_host} = apr\_pstrdup(conn->\hyperlink{structproxy__conn__rec_a1e898616b25ea637fc7bbfdb9bc8a04e}{pool}, uri->
      \hyperlink{structapr__uri__t_a8c6bf3dfca3d159f091377d9f7228aec}{hostname});
2286                     forward->\hyperlink{structforward__info_a8869e21f61a36353e6a0e56e56d54d11}{target\_port} = uri->\hyperlink{structapr__uri__t_a6e6e858ce56b5d58389287c1cc1134fa}{port};
2287                     \textcolor{comment}{/* Do we want to pass Proxy-Authorization along?}
2288 \textcolor{comment}{                     * If we haven't used it, then YES}
2289 \textcolor{comment}{                     * If we have used it then MAYBE: RFC2616 says we MAY propagate it.}
2290 \textcolor{comment}{                     * So let's make it configurable by env.}
2291 \textcolor{comment}{                     * The logic here is the same used in mod\_proxy\_http.}
2292 \textcolor{comment}{                     */}
2293                     proxy\_auth = apr\_table\_get(r->\hyperlink{structrequest__rec_a5497da6c01af49acf70a4a9b975c1c83}{headers\_in}, \textcolor{stringliteral}{"Proxy-Authorization"});
2294                     \textcolor{keywordflow}{if} (proxy\_auth != \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL} &&
2295                         proxy\_auth[0] != \textcolor{charliteral}{'\(\backslash\)0'} &&
2296                         r->\hyperlink{structrequest__rec_a63f3abd83f53633f9d0069bc39aeb424}{user} == \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL} && \textcolor{comment}{/* we haven't yet authenticated */}
2297                         apr\_table\_get(r->\hyperlink{structrequest__rec_a36fa8def3b9cb16fe49d0b4d78099085}{subprocess\_env}, \textcolor{stringliteral}{"Proxy-Chain-Auth"})) \{
2298                         forward->\hyperlink{structforward__info_a8d2838aa6f8c5f477a3403c3ff404c3a}{proxy\_auth} = apr\_pstrdup(conn->\hyperlink{structproxy__conn__rec_a1e898616b25ea637fc7bbfdb9bc8a04e}{pool}, proxy\_auth);
2299                     \}
2300                 \}
2301             \}
2302             \textcolor{keywordflow}{else} \{
2303                 conn->\hyperlink{structproxy__conn__rec_a1ab19f0a00dd603547746818640ce583}{hostname} = apr\_pstrdup(conn->\hyperlink{structproxy__conn__rec_a1e898616b25ea637fc7bbfdb9bc8a04e}{pool}, uri->
      \hyperlink{structapr__uri__t_a8c6bf3dfca3d159f091377d9f7228aec}{hostname});
2304                 conn->\hyperlink{structproxy__conn__rec_aa3e507bc0bd0e23c0bedaae83b0307c7}{port} = uri->\hyperlink{structapr__uri__t_a6e6e858ce56b5d58389287c1cc1134fa}{port};
2305             \}
2306             \textcolor{keywordflow}{if} (!will\_reuse) \{
2307                 \textcolor{comment}{/*}
2308 \textcolor{comment}{                 * Only do a lookup if we should not reuse the backend address.}
2309 \textcolor{comment}{                 * Otherwise we will look it up once for the worker.}
2310 \textcolor{comment}{                 */}
2311                 err = apr\_sockaddr\_info\_get(&(conn->\hyperlink{structproxy__conn__rec_a743a0aac62712d38e0a7f55675dfaa98}{addr}),
2312                                             conn->\hyperlink{structproxy__conn__rec_a1ab19f0a00dd603547746818640ce583}{hostname}, \hyperlink{group__apr__network__io_gaa7a33b17a7d0820b09ef489bd3328f85}{APR\_UNSPEC},
2313                                             conn->\hyperlink{structproxy__conn__rec_aa3e507bc0bd0e23c0bedaae83b0307c7}{port}, 0,
2314                                             conn->\hyperlink{structproxy__conn__rec_a1e898616b25ea637fc7bbfdb9bc8a04e}{pool});
2315             \}
2316             socket\_cleanup(conn);
2317             conn->\hyperlink{structproxy__conn__rec_acb5fb6e7736c1833e3da6bfdb2bbe55f}{close} = 0;
2318         \}
2319         \textcolor{keywordflow}{if} (will\_reuse) \{
2320             \textcolor{comment}{/*}
2321 \textcolor{comment}{             * Looking up the backend address for the worker only makes sense if}
2322 \textcolor{comment}{             * we can reuse the address.}
2323 \textcolor{comment}{             */}
2324             \textcolor{keywordflow}{if} (!worker->\hyperlink{structproxy__worker_aa3b1761756ad260fc52589501c9f6fe0}{cp}->\hyperlink{structproxy__conn__pool_ace4435ae1625464d94beb6c4d6de7c2b}{addr}) \{
2325                 \textcolor{keywordflow}{if} ((err = \hyperlink{group__MOD__PROXY_ga4fa0e4229760fdbc94c35580e2e466bb}{PROXY\_THREAD\_LOCK}(worker)) != 
      \hyperlink{group__apr__errno_ga9ee311b7bf1c691dc521d721339ee2a6}{APR\_SUCCESS}) \{
2326                     \hyperlink{group__APACHE__CORE__LOG_ga4c112558ccffd6b363da102b2052d2a6}{ap\_log\_rerror}(\hyperlink{group__APACHE__CORE__LOG_ga655e126996849bcb82e4e5a14c616f4a}{APLOG\_MARK}, \hyperlink{group__APACHE__CORE__LOG_ga57ad94ed8c92c4306de90479251a5d58}{APLOG\_ERR}, err, r, 
      \hyperlink{group__APACHE__CORE__LOG_ga1dee8a07e06bc5b3de8b89662c2cd666}{APLOGNO}(00945) \textcolor{stringliteral}{"lock"});
2327                     \textcolor{keywordflow}{return} \hyperlink{group__HTTP__Status_ga5d9777e02c26063c2985e39ef71091d2}{HTTP\_INTERNAL\_SERVER\_ERROR};
2328                 \}
2329 
2330                 \textcolor{comment}{/*}
2331 \textcolor{comment}{                 * Worker can have the single constant backend address.}
2332 \textcolor{comment}{                 * The single DNS lookup is used once per worker.}
2333 \textcolor{comment}{                 * If dynamic change is needed then set the addr to NULL}
2334 \textcolor{comment}{                 * inside dynamic config to force the lookup.}
2335 \textcolor{comment}{                 */}
2336                 err = apr\_sockaddr\_info\_get(&(worker->\hyperlink{structproxy__worker_aa3b1761756ad260fc52589501c9f6fe0}{cp}->\hyperlink{structproxy__conn__pool_ace4435ae1625464d94beb6c4d6de7c2b}{addr}),
2337                                             conn->\hyperlink{structproxy__conn__rec_a1ab19f0a00dd603547746818640ce583}{hostname}, \hyperlink{group__apr__network__io_gaa7a33b17a7d0820b09ef489bd3328f85}{APR\_UNSPEC},
2338                                             conn->\hyperlink{structproxy__conn__rec_aa3e507bc0bd0e23c0bedaae83b0307c7}{port}, 0,
2339                                             worker->\hyperlink{structproxy__worker_aa3b1761756ad260fc52589501c9f6fe0}{cp}->\hyperlink{structproxy__conn__pool_aa683a756f120a4482de8289705ff5faa}{pool});
2340                 conn->\hyperlink{structproxy__conn__rec_a743a0aac62712d38e0a7f55675dfaa98}{addr} = worker->\hyperlink{structproxy__worker_aa3b1761756ad260fc52589501c9f6fe0}{cp}->\hyperlink{structproxy__conn__pool_ace4435ae1625464d94beb6c4d6de7c2b}{addr};
2341                 \textcolor{keywordflow}{if} ((uerr = \hyperlink{group__MOD__PROXY_ga704882df51862165ac773183f2a63cbc}{PROXY\_THREAD\_UNLOCK}(worker)) != 
      \hyperlink{group__apr__errno_ga9ee311b7bf1c691dc521d721339ee2a6}{APR\_SUCCESS}) \{
2342                     \hyperlink{group__APACHE__CORE__LOG_ga4c112558ccffd6b363da102b2052d2a6}{ap\_log\_rerror}(\hyperlink{group__APACHE__CORE__LOG_ga655e126996849bcb82e4e5a14c616f4a}{APLOG\_MARK}, \hyperlink{group__APACHE__CORE__LOG_ga57ad94ed8c92c4306de90479251a5d58}{APLOG\_ERR}, uerr, r, 
      \hyperlink{group__APACHE__CORE__LOG_ga1dee8a07e06bc5b3de8b89662c2cd666}{APLOGNO}(00946) \textcolor{stringliteral}{"unlock"});
2343                 \}
2344             \}
2345             \textcolor{keywordflow}{else} \{
2346                 conn->\hyperlink{structproxy__conn__rec_a743a0aac62712d38e0a7f55675dfaa98}{addr} = worker->\hyperlink{structproxy__worker_aa3b1761756ad260fc52589501c9f6fe0}{cp}->\hyperlink{structproxy__conn__pool_ace4435ae1625464d94beb6c4d6de7c2b}{addr};
2347             \}
2348         \}
2349     \}
2350     \textcolor{comment}{/* Close a possible existing socket if we are told to do so */}
2351     \textcolor{keywordflow}{if} (conn->\hyperlink{structproxy__conn__rec_acb5fb6e7736c1833e3da6bfdb2bbe55f}{close}) \{
2352         socket\_cleanup(conn);
2353         conn->\hyperlink{structproxy__conn__rec_acb5fb6e7736c1833e3da6bfdb2bbe55f}{close} = 0;
2354     \}
2355 
2356     \textcolor{keywordflow}{if} (err != \hyperlink{group__apr__errno_ga9ee311b7bf1c691dc521d721339ee2a6}{APR\_SUCCESS}) \{
2357         \textcolor{keywordflow}{return} ap\_proxyerror(r, \hyperlink{group__HTTP__Status_ga57ddfb82346d6efc864c3e164e574b10}{HTTP\_BAD\_GATEWAY},
2358                              apr\_pstrcat(p, \textcolor{stringliteral}{"DNS lookup failure for: "},
2359                                          conn->\hyperlink{structproxy__conn__rec_a1ab19f0a00dd603547746818640ce583}{hostname}, \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL}));
2360     \}
2361 
2362     \textcolor{comment}{/* Get the server port for the Via headers */}
2363     server\_port = ap\_get\_server\_port(r);
2364     \hyperlink{group__APACHE__CORE__DAEMON_ga85dbc1e4d9600422461f815193f8ace8}{AP\_DEBUG\_ASSERT}(\hyperlink{group__MOD__PROXY_gace3850b28542570d38229df96ad5cdb8}{server\_portstr\_size} > 0);
2365     \textcolor{keywordflow}{if} (\hyperlink{group__APACHE__CORE__DAEMON_gae5bc38a44a7c51bef163b8208559f3a1}{ap\_is\_default\_port}(server\_port, r)) \{
2366         \hyperlink{group__MOD__PROXY_ga802fad35b3c2f0228598874c678130a6}{server\_portstr}[0] = \textcolor{charliteral}{'\(\backslash\)0'};
2367     \}
2368     \textcolor{keywordflow}{else} \{
2369         apr\_snprintf(\hyperlink{group__MOD__PROXY_ga802fad35b3c2f0228598874c678130a6}{server\_portstr}, \hyperlink{group__MOD__PROXY_gace3850b28542570d38229df96ad5cdb8}{server\_portstr\_size}, \textcolor{stringliteral}{":%d"},
2370                      server\_port);
2371     \}
2372 
2373     \textcolor{comment}{/* check if ProxyBlock directive on this host */}
2374     \textcolor{keywordflow}{if} (\hyperlink{group__APACHE__CORE__DAEMON_gaba51915c87d64af47fb1cc59348961c9}{OK} != ap\_proxy\_checkproxyblock2(r, conf, uri->\hyperlink{structapr__uri__t_a8c6bf3dfca3d159f091377d9f7228aec}{hostname}, 
2375                                        \hyperlink{group__MOD__PROXY_gaa1c038713fefa564c88a58477a1b2001}{proxyname} ? \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL} : conn->
      \hyperlink{structproxy__conn__rec_a743a0aac62712d38e0a7f55675dfaa98}{addr})) \{
2376         \textcolor{keywordflow}{return} ap\_proxyerror(r, \hyperlink{group__HTTP__Status_ga92646f876056a1e5013e0050496dc04d}{HTTP\_FORBIDDEN},
2377                              \textcolor{stringliteral}{"Connect to remote machine blocked"});
2378     \}
2379     \textcolor{comment}{/*}
2380 \textcolor{comment}{     * When SSL is configured, determine the hostname (SNI) for the request}
2381 \textcolor{comment}{     * and save it in conn->ssl\_hostname. Close any reused connection whose}
2382 \textcolor{comment}{     * SNI differs.}
2383 \textcolor{comment}{     */}
2384     \textcolor{keywordflow}{if} (conn->\hyperlink{structproxy__conn__rec_aa94e7ad5ae965ab446679e42a3f9b0ab}{is\_ssl}) \{
2385         \hyperlink{structproxy__dir__conf}{proxy\_dir\_conf} *\hyperlink{group__MOD__PROXY_ga01226e8c588429d47a24e72bda63a5e3}{dconf};
2386         \textcolor{keyword}{const} \textcolor{keywordtype}{char} *ssl\_hostname;
2387         \textcolor{comment}{/*}
2388 \textcolor{comment}{         * In the case of ProxyPreserveHost on use the hostname of}
2389 \textcolor{comment}{         * the request if present otherwise use the one from the}
2390 \textcolor{comment}{         * backend request URI.}
2391 \textcolor{comment}{         */}
2392         dconf = \hyperlink{group__APACHE__CORE__CONFIG_ga1093a5908a384eacc929b028c79f2a02}{ap\_get\_module\_config}(r->\hyperlink{structrequest__rec_a0935ac19a61c462c8986898b4c30547d}{per\_dir\_config}, &
      \hyperlink{group__MOD__PROXY_ga27b03f85d7a77ee10f73b8df6f58aa0e}{proxy\_module});
2393         \textcolor{keywordflow}{if} (dconf->\hyperlink{structproxy__dir__conf_ab866a9816beea17c38a145be11807857}{preserve\_host}) \{
2394             ssl\_hostname = r->\hyperlink{structrequest__rec_a93baa938b6e2f6c4648cb2429495cd1b}{hostname};
2395         \}
2396         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (conn->\hyperlink{structproxy__conn__rec_a27586ca1faf991d81e6bd3dc2f769240}{forward}
2397                  && ((\hyperlink{structforward__info}{forward\_info} *)(conn->\hyperlink{structproxy__conn__rec_a27586ca1faf991d81e6bd3dc2f769240}{forward}))->use\_http\_connect) \{
2398             ssl\_hostname = ((\hyperlink{structforward__info}{forward\_info} *)conn->\hyperlink{structproxy__conn__rec_a27586ca1faf991d81e6bd3dc2f769240}{forward})->target\_host;
2399         \}
2400         \textcolor{keywordflow}{else} \{
2401             ssl\_hostname = conn->\hyperlink{structproxy__conn__rec_a1ab19f0a00dd603547746818640ce583}{hostname};
2402         \}
2403         \textcolor{comment}{/*}
2404 \textcolor{comment}{         * Close if a SNI is in use but this request requires no or}
2405 \textcolor{comment}{         * a different one, or no SNI is in use but one is required.}
2406 \textcolor{comment}{         */}
2407         \textcolor{keywordflow}{if} ((conn->\hyperlink{structproxy__conn__rec_ab6205c31f7ed891e0a9b133bb4195f51}{ssl\_hostname} && (!ssl\_hostname ||
2408                                     \hyperlink{apr__cpystrn_8c_a4a00fc29b96a953fed9e0107a9c4548a}{strcasecmp}(conn->\hyperlink{structproxy__conn__rec_ab6205c31f7ed891e0a9b133bb4195f51}{ssl\_hostname},
2409                                                ssl\_hostname) != 0)) ||
2410                 (!conn->\hyperlink{structproxy__conn__rec_ab6205c31f7ed891e0a9b133bb4195f51}{ssl\_hostname} && ssl\_hostname && conn->\hyperlink{structproxy__conn__rec_a8793b656730c1978e7886f249eff739d}{sock})) \{
2411             socket\_cleanup(conn);
2412         \}
2413         \textcolor{keywordflow}{if} (conn->\hyperlink{structproxy__conn__rec_ab6205c31f7ed891e0a9b133bb4195f51}{ssl\_hostname} == NULL) \{
2414             conn->\hyperlink{structproxy__conn__rec_ab6205c31f7ed891e0a9b133bb4195f51}{ssl\_hostname} = apr\_pstrdup(conn->\hyperlink{structproxy__conn__rec_a572f7275ff328d6181a01389b95a7761}{scpool}, ssl\_hostname);
2415         \}
2416     \}
2417     \hyperlink{group__APACHE__CORE__LOG_ga4c112558ccffd6b363da102b2052d2a6}{ap\_log\_rerror}(\hyperlink{group__APACHE__CORE__LOG_ga655e126996849bcb82e4e5a14c616f4a}{APLOG\_MARK}, \hyperlink{group__APACHE__CORE__LOG_gadfcef90537539cf2b7d35cfbbbafeb93}{APLOG\_DEBUG}, 0, r, 
      \hyperlink{group__APACHE__CORE__LOG_ga1dee8a07e06bc5b3de8b89662c2cd666}{APLOGNO}(00947)
2418                  \textcolor{stringliteral}{"connected %s to %s:%d"}, *\hyperlink{group__MOD__PROXY_ga05d2db9f2dd75d18170f192bd1cc9b4e}{url}, conn->\hyperlink{structproxy__conn__rec_a1ab19f0a00dd603547746818640ce583}{hostname}, conn->
      \hyperlink{structproxy__conn__rec_aa3e507bc0bd0e23c0bedaae83b0307c7}{port});
2419     \textcolor{keywordflow}{return} \hyperlink{group__APACHE__CORE__DAEMON_gaba51915c87d64af47fb1cc59348961c9}{OK};
2420 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=288pt]{proxy__util_8c_ade616416cb4f3a7356fa87cd3011325c_cgraph}
\end{center}
\end{figure}


\index{proxy\+\_\+util.\+c@{proxy\+\_\+util.\+c}!ap\+\_\+proxy\+\_\+hashfunc@{ap\+\_\+proxy\+\_\+hashfunc}}
\index{ap\+\_\+proxy\+\_\+hashfunc@{ap\+\_\+proxy\+\_\+hashfunc}!proxy\+\_\+util.\+c@{proxy\+\_\+util.\+c}}
\subsubsection[{\texorpdfstring{ap\+\_\+proxy\+\_\+hashfunc(const char $\ast$str, proxy\+\_\+hash\+\_\+t method)}{ap_proxy_hashfunc(const char *str, proxy_hash_t method)}}]{\setlength{\rightskip}{0pt plus 5cm}ap\+\_\+proxy\+\_\+hashfunc (
\begin{DoxyParamCaption}
\item[{const char $\ast$}]{str, }
\item[{{\bf proxy\+\_\+hash\+\_\+t}}]{method}
\end{DoxyParamCaption}
)}\hypertarget{proxy__util_8c_a894a8f960939418e2122523aa81b5dd0}{}\label{proxy__util_8c_a894a8f960939418e2122523aa81b5dd0}

\begin{DoxyCode}
3122 \{
3123     \textcolor{keywordflow}{if} (\hyperlink{group__APACHE__CORE__CONFIG_ga6c1b16298acdfc2ca3cba871da0daa17}{method} == \hyperlink{group__MOD__PROXY_ggad04e421d409d5c4b460cd62694ada47ca974beb94711f8b9d072dbec227b5255c}{PROXY\_HASHFUNC\_APR}) \{
3124         \hyperlink{group__apr__platform_ga215ebb88932bee220b766263ebbfe6fa}{apr\_ssize\_t} \hyperlink{group__APR__Util__Escaping_ga00eba03f583932b8cdcec6e0847f08b3}{slen} = strlen(\hyperlink{group__MOD__DAV_gaab9226fe8f632e1f998e24276d478f30}{str});
3125         \textcolor{keywordflow}{return} apr\_hashfunc\_default(\hyperlink{group__MOD__DAV_gaab9226fe8f632e1f998e24276d478f30}{str}, &slen);
3126     \}
3127     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{group__APACHE__CORE__CONFIG_ga6c1b16298acdfc2ca3cba871da0daa17}{method} == \hyperlink{group__MOD__PROXY_ggad04e421d409d5c4b460cd62694ada47ca4af344ec2e59dc7162cd4c20f85d8c19}{PROXY\_HASHFUNC\_FNV}) \{
3128         \textcolor{comment}{/* FNV model */}
3129         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \hyperlink{apr__random_8c_a1961406c0af51085f634defe740cbf52}{hash};
3130         \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} fnv\_prime = 0x811C9DC5;
3131         \textcolor{keywordflow}{for} (hash = 0; *\hyperlink{group__MOD__DAV_gaab9226fe8f632e1f998e24276d478f30}{str}; \hyperlink{group__MOD__DAV_gaab9226fe8f632e1f998e24276d478f30}{str}++) \{
3132             hash *= fnv\_prime;
3133             hash ^= (*str);
3134         \}
3135         \textcolor{keywordflow}{return} \hyperlink{apr__random_8c_a1961406c0af51085f634defe740cbf52}{hash};
3136     \}
3137     \textcolor{keywordflow}{else} \{ \textcolor{comment}{/* method == PROXY\_HASHFUNC\_DEFAULT */}
3138         \textcolor{comment}{/* SDBM model */}
3139         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \hyperlink{apr__random_8c_a1961406c0af51085f634defe740cbf52}{hash};
3140         \textcolor{keywordflow}{for} (hash = 0; *\hyperlink{group__MOD__DAV_gaab9226fe8f632e1f998e24276d478f30}{str}; \hyperlink{group__MOD__DAV_gaab9226fe8f632e1f998e24276d478f30}{str}++) \{
3141             hash = (*str) + (hash << 6) + (hash << 16) - \hyperlink{apr__random_8c_a1961406c0af51085f634defe740cbf52}{hash};
3142         \}
3143         \textcolor{keywordflow}{return} \hyperlink{apr__random_8c_a1961406c0af51085f634defe740cbf52}{hash};
3144     \}
3145 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=322pt]{proxy__util_8c_a894a8f960939418e2122523aa81b5dd0_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=322pt]{proxy__util_8c_a894a8f960939418e2122523aa81b5dd0_icgraph}
\end{center}
\end{figure}


\index{proxy\+\_\+util.\+c@{proxy\+\_\+util.\+c}!A\+P\+L\+O\+G\+\_\+\+U\+S\+E\+\_\+\+M\+O\+D\+U\+LE@{A\+P\+L\+O\+G\+\_\+\+U\+S\+E\+\_\+\+M\+O\+D\+U\+LE}}
\index{A\+P\+L\+O\+G\+\_\+\+U\+S\+E\+\_\+\+M\+O\+D\+U\+LE@{A\+P\+L\+O\+G\+\_\+\+U\+S\+E\+\_\+\+M\+O\+D\+U\+LE}!proxy\+\_\+util.\+c@{proxy\+\_\+util.\+c}}
\subsubsection[{\texorpdfstring{A\+P\+L\+O\+G\+\_\+\+U\+S\+E\+\_\+\+M\+O\+D\+U\+L\+E(proxy)}{APLOG_USE_MODULE(proxy)}}]{\setlength{\rightskip}{0pt plus 5cm}A\+P\+L\+O\+G\+\_\+\+U\+S\+E\+\_\+\+M\+O\+D\+U\+LE (
\begin{DoxyParamCaption}
\item[{proxy}]{}
\end{DoxyParamCaption}
)}\hypertarget{proxy__util_8c_aee811a1f31a5fa14ab95b0c83df0cf2a}{}\label{proxy__util_8c_aee811a1f31a5fa14ab95b0c83df0cf2a}
\index{proxy\+\_\+util.\+c@{proxy\+\_\+util.\+c}!A\+P\+R\+\_\+\+I\+M\+P\+L\+E\+M\+E\+N\+T\+\_\+\+O\+P\+T\+I\+O\+N\+A\+L\+\_\+\+H\+O\+O\+K\+\_\+\+R\+U\+N\+\_\+\+A\+LL@{A\+P\+R\+\_\+\+I\+M\+P\+L\+E\+M\+E\+N\+T\+\_\+\+O\+P\+T\+I\+O\+N\+A\+L\+\_\+\+H\+O\+O\+K\+\_\+\+R\+U\+N\+\_\+\+A\+LL}}
\index{A\+P\+R\+\_\+\+I\+M\+P\+L\+E\+M\+E\+N\+T\+\_\+\+O\+P\+T\+I\+O\+N\+A\+L\+\_\+\+H\+O\+O\+K\+\_\+\+R\+U\+N\+\_\+\+A\+LL@{A\+P\+R\+\_\+\+I\+M\+P\+L\+E\+M\+E\+N\+T\+\_\+\+O\+P\+T\+I\+O\+N\+A\+L\+\_\+\+H\+O\+O\+K\+\_\+\+R\+U\+N\+\_\+\+A\+LL}!proxy\+\_\+util.\+c@{proxy\+\_\+util.\+c}}
\subsubsection[{\texorpdfstring{A\+P\+R\+\_\+\+I\+M\+P\+L\+E\+M\+E\+N\+T\+\_\+\+O\+P\+T\+I\+O\+N\+A\+L\+\_\+\+H\+O\+O\+K\+\_\+\+R\+U\+N\+\_\+\+A\+L\+L(proxy, P\+R\+O\+X\+Y, int, create\+\_\+req,(request\+\_\+rec $\ast$r, request\+\_\+rec $\ast$pr),(r, pr), O\+K, D\+E\+C\+L\+I\+N\+E\+D)}{APR_IMPLEMENT_OPTIONAL_HOOK_RUN_ALL(proxy, PROXY, int, create_req,(request_rec *r, request_rec *pr),(r, pr), OK, DECLINED)}}]{\setlength{\rightskip}{0pt plus 5cm}A\+P\+R\+\_\+\+I\+M\+P\+L\+E\+M\+E\+N\+T\+\_\+\+O\+P\+T\+I\+O\+N\+A\+L\+\_\+\+H\+O\+O\+K\+\_\+\+R\+U\+N\+\_\+\+A\+LL (
\begin{DoxyParamCaption}
\item[{proxy}]{, }
\item[{{\bf P\+R\+O\+XY}}]{, }
\item[{{\bf int}}]{, }
\item[{create\+\_\+req}]{, }
\item[{({\bf request\+\_\+rec} $\ast${\bf r}, {\bf request\+\_\+rec} $\ast$pr)}]{, }
\item[{({\bf r}, pr)}]{, }
\item[{{\bf OK}}]{, }
\item[{{\bf D\+E\+C\+L\+I\+N\+ED}}]{}
\end{DoxyParamCaption}
)}\hypertarget{proxy__util_8c_a35e77ebd2481f040c75b5d246b5c487c}{}\label{proxy__util_8c_a35e77ebd2481f040c75b5d246b5c487c}

\begin{DoxyCode}
76 \{
77     \textcolor{keywordtype}{char} *thenil;
78     \hyperlink{group__apr__platform_gaaa72b2253f6f3032cefea5712a27540e}{apr\_size\_t} thelen;
79 
80     \textcolor{comment}{/* special case handling */}
81     \textcolor{keywordflow}{if} (!\hyperlink{group__MOD__PROXY_ga63ef3f66045cd6e20f6ea5a82363580d}{dlen}) \{
82         \textcolor{comment}{/* XXX: APR\_ENOSPACE would be better */}
83         \textcolor{keywordflow}{return} \hyperlink{group__APR__Error_ga18f5678bea0c2c704a2b6a186c9e158b}{APR\_EGENERAL};
84     \}
85     \textcolor{keywordflow}{if} (!\hyperlink{group__APACHE__CORE__PROTO_ga3250c7d76063d957a24f2ecbb3d93c2c}{src}) \{
86         *dst = \textcolor{charliteral}{'\(\backslash\)0'};
87         \textcolor{keywordflow}{return} \hyperlink{group__apr__errno_ga9ee311b7bf1c691dc521d721339ee2a6}{APR\_SUCCESS};
88     \}
89     thenil = apr\_cpystrn(dst, \hyperlink{group__APACHE__CORE__PROTO_ga3250c7d76063d957a24f2ecbb3d93c2c}{src}, \hyperlink{group__MOD__PROXY_ga63ef3f66045cd6e20f6ea5a82363580d}{dlen});
90     thelen = thenil - dst;
91     \textcolor{keywordflow}{if} (\hyperlink{group__APACHE__CORE__PROTO_ga3250c7d76063d957a24f2ecbb3d93c2c}{src}[thelen] == \textcolor{charliteral}{'\(\backslash\)0'}) \{
92         \textcolor{keywordflow}{return} \hyperlink{group__apr__errno_ga9ee311b7bf1c691dc521d721339ee2a6}{APR\_SUCCESS};
93     \}
94     \textcolor{keywordflow}{return} \hyperlink{group__APR__Error_ga18f5678bea0c2c704a2b6a186c9e158b}{APR\_EGENERAL};
95 \}
\end{DoxyCode}
\index{proxy\+\_\+util.\+c@{proxy\+\_\+util.\+c}!P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE@{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE}}
\index{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE@{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE}!proxy\+\_\+util.\+c@{proxy\+\_\+util.\+c}}
\subsubsection[{\texorpdfstring{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+R\+E(int)}{PROXY_DECLARE(int)}}]{\setlength{\rightskip}{0pt plus 5cm}P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE (
\begin{DoxyParamCaption}
\item[{{\bf int}}]{}
\end{DoxyParamCaption}
)}\hypertarget{proxy__util_8c_ab8b131b879f2da190de9e2d128450143}{}\label{proxy__util_8c_ab8b131b879f2da190de9e2d128450143}

\begin{DoxyCode}
99 \{
100     \textcolor{keywordtype}{int} \hyperlink{group__MOD__PROXY_ga38403a0592eb8018a3ad61aef0f7ca2c}{i};
101 
102 \textcolor{preprocessor}{#if !APR\_CHARSET\_EBCDIC}
103     \textcolor{keywordtype}{int} ch = \hyperlink{group__MOD__PROXY_gaa51afdb6d96b938b938dc9439be201be}{x}[0];
104 
105     \textcolor{keywordflow}{if} (\hyperlink{group__apr__ctype_ga8c453b1d66015b357c3d3a3ddb7d97d7}{apr\_isdigit}(ch)) \{
106         i = ch - \textcolor{charliteral}{'0'};
107     \}
108     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{group__apr__ctype_ga362f53cc44aab662aaf04fa87e36035b}{apr\_isupper}(ch)) \{
109         i = ch - (\textcolor{charliteral}{'A'} - 10);
110     \}
111     \textcolor{keywordflow}{else} \{
112         i = ch - (\textcolor{charliteral}{'a'} - 10);
113     \}
114     i <<= 4;
115 
116     ch = \hyperlink{group__MOD__PROXY_gaa51afdb6d96b938b938dc9439be201be}{x}[1];
117     \textcolor{keywordflow}{if} (\hyperlink{group__apr__ctype_ga8c453b1d66015b357c3d3a3ddb7d97d7}{apr\_isdigit}(ch)) \{
118         i += ch - \textcolor{charliteral}{'0'};
119     \}
120     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{group__apr__ctype_ga362f53cc44aab662aaf04fa87e36035b}{apr\_isupper}(ch)) \{
121         i += ch - (\textcolor{charliteral}{'A'} - 10);
122     \}
123     \textcolor{keywordflow}{else} \{
124         i += ch - (\textcolor{charliteral}{'a'} - 10);
125     \}
126     \textcolor{keywordflow}{return} \hyperlink{group__MOD__PROXY_ga38403a0592eb8018a3ad61aef0f7ca2c}{i};
127 \textcolor{preprocessor}{#else }\textcolor{comment}{/*APR\_CHARSET\_EBCDIC*/}\textcolor{preprocessor}{}
128     \textcolor{comment}{/*}
129 \textcolor{comment}{     * we assume that the hex value refers to an ASCII character}
130 \textcolor{comment}{     * so convert to EBCDIC so that it makes sense locally;}
131 \textcolor{comment}{     *}
132 \textcolor{comment}{     * example:}
133 \textcolor{comment}{     *}
134 \textcolor{comment}{     * client specifies %20 in URL to refer to a space char;}
135 \textcolor{comment}{     * at this point we're called with EBCDIC "20"; after turning}
136 \textcolor{comment}{     * EBCDIC "20" into binary 0x20, we then need to assume that 0x20}
137 \textcolor{comment}{     * represents an ASCII char and convert 0x20 to EBCDIC, yielding}
138 \textcolor{comment}{     * 0x40}
139 \textcolor{comment}{     */}
140     \textcolor{keywordtype}{char} \hyperlink{group__APACHE__CORE__PROTO_ga17bc47ccf1b618ed082a4ff4f2cc7f7e}{buf}[1];
141 
142     \textcolor{keywordflow}{if} (1 == sscanf(\hyperlink{group__MOD__PROXY_gaa51afdb6d96b938b938dc9439be201be}{x}, \textcolor{stringliteral}{"%2x"}, &i)) \{
143         buf[0] = i & 0xFF;
144         \hyperlink{group__APACHE__CORE__EBCDIC_gad8d6e268d45b4380e6b00371795b12c7}{ap\_xlate\_proto\_from\_ascii}(buf, 1);
145         \textcolor{keywordflow}{return} buf[0];
146     \}
147     \textcolor{keywordflow}{else} \{
148         \textcolor{keywordflow}{return} 0;
149     \}
150 \textcolor{preprocessor}{#endif }\textcolor{comment}{/*APR\_CHARSET\_EBCDIC*/}\textcolor{preprocessor}{}
151 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{proxy__util_8c_ab8b131b879f2da190de9e2d128450143_icgraph}
\end{center}
\end{figure}


\index{proxy\+\_\+util.\+c@{proxy\+\_\+util.\+c}!P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE@{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE}}
\index{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE@{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE}!proxy\+\_\+util.\+c@{proxy\+\_\+util.\+c}}
\subsubsection[{\texorpdfstring{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+R\+E(void)}{PROXY_DECLARE(void)}}]{\setlength{\rightskip}{0pt plus 5cm}P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)}\hypertarget{proxy__util_8c_a9ced80174d35950697817a36a655de23}{}\label{proxy__util_8c_a9ced80174d35950697817a36a655de23}

\begin{DoxyCode}
154 \{
155 \textcolor{preprocessor}{#if !APR\_CHARSET\_EBCDIC}
156     \textcolor{keywordtype}{int} \hyperlink{group__MOD__PROXY_ga38403a0592eb8018a3ad61aef0f7ca2c}{i};
157 
158     \hyperlink{group__MOD__PROXY_gaa51afdb6d96b938b938dc9439be201be}{x}[0] = \textcolor{charliteral}{'%'};
159     i = (ch & 0xF0) >> 4;
160     \textcolor{keywordflow}{if} (i >= 10) \{
161         \hyperlink{group__MOD__PROXY_gaa51afdb6d96b938b938dc9439be201be}{x}[1] = (\textcolor{charliteral}{'A'} - 10) + i;
162     \}
163     \textcolor{keywordflow}{else} \{
164         \hyperlink{group__MOD__PROXY_gaa51afdb6d96b938b938dc9439be201be}{x}[1] = \textcolor{charliteral}{'0'} + \hyperlink{group__MOD__PROXY_ga38403a0592eb8018a3ad61aef0f7ca2c}{i};
165     \}
166 
167     i = ch & 0x0F;
168     \textcolor{keywordflow}{if} (i >= 10) \{
169         \hyperlink{group__MOD__PROXY_gaa51afdb6d96b938b938dc9439be201be}{x}[2] = (\textcolor{charliteral}{'A'} - 10) + i;
170     \}
171     \textcolor{keywordflow}{else} \{
172         \hyperlink{group__MOD__PROXY_gaa51afdb6d96b938b938dc9439be201be}{x}[2] = \textcolor{charliteral}{'0'} + \hyperlink{group__MOD__PROXY_ga38403a0592eb8018a3ad61aef0f7ca2c}{i};
173     \}
174 \textcolor{preprocessor}{#else }\textcolor{comment}{/*APR\_CHARSET\_EBCDIC*/}\textcolor{preprocessor}{}
175     \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{char} ntoa[] = \{ \textcolor{stringliteral}{"0123456789ABCDEF"} \};
176     \textcolor{keywordtype}{char} \hyperlink{group__APACHE__CORE__PROTO_ga17bc47ccf1b618ed082a4ff4f2cc7f7e}{buf}[1];
177 
178     ch &= 0xFF;
179 
180     buf[0] = ch;
181     \hyperlink{group__APACHE__CORE__EBCDIC_gab64dbae9ff27269fd9e52c43cb142c16}{ap\_xlate\_proto\_to\_ascii}(buf, 1);
182 
183     \hyperlink{group__MOD__PROXY_gaa51afdb6d96b938b938dc9439be201be}{x}[0] = \textcolor{charliteral}{'%'};
184     \hyperlink{group__MOD__PROXY_gaa51afdb6d96b938b938dc9439be201be}{x}[1] = ntoa[(buf[0] >> 4) & 0x0F];
185     \hyperlink{group__MOD__PROXY_gaa51afdb6d96b938b938dc9439be201be}{x}[2] = ntoa[buf[0] & 0x0F];
186     x[3] = \textcolor{charliteral}{'\(\backslash\)0'};
187 \textcolor{preprocessor}{#endif }\textcolor{comment}{/*APR\_CHARSET\_EBCDIC*/}\textcolor{preprocessor}{}
188 \}
\end{DoxyCode}
\index{proxy\+\_\+util.\+c@{proxy\+\_\+util.\+c}!P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE@{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE}}
\index{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE@{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE}!proxy\+\_\+util.\+c@{proxy\+\_\+util.\+c}}
\subsubsection[{\texorpdfstring{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+R\+E(char $\ast$)}{PROXY_DECLARE(char *)}}]{\setlength{\rightskip}{0pt plus 5cm}P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{}
\end{DoxyParamCaption}
)}\hypertarget{proxy__util_8c_a1c03b3f7f69d399a646d84db4caaed65}{}\label{proxy__util_8c_a1c03b3f7f69d399a646d84db4caaed65}

\begin{DoxyCode}
203 \{
204     \textcolor{keywordtype}{int} \hyperlink{group__MOD__PROXY_ga38403a0592eb8018a3ad61aef0f7ca2c}{i}, j, ch;
205     \textcolor{keywordtype}{char} *\hyperlink{group__MOD__CACHE_gad4d47f76a849e2c428e3dd7f8c4eab1f}{y};
206     \textcolor{keywordtype}{char} *allowed;  \textcolor{comment}{/* characters which should not be encoded */}
207     \textcolor{keywordtype}{char} *\hyperlink{group__APR__Util__Escaping_ga8934de0ca6ba44b94f1e61b77c1dda41}{reserved}; \textcolor{comment}{/* characters which much not be en/de-coded */}
208 
209 \textcolor{comment}{/*}
210 \textcolor{comment}{ * N.B. in addition to :@&=, this allows ';' in an http path}
211 \textcolor{comment}{ * and '?' in an ftp path -- this may be revised}
212 \textcolor{comment}{ *}
213 \textcolor{comment}{ * Also, it makes a '+' character in a search string reserved, as}
214 \textcolor{comment}{ * it may be form-encoded. (Although RFC 1738 doesn't allow this -}
215 \textcolor{comment}{ * it only permits ; / ? : @ = & as reserved chars.)}
216 \textcolor{comment}{ */}
217     \textcolor{keywordflow}{if} (\hyperlink{group__APACHE__CORE__DAEMON_gabfa74bb4f05f3b2de1a89160025e5400}{t} == \hyperlink{group__MOD__PROXY_gga4484631c7debf2a3a8d82d27273eb629a4a906f76cb6afc6083fed6de6f47b853}{enc\_path}) \{
218         allowed = \textcolor{stringliteral}{"~$-\_.+!*'(),;:@&="};
219     \}
220     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{group__APACHE__CORE__DAEMON_gabfa74bb4f05f3b2de1a89160025e5400}{t} == \hyperlink{group__MOD__PROXY_gga4484631c7debf2a3a8d82d27273eb629ae2aea57f1d25f433e0dcd16ff29df2ae}{enc\_search}) \{
221         allowed = \textcolor{stringliteral}{"$-\_.!*'(),;:@&="};
222     \}
223     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{group__APACHE__CORE__DAEMON_gabfa74bb4f05f3b2de1a89160025e5400}{t} == \hyperlink{group__MOD__PROXY_gga4484631c7debf2a3a8d82d27273eb629a1d653a7e4cd137d0274990adf74b9efb}{enc\_user}) \{
224         allowed = \textcolor{stringliteral}{"$-\_.+!*'(),;@&="};
225     \}
226     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{group__APACHE__CORE__DAEMON_gabfa74bb4f05f3b2de1a89160025e5400}{t} == \hyperlink{group__MOD__PROXY_gga4484631c7debf2a3a8d82d27273eb629a60960ded4f746303ffa6da62959e1071}{enc\_fpath}) \{
227         allowed = \textcolor{stringliteral}{"$-\_.+!*'(),?:@&="};
228     \}
229     \textcolor{keywordflow}{else} \{            \textcolor{comment}{/* if (t == enc\_parm) */}
230         allowed = \textcolor{stringliteral}{"$-\_.+!*'(),?/:@&="};
231     \}
232 
233     \textcolor{keywordflow}{if} (\hyperlink{group__APACHE__CORE__DAEMON_gabfa74bb4f05f3b2de1a89160025e5400}{t} == \hyperlink{group__MOD__PROXY_gga4484631c7debf2a3a8d82d27273eb629a4a906f76cb6afc6083fed6de6f47b853}{enc\_path}) \{
234         reserved = \textcolor{stringliteral}{"/"};
235     \}
236     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{group__APACHE__CORE__DAEMON_gabfa74bb4f05f3b2de1a89160025e5400}{t} == \hyperlink{group__MOD__PROXY_gga4484631c7debf2a3a8d82d27273eb629ae2aea57f1d25f433e0dcd16ff29df2ae}{enc\_search}) \{
237         reserved = \textcolor{stringliteral}{"+"};
238     \}
239     \textcolor{keywordflow}{else} \{
240         reserved = \textcolor{stringliteral}{""};
241     \}
242 
243     y = apr\_palloc(\hyperlink{group__APACHE__CORE__MPM_ga5cd91701e5c167f2b1a38e70ab57817e}{p}, 3 * \hyperlink{group__APACHE__CORE__LOG_gab5a43233d60ef05c5b5bf5cba3d74468}{len} + 1);
244 
245     \textcolor{keywordflow}{for} (i = 0, j = 0; i < \hyperlink{group__APACHE__CORE__LOG_gab5a43233d60ef05c5b5bf5cba3d74468}{len}; i++, j++) \{
246 \textcolor{comment}{/* always handle '/' first */}
247         ch = \hyperlink{group__MOD__PROXY_gaa51afdb6d96b938b938dc9439be201be}{x}[\hyperlink{group__MOD__PROXY_ga38403a0592eb8018a3ad61aef0f7ca2c}{i}];
248         \textcolor{keywordflow}{if} (strchr(reserved, ch)) \{
249             y[j] = ch;
250             \textcolor{keywordflow}{continue};
251         \}
252 \textcolor{comment}{/*}
253 \textcolor{comment}{ * decode it if not already done. do not decode reverse proxied URLs}
254 \textcolor{comment}{ * unless specifically forced}
255 \textcolor{comment}{ */}
256         \textcolor{keywordflow}{if} ((forcedec || (\hyperlink{group__MOD__PROXY_ga7adaa91224b884116382c7c9a5b86ff4}{proxyreq} && \hyperlink{group__MOD__PROXY_ga7adaa91224b884116382c7c9a5b86ff4}{proxyreq} != 
      \hyperlink{group__ProxyReq_gada87167650249c33339a5992ad199219}{PROXYREQ\_REVERSE})) && ch == \textcolor{charliteral}{'%'}) \{
257             \textcolor{keywordflow}{if} (!\hyperlink{group__apr__ctype_ga9d30f3c5d538c21c6d50565cda8654d0}{apr\_isxdigit}(\hyperlink{group__MOD__PROXY_gaa51afdb6d96b938b938dc9439be201be}{x}[i + 1]) || !\hyperlink{group__apr__ctype_ga9d30f3c5d538c21c6d50565cda8654d0}{apr\_isxdigit}(
      \hyperlink{group__MOD__PROXY_gaa51afdb6d96b938b938dc9439be201be}{x}[i + 2])) \{
258                 \textcolor{keywordflow}{return} \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL};
259             \}
260             ch = ap\_proxy\_hex2c(&\hyperlink{group__MOD__PROXY_gaa51afdb6d96b938b938dc9439be201be}{x}[i + 1]);
261             i += 2;
262             \textcolor{keywordflow}{if} (ch != 0 && strchr(reserved, ch)) \{  \textcolor{comment}{/* keep it encoded */}
263                 ap\_proxy\_c2hex(ch, &y[j]);
264                 j += 2;
265                 \textcolor{keywordflow}{continue};
266             \}
267         \}
268 \textcolor{comment}{/* recode it, if necessary */}
269         \textcolor{keywordflow}{if} (!\hyperlink{group__apr__ctype_ga4fa78e6e7272dae64731768a17a2e003}{apr\_isalnum}(ch) && !strchr(allowed, ch)) \{
270             ap\_proxy\_c2hex(ch, &y[j]);
271             j += 2;
272         \}
273         \textcolor{keywordflow}{else} \{
274             y[j] = ch;
275         \}
276     \}
277     y[j] = \textcolor{charliteral}{'\(\backslash\)0'};
278     \textcolor{keywordflow}{return} \hyperlink{group__MOD__CACHE_gad4d47f76a849e2c428e3dd7f8c4eab1f}{y};
279 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=326pt]{proxy__util_8c_a1c03b3f7f69d399a646d84db4caaed65_cgraph}
\end{center}
\end{figure}


\index{proxy\+\_\+util.\+c@{proxy\+\_\+util.\+c}!P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE@{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE}}
\index{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE@{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE}!proxy\+\_\+util.\+c@{proxy\+\_\+util.\+c}}
\subsubsection[{\texorpdfstring{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+R\+E(const char $\ast$)}{PROXY_DECLARE(const char *)}}]{\setlength{\rightskip}{0pt plus 5cm}P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE (
\begin{DoxyParamCaption}
\item[{const char $\ast$}]{}
\end{DoxyParamCaption}
)}\hypertarget{proxy__util_8c_a994976c3ebd4838c2112ff7cbdb15547}{}\label{proxy__util_8c_a994976c3ebd4838c2112ff7cbdb15547}

\begin{DoxyCode}
830 \{
831     \hyperlink{structproxy__req__conf}{proxy\_req\_conf} *rconf;
832     \textcolor{keyword}{struct }\hyperlink{structproxy__alias}{proxy\_alias} *\hyperlink{group__MOD__PROXY_ga34404405efb1bb7f5b6dfd95e43d0181}{ent};
833     \textcolor{keywordtype}{int} \hyperlink{group__MOD__PROXY_ga38403a0592eb8018a3ad61aef0f7ca2c}{i}, l1, l2;
834     \textcolor{keywordtype}{char} *\hyperlink{pcregrep_8txt_a313eed54a0385c4d4c4c3ef54236123d}{u};
835 
836     \textcolor{comment}{/*}
837 \textcolor{comment}{     * XXX FIXME: Make sure this handled the ambiguous case of the :<PORT>}
838 \textcolor{comment}{     * after the hostname}
839 \textcolor{comment}{     * XXX FIXME: Ensure the /uri component is a case sensitive match}
840 \textcolor{comment}{     */}
841     \textcolor{keywordflow}{if} (\hyperlink{group__APACHE__CORE__CONFIG_ga091cdd45984e865a888a4f8bb8fe107a}{r}->\hyperlink{structrequest__rec_a82ca03c6dcfcacbf7001ff85e462289d}{proxyreq} != \hyperlink{group__ProxyReq_gada87167650249c33339a5992ad199219}{PROXYREQ\_REVERSE}) \{
842         \textcolor{keywordflow}{return} \hyperlink{group__MOD__PROXY_ga05d2db9f2dd75d18170f192bd1cc9b4e}{url};
843     \}
844 
845     l1 = strlen(\hyperlink{group__MOD__PROXY_ga05d2db9f2dd75d18170f192bd1cc9b4e}{url});
846     \textcolor{keywordflow}{if} (\hyperlink{group__APACHE__CORE__HTTPD_ga7be6dfd9155648f64d6e9abcd78c38cd}{conf}->interpolate\_env == 1) \{
847         rconf = \hyperlink{group__APACHE__CORE__CONFIG_ga1093a5908a384eacc929b028c79f2a02}{ap\_get\_module\_config}(\hyperlink{group__APACHE__CORE__CONFIG_ga091cdd45984e865a888a4f8bb8fe107a}{r}->\hyperlink{structrequest__rec_a64ddc7e883db1473c43254766c0c0c07}{request\_config}, &
      \hyperlink{group__MOD__PROXY_ga27b03f85d7a77ee10f73b8df6f58aa0e}{proxy\_module});
848         ent = (\textcolor{keyword}{struct }\hyperlink{structproxy__alias}{proxy\_alias} *)rconf->\hyperlink{structproxy__req__conf_a2a7db0adc7b6be3b7f280028b6ac19bb}{raliases}->\hyperlink{structapr__array__header__t_af8462fa2a1ddf6406c66cd3dd441a269}{elts};
849     \}
850     \textcolor{keywordflow}{else} \{
851         ent = (\textcolor{keyword}{struct }\hyperlink{structproxy__alias}{proxy\_alias} *)\hyperlink{group__APACHE__CORE__HTTPD_ga7be6dfd9155648f64d6e9abcd78c38cd}{conf}->raliases->elts;
852     \}
853     \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{group__APACHE__CORE__HTTPD_ga7be6dfd9155648f64d6e9abcd78c38cd}{conf}->raliases->nelts; i++) \{
854         \hyperlink{structproxy__server__conf}{proxy\_server\_conf} *sconf = (\hyperlink{structproxy__server__conf}{proxy\_server\_conf} *)
855             \hyperlink{group__APACHE__CORE__CONFIG_ga1093a5908a384eacc929b028c79f2a02}{ap\_get\_module\_config}(\hyperlink{group__APACHE__CORE__CONFIG_ga091cdd45984e865a888a4f8bb8fe107a}{r}->\hyperlink{structrequest__rec_a4a8059930ce9409cb885fdeef6921b7b}{server}->module\_config, &
      \hyperlink{group__MOD__PROXY_ga27b03f85d7a77ee10f73b8df6f58aa0e}{proxy\_module});
856         \hyperlink{structproxy__balancer}{proxy\_balancer} *\hyperlink{group__MOD__PROXY_ga7d902f564a33cf9c787a5670b026737b}{balancer};
857         \textcolor{keyword}{const} \textcolor{keywordtype}{char} *\hyperlink{structproxy__alias_a62e250f96fd9f5756c85c3df047282c7}{real} = ent[\hyperlink{group__MOD__PROXY_ga38403a0592eb8018a3ad61aef0f7ca2c}{i}].\hyperlink{structproxy__alias_a62e250f96fd9f5756c85c3df047282c7}{real};
858         \textcolor{comment}{/*}
859 \textcolor{comment}{         * First check if mapping against a balancer and see}
860 \textcolor{comment}{         * if we have such a entity. If so, then we need to}
861 \textcolor{comment}{         * find the particulars of the actual worker which may}
862 \textcolor{comment}{         * or may not be the right one... basically, we need}
863 \textcolor{comment}{         * to find which member actually handled this request.}
864 \textcolor{comment}{         */}
865         \textcolor{keywordflow}{if} (ap\_proxy\_valid\_balancer\_name((\textcolor{keywordtype}{char} *)\hyperlink{structproxy__alias_a62e250f96fd9f5756c85c3df047282c7}{real}, 0) &&
866             (balancer = ap\_proxy\_get\_balancer(\hyperlink{group__APACHE__CORE__CONFIG_ga091cdd45984e865a888a4f8bb8fe107a}{r}->\hyperlink{structrequest__rec_aa0a0c16f9a9ab3901cdb3f3c9c9d83d0}{pool}, sconf, real, 1))) \{
867             \textcolor{keywordtype}{int} \hyperlink{group__APACHE__CORE__PROTO_gad484edfd58b9127caa8f0f59b4004d09}{n}, l3 = 0;
868             \hyperlink{structproxy__worker}{proxy\_worker} **\hyperlink{group__MOD__PROXY_gad62a732febc2b789c7a84e2fdb3c5aa8}{worker} = (\hyperlink{structproxy__worker}{proxy\_worker} **)balancer->
      \hyperlink{structproxy__balancer_ae3b2618b5893903a9ddd19f77473efde}{workers}->\hyperlink{structapr__array__header__t_af8462fa2a1ddf6406c66cd3dd441a269}{elts};
869             \textcolor{keyword}{const} \textcolor{keywordtype}{char} *urlpart = \hyperlink{group__APACHE__CORE__DAEMON_ga6016b58857e4c0b11e39913bdf4ff910}{ap\_strchr\_c}(real + \textcolor{keyword}{sizeof}(
      \hyperlink{group__MOD__PROXY_gaaf7d23b31bf384aa5486370ad925880f}{BALANCER\_PREFIX}) - 1, \textcolor{charliteral}{'/'});
870             \textcolor{keywordflow}{if} (urlpart) \{
871                 \textcolor{keywordflow}{if} (!urlpart[1])
872                     urlpart = \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL};
873                 \textcolor{keywordflow}{else}
874                     l3 = strlen(urlpart);
875             \}
876             \textcolor{comment}{/* The balancer comparison is a bit trickier.  Given the context}
877 \textcolor{comment}{             *   BalancerMember balancer://alias http://example.com/foo}
878 \textcolor{comment}{             *   ProxyPassReverse /bash balancer://alias/bar}
879 \textcolor{comment}{             * translate url http://example.com/foo/bar/that to /bash/that}
880 \textcolor{comment}{             */}
881             \textcolor{keywordflow}{for} (n = 0; n < balancer->\hyperlink{structproxy__balancer_ae3b2618b5893903a9ddd19f77473efde}{workers}->\hyperlink{structapr__array__header__t_ab11b88220885c5a0920a06ac85680055}{nelts}; n++) \{
882                 l2 = strlen((*worker)->s->name);
883                 \textcolor{keywordflow}{if} (urlpart) \{
884                     \textcolor{comment}{/* urlpart (l3) assuredly starts with its own '/' */}
885                     \textcolor{keywordflow}{if} ((*worker)->s->name[l2 - 1] == \textcolor{charliteral}{'/'})
886                         --l2;
887                     \textcolor{keywordflow}{if} (l1 >= l2 + l3
888                             && \hyperlink{apr__cpystrn_8c_a8a019f6d84acf570175ecfc8b3382170}{strncasecmp}((*worker)->s->name, \hyperlink{group__MOD__PROXY_ga05d2db9f2dd75d18170f192bd1cc9b4e}{url}, l2) == 0
889                             && strncmp(urlpart, \hyperlink{group__MOD__PROXY_ga05d2db9f2dd75d18170f192bd1cc9b4e}{url} + l2, l3) == 0) \{
890                         u = apr\_pstrcat(\hyperlink{group__APACHE__CORE__CONFIG_ga091cdd45984e865a888a4f8bb8fe107a}{r}->\hyperlink{structrequest__rec_aa0a0c16f9a9ab3901cdb3f3c9c9d83d0}{pool}, ent[i].\hyperlink{structproxy__alias_ae4561a39b8d452bd0cb2e9616ac5a29a}{fake}, &\hyperlink{group__MOD__PROXY_ga05d2db9f2dd75d18170f192bd1cc9b4e}{url}[l2 + l3],
891                                         \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL});
892                         \textcolor{keywordflow}{return} ap\_is\_url(u) ? u : ap\_construct\_url(\hyperlink{group__APACHE__CORE__CONFIG_ga091cdd45984e865a888a4f8bb8fe107a}{r}->\hyperlink{structrequest__rec_aa0a0c16f9a9ab3901cdb3f3c9c9d83d0}{pool}, u, 
      \hyperlink{group__APACHE__CORE__CONFIG_ga091cdd45984e865a888a4f8bb8fe107a}{r});
893                     \}
894                 \}
895                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (l1 >= l2 && \hyperlink{apr__cpystrn_8c_a8a019f6d84acf570175ecfc8b3382170}{strncasecmp}((*worker)->s->name, 
      \hyperlink{group__MOD__PROXY_ga05d2db9f2dd75d18170f192bd1cc9b4e}{url}, l2) == 0) \{
896                     \textcolor{comment}{/* edge case where fake is just "/"... avoid double slash */}
897                     \textcolor{keywordflow}{if} ((ent[i].\hyperlink{structproxy__alias_ae4561a39b8d452bd0cb2e9616ac5a29a}{fake}[0] == \textcolor{charliteral}{'/'}) && (ent[i].\hyperlink{structproxy__alias_ae4561a39b8d452bd0cb2e9616ac5a29a}{fake}[1] == 0) && (
      \hyperlink{group__MOD__PROXY_ga05d2db9f2dd75d18170f192bd1cc9b4e}{url}[l2] == \textcolor{charliteral}{'/'})) \{
898                         u = apr\_pstrdup(\hyperlink{group__APACHE__CORE__CONFIG_ga091cdd45984e865a888a4f8bb8fe107a}{r}->\hyperlink{structrequest__rec_aa0a0c16f9a9ab3901cdb3f3c9c9d83d0}{pool}, &\hyperlink{group__MOD__PROXY_ga05d2db9f2dd75d18170f192bd1cc9b4e}{url}[l2]);
899                     \} \textcolor{keywordflow}{else} \{
900                         u = apr\_pstrcat(\hyperlink{group__APACHE__CORE__CONFIG_ga091cdd45984e865a888a4f8bb8fe107a}{r}->\hyperlink{structrequest__rec_aa0a0c16f9a9ab3901cdb3f3c9c9d83d0}{pool}, ent[i].\hyperlink{structproxy__alias_ae4561a39b8d452bd0cb2e9616ac5a29a}{fake}, &\hyperlink{group__MOD__PROXY_ga05d2db9f2dd75d18170f192bd1cc9b4e}{url}[l2], 
      \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL});
901                     \}
902                     \textcolor{keywordflow}{return} ap\_is\_url(u) ? u : ap\_construct\_url(\hyperlink{group__APACHE__CORE__CONFIG_ga091cdd45984e865a888a4f8bb8fe107a}{r}->\hyperlink{structrequest__rec_aa0a0c16f9a9ab3901cdb3f3c9c9d83d0}{pool}, u, 
      \hyperlink{group__APACHE__CORE__CONFIG_ga091cdd45984e865a888a4f8bb8fe107a}{r});
903                 \}
904                 worker++;
905             \}
906         \}
907         \textcolor{keywordflow}{else} \{
908             \textcolor{keyword}{const} \textcolor{keywordtype}{char} *part = \hyperlink{group__MOD__PROXY_ga05d2db9f2dd75d18170f192bd1cc9b4e}{url};
909             l2 = strlen(real);
910             \textcolor{keywordflow}{if} (real[0] == \textcolor{charliteral}{'/'}) \{
911                 part = \hyperlink{group__APACHE__CORE__DAEMON_ga48f6ba4ea178ad3a334403ec7206d7a3}{ap\_strstr\_c}(\hyperlink{group__MOD__PROXY_ga05d2db9f2dd75d18170f192bd1cc9b4e}{url}, \textcolor{stringliteral}{"://"});
912                 \textcolor{keywordflow}{if} (part) \{
913                     part = \hyperlink{group__APACHE__CORE__DAEMON_ga6016b58857e4c0b11e39913bdf4ff910}{ap\_strchr\_c}(part+3, \textcolor{charliteral}{'/'});
914                     \textcolor{keywordflow}{if} (part) \{
915                         l1 = strlen(part);
916                     \}
917                     \textcolor{keywordflow}{else} \{
918                         part = \hyperlink{group__MOD__PROXY_ga05d2db9f2dd75d18170f192bd1cc9b4e}{url};
919                     \}
920                 \}
921                 \textcolor{keywordflow}{else} \{
922                     part = \hyperlink{group__MOD__PROXY_ga05d2db9f2dd75d18170f192bd1cc9b4e}{url};
923                 \}
924             \}
925             \textcolor{keywordflow}{if} (l2 > 0 && l1 >= l2 && \hyperlink{apr__cpystrn_8c_a8a019f6d84acf570175ecfc8b3382170}{strncasecmp}(real, part, l2) == 0) \{
926                 u = apr\_pstrcat(\hyperlink{group__APACHE__CORE__CONFIG_ga091cdd45984e865a888a4f8bb8fe107a}{r}->\hyperlink{structrequest__rec_aa0a0c16f9a9ab3901cdb3f3c9c9d83d0}{pool}, ent[i].\hyperlink{structproxy__alias_ae4561a39b8d452bd0cb2e9616ac5a29a}{fake}, &part[l2], \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL});
927                 \textcolor{keywordflow}{return} ap\_is\_url(u) ? u : ap\_construct\_url(\hyperlink{group__APACHE__CORE__CONFIG_ga091cdd45984e865a888a4f8bb8fe107a}{r}->\hyperlink{structrequest__rec_aa0a0c16f9a9ab3901cdb3f3c9c9d83d0}{pool}, u, \hyperlink{group__APACHE__CORE__CONFIG_ga091cdd45984e865a888a4f8bb8fe107a}{r});
928             \}
929         \}
930     \}
931 
932     \textcolor{keywordflow}{return} \hyperlink{group__MOD__PROXY_ga05d2db9f2dd75d18170f192bd1cc9b4e}{url};
933 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=326pt]{proxy__util_8c_a994976c3ebd4838c2112ff7cbdb15547_cgraph}
\end{center}
\end{figure}


\index{proxy\+\_\+util.\+c@{proxy\+\_\+util.\+c}!P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE@{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE}}
\index{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE@{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE}!proxy\+\_\+util.\+c@{proxy\+\_\+util.\+c}}
\subsubsection[{\texorpdfstring{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+R\+E(proxy\+\_\+balancer $\ast$)}{PROXY_DECLARE(proxy_balancer *)}}]{\setlength{\rightskip}{0pt plus 5cm}P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE (
\begin{DoxyParamCaption}
\item[{{\bf proxy\+\_\+balancer} $\ast$}]{}
\end{DoxyParamCaption}
)}\hypertarget{proxy__util_8c_a79099e6d2f71bcc882b6b64ecd59fe8c}{}\label{proxy__util_8c_a79099e6d2f71bcc882b6b64ecd59fe8c}

\begin{DoxyCode}
1074 \{
1075     \hyperlink{structproxy__balancer}{proxy\_balancer} *\hyperlink{group__MOD__PROXY_ga7d902f564a33cf9c787a5670b026737b}{balancer};
1076     \textcolor{keywordtype}{char} *\hyperlink{group__APACHE__CORE__HTTPD_ga7cce37ef8558e46f408cb4d0f555605b}{c}, *\hyperlink{group__APACHE__CORE__HTTPD_gaaf802cf1817bf45bcf1a5f266ef18bbd}{uri} = apr\_pstrdup(\hyperlink{group__APACHE__CORE__MPM_ga5cd91701e5c167f2b1a38e70ab57817e}{p}, \hyperlink{group__MOD__PROXY_ga05d2db9f2dd75d18170f192bd1cc9b4e}{url});
1077     \textcolor{keywordtype}{int} \hyperlink{group__MOD__PROXY_ga38403a0592eb8018a3ad61aef0f7ca2c}{i};
1078     \hyperlink{structproxy__hashes}{proxy\_hashes} \hyperlink{apr__random_8c_a1961406c0af51085f634defe740cbf52}{hash};
1079 
1080     c = strchr(uri, \textcolor{charliteral}{':'});
1081     \textcolor{keywordflow}{if} (c == \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL} || c[1] != \textcolor{charliteral}{'/'} || c[2] != \textcolor{charliteral}{'/'} || c[3] == \textcolor{charliteral}{'\(\backslash\)0'}) \{
1082         \textcolor{keywordflow}{return} \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL};
1083     \}
1084     \textcolor{comment}{/* remove path from uri */}
1085     \textcolor{keywordflow}{if} ((c = strchr(c + 3, \textcolor{charliteral}{'/'}))) \{
1086         *c = \textcolor{charliteral}{'\(\backslash\)0'};
1087     \}
1088     ap\_str\_tolower(uri);
1089     hash.\hyperlink{structproxy__hashes_acb9f2008dcbfc80b3545d2df2219284a}{def} = \hyperlink{proxy__util_8c_a894a8f960939418e2122523aa81b5dd0}{ap\_proxy\_hashfunc}(uri, \hyperlink{group__MOD__PROXY_ggad04e421d409d5c4b460cd62694ada47ca1e5ad274df0e7ce6dd6f12686640f446}{PROXY\_HASHFUNC\_DEFAULT});
1090     hash.\hyperlink{structproxy__hashes_a229642e1523de07c9edb64b67174dd90}{fnv} = \hyperlink{proxy__util_8c_a894a8f960939418e2122523aa81b5dd0}{ap\_proxy\_hashfunc}(uri, \hyperlink{group__MOD__PROXY_ggad04e421d409d5c4b460cd62694ada47ca4af344ec2e59dc7162cd4c20f85d8c19}{PROXY\_HASHFUNC\_FNV});
1091     balancer = (\hyperlink{structproxy__balancer}{proxy\_balancer} *)\hyperlink{group__APACHE__CORE__HTTPD_ga7be6dfd9155648f64d6e9abcd78c38cd}{conf}->balancers->elts;
1092     for (i = 0; i < \hyperlink{group__APACHE__CORE__HTTPD_ga7be6dfd9155648f64d6e9abcd78c38cd}{conf}->balancers->nelts; i++) \{
1093         \textcolor{keywordflow}{if} (balancer->\hyperlink{structproxy__balancer_afc9835916ce7788d2ef378d2483eaaed}{hash}.\hyperlink{structproxy__hashes_acb9f2008dcbfc80b3545d2df2219284a}{def} == hash.\hyperlink{structproxy__hashes_acb9f2008dcbfc80b3545d2df2219284a}{def} && balancer->\hyperlink{structproxy__balancer_afc9835916ce7788d2ef378d2483eaaed}{hash}.\hyperlink{structproxy__hashes_a229642e1523de07c9edb64b67174dd90}{fnv} == hash.
      \hyperlink{structproxy__hashes_a229642e1523de07c9edb64b67174dd90}{fnv}) \{
1094             \textcolor{keywordflow}{if} (!care || !balancer->\hyperlink{structproxy__balancer_a4604afa7d99a6cc1f411eb723f35e458}{s}->\hyperlink{structproxy__balancer__shared_ac2d10d9760ffd4d0bf8afcdea1f68a31}{inactive}) \{
1095                 \textcolor{keywordflow}{return} \hyperlink{group__MOD__PROXY_ga7d902f564a33cf9c787a5670b026737b}{balancer};
1096             \}
1097         \}
1098         balancer++;
1099     \}
1100     \textcolor{keywordflow}{return} \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL};
1101 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{proxy__util_8c_a79099e6d2f71bcc882b6b64ecd59fe8c_cgraph}
\end{center}
\end{figure}


\index{proxy\+\_\+util.\+c@{proxy\+\_\+util.\+c}!P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE@{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE}}
\index{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE@{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE}!proxy\+\_\+util.\+c@{proxy\+\_\+util.\+c}}
\subsubsection[{\texorpdfstring{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+R\+E(proxy\+\_\+worker $\ast$)}{PROXY_DECLARE(proxy_worker *)}}]{\setlength{\rightskip}{0pt plus 5cm}P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE (
\begin{DoxyParamCaption}
\item[{{\bf proxy\+\_\+worker} $\ast$}]{}
\end{DoxyParamCaption}
)}\hypertarget{proxy__util_8c_a43277b2a3035c3bb12ff3588a58a01e4}{}\label{proxy__util_8c_a43277b2a3035c3bb12ff3588a58a01e4}

\begin{DoxyCode}
1512 \{
1513     \hyperlink{structproxy__worker}{proxy\_worker} *\hyperlink{group__MOD__PROXY_gad62a732febc2b789c7a84e2fdb3c5aa8}{worker};
1514     \hyperlink{structproxy__worker}{proxy\_worker} *max\_worker = \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL};
1515     \textcolor{keywordtype}{int} max\_match = 0;
1516     \textcolor{keywordtype}{int} url\_length;
1517     \textcolor{keywordtype}{int} min\_match;
1518     \textcolor{keywordtype}{int} worker\_name\_length;
1519     \textcolor{keyword}{const} \textcolor{keywordtype}{char} *\hyperlink{group__APACHE__CORE__HTTPD_ga7cce37ef8558e46f408cb4d0f555605b}{c};
1520     \textcolor{keywordtype}{char} *url\_copy;
1521     \textcolor{keywordtype}{int} \hyperlink{group__MOD__PROXY_ga38403a0592eb8018a3ad61aef0f7ca2c}{i};
1522 
1523     \textcolor{keywordflow}{if} (!\hyperlink{group__MOD__PROXY_ga05d2db9f2dd75d18170f192bd1cc9b4e}{url}) \{
1524         \textcolor{keywordflow}{return} \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL};
1525     \}
1526 
1527     \hyperlink{group__MOD__PROXY_ga05d2db9f2dd75d18170f192bd1cc9b4e}{url} = ap\_proxy\_de\_socketfy(\hyperlink{group__APACHE__CORE__MPM_ga5cd91701e5c167f2b1a38e70ab57817e}{p}, \hyperlink{group__MOD__PROXY_ga05d2db9f2dd75d18170f192bd1cc9b4e}{url});
1528 
1529     c = \hyperlink{group__APACHE__CORE__DAEMON_ga6016b58857e4c0b11e39913bdf4ff910}{ap\_strchr\_c}(\hyperlink{group__MOD__PROXY_ga05d2db9f2dd75d18170f192bd1cc9b4e}{url}, \textcolor{charliteral}{':'});
1530     \textcolor{keywordflow}{if} (c == \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL} || c[1] != \textcolor{charliteral}{'/'} || c[2] != \textcolor{charliteral}{'/'} || c[3] == \textcolor{charliteral}{'\(\backslash\)0'}) \{
1531         \textcolor{keywordflow}{return} \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL};
1532     \}
1533 
1534     url\_length = strlen(\hyperlink{group__MOD__PROXY_ga05d2db9f2dd75d18170f192bd1cc9b4e}{url});
1535     url\_copy = apr\_pstrmemdup(\hyperlink{group__APACHE__CORE__MPM_ga5cd91701e5c167f2b1a38e70ab57817e}{p}, \hyperlink{group__MOD__PROXY_ga05d2db9f2dd75d18170f192bd1cc9b4e}{url}, url\_length);
1536 
1537     \textcolor{comment}{/*}
1538 \textcolor{comment}{     * We need to find the start of the path and}
1539 \textcolor{comment}{     * therefore we know the length of the scheme://hostname/}
1540 \textcolor{comment}{     * part to we can force-lowercase everything up to}
1541 \textcolor{comment}{     * the start of the path.}
1542 \textcolor{comment}{     */}
1543     c = \hyperlink{group__APACHE__CORE__DAEMON_ga6016b58857e4c0b11e39913bdf4ff910}{ap\_strchr\_c}(c+3, \textcolor{charliteral}{'/'});
1544     \textcolor{keywordflow}{if} (c) \{
1545         \textcolor{keywordtype}{char} *pathstart;
1546         pathstart = url\_copy + (c - \hyperlink{group__MOD__PROXY_ga05d2db9f2dd75d18170f192bd1cc9b4e}{url});
1547         *pathstart = \textcolor{charliteral}{'\(\backslash\)0'};
1548         ap\_str\_tolower(url\_copy);
1549         min\_match = strlen(url\_copy);
1550         *pathstart = \textcolor{charliteral}{'/'};
1551     \}
1552     \textcolor{keywordflow}{else} \{
1553         ap\_str\_tolower(url\_copy);
1554         min\_match = strlen(url\_copy);
1555     \}
1556     \textcolor{comment}{/*}
1557 \textcolor{comment}{     * Do a "longest match" on the worker name to find the worker that}
1558 \textcolor{comment}{     * fits best to the URL, but keep in mind that we must have at least}
1559 \textcolor{comment}{     * a minimum matching of length min\_match such that}
1560 \textcolor{comment}{     * scheme://hostname[:port] matches between worker and url.}
1561 \textcolor{comment}{     */}
1562 
1563     \textcolor{keywordflow}{if} (\hyperlink{group__MOD__PROXY_ga7d902f564a33cf9c787a5670b026737b}{balancer}) \{
1564         \hyperlink{structproxy__worker}{proxy\_worker} **workers = (\hyperlink{structproxy__worker}{proxy\_worker} **)
      \hyperlink{group__MOD__PROXY_ga7d902f564a33cf9c787a5670b026737b}{balancer}->workers->elts;
1565         for (i = 0; i < \hyperlink{group__MOD__PROXY_ga7d902f564a33cf9c787a5670b026737b}{balancer}->workers->nelts; i++, workers++) \{
1566             worker = *workers;
1567             \textcolor{keywordflow}{if} ( ((worker\_name\_length = strlen(worker->\hyperlink{structproxy__worker_abeaebad014908a4f108fba27313187aa}{s}->\hyperlink{structproxy__worker__shared_a5cc7bac10e746c287d81e723ddd5bad4}{name})) <= url\_length)
1568                 && (worker\_name\_length >= min\_match)
1569                 && (worker\_name\_length > max\_match)
1570                 && (strncmp(url\_copy, worker->\hyperlink{structproxy__worker_abeaebad014908a4f108fba27313187aa}{s}->\hyperlink{structproxy__worker__shared_a5cc7bac10e746c287d81e723ddd5bad4}{name}, worker\_name\_length) == 0) ) \{
1571                 max\_worker = \hyperlink{group__MOD__PROXY_gad62a732febc2b789c7a84e2fdb3c5aa8}{worker};
1572                 max\_match = worker\_name\_length;
1573             \}
1574 
1575         \}
1576     \} \textcolor{keywordflow}{else} \{
1577         worker = (\hyperlink{structproxy__worker}{proxy\_worker} *)\hyperlink{group__APACHE__CORE__HTTPD_ga7be6dfd9155648f64d6e9abcd78c38cd}{conf}->workers->elts;
1578         for (i = 0; i < \hyperlink{group__APACHE__CORE__HTTPD_ga7be6dfd9155648f64d6e9abcd78c38cd}{conf}->workers->nelts; i++, worker++) \{
1579             \textcolor{keywordflow}{if} ( ((worker\_name\_length = strlen(worker->\hyperlink{structproxy__worker_abeaebad014908a4f108fba27313187aa}{s}->\hyperlink{structproxy__worker__shared_a5cc7bac10e746c287d81e723ddd5bad4}{name})) <= url\_length)
1580                 && (worker\_name\_length >= min\_match)
1581                 && (worker\_name\_length > max\_match)
1582                 && (strncmp(url\_copy, worker->\hyperlink{structproxy__worker_abeaebad014908a4f108fba27313187aa}{s}->\hyperlink{structproxy__worker__shared_a5cc7bac10e746c287d81e723ddd5bad4}{name}, worker\_name\_length) == 0) ) \{
1583                 max\_worker = \hyperlink{group__MOD__PROXY_gad62a732febc2b789c7a84e2fdb3c5aa8}{worker};
1584                 max\_match = worker\_name\_length;
1585             \}
1586         \}
1587     \}
1588 
1589     \textcolor{keywordflow}{return} max\_worker;
1590 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{proxy__util_8c_a43277b2a3035c3bb12ff3588a58a01e4_cgraph}
\end{center}
\end{figure}


\index{proxy\+\_\+util.\+c@{proxy\+\_\+util.\+c}!P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE@{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE}}
\index{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE@{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE}!proxy\+\_\+util.\+c@{proxy\+\_\+util.\+c}}
\subsubsection[{\texorpdfstring{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+R\+E(proxy\+\_\+worker\+\_\+shared $\ast$)}{PROXY_DECLARE(proxy_worker_shared *)}}]{\setlength{\rightskip}{0pt plus 5cm}P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE (
\begin{DoxyParamCaption}
\item[{{\bf proxy\+\_\+worker\+\_\+shared} $\ast$}]{}
\end{DoxyParamCaption}
)}\hypertarget{proxy__util_8c_a1beab2264f256cb4c71d873d7ca3ff26}{}\label{proxy__util_8c_a1beab2264f256cb4c71d873d7ca3ff26}

\begin{DoxyCode}
3273 \{
3274     \hyperlink{structproxy__worker__shared}{proxy\_worker\_shared} *\hyperlink{group__MOD__PROXY_gaa4ebe098e8dd67428afcaa1f9bca45bd}{shm};
3275     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \hyperlink{group__MOD__PROXY_ga38403a0592eb8018a3ad61aef0f7ca2c}{i}, \hyperlink{group__apr__thread__proc_ga915cb5b6b271c146b5198c51cff16f9a}{limit};
3276     limit = \hyperlink{mod__proxy__balancer_8c_a609a617b3142b92c83376840773f50bf}{storage}->\hyperlink{structap__slotmem__provider__t_ab6ef040311cb142505aaa57793e1c23b}{num\_slots}(\hyperlink{group__MOD__PROXY_ga272f60c5e6cce1bfc743cd17b683d5a3}{slot});
3277     \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{group__apr__thread__proc_ga915cb5b6b271c146b5198c51cff16f9a}{limit}; i++) \{
3278         \textcolor{keywordflow}{if} (\hyperlink{mod__proxy__balancer_8c_a609a617b3142b92c83376840773f50bf}{storage}->\hyperlink{structap__slotmem__provider__t_a66fb8f1a2e6ca94d6bed2e222bfb145d}{dptr}(\hyperlink{group__MOD__PROXY_ga272f60c5e6cce1bfc743cd17b683d5a3}{slot}, i, (\textcolor{keywordtype}{void} *)&shm) != \hyperlink{group__apr__errno_ga9ee311b7bf1c691dc521d721339ee2a6}{APR\_SUCCESS}) \{
3279             \textcolor{keywordflow}{return} \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL};
3280         \}
3281         \textcolor{keywordflow}{if} ((\hyperlink{group__MOD__PROXY_gad62a732febc2b789c7a84e2fdb3c5aa8}{worker}->s->hash.def == shm->\hyperlink{structproxy__worker__shared_aade40e2000e67a4cd33f6015336da649}{hash}.\hyperlink{structproxy__hashes_acb9f2008dcbfc80b3545d2df2219284a}{def}) &&
3282             (\hyperlink{group__MOD__PROXY_gad62a732febc2b789c7a84e2fdb3c5aa8}{worker}->s->hash.fnv == shm->\hyperlink{structproxy__worker__shared_aade40e2000e67a4cd33f6015336da649}{hash}.\hyperlink{structproxy__hashes_a229642e1523de07c9edb64b67174dd90}{fnv})) \{
3283             *\hyperlink{group__APACHE__CORE__CONFIG_ga186c402ad812159f19596ff36a42bf20}{index} = \hyperlink{group__MOD__PROXY_ga38403a0592eb8018a3ad61aef0f7ca2c}{i};
3284             \textcolor{keywordflow}{return} \hyperlink{group__MOD__PROXY_gaa4ebe098e8dd67428afcaa1f9bca45bd}{shm};
3285         \}
3286     \}
3287     \textcolor{keywordflow}{return} \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL};
3288 \}
\end{DoxyCode}
\index{proxy\+\_\+util.\+c@{proxy\+\_\+util.\+c}!P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE@{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE}}
\index{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE@{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE}!proxy\+\_\+util.\+c@{proxy\+\_\+util.\+c}}
\subsubsection[{\texorpdfstring{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+R\+E(proxy\+\_\+balancer\+\_\+shared $\ast$)}{PROXY_DECLARE(proxy_balancer_shared *)}}]{\setlength{\rightskip}{0pt plus 5cm}P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE (
\begin{DoxyParamCaption}
\item[{{\bf proxy\+\_\+balancer\+\_\+shared} $\ast$}]{}
\end{DoxyParamCaption}
)}\hypertarget{proxy__util_8c_a0f3cbd83fd7551835af4b1e11ded1e4a}{}\label{proxy__util_8c_a0f3cbd83fd7551835af4b1e11ded1e4a}

\begin{DoxyCode}
3294 \{
3295     \hyperlink{structproxy__balancer__shared}{proxy\_balancer\_shared} *\hyperlink{group__MOD__PROXY_gaa4ebe098e8dd67428afcaa1f9bca45bd}{shm};
3296     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \hyperlink{group__MOD__PROXY_ga38403a0592eb8018a3ad61aef0f7ca2c}{i}, \hyperlink{group__apr__thread__proc_ga915cb5b6b271c146b5198c51cff16f9a}{limit};
3297     limit = \hyperlink{mod__proxy__balancer_8c_a609a617b3142b92c83376840773f50bf}{storage}->\hyperlink{structap__slotmem__provider__t_ab6ef040311cb142505aaa57793e1c23b}{num\_slots}(\hyperlink{group__MOD__PROXY_ga272f60c5e6cce1bfc743cd17b683d5a3}{slot});
3298     \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{group__apr__thread__proc_ga915cb5b6b271c146b5198c51cff16f9a}{limit}; i++) \{
3299         \textcolor{keywordflow}{if} (\hyperlink{mod__proxy__balancer_8c_a609a617b3142b92c83376840773f50bf}{storage}->\hyperlink{structap__slotmem__provider__t_a66fb8f1a2e6ca94d6bed2e222bfb145d}{dptr}(\hyperlink{group__MOD__PROXY_ga272f60c5e6cce1bfc743cd17b683d5a3}{slot}, i, (\textcolor{keywordtype}{void} *)&shm) != \hyperlink{group__apr__errno_ga9ee311b7bf1c691dc521d721339ee2a6}{APR\_SUCCESS}) \{
3300             \textcolor{keywordflow}{return} \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL};
3301         \}
3302         \textcolor{keywordflow}{if} ((\hyperlink{group__MOD__PROXY_ga7d902f564a33cf9c787a5670b026737b}{balancer}->s->hash.def == shm->\hyperlink{structproxy__balancer__shared_a126cbb1a44416a4d95987edec23c480e}{hash}.\hyperlink{structproxy__hashes_acb9f2008dcbfc80b3545d2df2219284a}{def}) &&
3303             (\hyperlink{group__MOD__PROXY_ga7d902f564a33cf9c787a5670b026737b}{balancer}->s->hash.fnv == shm->\hyperlink{structproxy__balancer__shared_a126cbb1a44416a4d95987edec23c480e}{hash}.\hyperlink{structproxy__hashes_a229642e1523de07c9edb64b67174dd90}{fnv})) \{
3304             *\hyperlink{group__APACHE__CORE__CONFIG_ga186c402ad812159f19596ff36a42bf20}{index} = \hyperlink{group__MOD__PROXY_ga38403a0592eb8018a3ad61aef0f7ca2c}{i};
3305             \textcolor{keywordflow}{return} \hyperlink{group__MOD__PROXY_gaa4ebe098e8dd67428afcaa1f9bca45bd}{shm};
3306         \}
3307     \}
3308     \textcolor{keywordflow}{return} \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL};
3309 \}
\end{DoxyCode}
\index{proxy\+\_\+util.\+c@{proxy\+\_\+util.\+c}!P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE@{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE}}
\index{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE@{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE}!proxy\+\_\+util.\+c@{proxy\+\_\+util.\+c}}
\subsubsection[{\texorpdfstring{P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+R\+E(apr\+\_\+port\+\_\+t)}{PROXY_DECLARE(apr_port_t)}}]{\setlength{\rightskip}{0pt plus 5cm}P\+R\+O\+X\+Y\+\_\+\+D\+E\+C\+L\+A\+RE (
\begin{DoxyParamCaption}
\item[{{\bf apr\+\_\+port\+\_\+t}}]{}
\end{DoxyParamCaption}
)}\hypertarget{proxy__util_8c_ac3c014c25a18c7216833afbd3e8498c5}{}\label{proxy__util_8c_ac3c014c25a18c7216833afbd3e8498c5}

\begin{DoxyCode}
3713 \{
3714     \textcolor{keywordflow}{if} (scheme) \{
3715         \hyperlink{group__apr__network__io_gaa670a71960f6eb4fe0d0de2a1e7aba03}{apr\_port\_t} \hyperlink{group__APACHE__CORE__VHOST_ga225c76c246a5cc263c5a2628eb99353e}{port};
3716         \textcolor{keywordflow}{if} ((port = apr\_uri\_port\_of\_scheme(scheme)) != 0) \{
3717             \textcolor{keywordflow}{return} \hyperlink{group__APACHE__CORE__VHOST_ga225c76c246a5cc263c5a2628eb99353e}{port};
3718         \} \textcolor{keywordflow}{else} \{
3719             \hyperlink{structproxy__schemes__t}{proxy\_schemes\_t} *pscheme;
3720             \textcolor{keywordflow}{for} (pscheme = pschemes; pscheme->\hyperlink{structproxy__schemes__t_aabe6c40adfd8db23b65d36d687b76f2b}{name} != \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL}; ++pscheme) \{
3721                 \textcolor{keywordflow}{if} (\hyperlink{apr__cpystrn_8c_a4a00fc29b96a953fed9e0107a9c4548a}{strcasecmp}(scheme, pscheme->\hyperlink{structproxy__schemes__t_aabe6c40adfd8db23b65d36d687b76f2b}{name}) == 0) \{
3722                     \textcolor{keywordflow}{return} pscheme->\hyperlink{structproxy__schemes__t_a5a8c3d9a6458dd3417ab69fa82e7eea1}{default\_port};
3723                 \}
3724             \}
3725         \}
3726     \}
3727     \textcolor{keywordflow}{return} 0;
3728 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=326pt]{proxy__util_8c_ac3c014c25a18c7216833afbd3e8498c5_cgraph}
\end{center}
\end{figure}




\subsection{Variable Documentation}
\index{proxy\+\_\+util.\+c@{proxy\+\_\+util.\+c}!proxy\+\_\+mutex@{proxy\+\_\+mutex}}
\index{proxy\+\_\+mutex@{proxy\+\_\+mutex}!proxy\+\_\+util.\+c@{proxy\+\_\+util.\+c}}
\subsubsection[{\texorpdfstring{proxy\+\_\+mutex}{proxy_mutex}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf apr\+\_\+global\+\_\+mutex\+\_\+t}$\ast$ proxy\+\_\+mutex}\hypertarget{proxy__util_8c_a93b0fcd14bd51e35876e3ed7ec589d85}{}\label{proxy__util_8c_a93b0fcd14bd51e35876e3ed7ec589d85}
