\hypertarget{htpasswd_8c}{}\section{/usr/local/src/github/\+Codebase/httpd-\/2.4.29/support/htpasswd.c File Reference}
\label{htpasswd_8c}\index{/usr/local/src/github/\+Codebase/httpd-\/2.\+4.\+29/support/htpasswd.\+c@{/usr/local/src/github/\+Codebase/httpd-\/2.\+4.\+29/support/htpasswd.\+c}}
{\ttfamily \#include \char`\"{}passwd\+\_\+common.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}apr\+\_\+signal.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}apr\+\_\+getopt.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}apr\+\_\+md5.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}apr\+\_\+sha1.\+h\char`\"{}}\\*
Include dependency graph for htpasswd.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{htpasswd_8c__incl}
\end{center}
\end{figure}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{htpasswd_8c_aa6d7c3a5e6844767b57b811344a5ed84}{A\+P\+H\+T\+P\+\_\+\+N\+E\+W\+F\+I\+LE}~1
\item 
\#define \hyperlink{htpasswd_8c_a489d764ea94e38ba4023d583cecbb2b3}{A\+P\+H\+T\+P\+\_\+\+N\+O\+F\+I\+LE}~2
\item 
\#define \hyperlink{htpasswd_8c_a7c08caad05d2a1b5a18d3d4c4239bde1}{A\+P\+H\+T\+P\+\_\+\+D\+E\+L\+U\+S\+ER}~4
\item 
\#define \hyperlink{htpasswd_8c_a8aac6db34cf2733474bf9742b0b41ef1}{A\+P\+H\+T\+P\+\_\+\+V\+E\+R\+I\+FY}~8
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{pcre_8txt_a42dfa4ff673c82d8efe7144098fbc198}{int} \hyperlink{htpasswd_8c_a814244b02f6701fd8ead246678bb3dae}{main} (\hyperlink{pcre_8txt_a42dfa4ff673c82d8efe7144098fbc198}{int} \hyperlink{group__apr__getopt_ga6bdebf9385dc069c90aa21989641be02}{argc}, const char $\ast$const \hyperlink{group__apr__getopt_ga675a108e956f4e2ea74dae8d26e6273e}{argv}\mbox{[}$\,$\mbox{]})
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hyperlink{structapr__file__t}{apr\+\_\+file\+\_\+t} $\ast$ \hyperlink{htpasswd_8c_a945261dd766884b1aa9ad05319891923}{ftemp} = \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{N\+U\+LL}
\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\index{htpasswd.\+c@{htpasswd.\+c}!A\+P\+H\+T\+P\+\_\+\+D\+E\+L\+U\+S\+ER@{A\+P\+H\+T\+P\+\_\+\+D\+E\+L\+U\+S\+ER}}
\index{A\+P\+H\+T\+P\+\_\+\+D\+E\+L\+U\+S\+ER@{A\+P\+H\+T\+P\+\_\+\+D\+E\+L\+U\+S\+ER}!htpasswd.\+c@{htpasswd.\+c}}
\subsubsection[{\texorpdfstring{A\+P\+H\+T\+P\+\_\+\+D\+E\+L\+U\+S\+ER}{APHTP_DELUSER}}]{\setlength{\rightskip}{0pt plus 5cm}\#define A\+P\+H\+T\+P\+\_\+\+D\+E\+L\+U\+S\+ER~4}\hypertarget{htpasswd_8c_a7c08caad05d2a1b5a18d3d4c4239bde1}{}\label{htpasswd_8c_a7c08caad05d2a1b5a18d3d4c4239bde1}
\index{htpasswd.\+c@{htpasswd.\+c}!A\+P\+H\+T\+P\+\_\+\+N\+E\+W\+F\+I\+LE@{A\+P\+H\+T\+P\+\_\+\+N\+E\+W\+F\+I\+LE}}
\index{A\+P\+H\+T\+P\+\_\+\+N\+E\+W\+F\+I\+LE@{A\+P\+H\+T\+P\+\_\+\+N\+E\+W\+F\+I\+LE}!htpasswd.\+c@{htpasswd.\+c}}
\subsubsection[{\texorpdfstring{A\+P\+H\+T\+P\+\_\+\+N\+E\+W\+F\+I\+LE}{APHTP_NEWFILE}}]{\setlength{\rightskip}{0pt plus 5cm}\#define A\+P\+H\+T\+P\+\_\+\+N\+E\+W\+F\+I\+LE~1}\hypertarget{htpasswd_8c_aa6d7c3a5e6844767b57b811344a5ed84}{}\label{htpasswd_8c_aa6d7c3a5e6844767b57b811344a5ed84}
\index{htpasswd.\+c@{htpasswd.\+c}!A\+P\+H\+T\+P\+\_\+\+N\+O\+F\+I\+LE@{A\+P\+H\+T\+P\+\_\+\+N\+O\+F\+I\+LE}}
\index{A\+P\+H\+T\+P\+\_\+\+N\+O\+F\+I\+LE@{A\+P\+H\+T\+P\+\_\+\+N\+O\+F\+I\+LE}!htpasswd.\+c@{htpasswd.\+c}}
\subsubsection[{\texorpdfstring{A\+P\+H\+T\+P\+\_\+\+N\+O\+F\+I\+LE}{APHTP_NOFILE}}]{\setlength{\rightskip}{0pt plus 5cm}\#define A\+P\+H\+T\+P\+\_\+\+N\+O\+F\+I\+LE~2}\hypertarget{htpasswd_8c_a489d764ea94e38ba4023d583cecbb2b3}{}\label{htpasswd_8c_a489d764ea94e38ba4023d583cecbb2b3}
\index{htpasswd.\+c@{htpasswd.\+c}!A\+P\+H\+T\+P\+\_\+\+V\+E\+R\+I\+FY@{A\+P\+H\+T\+P\+\_\+\+V\+E\+R\+I\+FY}}
\index{A\+P\+H\+T\+P\+\_\+\+V\+E\+R\+I\+FY@{A\+P\+H\+T\+P\+\_\+\+V\+E\+R\+I\+FY}!htpasswd.\+c@{htpasswd.\+c}}
\subsubsection[{\texorpdfstring{A\+P\+H\+T\+P\+\_\+\+V\+E\+R\+I\+FY}{APHTP_VERIFY}}]{\setlength{\rightskip}{0pt plus 5cm}\#define A\+P\+H\+T\+P\+\_\+\+V\+E\+R\+I\+FY~8}\hypertarget{htpasswd_8c_a8aac6db34cf2733474bf9742b0b41ef1}{}\label{htpasswd_8c_a8aac6db34cf2733474bf9742b0b41ef1}


\subsection{Function Documentation}
\index{htpasswd.\+c@{htpasswd.\+c}!main@{main}}
\index{main@{main}!htpasswd.\+c@{htpasswd.\+c}}
\subsubsection[{\texorpdfstring{main(int argc, const char $\ast$const argv[])}{main(int argc, const char *const argv[])}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf int} main (
\begin{DoxyParamCaption}
\item[{{\bf int}}]{argc, }
\item[{const char $\ast$const}]{argv\mbox{[}$\,$\mbox{]}}
\end{DoxyParamCaption}
)}\hypertarget{htpasswd_8c_a814244b02f6701fd8ead246678bb3dae}{}\label{htpasswd_8c_a814244b02f6701fd8ead246678bb3dae}

\begin{DoxyCode}
275 \{
276     \hyperlink{structapr__file__t}{apr\_file\_t} *fpw = \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL};
277     \textcolor{keywordtype}{char} \hyperlink{group__APACHE__CORE__LOG_gaa843820216dea79b53a16310cb08e8dd}{line}[\hyperlink{group__APACHE__CORE__DAEMON_ga4fa9aad0e9c7cc2e344b679cdbb2b67d}{MAX\_STRING\_LEN}];
278     \textcolor{keywordtype}{char} *pwfilename = \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL};
279     \textcolor{keywordtype}{char} *user = \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL};
280     \textcolor{keywordtype}{char} tn[] = \textcolor{stringliteral}{"htpasswd.tmp.XXXXXX"};
281     \textcolor{keywordtype}{char} *\hyperlink{group__apr__dir_gab8a2fd169b20f0b9d33959f7b17d35aa}{dirname};
282     \textcolor{keywordtype}{char} *scratch, cp[\hyperlink{group__APACHE__CORE__DAEMON_ga4fa9aad0e9c7cc2e344b679cdbb2b67d}{MAX\_STRING\_LEN}];
283     \textcolor{keywordtype}{int} \hyperlink{pcregrep_8txt_a1fdac88190c7a3aca2735f0bf49094dd}{found} = 0;
284     \textcolor{keywordtype}{int} \hyperlink{group__MOD__PROXY_ga38403a0592eb8018a3ad61aef0f7ca2c}{i};
285     \textcolor{keywordtype}{unsigned} \hyperlink{group__APR__Util__Date_ga6bd7250007a3cfeadacf370fbf68cf5a}{mask} = 0;
286     \hyperlink{structapr__pool__t}{apr\_pool\_t} *\hyperlink{group__APACHE__CORE__MUTEX_ga8fea43b485988aa6df5dced9dddbe733}{pool};
287     \textcolor{keywordtype}{int} existing\_file = 0;
288     \textcolor{keyword}{struct }\hyperlink{structpasswd__ctx}{passwd\_ctx} \hyperlink{group__APACHE__CORE__FILTER_ga94af791485570bea922969fef12d6259}{ctx} = \{ 0 \};
289 \textcolor{preprocessor}{#if APR\_CHARSET\_EBCDIC}
290     \hyperlink{group__apr__errno_gaa5105fa83cc322f09382292db8b47593}{apr\_status\_t} rv;
291     \hyperlink{group__APR__XLATE_ga069dabbadc30e3a4157c38104a250e77}{apr\_xlate\_t} *\hyperlink{ab_8c_ac2b1e84470918e4c7d16449f4b4d5ddb}{to\_ascii};
292 \textcolor{preprocessor}{#endif}
293 
294     apr\_app\_initialize(&\hyperlink{group__APACHE__CORE__LISTEN_ga073cc653debb351b563a84ac72c49614}{argc}, &\hyperlink{group__APACHE__CORE__LISTEN_ga7af4ef3a08f923773e59081c357d9adf}{argv}, \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL});
295     atexit(terminate);
296     \hyperlink{group__apr__pools_gaa7c40921aae156b665e82b0a66991a39}{apr\_pool\_create}(&pool, \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL});
297     apr\_pool\_abort\_set(abort\_on\_oom, pool);
298     apr\_file\_open\_stderr(&errfile, pool);
299     ctx.\hyperlink{structpasswd__ctx_abdb187a35f5be5af2bf82ef3363dc11b}{pool} = \hyperlink{group__APACHE__CORE__MUTEX_ga8fea43b485988aa6df5dced9dddbe733}{pool};
300     ctx.\hyperlink{structpasswd__ctx_a6f535584596964c51f398f1728b25c71}{alg} = \hyperlink{lua__passwd_8h_a9a6460186b091969c74996c0c4b32202}{ALG\_APMD5};
301 
302 \textcolor{preprocessor}{#if APR\_CHARSET\_EBCDIC}
303     rv = apr\_xlate\_open(&to\_ascii, \textcolor{stringliteral}{"ISO-8859-1"}, \hyperlink{group__APR__XLATE_ga3276c680eb0917ff51ff22c9b9959fa9}{APR\_DEFAULT\_CHARSET}, pool);
304     \textcolor{keywordflow}{if} (rv) \{
305         apr\_file\_printf(errfile, \textcolor{stringliteral}{"apr\_xlate\_open(to ASCII)->%d"} \hyperlink{htcacheclean_8c_a4fc34b120ed3bd1120c1eb36abbcd6af}{NL}, rv);
306         \hyperlink{group__APACHE__OS__NETWARE_gaac7f3a566d7243651a356db3fcfef6b1}{exit}(1);
307     \}
308     rv = apr\_SHA1InitEBCDIC(to\_ascii);
309     \textcolor{keywordflow}{if} (rv) \{
310         apr\_file\_printf(errfile, \textcolor{stringliteral}{"apr\_SHA1InitEBCDIC()->%d"} \hyperlink{htcacheclean_8c_a4fc34b120ed3bd1120c1eb36abbcd6af}{NL}, rv);
311         \hyperlink{group__APACHE__OS__NETWARE_gaac7f3a566d7243651a356db3fcfef6b1}{exit}(1);
312     \}
313     rv = apr\_MD5InitEBCDIC(to\_ascii);
314     \textcolor{keywordflow}{if} (rv) \{
315         apr\_file\_printf(errfile, \textcolor{stringliteral}{"apr\_MD5InitEBCDIC()->%d"} \hyperlink{htcacheclean_8c_a4fc34b120ed3bd1120c1eb36abbcd6af}{NL}, rv);
316         \hyperlink{group__APACHE__OS__NETWARE_gaac7f3a566d7243651a356db3fcfef6b1}{exit}(1);
317     \}
318 \textcolor{preprocessor}{#endif }\textcolor{comment}{/*APR\_CHARSET\_EBCDIC*/}\textcolor{preprocessor}{}
319 
320     check\_args(\hyperlink{group__APACHE__CORE__LISTEN_ga073cc653debb351b563a84ac72c49614}{argc}, \hyperlink{group__APACHE__CORE__LISTEN_ga7af4ef3a08f923773e59081c357d9adf}{argv}, &ctx, &mask, &user, &pwfilename);
321 
322     \textcolor{comment}{/*}
323 \textcolor{comment}{     * Only do the file checks if we're supposed to frob it.}
324 \textcolor{comment}{     */}
325     \textcolor{keywordflow}{if} (!(mask & \hyperlink{htpasswd_8c_a489d764ea94e38ba4023d583cecbb2b3}{APHTP\_NOFILE})) \{
326         existing\_file = exists(pwfilename, pool);
327         \textcolor{keywordflow}{if} (existing\_file) \{
328             \textcolor{comment}{/*}
329 \textcolor{comment}{             * Check that this existing file is readable and writable.}
330 \textcolor{comment}{             */}
331             \textcolor{keywordflow}{if} (!accessible(pool, pwfilename, \hyperlink{group__apr__file__open__flags_gaf9e7303f028b130ff7d4b209d6662d7d}{APR\_FOPEN\_READ}|
      \hyperlink{group__apr__file__open__flags_gac598bb95fc9476b0bf2ed0b1c308842c}{APR\_FOPEN\_WRITE})) \{
332                 apr\_file\_printf(errfile, \textcolor{stringliteral}{"%s: cannot open file %s for "}
333                                 \textcolor{stringliteral}{"read/write access"} \hyperlink{htcacheclean_8c_a4fc34b120ed3bd1120c1eb36abbcd6af}{NL}, \hyperlink{group__APACHE__CORE__LISTEN_ga7af4ef3a08f923773e59081c357d9adf}{argv}[0], pwfilename);
334                 \hyperlink{group__APACHE__OS__NETWARE_gaac7f3a566d7243651a356db3fcfef6b1}{exit}(\hyperlink{lua__passwd_8h_aca1e63696ddadb011dde9ae55a71a360}{ERR\_FILEPERM});
335             \}
336         \}
337         \textcolor{keywordflow}{else} \{
338             \textcolor{comment}{/*}
339 \textcolor{comment}{             * Error out if -c was omitted for this non-existant file.}
340 \textcolor{comment}{             */}
341             \textcolor{keywordflow}{if} (!(mask & \hyperlink{htpasswd_8c_aa6d7c3a5e6844767b57b811344a5ed84}{APHTP\_NEWFILE})) \{
342                 apr\_file\_printf(errfile,
343                         \textcolor{stringliteral}{"%s: cannot modify file %s; use '-c' to create it"} \hyperlink{htcacheclean_8c_a4fc34b120ed3bd1120c1eb36abbcd6af}{NL},
344                         \hyperlink{group__APACHE__CORE__LISTEN_ga7af4ef3a08f923773e59081c357d9adf}{argv}[0], pwfilename);
345                 \hyperlink{group__APACHE__OS__NETWARE_gaac7f3a566d7243651a356db3fcfef6b1}{exit}(\hyperlink{lua__passwd_8h_aca1e63696ddadb011dde9ae55a71a360}{ERR\_FILEPERM});
346             \}
347             \textcolor{comment}{/*}
348 \textcolor{comment}{             * As it doesn't exist yet, verify that we can create it.}
349 \textcolor{comment}{             */}
350             \textcolor{keywordflow}{if} (!accessible(pool, pwfilename, \hyperlink{group__apr__file__open__flags_gac598bb95fc9476b0bf2ed0b1c308842c}{APR\_FOPEN\_WRITE}|
      \hyperlink{group__apr__file__open__flags_gafe94f21ccbf411172e70e7f473af251a}{APR\_FOPEN\_CREATE})) \{
351                 apr\_file\_printf(errfile, \textcolor{stringliteral}{"%s: cannot create file %s"} \hyperlink{htcacheclean_8c_a4fc34b120ed3bd1120c1eb36abbcd6af}{NL},
352                                 \hyperlink{group__APACHE__CORE__LISTEN_ga7af4ef3a08f923773e59081c357d9adf}{argv}[0], pwfilename);
353                 \hyperlink{group__APACHE__OS__NETWARE_gaac7f3a566d7243651a356db3fcfef6b1}{exit}(\hyperlink{lua__passwd_8h_aca1e63696ddadb011dde9ae55a71a360}{ERR\_FILEPERM});
354             \}
355         \}
356     \}
357 
358     \textcolor{comment}{/*}
359 \textcolor{comment}{     * All the file access checks (if any) have been made.  Time to go to work;}
360 \textcolor{comment}{     * try to create the record for the username in question.  If that}
361 \textcolor{comment}{     * fails, there's no need to waste any time on file manipulations.}
362 \textcolor{comment}{     * Any error message text is returned in the record buffer, since}
363 \textcolor{comment}{     * the mkrecord() routine doesn't have access to argv[].}
364 \textcolor{comment}{     */}
365     \textcolor{keywordflow}{if} ((mask & (\hyperlink{htpasswd_8c_a7c08caad05d2a1b5a18d3d4c4239bde1}{APHTP\_DELUSER}|\hyperlink{htpasswd_8c_a8aac6db34cf2733474bf9742b0b41ef1}{APHTP\_VERIFY})) == 0) \{
366         i = mkrecord(&ctx, user);
367         \textcolor{keywordflow}{if} (i != 0) \{
368             apr\_file\_printf(errfile, \textcolor{stringliteral}{"%s: %s"} \hyperlink{htcacheclean_8c_a4fc34b120ed3bd1120c1eb36abbcd6af}{NL}, \hyperlink{group__APACHE__CORE__LISTEN_ga7af4ef3a08f923773e59081c357d9adf}{argv}[0], ctx.\hyperlink{structpasswd__ctx_ac138b422f243f942d99385910e813777}{errstr});
369             \hyperlink{group__APACHE__OS__NETWARE_gaac7f3a566d7243651a356db3fcfef6b1}{exit}(i);
370         \}
371         \textcolor{keywordflow}{if} (mask & APHTP\_NOFILE) \{
372             printf(\textcolor{stringliteral}{"%s"} \hyperlink{htcacheclean_8c_a4fc34b120ed3bd1120c1eb36abbcd6af}{NL}, ctx.\hyperlink{structpasswd__ctx_a08a570cfa3f0a660479b64ec4a08d4b7}{out});
373             \hyperlink{group__APACHE__OS__NETWARE_gaac7f3a566d7243651a356db3fcfef6b1}{exit}(0);
374         \}
375     \}
376 
377     \textcolor{keywordflow}{if} ((mask & \hyperlink{htpasswd_8c_a8aac6db34cf2733474bf9742b0b41ef1}{APHTP\_VERIFY}) == 0) \{
378         \textcolor{comment}{/*}
379 \textcolor{comment}{         * We can access the files the right way, and we have a record}
380 \textcolor{comment}{         * to add or update.  Let's do it..}
381 \textcolor{comment}{         */}
382         \textcolor{keywordflow}{if} (apr\_temp\_dir\_get((\textcolor{keyword}{const} \textcolor{keywordtype}{char}**)&dirname, pool) != \hyperlink{group__apr__errno_ga9ee311b7bf1c691dc521d721339ee2a6}{APR\_SUCCESS}) \{
383             apr\_file\_printf(errfile, \textcolor{stringliteral}{"%s: could not determine temp dir"} \hyperlink{htcacheclean_8c_a4fc34b120ed3bd1120c1eb36abbcd6af}{NL},
384                             \hyperlink{group__APACHE__CORE__LISTEN_ga7af4ef3a08f923773e59081c357d9adf}{argv}[0]);
385             \hyperlink{group__APACHE__OS__NETWARE_gaac7f3a566d7243651a356db3fcfef6b1}{exit}(\hyperlink{lua__passwd_8h_aca1e63696ddadb011dde9ae55a71a360}{ERR\_FILEPERM});
386         \}
387         dirname = apr\_psprintf(pool, \textcolor{stringliteral}{"%s/%s"}, dirname, tn);
388 
389         \textcolor{keywordflow}{if} (apr\_file\_mktemp(&\hyperlink{htpasswd_8c_a945261dd766884b1aa9ad05319891923}{ftemp}, dirname, 0, pool) != \hyperlink{group__apr__errno_ga9ee311b7bf1c691dc521d721339ee2a6}{APR\_SUCCESS}) \{
390             apr\_file\_printf(errfile, \textcolor{stringliteral}{"%s: unable to create temporary file %s"} \hyperlink{htcacheclean_8c_a4fc34b120ed3bd1120c1eb36abbcd6af}{NL},
391                             \hyperlink{group__APACHE__CORE__LISTEN_ga7af4ef3a08f923773e59081c357d9adf}{argv}[0], dirname);
392             \hyperlink{group__APACHE__OS__NETWARE_gaac7f3a566d7243651a356db3fcfef6b1}{exit}(\hyperlink{lua__passwd_8h_aca1e63696ddadb011dde9ae55a71a360}{ERR\_FILEPERM});
393         \}
394     \}
395 
396     \textcolor{comment}{/*}
397 \textcolor{comment}{     * If we're not creating a new file, copy records from the existing}
398 \textcolor{comment}{     * one to the temporary file until we find the specified user.}
399 \textcolor{comment}{     */}
400     \textcolor{keywordflow}{if} (existing\_file && !(mask & APHTP\_NEWFILE)) \{
401         \textcolor{keywordflow}{if} (apr\_file\_open(&fpw, pwfilename, \hyperlink{group__apr__file__open__flags_ga0021db78d799d1c8825b701c7efee483}{APR\_READ} | \hyperlink{group__apr__file__open__flags_ga6edc818199e8b90e3dabf97c42a27158}{APR\_BUFFERED},
402                           \hyperlink{group__apr__file__permissions_ga8552adb50d545d5fc7faeabb4f4a388f}{APR\_OS\_DEFAULT}, pool) != \hyperlink{group__apr__errno_ga9ee311b7bf1c691dc521d721339ee2a6}{APR\_SUCCESS}) \{
403             apr\_file\_printf(errfile, \textcolor{stringliteral}{"%s: unable to read file %s"} \hyperlink{htcacheclean_8c_a4fc34b120ed3bd1120c1eb36abbcd6af}{NL},
404                             \hyperlink{group__APACHE__CORE__LISTEN_ga7af4ef3a08f923773e59081c357d9adf}{argv}[0], pwfilename);
405             \hyperlink{group__APACHE__OS__NETWARE_gaac7f3a566d7243651a356db3fcfef6b1}{exit}(\hyperlink{lua__passwd_8h_aca1e63696ddadb011dde9ae55a71a360}{ERR\_FILEPERM});
406         \}
407         \textcolor{keywordflow}{while} (apr\_file\_gets(line, \textcolor{keyword}{sizeof}(line), fpw) == \hyperlink{group__apr__errno_ga9ee311b7bf1c691dc521d721339ee2a6}{APR\_SUCCESS}) \{
408             \textcolor{keywordtype}{char} *\hyperlink{group__APR__Util__Escaping_ga6299e50771f9eb5ee423ea0611f1c896}{colon};
409 
410             strcpy(cp, line);
411             scratch = cp;
412             \textcolor{keywordflow}{while} (\hyperlink{group__apr__ctype_ga23f4c7721923a0f0f444fd7fb196047a}{apr\_isspace}(*scratch)) \{
413                 ++scratch;
414             \}
415 
416             \textcolor{keywordflow}{if} (!*scratch || (*scratch == \textcolor{charliteral}{'#'})) \{
417                 \hyperlink{passwd__common_8c_ad569b14bb6259bdb981228f3d7be55e0}{putline}(\hyperlink{htpasswd_8c_a945261dd766884b1aa9ad05319891923}{ftemp}, line);
418                 \textcolor{keywordflow}{continue};
419             \}
420             \textcolor{comment}{/*}
421 \textcolor{comment}{             * See if this is our user.}
422 \textcolor{comment}{             */}
423             colon = strchr(scratch, \textcolor{charliteral}{':'});
424             \textcolor{keywordflow}{if} (colon != \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL}) \{
425                 *colon = \textcolor{charliteral}{'\(\backslash\)0'};
426             \}
427             \textcolor{keywordflow}{else} \{
428                 \textcolor{comment}{/*}
429 \textcolor{comment}{                 * If we've not got a colon on the line, this could well}
430 \textcolor{comment}{                 * not be a valid htpasswd file.}
431 \textcolor{comment}{                 * We should bail at this point.}
432 \textcolor{comment}{                 */}
433                 apr\_file\_printf(errfile, \textcolor{stringliteral}{"%s: The file %s does not appear "}
434                                          \textcolor{stringliteral}{"to be a valid htpasswd file."} \hyperlink{htcacheclean_8c_a4fc34b120ed3bd1120c1eb36abbcd6af}{NL},
435                                 \hyperlink{group__APACHE__CORE__LISTEN_ga7af4ef3a08f923773e59081c357d9adf}{argv}[0], pwfilename);
436                 apr\_file\_close(fpw);
437                 \hyperlink{group__APACHE__OS__NETWARE_gaac7f3a566d7243651a356db3fcfef6b1}{exit}(\hyperlink{lua__passwd_8h_a590fcd0ab079b3e9c584385c52a2980f}{ERR\_INVALID});
438             \}
439             \textcolor{keywordflow}{if} (strcmp(user, scratch) != 0) \{
440                 \hyperlink{passwd__common_8c_ad569b14bb6259bdb981228f3d7be55e0}{putline}(\hyperlink{htpasswd_8c_a945261dd766884b1aa9ad05319891923}{ftemp}, line);
441                 \textcolor{keywordflow}{continue};
442             \}
443             \textcolor{keywordflow}{else} \{
444                 \textcolor{comment}{/* We found the user we were looking for */}
445                 found++;
446                 \textcolor{keywordflow}{if} ((mask & \hyperlink{htpasswd_8c_a7c08caad05d2a1b5a18d3d4c4239bde1}{APHTP\_DELUSER})) \{
447                     \textcolor{comment}{/* Delete entry from the file */}
448                     apr\_file\_printf(errfile, \textcolor{stringliteral}{"Deleting "});
449                 \}
450                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((mask & APHTP\_VERIFY)) \{
451                     \textcolor{comment}{/* Verify */}
452                     \textcolor{keywordtype}{char} *\hyperlink{apr__random_8c_a1961406c0af51085f634defe740cbf52}{hash} = colon + 1;
453                     \textcolor{keywordtype}{size\_t} \hyperlink{group__APACHE__CORE__LOG_gab5a43233d60ef05c5b5bf5cba3d74468}{len};
454 
455                     len = strcspn(hash, \textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"});
456                     \textcolor{keywordflow}{if} (len == 0) \{
457                         apr\_file\_printf(errfile, \textcolor{stringliteral}{"Empty hash for user %s"} \hyperlink{htcacheclean_8c_a4fc34b120ed3bd1120c1eb36abbcd6af}{NL},
458                                         user);
459                         \hyperlink{group__APACHE__OS__NETWARE_gaac7f3a566d7243651a356db3fcfef6b1}{exit}(\hyperlink{lua__passwd_8h_a590fcd0ab079b3e9c584385c52a2980f}{ERR\_INVALID});
460                     \}
461                     hash[\hyperlink{group__APACHE__CORE__LOG_gab5a43233d60ef05c5b5bf5cba3d74468}{len}] = \textcolor{charliteral}{'\(\backslash\)0'};
462 
463                     i = verify(&ctx, hash);
464                     \textcolor{keywordflow}{if} (i != 0) \{
465                         apr\_file\_printf(errfile, \textcolor{stringliteral}{"%s"} \hyperlink{htcacheclean_8c_a4fc34b120ed3bd1120c1eb36abbcd6af}{NL}, ctx.\hyperlink{structpasswd__ctx_ac138b422f243f942d99385910e813777}{errstr});
466                         \hyperlink{group__APACHE__OS__NETWARE_gaac7f3a566d7243651a356db3fcfef6b1}{exit}(i);
467                     \}
468                 \}
469                 \textcolor{keywordflow}{else} \{
470                     \textcolor{comment}{/* Update entry */}
471                     apr\_file\_printf(errfile, \textcolor{stringliteral}{"Updating "});
472                     \hyperlink{passwd__common_8c_ad569b14bb6259bdb981228f3d7be55e0}{putline}(\hyperlink{htpasswd_8c_a945261dd766884b1aa9ad05319891923}{ftemp}, ctx.\hyperlink{structpasswd__ctx_a08a570cfa3f0a660479b64ec4a08d4b7}{out});
473                 \}
474             \}
475         \}
476         apr\_file\_close(fpw);
477     \}
478     \textcolor{keywordflow}{if} (!found) \{
479         \textcolor{keywordflow}{if} (mask & APHTP\_DELUSER) \{
480             apr\_file\_printf(errfile, \textcolor{stringliteral}{"User %s not found"} \hyperlink{htcacheclean_8c_a4fc34b120ed3bd1120c1eb36abbcd6af}{NL}, user);
481             \hyperlink{group__APACHE__OS__NETWARE_gaac7f3a566d7243651a356db3fcfef6b1}{exit}(0);
482         \}
483         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (mask & APHTP\_VERIFY) \{
484             apr\_file\_printf(errfile, \textcolor{stringliteral}{"User %s not found"} \hyperlink{htcacheclean_8c_a4fc34b120ed3bd1120c1eb36abbcd6af}{NL}, user);
485             \hyperlink{group__APACHE__OS__NETWARE_gaac7f3a566d7243651a356db3fcfef6b1}{exit}(\hyperlink{lua__passwd_8h_adbecc3440a7ce0170b78f71187ca8d22}{ERR\_BADUSER});
486         \}
487         \textcolor{keywordflow}{else} \{
488             apr\_file\_printf(errfile, \textcolor{stringliteral}{"Adding "});
489             \hyperlink{passwd__common_8c_ad569b14bb6259bdb981228f3d7be55e0}{putline}(\hyperlink{htpasswd_8c_a945261dd766884b1aa9ad05319891923}{ftemp}, ctx.\hyperlink{structpasswd__ctx_a08a570cfa3f0a660479b64ec4a08d4b7}{out});
490         \}
491     \}
492     \textcolor{keywordflow}{if} (mask & APHTP\_VERIFY) \{
493         apr\_file\_printf(errfile, \textcolor{stringliteral}{"Password for user %s correct."} \hyperlink{htcacheclean_8c_a4fc34b120ed3bd1120c1eb36abbcd6af}{NL}, user);
494         \hyperlink{group__APACHE__OS__NETWARE_gaac7f3a566d7243651a356db3fcfef6b1}{exit}(0);
495     \}
496 
497     apr\_file\_printf(errfile, \textcolor{stringliteral}{"password for user %s"} \hyperlink{htcacheclean_8c_a4fc34b120ed3bd1120c1eb36abbcd6af}{NL}, user);
498 
499     \textcolor{comment}{/* The temporary file has all the data, just copy it to the new location.}
500 \textcolor{comment}{     */}
501     \textcolor{keywordflow}{if} (apr\_file\_copy(dirname, pwfilename, \hyperlink{group__apr__file__permissions_ga8552adb50d545d5fc7faeabb4f4a388f}{APR\_OS\_DEFAULT}, pool) !=
502         \hyperlink{group__apr__errno_ga9ee311b7bf1c691dc521d721339ee2a6}{APR\_SUCCESS}) \{
503         apr\_file\_printf(errfile, \textcolor{stringliteral}{"%s: unable to update file %s"} \hyperlink{htcacheclean_8c_a4fc34b120ed3bd1120c1eb36abbcd6af}{NL},
504                         \hyperlink{group__APACHE__CORE__LISTEN_ga7af4ef3a08f923773e59081c357d9adf}{argv}[0], pwfilename);
505         \hyperlink{group__APACHE__OS__NETWARE_gaac7f3a566d7243651a356db3fcfef6b1}{exit}(\hyperlink{lua__passwd_8h_aca1e63696ddadb011dde9ae55a71a360}{ERR\_FILEPERM});
506     \}
507     apr\_file\_close(\hyperlink{htpasswd_8c_a945261dd766884b1aa9ad05319891923}{ftemp});
508     \textcolor{keywordflow}{return} 0;
509 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=232pt]{htpasswd_8c_a814244b02f6701fd8ead246678bb3dae_cgraph}
\end{center}
\end{figure}




\subsection{Variable Documentation}
\index{htpasswd.\+c@{htpasswd.\+c}!ftemp@{ftemp}}
\index{ftemp@{ftemp}!htpasswd.\+c@{htpasswd.\+c}}
\subsubsection[{\texorpdfstring{ftemp}{ftemp}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf apr\+\_\+file\+\_\+t}$\ast$ ftemp = {\bf N\+U\+LL}}\hypertarget{htpasswd_8c_a945261dd766884b1aa9ad05319891923}{}\label{htpasswd_8c_a945261dd766884b1aa9ad05319891923}
