\hypertarget{apr__date_8c}{}\section{/usr/local/src/github/\+Codebase/httpd-\/2.4.29/srclib/apr-\/util/misc/apr\+\_\+date.c File Reference}
\label{apr__date_8c}\index{/usr/local/src/github/\+Codebase/httpd-\/2.\+4.\+29/srclib/apr-\/util/misc/apr\+\_\+date.\+c@{/usr/local/src/github/\+Codebase/httpd-\/2.\+4.\+29/srclib/apr-\/util/misc/apr\+\_\+date.\+c}}
{\ttfamily \#include \char`\"{}apr.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}apr\+\_\+lib.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}apr\+\_\+want.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}apr\+\_\+date.\+h\char`\"{}}\\*
Include dependency graph for apr\+\_\+date.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{apr__date_8c__incl}
\end{center}
\end{figure}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{apr__date_8c_a88a4bf7f483aad3f3945773f3383e713}{A\+P\+R\+\_\+\+W\+A\+N\+T\+\_\+\+S\+T\+R\+F\+U\+NC}
\item 
\#define \hyperlink{apr__date_8c_aa1f7825c136058e465186eb635d12f11}{T\+I\+M\+E\+P\+A\+R\+SE}(ds,  hr10,  hr1,  min10,  min1,  sec10,  sec1)
\item 
\#define \hyperlink{apr__date_8c_a574f7cc7ba24c017bff5d6c41cf5903d}{T\+I\+M\+E\+P\+A\+R\+S\+E\+\_\+\+S\+TD}(ds,  timstr)
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{group__APR__Util__Base64_gaf43a293bb29d7041e6c85e90b967715f}{A\+P\+U\+\_\+\+D\+E\+C\+L\+A\+RE} (\hyperlink{pcre_8txt_a42dfa4ff673c82d8efe7144098fbc198}{int})
\item 
\hyperlink{apr__date_8c_a005db26a62fad23b4c776026848505f4}{A\+P\+U\+\_\+\+D\+E\+C\+L\+A\+RE} (\hyperlink{group__apr__time_gadb4bde16055748190eae190c55aa02bb}{apr\+\_\+time\+\_\+t})
\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\index{apr\+\_\+date.\+c@{apr\+\_\+date.\+c}!A\+P\+R\+\_\+\+W\+A\+N\+T\+\_\+\+S\+T\+R\+F\+U\+NC@{A\+P\+R\+\_\+\+W\+A\+N\+T\+\_\+\+S\+T\+R\+F\+U\+NC}}
\index{A\+P\+R\+\_\+\+W\+A\+N\+T\+\_\+\+S\+T\+R\+F\+U\+NC@{A\+P\+R\+\_\+\+W\+A\+N\+T\+\_\+\+S\+T\+R\+F\+U\+NC}!apr\+\_\+date.\+c@{apr\+\_\+date.\+c}}
\subsubsection[{\texorpdfstring{A\+P\+R\+\_\+\+W\+A\+N\+T\+\_\+\+S\+T\+R\+F\+U\+NC}{APR_WANT_STRFUNC}}]{\setlength{\rightskip}{0pt plus 5cm}\#define A\+P\+R\+\_\+\+W\+A\+N\+T\+\_\+\+S\+T\+R\+F\+U\+NC}\hypertarget{apr__date_8c_a88a4bf7f483aad3f3945773f3383e713}{}\label{apr__date_8c_a88a4bf7f483aad3f3945773f3383e713}
\index{apr\+\_\+date.\+c@{apr\+\_\+date.\+c}!T\+I\+M\+E\+P\+A\+R\+SE@{T\+I\+M\+E\+P\+A\+R\+SE}}
\index{T\+I\+M\+E\+P\+A\+R\+SE@{T\+I\+M\+E\+P\+A\+R\+SE}!apr\+\_\+date.\+c@{apr\+\_\+date.\+c}}
\subsubsection[{\texorpdfstring{T\+I\+M\+E\+P\+A\+R\+SE}{TIMEPARSE}}]{\setlength{\rightskip}{0pt plus 5cm}\#define T\+I\+M\+E\+P\+A\+R\+SE(
\begin{DoxyParamCaption}
\item[{}]{ds, }
\item[{}]{hr10, }
\item[{}]{hr1, }
\item[{}]{min10, }
\item[{}]{min1, }
\item[{}]{sec10, }
\item[{}]{sec1}
\end{DoxyParamCaption}
)}\hypertarget{apr__date_8c_aa1f7825c136058e465186eb635d12f11}{}\label{apr__date_8c_aa1f7825c136058e465186eb635d12f11}
{\bfseries Value\+:}
\begin{DoxyCode}
\{                                                       \(\backslash\)
        ds.tm\_hour = ((hr10 - \textcolor{charliteral}{'0'}) * 10) + (hr1 - \textcolor{charliteral}{'0'});     \(\backslash\)
        ds.tm\_min = ((min10 - \textcolor{charliteral}{'0'}) * 10) + (min1 - \textcolor{charliteral}{'0'});    \(\backslash\)
        ds.tm\_sec = ((sec10 - \textcolor{charliteral}{'0'}) * 10) + (sec1 - \textcolor{charliteral}{'0'});    \(\backslash\)
    \}
\end{DoxyCode}
\index{apr\+\_\+date.\+c@{apr\+\_\+date.\+c}!T\+I\+M\+E\+P\+A\+R\+S\+E\+\_\+\+S\+TD@{T\+I\+M\+E\+P\+A\+R\+S\+E\+\_\+\+S\+TD}}
\index{T\+I\+M\+E\+P\+A\+R\+S\+E\+\_\+\+S\+TD@{T\+I\+M\+E\+P\+A\+R\+S\+E\+\_\+\+S\+TD}!apr\+\_\+date.\+c@{apr\+\_\+date.\+c}}
\subsubsection[{\texorpdfstring{T\+I\+M\+E\+P\+A\+R\+S\+E\+\_\+\+S\+TD}{TIMEPARSE_STD}}]{\setlength{\rightskip}{0pt plus 5cm}\#define T\+I\+M\+E\+P\+A\+R\+S\+E\+\_\+\+S\+TD(
\begin{DoxyParamCaption}
\item[{}]{ds, }
\item[{}]{timstr}
\end{DoxyParamCaption}
)}\hypertarget{apr__date_8c_a574f7cc7ba24c017bff5d6c41cf5903d}{}\label{apr__date_8c_a574f7cc7ba24c017bff5d6c41cf5903d}
{\bfseries Value\+:}
\begin{DoxyCode}
\{                                                       \hyperlink{apr__date_8c_aa1f7825c136058e465186eb635d12f11}{\(\backslash\)}
\hyperlink{apr__date_8c_aa1f7825c136058e465186eb635d12f11}{        TIMEPARSE}(ds, timstr[0],timstr[1],                  \(\backslash\)
                      timstr[3],timstr[4],                  \(\backslash\)
                      timstr[6],timstr[7]);                 \(\backslash\)
    \}
\end{DoxyCode}


\subsection{Function Documentation}
\index{apr\+\_\+date.\+c@{apr\+\_\+date.\+c}!A\+P\+U\+\_\+\+D\+E\+C\+L\+A\+RE@{A\+P\+U\+\_\+\+D\+E\+C\+L\+A\+RE}}
\index{A\+P\+U\+\_\+\+D\+E\+C\+L\+A\+RE@{A\+P\+U\+\_\+\+D\+E\+C\+L\+A\+RE}!apr\+\_\+date.\+c@{apr\+\_\+date.\+c}}
\subsubsection[{\texorpdfstring{A\+P\+U\+\_\+\+D\+E\+C\+L\+A\+R\+E(apr\+\_\+time\+\_\+t)}{APU_DECLARE(apr_time_t)}}]{\setlength{\rightskip}{0pt plus 5cm}A\+P\+U\+\_\+\+D\+E\+C\+L\+A\+RE (
\begin{DoxyParamCaption}
\item[{{\bf apr\+\_\+time\+\_\+t}}]{}
\end{DoxyParamCaption}
)}\hypertarget{apr__date_8c_a005db26a62fad23b4c776026848505f4}{}\label{apr__date_8c_a005db26a62fad23b4c776026848505f4}

\begin{DoxyCode}
146 \{
147     \hyperlink{structapr__time__exp__t}{apr\_time\_exp\_t} ds;
148     \hyperlink{group__apr__time_gadb4bde16055748190eae190c55aa02bb}{apr\_time\_t} \hyperlink{group__APACHE__CORE__MPM_ga9f5959dd76d5c83e775dcf44de684686}{result};
149     \textcolor{keywordtype}{int} mint, mon;
150     \textcolor{keyword}{const} \textcolor{keywordtype}{char} *monstr, *timstr;
151     \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{int} months[12] =
152     \{
153     (\textcolor{charliteral}{'J'} << 16) | (\textcolor{charliteral}{'a'} << 8) | \textcolor{charliteral}{'n'}, (\textcolor{charliteral}{'F'} << 16) | (\textcolor{charliteral}{'e'} << 8) | \textcolor{charliteral}{'b'},
154     (\textcolor{charliteral}{'M'} << 16) | (\textcolor{charliteral}{'a'} << 8) | \textcolor{charliteral}{'r'}, (\textcolor{charliteral}{'A'} << 16) | (\textcolor{charliteral}{'p'} << 8) | \textcolor{charliteral}{'r'},
155     (\textcolor{charliteral}{'M'} << 16) | (\textcolor{charliteral}{'a'} << 8) | \textcolor{charliteral}{'y'}, (\textcolor{charliteral}{'J'} << 16) | (\textcolor{charliteral}{'u'} << 8) | \textcolor{charliteral}{'n'},
156     (\textcolor{charliteral}{'J'} << 16) | (\textcolor{charliteral}{'u'} << 8) | \textcolor{charliteral}{'l'}, (\textcolor{charliteral}{'A'} << 16) | (\textcolor{charliteral}{'u'} << 8) | \textcolor{charliteral}{'g'},
157     (\textcolor{charliteral}{'S'} << 16) | (\textcolor{charliteral}{'e'} << 8) | \textcolor{charliteral}{'p'}, (\textcolor{charliteral}{'O'} << 16) | (\textcolor{charliteral}{'c'} << 8) | \textcolor{charliteral}{'t'},
158     (\textcolor{charliteral}{'N'} << 16) | (\textcolor{charliteral}{'o'} << 8) | \textcolor{charliteral}{'v'}, (\textcolor{charliteral}{'D'} << 16) | (\textcolor{charliteral}{'e'} << 8) | \textcolor{charliteral}{'c'}\};
159 
160     \textcolor{keywordflow}{if} (!date)
161         \textcolor{keywordflow}{return} \hyperlink{group__APR__Util__Date_ga8be88b25f4b477ad13c4067c959411b0}{APR\_DATE\_BAD};
162 
163     \textcolor{keywordflow}{while} (*date && \hyperlink{group__apr__ctype_ga23f4c7721923a0f0f444fd7fb196047a}{apr\_isspace}(*date))    \textcolor{comment}{/* Find first non-whitespace char */}
164         ++date;
165 
166     \textcolor{keywordflow}{if} (*date == \textcolor{charliteral}{'\(\backslash\)0'}) 
167         \textcolor{keywordflow}{return} \hyperlink{group__APR__Util__Date_ga8be88b25f4b477ad13c4067c959411b0}{APR\_DATE\_BAD};
168 
169     \textcolor{keywordflow}{if} ((date = strchr(date, \textcolor{charliteral}{' '})) == \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL})       \textcolor{comment}{/* Find space after weekday */}
170         \textcolor{keywordflow}{return} \hyperlink{group__APR__Util__Date_ga8be88b25f4b477ad13c4067c959411b0}{APR\_DATE\_BAD};
171 
172     ++date;        \textcolor{comment}{/* Now pointing to first char after space, which should be */}
173 
174     \textcolor{comment}{/* start of the actual date information for all 4 formats. */}
175 
176     \textcolor{keywordflow}{if} (apr\_date\_checkmask(date, \textcolor{stringliteral}{"## @$$ #### ##:##:## *"})) \{
177         \textcolor{comment}{/* RFC 1123 format with two days */}
178         ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} = ((date[7] - \textcolor{charliteral}{'0'}) * 10 + (date[8] - \textcolor{charliteral}{'0'}) - 19) * 100;
179         \textcolor{keywordflow}{if} (ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} < 0)
180             \textcolor{keywordflow}{return} \hyperlink{group__APR__Util__Date_ga8be88b25f4b477ad13c4067c959411b0}{APR\_DATE\_BAD};
181 
182         ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} += ((date[9] - \textcolor{charliteral}{'0'}) * 10) + (date[10] - \textcolor{charliteral}{'0'});
183 
184         ds.\hyperlink{structapr__time__exp__t_a6c09a274f011841e9e988c3c9504848a}{tm\_mday} = ((date[0] - \textcolor{charliteral}{'0'}) * 10) + (date[1] - \textcolor{charliteral}{'0'});
185 
186         monstr = date + 3;
187         timstr = date + 12;
188     \}
189     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (apr\_date\_checkmask(date, \textcolor{stringliteral}{"##-@$$-## ##:##:## *"})) \{ 
190         \textcolor{comment}{/* RFC 850 format */}
191         ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} = ((date[7] - \textcolor{charliteral}{'0'}) * 10) + (date[8] - \textcolor{charliteral}{'0'});
192         \textcolor{keywordflow}{if} (ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} < 70)
193             ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} += 100;
194 
195         ds.\hyperlink{structapr__time__exp__t_a6c09a274f011841e9e988c3c9504848a}{tm\_mday} = ((date[0] - \textcolor{charliteral}{'0'}) * 10) + (date[1] - \textcolor{charliteral}{'0'});
196 
197         monstr = date + 3;
198         timstr = date + 10;
199     \}
200     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (apr\_date\_checkmask(date, \textcolor{stringliteral}{"@$$ ~# ##:##:## ####*"})) \{
201         \textcolor{comment}{/* asctime format */}
202         ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} = ((date[16] - \textcolor{charliteral}{'0'}) * 10 + (date[17] - \textcolor{charliteral}{'0'}) - 19) * 100;
203         \textcolor{keywordflow}{if} (ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} < 0) 
204             \textcolor{keywordflow}{return} \hyperlink{group__APR__Util__Date_ga8be88b25f4b477ad13c4067c959411b0}{APR\_DATE\_BAD};
205 
206         ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} += ((date[18] - \textcolor{charliteral}{'0'}) * 10) + (date[19] - \textcolor{charliteral}{'0'});
207 
208         \textcolor{keywordflow}{if} (date[4] == \textcolor{charliteral}{' '})
209             ds.\hyperlink{structapr__time__exp__t_a6c09a274f011841e9e988c3c9504848a}{tm\_mday} = 0;
210         \textcolor{keywordflow}{else}
211             ds.\hyperlink{structapr__time__exp__t_a6c09a274f011841e9e988c3c9504848a}{tm\_mday} = (date[4] - \textcolor{charliteral}{'0'}) * 10;
212 
213         ds.\hyperlink{structapr__time__exp__t_a6c09a274f011841e9e988c3c9504848a}{tm\_mday} += (date[5] - \textcolor{charliteral}{'0'});
214 
215         monstr = date;
216         timstr = date + 7;
217     \}
218     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (apr\_date\_checkmask(date, \textcolor{stringliteral}{"# @$$ #### ##:##:## *"})) \{
219         \textcolor{comment}{/* RFC 1123 format with one day */}
220         ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} = ((date[6] - \textcolor{charliteral}{'0'}) * 10 + (date[7] - \textcolor{charliteral}{'0'}) - 19) * 100;
221         \textcolor{keywordflow}{if} (ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} < 0)
222             \textcolor{keywordflow}{return} \hyperlink{group__APR__Util__Date_ga8be88b25f4b477ad13c4067c959411b0}{APR\_DATE\_BAD};
223 
224         ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} += ((date[8] - \textcolor{charliteral}{'0'}) * 10) + (date[9] - \textcolor{charliteral}{'0'});
225 
226         ds.\hyperlink{structapr__time__exp__t_a6c09a274f011841e9e988c3c9504848a}{tm\_mday} = (date[0] - \textcolor{charliteral}{'0'});
227 
228         monstr = date + 2;
229         timstr = date + 11;
230     \}
231     \textcolor{keywordflow}{else}
232         \textcolor{keywordflow}{return} \hyperlink{group__APR__Util__Date_ga8be88b25f4b477ad13c4067c959411b0}{APR\_DATE\_BAD};
233 
234     \textcolor{keywordflow}{if} (ds.\hyperlink{structapr__time__exp__t_a6c09a274f011841e9e988c3c9504848a}{tm\_mday} <= 0 || ds.\hyperlink{structapr__time__exp__t_a6c09a274f011841e9e988c3c9504848a}{tm\_mday} > 31)
235         \textcolor{keywordflow}{return} \hyperlink{group__APR__Util__Date_ga8be88b25f4b477ad13c4067c959411b0}{APR\_DATE\_BAD};
236 
237     ds.\hyperlink{structapr__time__exp__t_a2dbab1d10ed6234c8e9e714e13b7911c}{tm\_hour} = ((timstr[0] - \textcolor{charliteral}{'0'}) * 10) + (timstr[1] - \textcolor{charliteral}{'0'});
238     ds.\hyperlink{structapr__time__exp__t_a56a380db482ba5b2bef43351faad27fb}{tm\_min} = ((timstr[3] - \textcolor{charliteral}{'0'}) * 10) + (timstr[4] - \textcolor{charliteral}{'0'});
239     ds.\hyperlink{structapr__time__exp__t_a2c29c99a75b55237917cb05ebae6706c}{tm\_sec} = ((timstr[6] - \textcolor{charliteral}{'0'}) * 10) + (timstr[7] - \textcolor{charliteral}{'0'});
240 
241     \textcolor{keywordflow}{if} ((ds.\hyperlink{structapr__time__exp__t_a2dbab1d10ed6234c8e9e714e13b7911c}{tm\_hour} > 23) || (ds.\hyperlink{structapr__time__exp__t_a56a380db482ba5b2bef43351faad27fb}{tm\_min} > 59) || (ds.\hyperlink{structapr__time__exp__t_a2c29c99a75b55237917cb05ebae6706c}{tm\_sec} > 61)) 
242         \textcolor{keywordflow}{return} \hyperlink{group__APR__Util__Date_ga8be88b25f4b477ad13c4067c959411b0}{APR\_DATE\_BAD};
243 
244     mint = (monstr[0] << 16) | (monstr[1] << 8) | monstr[2];
245     \textcolor{keywordflow}{for} (mon = 0; mon < 12; mon++)
246         \textcolor{keywordflow}{if} (mint == months[mon])
247             \textcolor{keywordflow}{break};
248 
249     \textcolor{keywordflow}{if} (mon == 12)
250         \textcolor{keywordflow}{return} \hyperlink{group__APR__Util__Date_ga8be88b25f4b477ad13c4067c959411b0}{APR\_DATE\_BAD};
251 
252     \textcolor{keywordflow}{if} ((ds.\hyperlink{structapr__time__exp__t_a6c09a274f011841e9e988c3c9504848a}{tm\_mday} == 31) && (mon == 3 || mon == 5 || mon == 8 || mon == 10))
253         \textcolor{keywordflow}{return} \hyperlink{group__APR__Util__Date_ga8be88b25f4b477ad13c4067c959411b0}{APR\_DATE\_BAD};
254 
255     \textcolor{comment}{/* February gets special check for leapyear */}
256     \textcolor{keywordflow}{if} ((mon == 1) &&
257         ((ds.\hyperlink{structapr__time__exp__t_a6c09a274f011841e9e988c3c9504848a}{tm\_mday} > 29) || 
258         ((ds.\hyperlink{structapr__time__exp__t_a6c09a274f011841e9e988c3c9504848a}{tm\_mday} == 29)
259         && ((ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} & 3)
260         || (((ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} % 100) == 0)
261         && (((ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} % 400) != 100)))))))
262         \textcolor{keywordflow}{return} \hyperlink{group__APR__Util__Date_ga8be88b25f4b477ad13c4067c959411b0}{APR\_DATE\_BAD};
263 
264     ds.\hyperlink{structapr__time__exp__t_a746f38956dfeb6be3bd17282791e3577}{tm\_mon} = mon;
265 
266     \textcolor{comment}{/* ap\_mplode\_time uses tm\_usec and tm\_gmtoff fields, but they haven't }
267 \textcolor{comment}{     * been set yet. }
268 \textcolor{comment}{     * It should be safe to just zero out these values.}
269 \textcolor{comment}{     * tm\_usec is the number of microseconds into the second.  HTTP only}
270 \textcolor{comment}{     * cares about second granularity.}
271 \textcolor{comment}{     * tm\_gmtoff is the number of seconds off of GMT the time is.  By}
272 \textcolor{comment}{     * definition all times going through this function are in GMT, so this}
273 \textcolor{comment}{     * is zero. }
274 \textcolor{comment}{     */}
275     ds.\hyperlink{structapr__time__exp__t_ac5f11e3c1f5a30d357df2108296a8d30}{tm\_usec} = 0;
276     ds.\hyperlink{structapr__time__exp__t_a1102ca16ed70b1c707473431eed58d7b}{tm\_gmtoff} = 0;
277     \textcolor{keywordflow}{if} (apr\_time\_exp\_get(&result, &ds) != \hyperlink{group__apr__errno_ga9ee311b7bf1c691dc521d721339ee2a6}{APR\_SUCCESS}) 
278         \textcolor{keywordflow}{return} \hyperlink{group__APR__Util__Date_ga8be88b25f4b477ad13c4067c959411b0}{APR\_DATE\_BAD};
279     
280     \textcolor{keywordflow}{return} \hyperlink{group__APACHE__CORE__MPM_ga9f5959dd76d5c83e775dcf44de684686}{result};
281 \}
\end{DoxyCode}
