\hypertarget{group__APR__Util__Date}{}\section{Date routines}
\label{group__APR__Util__Date}\index{Date routines@{Date routines}}
Collaboration diagram for Date routines\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=303pt]{group__APR__Util__Date}
\end{center}
\end{figure}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{group__APR__Util__Date_ga8be88b25f4b477ad13c4067c959411b0}{A\+P\+R\+\_\+\+D\+A\+T\+E\+\_\+\+B\+AD}~((\hyperlink{group__apr__time_gadb4bde16055748190eae190c55aa02bb}{apr\+\_\+time\+\_\+t})0)
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{group__APR__Util__Date_ga4a4f99fb264d6c243cbbcb106c8e08c7}{A\+P\+U\+\_\+\+D\+E\+C\+L\+A\+RE} (\hyperlink{pcre_8txt_a42dfa4ff673c82d8efe7144098fbc198}{int}) apr\+\_\+date\+\_\+checkmask(const char $\ast$\hyperlink{structdata}{data}
\item 
\hyperlink{group__APR__Util__Date_ga9e15cdbb028ab9a85bfcc48eb7e842e9}{A\+P\+U\+\_\+\+D\+E\+C\+L\+A\+RE} (\hyperlink{group__apr__time_gadb4bde16055748190eae190c55aa02bb}{apr\+\_\+time\+\_\+t}) apr\+\_\+date\+\_\+parse\+\_\+http(const char $\ast$date)
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
const char $\ast$ \hyperlink{group__APR__Util__Date_ga6bd7250007a3cfeadacf370fbf68cf5a}{mask}
\end{DoxyCompactItemize}


\subsection{Detailed Description}


\subsection{Macro Definition Documentation}
\index{Date routines@{Date routines}!A\+P\+R\+\_\+\+D\+A\+T\+E\+\_\+\+B\+AD@{A\+P\+R\+\_\+\+D\+A\+T\+E\+\_\+\+B\+AD}}
\index{A\+P\+R\+\_\+\+D\+A\+T\+E\+\_\+\+B\+AD@{A\+P\+R\+\_\+\+D\+A\+T\+E\+\_\+\+B\+AD}!Date routines@{Date routines}}
\subsubsection[{\texorpdfstring{A\+P\+R\+\_\+\+D\+A\+T\+E\+\_\+\+B\+AD}{APR_DATE_BAD}}]{\setlength{\rightskip}{0pt plus 5cm}\#define A\+P\+R\+\_\+\+D\+A\+T\+E\+\_\+\+B\+AD~(({\bf apr\+\_\+time\+\_\+t})0)}\hypertarget{group__APR__Util__Date_ga8be88b25f4b477ad13c4067c959411b0}{}\label{group__APR__Util__Date_ga8be88b25f4b477ad13c4067c959411b0}
A bad date. 

\subsection{Function Documentation}
\index{Date routines@{Date routines}!A\+P\+U\+\_\+\+D\+E\+C\+L\+A\+RE@{A\+P\+U\+\_\+\+D\+E\+C\+L\+A\+RE}}
\index{A\+P\+U\+\_\+\+D\+E\+C\+L\+A\+RE@{A\+P\+U\+\_\+\+D\+E\+C\+L\+A\+RE}!Date routines@{Date routines}}
\subsubsection[{\texorpdfstring{A\+P\+U\+\_\+\+D\+E\+C\+L\+A\+R\+E(int) apr\+\_\+date\+\_\+checkmask(const char $\ast$data}{APU_DECLARE(int) apr_date_checkmask(const char *data}}]{\setlength{\rightskip}{0pt plus 5cm}A\+P\+U\+\_\+\+D\+E\+C\+L\+A\+RE (
\begin{DoxyParamCaption}
\item[{{\bf int}}]{}
\end{DoxyParamCaption}
) const}\hypertarget{group__APR__Util__Date_ga4a4f99fb264d6c243cbbcb106c8e08c7}{}\label{group__APR__Util__Date_ga4a4f99fb264d6c243cbbcb106c8e08c7}
Compare a string to a mask 
\begin{DoxyParams}{Parameters}
{\em data} & The string to compare \\
\hline
{\em mask} & Mask characters (arbitrary maximum is 256 characters)\+: 
\begin{DoxyPre}
  '@' - uppercase letter
  '\$' - lowercase letter
  '\&' - hex digit
  '\#' - digit
  '~' - digit or space
  '*' - swallow remaining characters
\end{DoxyPre}
 \\
\hline
\end{DoxyParams}
\begin{DoxyRemark}{Remarks}
The mask tests for an exact match for any other character 
\end{DoxyRemark}
\begin{DoxyReturn}{Returns}
1 if the string matches, 0 otherwise 
\end{DoxyReturn}
\index{Date routines@{Date routines}!A\+P\+U\+\_\+\+D\+E\+C\+L\+A\+RE@{A\+P\+U\+\_\+\+D\+E\+C\+L\+A\+RE}}
\index{A\+P\+U\+\_\+\+D\+E\+C\+L\+A\+RE@{A\+P\+U\+\_\+\+D\+E\+C\+L\+A\+RE}!Date routines@{Date routines}}
\subsubsection[{\texorpdfstring{A\+P\+U\+\_\+\+D\+E\+C\+L\+A\+R\+E(apr\+\_\+time\+\_\+t) apr\+\_\+date\+\_\+parse\+\_\+http(const char $\ast$date)}{APU_DECLARE(apr_time_t) apr_date_parse_http(const char *date)}}]{\setlength{\rightskip}{0pt plus 5cm}A\+P\+U\+\_\+\+D\+E\+C\+L\+A\+RE (
\begin{DoxyParamCaption}
\item[{{\bf apr\+\_\+time\+\_\+t}}]{}
\end{DoxyParamCaption}
) const}\hypertarget{group__APR__Util__Date_ga9e15cdbb028ab9a85bfcc48eb7e842e9}{}\label{group__APR__Util__Date_ga9e15cdbb028ab9a85bfcc48eb7e842e9}
Parses an H\+T\+TP date in one of three standard forms\+: 
\begin{DoxyPre}
    Sun, 06 Nov 1994 08:49:37 GMT  ; RFC 822, updated by RFC 1123
    Sunday, 06-Nov-94 08:49:37 GMT ; RFC 850, obsoleted by RFC 1036
    Sun Nov  6 08:49:37 1994       ; ANSI C's asctime() format
\end{DoxyPre}
 
\begin{DoxyParams}{Parameters}
{\em date} & The date in one of the three formats above \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the apr\+\_\+time\+\_\+t number of microseconds since 1 Jan 1970 G\+MT, or 0 if this would be out of range or if the date is invalid.
\end{DoxyReturn}
Parses a string resembling an R\+FC 822 date. This is meant to be leinent in its parsing of dates. Hence, this will parse a wider range of dates than apr\+\_\+date\+\_\+parse\+\_\+http.

The prominent mailer (or poster, if mailer is unknown) that has been seen in the wild is included for the unknown formats. 
\begin{DoxyPre}
    Sun, 06 Nov 1994 08:49:37 GMT  ; RFC 822, updated by RFC 1123
    Sunday, 06-Nov-94 08:49:37 GMT ; RFC 850, obsoleted by RFC 1036
    Sun Nov  6 08:49:37 1994       ; ANSI C's asctime() format
    Sun, 6 Nov 1994 08:49:37 GMT   ; RFC 822, updated by RFC 1123
    Sun, 06 Nov 94 08:49:37 GMT    ; RFC 822
    Sun, 6 Nov 94 08:49:37 GMT     ; RFC 822
    Sun, 06 Nov 94 08:49 GMT       ; Unknown [drtr@ast.cam.ac.uk] 
    Sun, 6 Nov 94 08:49 GMT        ; Unknown [drtr@ast.cam.ac.uk]
    Sun, 06 Nov 94 8:49:37 GMT     ; Unknown [Elm 70.85]
    Sun, 6 Nov 94 8:49:37 GMT      ; Unknown [Elm 70.85] 
\end{DoxyPre}



\begin{DoxyParams}{Parameters}
{\em date} & The date in one of the formats above \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the apr\+\_\+time\+\_\+t number of microseconds since 1 Jan 1970 G\+MT, or 0 if this would be out of range or if the date is invalid. 
\end{DoxyReturn}

\begin{DoxyCode}
320 \{
321     \hyperlink{structapr__time__exp__t}{apr\_time\_exp\_t} ds;
322     \hyperlink{group__apr__time_gadb4bde16055748190eae190c55aa02bb}{apr\_time\_t} \hyperlink{group__APACHE__CORE__MPM_ga9f5959dd76d5c83e775dcf44de684686}{result};
323     \textcolor{keywordtype}{int} mint, mon;
324     \textcolor{keyword}{const} \textcolor{keywordtype}{char} *monstr, *timstr, *gmtstr;
325     \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{int} months[12] =
326     \{
327     (\textcolor{charliteral}{'J'} << 16) | (\textcolor{charliteral}{'a'} << 8) | \textcolor{charliteral}{'n'}, (\textcolor{charliteral}{'F'} << 16) | (\textcolor{charliteral}{'e'} << 8) | \textcolor{charliteral}{'b'},
328     (\textcolor{charliteral}{'M'} << 16) | (\textcolor{charliteral}{'a'} << 8) | \textcolor{charliteral}{'r'}, (\textcolor{charliteral}{'A'} << 16) | (\textcolor{charliteral}{'p'} << 8) | \textcolor{charliteral}{'r'},
329     (\textcolor{charliteral}{'M'} << 16) | (\textcolor{charliteral}{'a'} << 8) | \textcolor{charliteral}{'y'}, (\textcolor{charliteral}{'J'} << 16) | (\textcolor{charliteral}{'u'} << 8) | \textcolor{charliteral}{'n'},
330     (\textcolor{charliteral}{'J'} << 16) | (\textcolor{charliteral}{'u'} << 8) | \textcolor{charliteral}{'l'}, (\textcolor{charliteral}{'A'} << 16) | (\textcolor{charliteral}{'u'} << 8) | \textcolor{charliteral}{'g'},
331     (\textcolor{charliteral}{'S'} << 16) | (\textcolor{charliteral}{'e'} << 8) | \textcolor{charliteral}{'p'}, (\textcolor{charliteral}{'O'} << 16) | (\textcolor{charliteral}{'c'} << 8) | \textcolor{charliteral}{'t'},
332     (\textcolor{charliteral}{'N'} << 16) | (\textcolor{charliteral}{'o'} << 8) | \textcolor{charliteral}{'v'}, (\textcolor{charliteral}{'D'} << 16) | (\textcolor{charliteral}{'e'} << 8) | \textcolor{charliteral}{'c'} \};
333 
334     \textcolor{keywordflow}{if} (!date)
335         \textcolor{keywordflow}{return} \hyperlink{group__APR__Util__Date_ga8be88b25f4b477ad13c4067c959411b0}{APR\_DATE\_BAD};
336 
337     \textcolor{comment}{/* Not all dates have text days at the beginning. */}
338     \textcolor{keywordflow}{if} (!\hyperlink{group__apr__ctype_ga8c453b1d66015b357c3d3a3ddb7d97d7}{apr\_isdigit}(date[0]))
339     \{
340         \textcolor{keywordflow}{while} (*date && \hyperlink{group__apr__ctype_ga23f4c7721923a0f0f444fd7fb196047a}{apr\_isspace}(*date)) \textcolor{comment}{/* Find first non-whitespace char */}
341             ++date;
342 
343         \textcolor{keywordflow}{if} (*date == \textcolor{charliteral}{'\(\backslash\)0'}) 
344             \textcolor{keywordflow}{return} \hyperlink{group__APR__Util__Date_ga8be88b25f4b477ad13c4067c959411b0}{APR\_DATE\_BAD};
345 
346         \textcolor{keywordflow}{if} ((date = strchr(date, \textcolor{charliteral}{' '})) == \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL})   \textcolor{comment}{/* Find space after weekday */}
347             \textcolor{keywordflow}{return} \hyperlink{group__APR__Util__Date_ga8be88b25f4b477ad13c4067c959411b0}{APR\_DATE\_BAD};
348 
349         ++date;    \textcolor{comment}{/* Now pointing to first char after space, which should be */}    \}
350 
351     \textcolor{comment}{/* start of the actual date information for all 11 formats. */}
352     \textcolor{keywordflow}{if} (apr\_date\_checkmask(date, \textcolor{stringliteral}{"## @$$ #### ##:##:## *"})) \{   \textcolor{comment}{/* RFC 1123 format */}
353         ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} = ((date[7] - \textcolor{charliteral}{'0'}) * 10 + (date[8] - \textcolor{charliteral}{'0'}) - 19) * 100;
354 
355         \textcolor{keywordflow}{if} (ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} < 0)
356             \textcolor{keywordflow}{return} \hyperlink{group__APR__Util__Date_ga8be88b25f4b477ad13c4067c959411b0}{APR\_DATE\_BAD};
357 
358         ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} += ((date[9] - \textcolor{charliteral}{'0'}) * 10) + (date[10] - \textcolor{charliteral}{'0'});
359 
360         ds.\hyperlink{structapr__time__exp__t_a6c09a274f011841e9e988c3c9504848a}{tm\_mday} = ((date[0] - \textcolor{charliteral}{'0'}) * 10) + (date[1] - \textcolor{charliteral}{'0'});
361 
362         monstr = date + 3;
363         timstr = date + 12;
364         gmtstr = date + 21;
365 
366         \hyperlink{apr__date_8c_a574f7cc7ba24c017bff5d6c41cf5903d}{TIMEPARSE\_STD}(ds, timstr);
367     \}
368     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (apr\_date\_checkmask(date, \textcolor{stringliteral}{"##-@$$-## ##:##:## *"})) \{\textcolor{comment}{/* RFC 850 format  */}
369         ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} = ((date[7] - \textcolor{charliteral}{'0'}) * 10) + (date[8] - \textcolor{charliteral}{'0'});
370 
371         \textcolor{keywordflow}{if} (ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} < 70)
372             ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} += 100;
373 
374         ds.\hyperlink{structapr__time__exp__t_a6c09a274f011841e9e988c3c9504848a}{tm\_mday} = ((date[0] - \textcolor{charliteral}{'0'}) * 10) + (date[1] - \textcolor{charliteral}{'0'});
375 
376         monstr = date + 3;
377         timstr = date + 10;
378         gmtstr = date + 19;
379 
380         \hyperlink{apr__date_8c_a574f7cc7ba24c017bff5d6c41cf5903d}{TIMEPARSE\_STD}(ds, timstr);
381     \}
382     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (apr\_date\_checkmask(date, \textcolor{stringliteral}{"@$$ ~# ##:##:## ####*"})) \{
383         \textcolor{comment}{/* asctime format */}
384         ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} = ((date[16] - \textcolor{charliteral}{'0'}) * 10 + (date[17] - \textcolor{charliteral}{'0'}) - 19) * 100;
385         \textcolor{keywordflow}{if} (ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} < 0) 
386             \textcolor{keywordflow}{return} \hyperlink{group__APR__Util__Date_ga8be88b25f4b477ad13c4067c959411b0}{APR\_DATE\_BAD};
387 
388         ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} += ((date[18] - \textcolor{charliteral}{'0'}) * 10) + (date[19] - \textcolor{charliteral}{'0'});
389 
390         \textcolor{keywordflow}{if} (date[4] == \textcolor{charliteral}{' '})
391             ds.\hyperlink{structapr__time__exp__t_a6c09a274f011841e9e988c3c9504848a}{tm\_mday} = 0;
392         \textcolor{keywordflow}{else}
393             ds.\hyperlink{structapr__time__exp__t_a6c09a274f011841e9e988c3c9504848a}{tm\_mday} = (date[4] - \textcolor{charliteral}{'0'}) * 10;
394 
395         ds.\hyperlink{structapr__time__exp__t_a6c09a274f011841e9e988c3c9504848a}{tm\_mday} += (date[5] - \textcolor{charliteral}{'0'});
396 
397         monstr = date;
398         timstr = date + 7;
399         gmtstr = \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL};
400 
401         \hyperlink{apr__date_8c_a574f7cc7ba24c017bff5d6c41cf5903d}{TIMEPARSE\_STD}(ds, timstr);
402     \}
403     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (apr\_date\_checkmask(date, \textcolor{stringliteral}{"# @$$ #### ##:##:## *"})) \{
404         \textcolor{comment}{/* RFC 1123 format*/}
405         ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} = ((date[6] - \textcolor{charliteral}{'0'}) * 10 + (date[7] - \textcolor{charliteral}{'0'}) - 19) * 100;
406 
407         \textcolor{keywordflow}{if} (ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} < 0)
408             \textcolor{keywordflow}{return} \hyperlink{group__APR__Util__Date_ga8be88b25f4b477ad13c4067c959411b0}{APR\_DATE\_BAD};
409 
410         ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} += ((date[8] - \textcolor{charliteral}{'0'}) * 10) + (date[9] - \textcolor{charliteral}{'0'});
411         ds.\hyperlink{structapr__time__exp__t_a6c09a274f011841e9e988c3c9504848a}{tm\_mday} = (date[0] - \textcolor{charliteral}{'0'});
412 
413         monstr = date + 2;
414         timstr = date + 11;
415         gmtstr = date + 20;
416 
417         \hyperlink{apr__date_8c_a574f7cc7ba24c017bff5d6c41cf5903d}{TIMEPARSE\_STD}(ds, timstr);
418     \}
419     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (apr\_date\_checkmask(date, \textcolor{stringliteral}{"## @$$ ## ##:##:## *"})) \{
420         \textcolor{comment}{/* This is the old RFC 1123 date format - many many years ago, people}
421 \textcolor{comment}{         * used two-digit years.  Oh, how foolish.}
422 \textcolor{comment}{         *}
423 \textcolor{comment}{         * Two-digit day, two-digit year version. */}
424         ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} = ((date[7] - \textcolor{charliteral}{'0'}) * 10) + (date[8] - \textcolor{charliteral}{'0'});
425 
426         \textcolor{keywordflow}{if} (ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} < 70)
427             ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} += 100;
428 
429         ds.\hyperlink{structapr__time__exp__t_a6c09a274f011841e9e988c3c9504848a}{tm\_mday} = ((date[0] - \textcolor{charliteral}{'0'}) * 10) + (date[1] - \textcolor{charliteral}{'0'});
430 
431         monstr = date + 3;
432         timstr = date + 10;
433         gmtstr = date + 19;
434 
435         \hyperlink{apr__date_8c_a574f7cc7ba24c017bff5d6c41cf5903d}{TIMEPARSE\_STD}(ds, timstr);
436     \} 
437     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (apr\_date\_checkmask(date, \textcolor{stringliteral}{" # @$$ ## ##:##:## *"})) \{
438         \textcolor{comment}{/* This is the old RFC 1123 date format - many many years ago, people}
439 \textcolor{comment}{         * used two-digit years.  Oh, how foolish.}
440 \textcolor{comment}{         *}
441 \textcolor{comment}{         * Space + one-digit day, two-digit year version.*/}
442         ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} = ((date[7] - \textcolor{charliteral}{'0'}) * 10) + (date[8] - \textcolor{charliteral}{'0'});
443 
444         \textcolor{keywordflow}{if} (ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} < 70)
445             ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} += 100;
446 
447         ds.\hyperlink{structapr__time__exp__t_a6c09a274f011841e9e988c3c9504848a}{tm\_mday} = (date[1] - \textcolor{charliteral}{'0'});
448 
449         monstr = date + 3;
450         timstr = date + 10;
451         gmtstr = date + 19;
452 
453         \hyperlink{apr__date_8c_a574f7cc7ba24c017bff5d6c41cf5903d}{TIMEPARSE\_STD}(ds, timstr);
454     \} 
455     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (apr\_date\_checkmask(date, \textcolor{stringliteral}{"# @$$ ## ##:##:## *"})) \{
456         \textcolor{comment}{/* This is the old RFC 1123 date format - many many years ago, people}
457 \textcolor{comment}{         * used two-digit years.  Oh, how foolish.}
458 \textcolor{comment}{         *}
459 \textcolor{comment}{         * One-digit day, two-digit year version. */}
460         ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} = ((date[6] - \textcolor{charliteral}{'0'}) * 10) + (date[7] - \textcolor{charliteral}{'0'});
461 
462         \textcolor{keywordflow}{if} (ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} < 70)
463             ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} += 100;
464 
465         ds.\hyperlink{structapr__time__exp__t_a6c09a274f011841e9e988c3c9504848a}{tm\_mday} = (date[0] - \textcolor{charliteral}{'0'});
466 
467         monstr = date + 2;
468         timstr = date + 9;
469         gmtstr = date + 18;
470 
471         \hyperlink{apr__date_8c_a574f7cc7ba24c017bff5d6c41cf5903d}{TIMEPARSE\_STD}(ds, timstr);
472     \} 
473     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (apr\_date\_checkmask(date, \textcolor{stringliteral}{"## @$$ ## ##:## *"})) \{
474         \textcolor{comment}{/* Loser format.  This is quite bogus.  */}
475         ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} = ((date[7] - \textcolor{charliteral}{'0'}) * 10) + (date[8] - \textcolor{charliteral}{'0'});
476 
477         \textcolor{keywordflow}{if} (ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} < 70)
478             ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} += 100;
479 
480         ds.\hyperlink{structapr__time__exp__t_a6c09a274f011841e9e988c3c9504848a}{tm\_mday} = ((date[0] - \textcolor{charliteral}{'0'}) * 10) + (date[1] - \textcolor{charliteral}{'0'});
481 
482         monstr = date + 3;
483         timstr = date + 10;
484         gmtstr = \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL};
485 
486         \hyperlink{apr__date_8c_aa1f7825c136058e465186eb635d12f11}{TIMEPARSE}(ds, timstr[0],timstr[1], timstr[3],timstr[4], \textcolor{charliteral}{'0'},\textcolor{charliteral}{'0'});
487     \} 
488     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (apr\_date\_checkmask(date, \textcolor{stringliteral}{"# @$$ ## ##:## *"})) \{
489         \textcolor{comment}{/* Loser format.  This is quite bogus.  */}
490         ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} = ((date[6] - \textcolor{charliteral}{'0'}) * 10) + (date[7] - \textcolor{charliteral}{'0'});
491 
492         \textcolor{keywordflow}{if} (ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} < 70)
493             ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} += 100;
494 
495         ds.\hyperlink{structapr__time__exp__t_a6c09a274f011841e9e988c3c9504848a}{tm\_mday} = (date[0] - \textcolor{charliteral}{'0'});
496 
497         monstr = date + 2;
498         timstr = date + 9;
499         gmtstr = \hyperlink{pcre_8txt_ad7f989d16aa8ca809a36bc392c07fba1}{NULL};
500 
501         \hyperlink{apr__date_8c_aa1f7825c136058e465186eb635d12f11}{TIMEPARSE}(ds, timstr[0],timstr[1], timstr[3],timstr[4], \textcolor{charliteral}{'0'},\textcolor{charliteral}{'0'});
502     \}
503     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (apr\_date\_checkmask(date, \textcolor{stringliteral}{"## @$$ ## #:##:## *"})) \{
504         \textcolor{comment}{/* Loser format.  This is quite bogus.  */}
505         ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} = ((date[7] - \textcolor{charliteral}{'0'}) * 10) + (date[8] - \textcolor{charliteral}{'0'});
506 
507         \textcolor{keywordflow}{if} (ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} < 70)
508             ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} += 100;
509 
510         ds.\hyperlink{structapr__time__exp__t_a6c09a274f011841e9e988c3c9504848a}{tm\_mday} = ((date[0] - \textcolor{charliteral}{'0'}) * 10) + (date[1] - \textcolor{charliteral}{'0'});
511 
512         monstr = date + 3;
513         timstr = date + 9;
514         gmtstr = date + 18;
515 
516         \hyperlink{apr__date_8c_aa1f7825c136058e465186eb635d12f11}{TIMEPARSE}(ds, \textcolor{charliteral}{'0'},timstr[1], timstr[3],timstr[4], timstr[6],timstr[7]);
517     \}
518     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (apr\_date\_checkmask(date, \textcolor{stringliteral}{"# @$$ ## #:##:## *"})) \{
519          \textcolor{comment}{/* Loser format.  This is quite bogus.  */}
520         ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} = ((date[6] - \textcolor{charliteral}{'0'}) * 10) + (date[7] - \textcolor{charliteral}{'0'});
521 
522         \textcolor{keywordflow}{if} (ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} < 70)
523             ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} += 100;
524 
525         ds.\hyperlink{structapr__time__exp__t_a6c09a274f011841e9e988c3c9504848a}{tm\_mday} = (date[0] - \textcolor{charliteral}{'0'});
526 
527         monstr = date + 2;
528         timstr = date + 8;
529         gmtstr = date + 17;
530 
531         \hyperlink{apr__date_8c_aa1f7825c136058e465186eb635d12f11}{TIMEPARSE}(ds, \textcolor{charliteral}{'0'},timstr[1], timstr[3],timstr[4], timstr[6],timstr[7]);
532     \}
533     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (apr\_date\_checkmask(date, \textcolor{stringliteral}{" # @$$ #### ##:##:## *"})) \{   
534         \textcolor{comment}{/* RFC 1123 format with a space instead of a leading zero. */}
535         ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} = ((date[7] - \textcolor{charliteral}{'0'}) * 10 + (date[8] - \textcolor{charliteral}{'0'}) - 19) * 100;
536 
537         \textcolor{keywordflow}{if} (ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} < 0)
538             \textcolor{keywordflow}{return} \hyperlink{group__APR__Util__Date_ga8be88b25f4b477ad13c4067c959411b0}{APR\_DATE\_BAD};
539 
540         ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} += ((date[9] - \textcolor{charliteral}{'0'}) * 10) + (date[10] - \textcolor{charliteral}{'0'});
541 
542         ds.\hyperlink{structapr__time__exp__t_a6c09a274f011841e9e988c3c9504848a}{tm\_mday} = (date[1] - \textcolor{charliteral}{'0'});
543 
544         monstr = date + 3;
545         timstr = date + 12;
546         gmtstr = date + 21;
547 
548         \hyperlink{apr__date_8c_a574f7cc7ba24c017bff5d6c41cf5903d}{TIMEPARSE\_STD}(ds, timstr);
549     \}
550     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (apr\_date\_checkmask(date, \textcolor{stringliteral}{"##-@$$-#### ##:##:## *"})) \{
551        \textcolor{comment}{/* RFC 1123 with dashes instead of spaces between date/month/year}
552 \textcolor{comment}{        * This also looks like RFC 850 with four digit years.}
553 \textcolor{comment}{        */}
554         ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} = ((date[7] - \textcolor{charliteral}{'0'}) * 10 + (date[8] - \textcolor{charliteral}{'0'}) - 19) * 100;
555         \textcolor{keywordflow}{if} (ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} < 0)
556             \textcolor{keywordflow}{return} \hyperlink{group__APR__Util__Date_ga8be88b25f4b477ad13c4067c959411b0}{APR\_DATE\_BAD};
557 
558         ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} += ((date[9] - \textcolor{charliteral}{'0'}) * 10) + (date[10] - \textcolor{charliteral}{'0'});
559 
560         ds.\hyperlink{structapr__time__exp__t_a6c09a274f011841e9e988c3c9504848a}{tm\_mday} = ((date[0] - \textcolor{charliteral}{'0'}) * 10) + (date[1] - \textcolor{charliteral}{'0'});
561 
562         monstr = date + 3;
563         timstr = date + 12;
564         gmtstr = date + 21;
565 
566         \hyperlink{apr__date_8c_a574f7cc7ba24c017bff5d6c41cf5903d}{TIMEPARSE\_STD}(ds, timstr);
567     \}
568     \textcolor{keywordflow}{else}
569         \textcolor{keywordflow}{return} \hyperlink{group__APR__Util__Date_ga8be88b25f4b477ad13c4067c959411b0}{APR\_DATE\_BAD};
570 
571     \textcolor{keywordflow}{if} (ds.\hyperlink{structapr__time__exp__t_a6c09a274f011841e9e988c3c9504848a}{tm\_mday} <= 0 || ds.\hyperlink{structapr__time__exp__t_a6c09a274f011841e9e988c3c9504848a}{tm\_mday} > 31)
572         \textcolor{keywordflow}{return} \hyperlink{group__APR__Util__Date_ga8be88b25f4b477ad13c4067c959411b0}{APR\_DATE\_BAD};
573 
574     \textcolor{keywordflow}{if} ((ds.\hyperlink{structapr__time__exp__t_a2dbab1d10ed6234c8e9e714e13b7911c}{tm\_hour} > 23) || (ds.\hyperlink{structapr__time__exp__t_a56a380db482ba5b2bef43351faad27fb}{tm\_min} > 59) || (ds.\hyperlink{structapr__time__exp__t_a2c29c99a75b55237917cb05ebae6706c}{tm\_sec} > 61)) 
575         \textcolor{keywordflow}{return} \hyperlink{group__APR__Util__Date_ga8be88b25f4b477ad13c4067c959411b0}{APR\_DATE\_BAD};
576 
577     mint = (monstr[0] << 16) | (monstr[1] << 8) | monstr[2];
578     \textcolor{keywordflow}{for} (mon = 0; mon < 12; mon++)
579         \textcolor{keywordflow}{if} (mint == months[mon])
580             \textcolor{keywordflow}{break};
581 
582     \textcolor{keywordflow}{if} (mon == 12)
583         \textcolor{keywordflow}{return} \hyperlink{group__APR__Util__Date_ga8be88b25f4b477ad13c4067c959411b0}{APR\_DATE\_BAD};
584 
585     \textcolor{keywordflow}{if} ((ds.\hyperlink{structapr__time__exp__t_a6c09a274f011841e9e988c3c9504848a}{tm\_mday} == 31) && (mon == 3 || mon == 5 || mon == 8 || mon == 10))
586         \textcolor{keywordflow}{return} \hyperlink{group__APR__Util__Date_ga8be88b25f4b477ad13c4067c959411b0}{APR\_DATE\_BAD};
587 
588     \textcolor{comment}{/* February gets special check for leapyear */}
589 
590     \textcolor{keywordflow}{if} ((mon == 1) &&
591         ((ds.\hyperlink{structapr__time__exp__t_a6c09a274f011841e9e988c3c9504848a}{tm\_mday} > 29)
592         || ((ds.\hyperlink{structapr__time__exp__t_a6c09a274f011841e9e988c3c9504848a}{tm\_mday} == 29)
593         && ((ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} & 3)
594         || (((ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} % 100) == 0)
595         && (((ds.\hyperlink{structapr__time__exp__t_a35c32245be49279a6689e34bcd6e534a}{tm\_year} % 400) != 100)))))))
596         \textcolor{keywordflow}{return} \hyperlink{group__APR__Util__Date_ga8be88b25f4b477ad13c4067c959411b0}{APR\_DATE\_BAD};
597 
598     ds.\hyperlink{structapr__time__exp__t_a746f38956dfeb6be3bd17282791e3577}{tm\_mon} = mon;
599 
600     \textcolor{comment}{/* tm\_gmtoff is the number of seconds off of GMT the time is.}
601 \textcolor{comment}{     *}
602 \textcolor{comment}{     * We only currently support: [+-]ZZZZ where Z is the offset in}
603 \textcolor{comment}{     * hours from GMT.}
604 \textcolor{comment}{     *}
605 \textcolor{comment}{     * If there is any confusion, tm\_gmtoff will remain 0.}
606 \textcolor{comment}{     */}
607     ds.\hyperlink{structapr__time__exp__t_a1102ca16ed70b1c707473431eed58d7b}{tm\_gmtoff} = 0;
608 
609     \textcolor{comment}{/* Do we have a timezone ? */}
610     \textcolor{keywordflow}{if} (gmtstr) \{
611         \textcolor{keywordtype}{int} \hyperlink{group__APACHE__CORE__PROTO_ga0feae9f93d4bc5dca392194c513e0921}{offset};
612         \textcolor{keywordflow}{switch} (*gmtstr) \{
613         \textcolor{keywordflow}{case} \textcolor{charliteral}{'-'}:
614             offset = atoi(gmtstr+1);
615             ds.\hyperlink{structapr__time__exp__t_a1102ca16ed70b1c707473431eed58d7b}{tm\_gmtoff} -= (offset / 100) * 60 * 60;
616             ds.\hyperlink{structapr__time__exp__t_a1102ca16ed70b1c707473431eed58d7b}{tm\_gmtoff} -= (offset % 100) * 60;
617             \textcolor{keywordflow}{break};
618         \textcolor{keywordflow}{case} \textcolor{charliteral}{'+'}:
619             offset = atoi(gmtstr+1);
620             ds.\hyperlink{structapr__time__exp__t_a1102ca16ed70b1c707473431eed58d7b}{tm\_gmtoff} += (offset / 100) * 60 * 60;
621             ds.\hyperlink{structapr__time__exp__t_a1102ca16ed70b1c707473431eed58d7b}{tm\_gmtoff} += (offset % 100) * 60;
622             \textcolor{keywordflow}{break};
623         \}
624     \}
625 
626     \textcolor{comment}{/* apr\_time\_exp\_get uses tm\_usec field, but it hasn't been set yet. }
627 \textcolor{comment}{     * It should be safe to just zero out this value.}
628 \textcolor{comment}{     * tm\_usec is the number of microseconds into the second.  HTTP only}
629 \textcolor{comment}{     * cares about second granularity.}
630 \textcolor{comment}{     */}
631     ds.\hyperlink{structapr__time__exp__t_ac5f11e3c1f5a30d357df2108296a8d30}{tm\_usec} = 0;
632 
633     \textcolor{keywordflow}{if} (apr\_time\_exp\_gmt\_get(&result, &ds) != \hyperlink{group__apr__errno_ga9ee311b7bf1c691dc521d721339ee2a6}{APR\_SUCCESS}) 
634         \textcolor{keywordflow}{return} \hyperlink{group__APR__Util__Date_ga8be88b25f4b477ad13c4067c959411b0}{APR\_DATE\_BAD};
635     
636     \textcolor{keywordflow}{return} \hyperlink{group__APACHE__CORE__MPM_ga9f5959dd76d5c83e775dcf44de684686}{result};
637 \}
\end{DoxyCode}


\subsection{Variable Documentation}
\index{Date routines@{Date routines}!mask@{mask}}
\index{mask@{mask}!Date routines@{Date routines}}
\subsubsection[{\texorpdfstring{mask}{mask}}]{\setlength{\rightskip}{0pt plus 5cm}const char$\ast$ mask}\hypertarget{group__APR__Util__Date_ga6bd7250007a3cfeadacf370fbf68cf5a}{}\label{group__APR__Util__Date_ga6bd7250007a3cfeadacf370fbf68cf5a}
