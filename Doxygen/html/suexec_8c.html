<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>My Project: /usr/local/src/github/Codebase/httpd-2.4.29/support/suexec.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_b2379abaa7725ab34fabdf9daa508e09.html">Codebase</a></li><li class="navelem"><a class="el" href="dir_db9466b59d24a02e023577068efc5d5d.html">httpd-2.4.29</a></li><li class="navelem"><a class="el" href="dir_afddd6f21d6f6ba7fb4d5f76c3912baf.html">support</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">suexec.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="apr_8h_source.html">apr.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="ap__config_8h_source.html">ap_config.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="suexec_8h_source.html">suexec.h</a>&quot;</code><br />
<code>#include &lt;sys/param.h&gt;</code><br />
<code>#include &lt;sys/stat.h&gt;</code><br />
<code>#include &lt;sys/types.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;time.h&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdarg.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for suexec.c:</div>
<div class="dyncontent">
<div class="center"><img src="suexec_8c__incl.png" border="0" usemap="#_2usr_2local_2src_2github_2Codebase_2httpd-2_84_829_2support_2suexec_8c" alt=""/></div>
<map name="_2usr_2local_2src_2github_2Codebase_2httpd-2_84_829_2support_2suexec_8c" id="_2usr_2local_2src_2github_2Codebase_2httpd-2_84_829_2support_2suexec_8c">
<area shape="rect" id="node2" href="apr_8h.html" title="APR Platform Definitions. " alt="" coords="416,707,467,733"/>
<area shape="rect" id="node8" href="ap__config_8h.html" title="Symbol export macros and hook functions. " alt="" coords="579,109,669,136"/>
<area shape="rect" id="node28" href="suexec_8h.html" title="user&#45;definable variables for the suexec wrapper code. (See README.configure on how to customize these..." alt="" coords="757,109,832,136"/>
<area shape="rect" id="node9" href="ap__hooks_8h.html" title="ap hook functions and macros " alt="" coords="241,184,330,211"/>
<area shape="rect" id="node25" href="ap__config__auto_8h.html" title="ap_config_auto.h" alt="" coords="354,184,475,211"/>
<area shape="rect" id="node26" href="ap__config__layout_8h.html" title="Apache Config Layout. " alt="" coords="729,184,860,211"/>
<area shape="rect" id="node27" href="apache__noprobes_8h.html" title="apache_noprobes.h" alt="" coords="499,184,634,211"/>
<area shape="rect" id="node10" href="apr__hooks_8h.html" title="Apache hook functions. " alt="" coords="409,259,503,285"/>
<area shape="rect" id="node23" href="apr__optional__hooks_8h.html" title="Apache optional hook functions. " alt="" coords="239,259,385,285"/>
<area shape="rect" id="node11" href="apu_8h.html" title="apu.h" alt="" coords="429,333,483,360"/>
<area shape="rect" id="node12" href="apr__tables_8h.html" title="APR Table library. " alt="" coords="297,333,391,360"/>
<area shape="rect" id="node13" href="apr__pools_8h.html" title="APR memory allocation. " alt="" coords="299,408,389,435"/>
<area shape="rect" id="node14" href="apr__errno_8h.html" title="APR Error Codes. " alt="" coords="479,632,566,659"/>
<area shape="rect" id="node16" href="apr__general_8h.html" title="APR Miscellaneous library routines. " alt="" coords="503,483,603,509"/>
<area shape="rect" id="node18" href="apr__want_8h.html" title="APR Standard Headers Support. " alt="" coords="165,557,251,584"/>
<area shape="rect" id="node20" href="apr__allocator_8h.html" title="APR Internal Memory Allocation. " alt="" coords="291,483,397,509"/>
<area shape="rect" id="node21" href="apr__thread__mutex_8h.html" title="APR Thread Mutex Routines. " alt="" coords="378,557,515,584"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ab653cf22c99ca5af86c45dbb5092739c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="suexec_8c.html#ab653cf22c99ca5af86c45dbb5092739c">AP_MAXPATH</a>&#160;&#160;&#160;8192</td></tr>
<tr class="separator:ab653cf22c99ca5af86c45dbb5092739c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a10bffde03876e58fae23810174e77cb5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="suexec_8c.html#a10bffde03876e58fae23810174e77cb5">AP_ENVBUF</a>&#160;&#160;&#160;256</td></tr>
<tr class="separator:a10bffde03876e58fae23810174e77cb5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a0ddf1224851353fc92bfbff6f499fa97"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pcre_8txt.html#a42dfa4ff673c82d8efe7144098fbc198">int</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="suexec_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main</a> (<a class="el" href="pcre_8txt.html#a42dfa4ff673c82d8efe7144098fbc198">int</a> <a class="el" href="group__apr__getopt.html#ga6bdebf9385dc069c90aa21989641be02">argc</a>, char *<a class="el" href="group__apr__getopt.html#ga675a108e956f4e2ea74dae8d26e6273e">argv</a>[])</td></tr>
<tr class="separator:a0ddf1224851353fc92bfbff6f499fa97"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:aa006daaf11f1e2e45a6ababaf463212b"><td class="memItemLeft" align="right" valign="top">char **&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="suexec_8c.html#aa006daaf11f1e2e45a6ababaf463212b">environ</a></td></tr>
<tr class="separator:aa006daaf11f1e2e45a6ababaf463212b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="a10bffde03876e58fae23810174e77cb5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AP_ENVBUF&#160;&#160;&#160;256</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ab653cf22c99ca5af86c45dbb5092739c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AP_MAXPATH&#160;&#160;&#160;8192</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a0ddf1224851353fc92bfbff6f499fa97"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pcre_8txt.html#a42dfa4ff673c82d8efe7144098fbc198">int</a> main </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pcre_8txt.html#a42dfa4ff673c82d8efe7144098fbc198">int</a>&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>argv</em>[]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;{</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="keywordtype">int</span> userdir = 0;        <span class="comment">/* ~userdir flag             */</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    uid_t uid;              <span class="comment">/* user information          */</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    gid_t gid;              <span class="comment">/* target group placeholder  */</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="keywordtype">char</span> *target_uname;     <span class="comment">/* target user name          */</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="keywordtype">char</span> *target_gname;     <span class="comment">/* target group name         */</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <span class="keywordtype">char</span> *target_homedir;   <span class="comment">/* target home directory     */</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="keywordtype">char</span> *actual_uname;     <span class="comment">/* actual user name          */</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="keywordtype">char</span> *actual_gname;     <span class="comment">/* actual group name         */</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="keywordtype">char</span> *<a class="code" href="group__APACHE__CORE__DAEMON.html#ga504a7f40c3261db3e10e1d2776642dd6">cmd</a>;              <span class="comment">/* command to be executed    */</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="keywordtype">char</span> cwd[<a class="code" href="suexec_8c.html#ab653cf22c99ca5af86c45dbb5092739c">AP_MAXPATH</a>];   <span class="comment">/* current working directory */</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="keywordtype">char</span> dwd[<a class="code" href="suexec_8c.html#ab653cf22c99ca5af86c45dbb5092739c">AP_MAXPATH</a>];   <span class="comment">/* docroot working directory */</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="keyword">struct </span>passwd *<a class="code" href="group__APACHE__CORE__PROTO.html#ga4b22922ccb91d71d170bf2bbca3d241e">pw</a>;      <span class="comment">/* password entry holder     */</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="keyword">struct </span><a class="code" href="group__MOD__DAV.html#gadc3add9d56a1a732c371606682db4c4e">group</a> *gr;       <span class="comment">/* group entry holder        */</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="keyword">struct </span>stat dir_info;   <span class="comment">/* directory info holder     */</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="keyword">struct </span>stat prg_info;   <span class="comment">/* program info holder       */</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment">     * Start with a &quot;clean&quot; environment</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    clean_env();</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="comment">     * Check existence/validity of the UID of the user</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="comment">     * running this program.  Error out if invalid.</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    uid = getuid();</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="keywordflow">if</span> ((pw = getpwuid(uid)) == <a class="code" href="pcre_8txt.html#ad7f989d16aa8ca809a36bc392c07fba1">NULL</a>) {</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        log_err(<span class="stringliteral">&quot;crit: invalid uid: (%lu)\n&quot;</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)uid);</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        <a class="code" href="group__APACHE__OS__NETWARE.html#gaac7f3a566d7243651a356db3fcfef6b1">exit</a>(102);</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    }</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="comment">     * See if this is a &#39;how were you compiled&#39; request, and</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment">     * comply if so.</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="group__APACHE__CORE__LISTEN.html#ga073cc653debb351b563a84ac72c49614">argc</a> &gt; 1)</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        &amp;&amp; (! strcmp(<a class="code" href="group__APACHE__CORE__LISTEN.html#ga7af4ef3a08f923773e59081c357d9adf">argv</a>[1], <span class="stringliteral">&quot;-V&quot;</span>))</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        &amp;&amp; ((uid == 0)</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;#ifdef _OSD_POSIX</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        <span class="comment">/* User name comparisons are case insensitive on BS2000/OSD */</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;            || (! <a class="code" href="apr__cpystrn_8c.html#a4a00fc29b96a953fed9e0107a9c4548a">strcasecmp</a>(<a class="code" href="ap__config__auto_8h.html#a95c1eda6cd1845a60b1c4640dc2f4f2f">AP_HTTPD_USER</a>, pw-&gt;pw_name)))</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;#<span class="keywordflow">else</span>  <span class="comment">/* _OSD_POSIX */</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;            || (! strcmp(<a class="code" href="ap__config__auto_8h.html#a95c1eda6cd1845a60b1c4640dc2f4f2f">AP_HTTPD_USER</a>, pw-&gt;pw_name)))</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* _OSD_POSIX */</span><span class="preprocessor"></span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        ) {</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="preprocessor">#ifdef AP_DOC_ROOT</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        fprintf(stderr, <span class="stringliteral">&quot; -D AP_DOC_ROOT=\&quot;%s\&quot;\n&quot;</span>, <a class="code" href="ap__config__auto_8h.html#ae9ee23915278e90e15f4849d1d559aef">AP_DOC_ROOT</a>);</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="preprocessor">#ifdef AP_GID_MIN</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        fprintf(stderr, <span class="stringliteral">&quot; -D AP_GID_MIN=%d\n&quot;</span>, <a class="code" href="suexec_8h.html#ab9fbc9f5869393f7e31d639b6bbfdef9">AP_GID_MIN</a>);</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="preprocessor">#ifdef AP_HTTPD_USER</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        fprintf(stderr, <span class="stringliteral">&quot; -D AP_HTTPD_USER=\&quot;%s\&quot;\n&quot;</span>, <a class="code" href="ap__config__auto_8h.html#a95c1eda6cd1845a60b1c4640dc2f4f2f">AP_HTTPD_USER</a>);</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="preprocessor">#ifdef AP_LOG_EXEC</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        fprintf(stderr, <span class="stringliteral">&quot; -D AP_LOG_EXEC=\&quot;%s\&quot;\n&quot;</span>, <a class="code" href="ap__config__auto_8h.html#a64642668abdaa652e5b4c2eedfc064ec">AP_LOG_EXEC</a>);</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="preprocessor">#ifdef AP_SAFE_PATH</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        fprintf(stderr, <span class="stringliteral">&quot; -D AP_SAFE_PATH=\&quot;%s\&quot;\n&quot;</span>, <a class="code" href="suexec_8h.html#ab8b260a0c132f7f07fe5a5416c00177d">AP_SAFE_PATH</a>);</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="preprocessor">#ifdef AP_SUEXEC_UMASK</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        fprintf(stderr, <span class="stringliteral">&quot; -D AP_SUEXEC_UMASK=%03o\n&quot;</span>, AP_SUEXEC_UMASK);</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="preprocessor">#ifdef AP_UID_MIN</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        fprintf(stderr, <span class="stringliteral">&quot; -D AP_UID_MIN=%d\n&quot;</span>, <a class="code" href="ap__config__auto_8h.html#a602c67a11bece1b53a3dc12211d38c6b">AP_UID_MIN</a>);</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="preprocessor">#ifdef AP_USERDIR_SUFFIX</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        fprintf(stderr, <span class="stringliteral">&quot; -D AP_USERDIR_SUFFIX=\&quot;%s\&quot;\n&quot;</span>, <a class="code" href="ap__config__auto_8h.html#a20dca2e528003299f7b3e69bfd3e9b6e">AP_USERDIR_SUFFIX</a>);</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        <a class="code" href="group__APACHE__OS__NETWARE.html#gaac7f3a566d7243651a356db3fcfef6b1">exit</a>(0);</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    }</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="comment">     * If there are a proper number of arguments, set</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment">     * all of them to variables.  Otherwise, error out.</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="group__APACHE__CORE__LISTEN.html#ga073cc653debb351b563a84ac72c49614">argc</a> &lt; 4) {</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        log_err(<span class="stringliteral">&quot;too few arguments\n&quot;</span>);</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        <a class="code" href="group__APACHE__OS__NETWARE.html#gaac7f3a566d7243651a356db3fcfef6b1">exit</a>(101);</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    }</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    target_uname = <a class="code" href="group__APACHE__CORE__LISTEN.html#ga7af4ef3a08f923773e59081c357d9adf">argv</a>[1];</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    target_gname = <a class="code" href="group__APACHE__CORE__LISTEN.html#ga7af4ef3a08f923773e59081c357d9adf">argv</a>[2];</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    cmd = <a class="code" href="group__APACHE__CORE__LISTEN.html#ga7af4ef3a08f923773e59081c357d9adf">argv</a>[3];</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="comment">     * Check to see if the user running this program</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment">     * is the user allowed to do so as defined in</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="comment">     * suexec.h.  If not the allowed user, error out.</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="preprocessor">#ifdef _OSD_POSIX</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="comment">/* User name comparisons are case insensitive on BS2000/OSD */</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="apr__cpystrn_8c.html#a4a00fc29b96a953fed9e0107a9c4548a">strcasecmp</a>(<a class="code" href="ap__config__auto_8h.html#a95c1eda6cd1845a60b1c4640dc2f4f2f">AP_HTTPD_USER</a>, pw-&gt;pw_name)) {</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        log_err(<span class="stringliteral">&quot;user mismatch (%s instead of %s)\n&quot;</span>, pw-&gt;pw_name, <a class="code" href="ap__config__auto_8h.html#a95c1eda6cd1845a60b1c4640dc2f4f2f">AP_HTTPD_USER</a>);</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        <a class="code" href="group__APACHE__OS__NETWARE.html#gaac7f3a566d7243651a356db3fcfef6b1">exit</a>(103);</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    }</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="preprocessor">#else  </span><span class="comment">/*_OSD_POSIX*/</span><span class="preprocessor"></span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <span class="keywordflow">if</span> (strcmp(<a class="code" href="ap__config__auto_8h.html#a95c1eda6cd1845a60b1c4640dc2f4f2f">AP_HTTPD_USER</a>, pw-&gt;pw_name)) {</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        log_err(<span class="stringliteral">&quot;user mismatch (%s instead of %s)\n&quot;</span>, pw-&gt;pw_name, <a class="code" href="ap__config__auto_8h.html#a95c1eda6cd1845a60b1c4640dc2f4f2f">AP_HTTPD_USER</a>);</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        <a class="code" href="group__APACHE__OS__NETWARE.html#gaac7f3a566d7243651a356db3fcfef6b1">exit</a>(103);</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    }</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/*_OSD_POSIX*/</span><span class="preprocessor"></span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="comment">     * Check for a leading &#39;/&#39; (absolute path) in the command to be executed,</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="comment">     * or attempts to back up out of the current directory,</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="comment">     * to protect against attacks.  If any are</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="comment">     * found, error out.  Naughty naughty crackers.</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="keywordflow">if</span> ((cmd[0] == <span class="charliteral">&#39;/&#39;</span>) || (!strncmp(cmd, <span class="stringliteral">&quot;../&quot;</span>, 3))</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        || (<a class="code" href="apr__cpystrn_8c.html#a230063e3f4d6c1324129ea552e026c27">strstr</a>(cmd, <span class="stringliteral">&quot;/../&quot;</span>) != <a class="code" href="pcre_8txt.html#ad7f989d16aa8ca809a36bc392c07fba1">NULL</a>)) {</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        log_err(<span class="stringliteral">&quot;invalid command (%s)\n&quot;</span>, cmd);</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        <a class="code" href="group__APACHE__OS__NETWARE.html#gaac7f3a566d7243651a356db3fcfef6b1">exit</a>(104);</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    }</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="comment">     * Check to see if this is a ~userdir request.  If</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment">     * so, set the flag, and remove the &#39;~&#39; from the</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment">     * target username.</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="keywordflow">if</span> (!strncmp(<span class="stringliteral">&quot;~&quot;</span>, target_uname, 1)) {</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        target_uname++;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        userdir = 1;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    }</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment">     * Error out if the target username is invalid.</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="keywordflow">if</span> (strspn(target_uname, <span class="stringliteral">&quot;1234567890&quot;</span>) != strlen(target_uname)) {</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        <span class="keywordflow">if</span> ((pw = getpwnam(target_uname)) == <a class="code" href="pcre_8txt.html#ad7f989d16aa8ca809a36bc392c07fba1">NULL</a>) {</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;            log_err(<span class="stringliteral">&quot;invalid target user name: (%s)\n&quot;</span>, target_uname);</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;            <a class="code" href="group__APACHE__OS__NETWARE.html#gaac7f3a566d7243651a356db3fcfef6b1">exit</a>(105);</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        }</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    }</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        <span class="keywordflow">if</span> ((pw = getpwuid(atoi(target_uname))) == <a class="code" href="pcre_8txt.html#ad7f989d16aa8ca809a36bc392c07fba1">NULL</a>) {</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;            log_err(<span class="stringliteral">&quot;invalid target user id: (%s)\n&quot;</span>, target_uname);</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;            <a class="code" href="group__APACHE__OS__NETWARE.html#gaac7f3a566d7243651a356db3fcfef6b1">exit</a>(121);</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        }</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    }</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="comment">     * Error out if the target group name is invalid.</span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <span class="keywordflow">if</span> (strspn(target_gname, <span class="stringliteral">&quot;1234567890&quot;</span>) != strlen(target_gname)) {</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        <span class="keywordflow">if</span> ((gr = getgrnam(target_gname)) == <a class="code" href="pcre_8txt.html#ad7f989d16aa8ca809a36bc392c07fba1">NULL</a>) {</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;            log_err(<span class="stringliteral">&quot;invalid target group name: (%s)\n&quot;</span>, target_gname);</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;            <a class="code" href="group__APACHE__OS__NETWARE.html#gaac7f3a566d7243651a356db3fcfef6b1">exit</a>(106);</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        }</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    }</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        <span class="keywordflow">if</span> ((gr = getgrgid(atoi(target_gname))) == <a class="code" href="pcre_8txt.html#ad7f989d16aa8ca809a36bc392c07fba1">NULL</a>) {</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;            log_err(<span class="stringliteral">&quot;invalid target group id: (%s)\n&quot;</span>, target_gname);</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;            <a class="code" href="group__APACHE__OS__NETWARE.html#gaac7f3a566d7243651a356db3fcfef6b1">exit</a>(106);</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        }</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    }</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    gid = gr-&gt;gr_gid;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <span class="keywordflow">if</span> ((actual_gname = <a class="code" href="apr__cpystrn_8c.html#a2c4f14c424a31db9c57fd046c3b9f0df">strdup</a>(gr-&gt;gr_name)) == <a class="code" href="pcre_8txt.html#ad7f989d16aa8ca809a36bc392c07fba1">NULL</a>) {</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        log_err(<span class="stringliteral">&quot;failed to alloc memory\n&quot;</span>);</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        <a class="code" href="group__APACHE__OS__NETWARE.html#gaac7f3a566d7243651a356db3fcfef6b1">exit</a>(125);</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    }</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="preprocessor">#ifdef _OSD_POSIX</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="comment">     * Initialize BS2000 user environment</span></div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    {</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        pid_t pid;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        <span class="keywordtype">int</span> <a class="code" href="group__APACHE__CORE__HTTPD.html#ga6e27f49150e9a14580fb313cc2777e00">status</a>;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        <span class="keywordflow">switch</span> (pid = ufork(target_uname)) {</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        <span class="keywordflow">case</span> -1:    <span class="comment">/* Error */</span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;            log_err(<span class="stringliteral">&quot;failed to setup bs2000 environment for user %s: %s\n&quot;</span>,</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;                    target_uname, <a class="code" href="pcregrep_8c.html#a5d6ffddd86bd0d0ead58247b1a80e486">strerror</a>(errno));</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;            <a class="code" href="group__APACHE__OS__NETWARE.html#gaac7f3a566d7243651a356db3fcfef6b1">exit</a>(150);</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        <span class="keywordflow">case</span> 0:     <span class="comment">/* Child */</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;        <span class="keywordflow">default</span>:    <span class="comment">/* Father */</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;            <span class="keywordflow">while</span> (pid != <a class="code" href="unix_2procsup_8c.html#ac7a6489ac1c0c6ac76b0122a1bfe5588">waitpid</a>(pid, &amp;status, 0))</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                ;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;            <span class="comment">/* @@@ FIXME: should we deal with STOP signals as well? */</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;            <span class="keywordflow">if</span> (WIFSIGNALED(status)) {</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;                kill (<a class="code" href="group__APACHE__OS__NETWARE.html#gacf2940fe9f29eb438f40629fd4fbb2b6">getpid</a>(), <a class="code" href="group__apr__platform.html#ga94ec02a12424092a8391069adcd2ff73">WTERMSIG</a>(status));</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;            }</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;            <a class="code" href="group__APACHE__OS__NETWARE.html#gaac7f3a566d7243651a356db3fcfef6b1">exit</a>(<a class="code" href="group__apr__platform.html#ga77f17ed4771a558a0f16e5f3aecee222">WEXITSTATUS</a>(status));</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        }</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    }</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/*_OSD_POSIX*/</span><span class="preprocessor"></span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="comment">     * Save these for later since initgroups will hose the struct</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    uid = pw-&gt;pw_uid;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    actual_uname = <a class="code" href="apr__cpystrn_8c.html#a2c4f14c424a31db9c57fd046c3b9f0df">strdup</a>(pw-&gt;pw_name);</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    target_homedir = <a class="code" href="apr__cpystrn_8c.html#a2c4f14c424a31db9c57fd046c3b9f0df">strdup</a>(pw-&gt;pw_dir);</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <span class="keywordflow">if</span> (actual_uname == <a class="code" href="pcre_8txt.html#ad7f989d16aa8ca809a36bc392c07fba1">NULL</a> || target_homedir == <a class="code" href="pcre_8txt.html#ad7f989d16aa8ca809a36bc392c07fba1">NULL</a>) {</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        log_err(<span class="stringliteral">&quot;failed to alloc memory\n&quot;</span>);</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        <a class="code" href="group__APACHE__OS__NETWARE.html#gaac7f3a566d7243651a356db3fcfef6b1">exit</a>(126);</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    }</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="comment">     * Log the transaction here to be sure we have an open log</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="comment">     * before we setuid().</span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    log_no_err(<span class="stringliteral">&quot;uid: (%s/%s) gid: (%s/%s) cmd: %s\n&quot;</span>,</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;               target_uname, actual_uname,</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;               target_gname, actual_gname,</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;               cmd);</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="comment">     * Error out if attempt is made to execute as root or as</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="comment">     * a UID less than AP_UID_MIN.  Tsk tsk.</span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <span class="keywordflow">if</span> ((uid == 0) || (uid &lt; <a class="code" href="ap__config__auto_8h.html#a602c67a11bece1b53a3dc12211d38c6b">AP_UID_MIN</a>)) {</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        log_err(<span class="stringliteral">&quot;cannot run as forbidden uid (%lu/%s)\n&quot;</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)uid, cmd);</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        <a class="code" href="group__APACHE__OS__NETWARE.html#gaac7f3a566d7243651a356db3fcfef6b1">exit</a>(107);</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    }</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="comment">     * Error out if attempt is made to execute as root group</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment">     * or as a GID less than AP_GID_MIN.  Tsk tsk.</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="keywordflow">if</span> ((gid == 0) || (gid &lt; <a class="code" href="suexec_8h.html#ab9fbc9f5869393f7e31d639b6bbfdef9">AP_GID_MIN</a>)) {</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        log_err(<span class="stringliteral">&quot;cannot run as forbidden gid (%lu/%s)\n&quot;</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)gid, cmd);</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        <a class="code" href="group__APACHE__OS__NETWARE.html#gaac7f3a566d7243651a356db3fcfef6b1">exit</a>(108);</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    }</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="comment">     * Change UID/GID here so that the following tests work over NFS.</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="comment">     * Initialize the group access list for the target user,</span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="comment">     * and setgid() to the target group. If unsuccessful, error out.</span></div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <span class="keywordflow">if</span> (((setgid(gid)) != 0) || (<a class="code" href="mpm__common_8c.html#a9c6178c435287e685ff3df23c5a3c0db">initgroups</a>(actual_uname, gid) != 0)) {</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        log_err(<span class="stringliteral">&quot;failed to setgid (%lu: %s)\n&quot;</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)gid, cmd);</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        <a class="code" href="group__APACHE__OS__NETWARE.html#gaac7f3a566d7243651a356db3fcfef6b1">exit</a>(109);</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    }</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="comment">     * setuid() to the target user.  Error out on fail.</span></div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <span class="keywordflow">if</span> ((setuid(uid)) != 0) {</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        log_err(<span class="stringliteral">&quot;failed to setuid (%lu: %s)\n&quot;</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)uid, cmd);</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;        <a class="code" href="group__APACHE__OS__NETWARE.html#gaac7f3a566d7243651a356db3fcfef6b1">exit</a>(110);</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    }</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="comment">     * Get the current working directory, as well as the proper</span></div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="comment">     * document root (dependant upon whether or not it is a</span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="comment">     * ~userdir request).  Error out if we cannot get either one,</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="comment">     * or if the current working directory is not in the docroot.</span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="comment">     * Use chdir()s and getcwd()s to avoid problems with symlinked</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="comment">     * directories.  Yuck.</span></div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    <span class="keywordflow">if</span> (getcwd(cwd, <a class="code" href="suexec_8c.html#ab653cf22c99ca5af86c45dbb5092739c">AP_MAXPATH</a>) == <a class="code" href="pcre_8txt.html#ad7f989d16aa8ca809a36bc392c07fba1">NULL</a>) {</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        log_err(<span class="stringliteral">&quot;cannot get current working directory\n&quot;</span>);</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        <a class="code" href="group__APACHE__OS__NETWARE.html#gaac7f3a566d7243651a356db3fcfef6b1">exit</a>(111);</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    }</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    <span class="keywordflow">if</span> (userdir) {</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;        <span class="keywordflow">if</span> (((chdir(target_homedir)) != 0) ||</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;            ((chdir(<a class="code" href="ap__config__auto_8h.html#a20dca2e528003299f7b3e69bfd3e9b6e">AP_USERDIR_SUFFIX</a>)) != 0) ||</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;            ((getcwd(dwd, <a class="code" href="suexec_8c.html#ab653cf22c99ca5af86c45dbb5092739c">AP_MAXPATH</a>)) == <a class="code" href="pcre_8txt.html#ad7f989d16aa8ca809a36bc392c07fba1">NULL</a>) ||</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;            ((chdir(cwd)) != 0)) {</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;            log_err(<span class="stringliteral">&quot;cannot get docroot information (%s)\n&quot;</span>, target_homedir);</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;            <a class="code" href="group__APACHE__OS__NETWARE.html#gaac7f3a566d7243651a356db3fcfef6b1">exit</a>(112);</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        }</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    }</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;        <span class="keywordflow">if</span> (((chdir(<a class="code" href="ap__config__auto_8h.html#ae9ee23915278e90e15f4849d1d559aef">AP_DOC_ROOT</a>)) != 0) ||</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;            ((getcwd(dwd, <a class="code" href="suexec_8c.html#ab653cf22c99ca5af86c45dbb5092739c">AP_MAXPATH</a>)) == <a class="code" href="pcre_8txt.html#ad7f989d16aa8ca809a36bc392c07fba1">NULL</a>) ||</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;            ((chdir(cwd)) != 0)) {</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;            log_err(<span class="stringliteral">&quot;cannot get docroot information (%s)\n&quot;</span>, <a class="code" href="ap__config__auto_8h.html#ae9ee23915278e90e15f4849d1d559aef">AP_DOC_ROOT</a>);</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;            <a class="code" href="group__APACHE__OS__NETWARE.html#gaac7f3a566d7243651a356db3fcfef6b1">exit</a>(113);</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;        }</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    }</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <span class="keywordflow">if</span> ((strncmp(cwd, dwd, strlen(dwd))) != 0) {</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        log_err(<span class="stringliteral">&quot;command not in docroot (%s/%s)\n&quot;</span>, cwd, cmd);</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        <a class="code" href="group__APACHE__OS__NETWARE.html#gaac7f3a566d7243651a356db3fcfef6b1">exit</a>(114);</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    }</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="comment">     * Stat the cwd and verify it is a directory, or error out.</span></div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    <span class="keywordflow">if</span> (((lstat(cwd, &amp;dir_info)) != 0) || !(S_ISDIR(dir_info.st_mode))) {</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        log_err(<span class="stringliteral">&quot;cannot stat directory: (%s)\n&quot;</span>, cwd);</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;        <a class="code" href="group__APACHE__OS__NETWARE.html#gaac7f3a566d7243651a356db3fcfef6b1">exit</a>(115);</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    }</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="comment">     * Error out if cwd is writable by others.</span></div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    <span class="keywordflow">if</span> ((dir_info.st_mode &amp; S_IWOTH) || (dir_info.st_mode &amp; S_IWGRP)) {</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        log_err(<span class="stringliteral">&quot;directory is writable by others: (%s)\n&quot;</span>, cwd);</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;        <a class="code" href="group__APACHE__OS__NETWARE.html#gaac7f3a566d7243651a356db3fcfef6b1">exit</a>(116);</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    }</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="comment">     * Error out if we cannot stat the program.</span></div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    <span class="keywordflow">if</span> (((lstat(cmd, &amp;prg_info)) != 0) || (S_ISLNK(prg_info.st_mode))) {</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        log_err(<span class="stringliteral">&quot;cannot stat program: (%s)\n&quot;</span>, cmd);</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        <a class="code" href="group__APACHE__OS__NETWARE.html#gaac7f3a566d7243651a356db3fcfef6b1">exit</a>(117);</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    }</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="comment">     * Error out if the program is writable by others.</span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <span class="keywordflow">if</span> ((prg_info.st_mode &amp; S_IWOTH) || (prg_info.st_mode &amp; S_IWGRP)) {</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        log_err(<span class="stringliteral">&quot;file is writable by others: (%s/%s)\n&quot;</span>, cwd, cmd);</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;        <a class="code" href="group__APACHE__OS__NETWARE.html#gaac7f3a566d7243651a356db3fcfef6b1">exit</a>(118);</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    }</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="comment">     * Error out if the file is setuid or setgid.</span></div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    <span class="keywordflow">if</span> ((prg_info.st_mode &amp; S_ISUID) || (prg_info.st_mode &amp; S_ISGID)) {</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;        log_err(<span class="stringliteral">&quot;file is either setuid or setgid: (%s/%s)\n&quot;</span>, cwd, cmd);</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;        <a class="code" href="group__APACHE__OS__NETWARE.html#gaac7f3a566d7243651a356db3fcfef6b1">exit</a>(119);</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    }</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="comment">     * Error out if the target name/group is different from</span></div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;<span class="comment">     * the name/group of the cwd or the program.</span></div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <span class="keywordflow">if</span> ((uid != dir_info.st_uid) ||</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;        (gid != dir_info.st_gid) ||</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;        (uid != prg_info.st_uid) ||</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;        (gid != prg_info.st_gid)) {</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        log_err(<span class="stringliteral">&quot;target uid/gid (%lu/%lu) mismatch &quot;</span></div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;                <span class="stringliteral">&quot;with directory (%lu/%lu) or program (%lu/%lu)\n&quot;</span>,</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;                (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)uid, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)gid,</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;                (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)dir_info.st_uid, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)dir_info.st_gid,</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;                (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)prg_info.st_uid, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)prg_info.st_gid);</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        <a class="code" href="group__APACHE__OS__NETWARE.html#gaac7f3a566d7243651a356db3fcfef6b1">exit</a>(120);</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    }</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="comment">     * Error out if the program is not executable for the user.</span></div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;<span class="comment">     * Otherwise, she won&#39;t find any error in the logs except for</span></div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;<span class="comment">     * &quot;[error] Premature end of script headers: ...&quot;</span></div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    <span class="keywordflow">if</span> (!(prg_info.st_mode &amp; S_IXUSR)) {</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;        log_err(<span class="stringliteral">&quot;file has no execute permission: (%s/%s)\n&quot;</span>, cwd, cmd);</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;        <a class="code" href="group__APACHE__OS__NETWARE.html#gaac7f3a566d7243651a356db3fcfef6b1">exit</a>(121);</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    }</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="preprocessor">#ifdef AP_SUEXEC_UMASK</span></div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="comment">     * umask() uses inverse logic; bits are CLEAR for allowed access.</span></div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <span class="keywordflow">if</span> ((~AP_SUEXEC_UMASK) &amp; 0022) {</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;        log_err(<span class="stringliteral">&quot;notice: AP_SUEXEC_UMASK of %03o allows &quot;</span></div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;                <span class="stringliteral">&quot;write permission to group and/or other\n&quot;</span>, AP_SUEXEC_UMASK);</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    }</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    umask(AP_SUEXEC_UMASK);</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* AP_SUEXEC_UMASK */</span><span class="preprocessor"></span></div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="comment">/* Be sure to close the log file so the CGI can&#39;t mess with it. */</span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <span class="keywordflow">if</span> (log != <a class="code" href="pcre_8txt.html#ad7f989d16aa8ca809a36bc392c07fba1">NULL</a>) {</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<span class="preprocessor">#if APR_HAVE_FCNTL_H</span></div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="comment">         * ask fcntl(2) to set the FD_CLOEXEC flag on the log file,</span></div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="comment">         * so it&#39;ll be automagically closed if the exec() call succeeds.</span></div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        fflush(log);</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        setbuf(log, <a class="code" href="pcre_8txt.html#ad7f989d16aa8ca809a36bc392c07fba1">NULL</a>);</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;        <span class="keywordflow">if</span> ((fcntl(fileno(log), F_SETFD, FD_CLOEXEC) == -1)) {</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;            log_err(<span class="stringliteral">&quot;error: can&#39;t set close-on-exec flag&quot;</span>);</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;            <a class="code" href="group__APACHE__OS__NETWARE.html#gaac7f3a566d7243651a356db3fcfef6b1">exit</a>(122);</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;        }</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;<span class="comment">         * In this case, exec() errors won&#39;t be logged because we have already</span></div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="comment">         * dropped privileges and won&#39;t be able to reopen the log file.</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;        fclose(log);</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;        log = <a class="code" href="pcre_8txt.html#ad7f989d16aa8ca809a36bc392c07fba1">NULL</a>;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    }</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;<span class="comment">     * Execute the command, replacing our image with its own.</span></div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="preprocessor">#ifdef NEED_HASHBANG_EMUL</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    <span class="comment">/* We need the #! emulation when we want to execute scripts */</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    {</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        <span class="keyword">extern</span> <span class="keywordtype">char</span> **<a class="code" href="suexec_8c.html#aa006daaf11f1e2e45a6ababaf463212b">environ</a>;</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;        ap_execve(cmd, &amp;<a class="code" href="group__APACHE__CORE__LISTEN.html#ga7af4ef3a08f923773e59081c357d9adf">argv</a>[3], environ);</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    }</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;<span class="preprocessor">#else </span><span class="comment">/*NEED_HASHBANG_EMUL*/</span><span class="preprocessor"></span></div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    execv(cmd, &amp;<a class="code" href="group__APACHE__CORE__LISTEN.html#ga7af4ef3a08f923773e59081c357d9adf">argv</a>[3]);</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/*NEED_HASHBANG_EMUL*/</span><span class="preprocessor"></span></div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="comment">     * (I can&#39;t help myself...sorry.)</span></div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<span class="comment">     * Uh oh.  Still here.  Where&#39;s the kaboom?  There was supposed to be an</span></div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;<span class="comment">     * EARTH-shattering kaboom!</span></div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;<span class="comment">     * Oh well, log the failure and error out.</span></div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    log_err(<span class="stringliteral">&quot;(%d)%s: exec failed (%s)\n&quot;</span>, errno, <a class="code" href="pcregrep_8c.html#a5d6ffddd86bd0d0ead58247b1a80e486">strerror</a>(errno), cmd);</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    <a class="code" href="group__APACHE__OS__NETWARE.html#gaac7f3a566d7243651a356db3fcfef6b1">exit</a>(255);</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;}</div><div class="ttc" id="group__apr__platform_html_ga77f17ed4771a558a0f16e5f3aecee222"><div class="ttname"><a href="group__apr__platform.html#ga77f17ed4771a558a0f16e5f3aecee222">WEXITSTATUS</a></div><div class="ttdeci">#define WEXITSTATUS(status)</div><div class="ttdef"><b>Definition:</b> apr.h:602</div></div>
<div class="ttc" id="group__APACHE__CORE__PROTO_html_ga4b22922ccb91d71d170bf2bbca3d241e"><div class="ttname"><a href="group__APACHE__CORE__PROTO.html#ga4b22922ccb91d71d170bf2bbca3d241e">pw</a></div><div class="ttdeci">const char ** pw</div><div class="ttdef"><b>Definition:</b> http_protocol.h:576</div></div>
<div class="ttc" id="group__APACHE__CORE__HTTPD_html_ga6e27f49150e9a14580fb313cc2777e00"><div class="ttname"><a href="group__APACHE__CORE__HTTPD.html#ga6e27f49150e9a14580fb313cc2777e00">status</a></div><div class="ttdeci">int status</div><div class="ttdef"><b>Definition:</b> http_core.h:277</div></div>
<div class="ttc" id="ap__config__auto_8h_html_ae9ee23915278e90e15f4849d1d559aef"><div class="ttname"><a href="ap__config__auto_8h.html#ae9ee23915278e90e15f4849d1d559aef">AP_DOC_ROOT</a></div><div class="ttdeci">#define AP_DOC_ROOT</div><div class="ttdef"><b>Definition:</b> ap_config_auto.h:5</div></div>
<div class="ttc" id="ap__config__auto_8h_html_a20dca2e528003299f7b3e69bfd3e9b6e"><div class="ttname"><a href="ap__config__auto_8h.html#a20dca2e528003299f7b3e69bfd3e9b6e">AP_USERDIR_SUFFIX</a></div><div class="ttdeci">#define AP_USERDIR_SUFFIX</div><div class="ttdef"><b>Definition:</b> ap_config_auto.h:45</div></div>
<div class="ttc" id="ap__config__auto_8h_html_a95c1eda6cd1845a60b1c4640dc2f4f2f"><div class="ttname"><a href="ap__config__auto_8h.html#a95c1eda6cd1845a60b1c4640dc2f4f2f">AP_HTTPD_USER</a></div><div class="ttdeci">#define AP_HTTPD_USER</div><div class="ttdef"><b>Definition:</b> ap_config_auto.h:23</div></div>
<div class="ttc" id="suexec_8c_html_aa006daaf11f1e2e45a6ababaf463212b"><div class="ttname"><a href="suexec_8c.html#aa006daaf11f1e2e45a6ababaf463212b">environ</a></div><div class="ttdeci">char ** environ</div></div>
<div class="ttc" id="mpm__common_8c_html_a9c6178c435287e685ff3df23c5a3c0db"><div class="ttname"><a href="mpm__common_8c.html#a9c6178c435287e685ff3df23c5a3c0db">initgroups</a></div><div class="ttdeci">int initgroups(const char *name, gid_t basegid)</div><div class="ttdef"><b>Definition:</b> mpm_common.c:261</div></div>
<div class="ttc" id="group__APACHE__OS__NETWARE_html_gacf2940fe9f29eb438f40629fd4fbb2b6"><div class="ttname"><a href="group__APACHE__OS__NETWARE.html#gacf2940fe9f29eb438f40629fd4fbb2b6">getpid</a></div><div class="ttdeci">#define getpid</div><div class="ttdef"><b>Definition:</b> os.h:49</div></div>
<div class="ttc" id="group__APACHE__CORE__LISTEN_html_ga7af4ef3a08f923773e59081c357d9adf"><div class="ttname"><a href="group__APACHE__CORE__LISTEN.html#ga7af4ef3a08f923773e59081c357d9adf">argv</a></div><div class="ttdeci">void int char *const argv[]</div><div class="ttdef"><b>Definition:</b> ap_listen.h:138</div></div>
<div class="ttc" id="group__APACHE__CORE__DAEMON_html_ga504a7f40c3261db3e10e1d2776642dd6"><div class="ttname"><a href="group__APACHE__CORE__DAEMON.html#ga504a7f40c3261db3e10e1d2776642dd6">cmd</a></div><div class="ttdeci">const char * cmd</div><div class="ttdef"><b>Definition:</b> httpd.h:2342</div></div>
<div class="ttc" id="ap__config__auto_8h_html_a602c67a11bece1b53a3dc12211d38c6b"><div class="ttname"><a href="ap__config__auto_8h.html#a602c67a11bece1b53a3dc12211d38c6b">AP_UID_MIN</a></div><div class="ttdeci">#define AP_UID_MIN</div><div class="ttdef"><b>Definition:</b> ap_config_auto.h:42</div></div>
<div class="ttc" id="suexec_8h_html_ab8b260a0c132f7f07fe5a5416c00177d"><div class="ttname"><a href="suexec_8h.html#ab8b260a0c132f7f07fe5a5416c00177d">AP_SAFE_PATH</a></div><div class="ttdeci">#define AP_SAFE_PATH</div><div class="ttdef"><b>Definition:</b> suexec.h:106</div></div>
<div class="ttc" id="group__MOD__DAV_html_gadc3add9d56a1a732c371606682db4c4e"><div class="ttname"><a href="group__MOD__DAV.html#gadc3add9d56a1a732c371606682db4c4e">group</a></div><div class="ttdeci">const char const dav_liveprop_group * group</div><div class="ttdef"><b>Definition:</b> mod_dav.h:954</div></div>
<div class="ttc" id="pcregrep_8c_html_a5d6ffddd86bd0d0ead58247b1a80e486"><div class="ttname"><a href="pcregrep_8c.html#a5d6ffddd86bd0d0ead58247b1a80e486">strerror</a></div><div class="ttdeci">char * strerror(int n)</div><div class="ttdef"><b>Definition:</b> pcregrep.c:835</div></div>
<div class="ttc" id="apr__cpystrn_8c_html_a230063e3f4d6c1324129ea552e026c27"><div class="ttname"><a href="apr__cpystrn_8c.html#a230063e3f4d6c1324129ea552e026c27">strstr</a></div><div class="ttdeci">char * strstr(char *s1, char *s2)</div><div class="ttdef"><b>Definition:</b> apr_cpystrn.c:288</div></div>
<div class="ttc" id="apr__cpystrn_8c_html_a2c4f14c424a31db9c57fd046c3b9f0df"><div class="ttname"><a href="apr__cpystrn_8c.html#a2c4f14c424a31db9c57fd046c3b9f0df">strdup</a></div><div class="ttdeci">char * strdup(const char *str)</div><div class="ttdef"><b>Definition:</b> apr_cpystrn.c:232</div></div>
<div class="ttc" id="group__APACHE__OS__NETWARE_html_gaac7f3a566d7243651a356db3fcfef6b1"><div class="ttname"><a href="group__APACHE__OS__NETWARE.html#gaac7f3a566d7243651a356db3fcfef6b1">exit</a></div><div class="ttdeci">#define exit(s)</div><div class="ttdef"><b>Definition:</b> os.h:54</div></div>
<div class="ttc" id="group__apr__platform_html_ga94ec02a12424092a8391069adcd2ff73"><div class="ttname"><a href="group__apr__platform.html#ga94ec02a12424092a8391069adcd2ff73">WTERMSIG</a></div><div class="ttdeci">#define WTERMSIG(status)</div><div class="ttdef"><b>Definition:</b> apr.h:603</div></div>
<div class="ttc" id="apr__cpystrn_8c_html_a4a00fc29b96a953fed9e0107a9c4548a"><div class="ttname"><a href="apr__cpystrn_8c.html#a4a00fc29b96a953fed9e0107a9c4548a">strcasecmp</a></div><div class="ttdeci">int strcasecmp(const char *a, const char *b)</div><div class="ttdef"><b>Definition:</b> apr_cpystrn.c:248</div></div>
<div class="ttc" id="unix_2procsup_8c_html_ac7a6489ac1c0c6ac76b0122a1bfe5588"><div class="ttname"><a href="unix_2procsup_8c.html#ac7a6489ac1c0c6ac76b0122a1bfe5588">waitpid</a></div><div class="ttdeci">int waitpid(pid_t pid, int *statusp, int options)</div><div class="ttdef"><b>Definition:</b> procsup.c:91</div></div>
<div class="ttc" id="suexec_8h_html_ab9fbc9f5869393f7e31d639b6bbfdef9"><div class="ttname"><a href="suexec_8h.html#ab9fbc9f5869393f7e31d639b6bbfdef9">AP_GID_MIN</a></div><div class="ttdeci">#define AP_GID_MIN</div><div class="ttdef"><b>Definition:</b> suexec.h:55</div></div>
<div class="ttc" id="suexec_8c_html_ab653cf22c99ca5af86c45dbb5092739c"><div class="ttname"><a href="suexec_8c.html#ab653cf22c99ca5af86c45dbb5092739c">AP_MAXPATH</a></div><div class="ttdeci">#define AP_MAXPATH</div><div class="ttdef"><b>Definition:</b> suexec.c:66</div></div>
<div class="ttc" id="pcre_8txt_html_ad7f989d16aa8ca809a36bc392c07fba1"><div class="ttname"><a href="pcre_8txt.html#ad7f989d16aa8ca809a36bc392c07fba1">NULL</a></div><div class="ttdeci">this is a typedef for a structure whose contents are not externally defined It is up to the caller to free the that it does not depend on memory the complete pcre data block is not fully because it may contain a copy of the tableptr argu which is an those that are compatible with but some others as well can also be set and unset from within the the contents of the options argument specifies their settings at the start of compilation and execution The and PCRE_NO_START_OPTIMIZE options can be set at the time of matching as well as at compile time If errptr is NULL</div><div class="ttdef"><b>Definition:</b> pcre.txt:2065</div></div>
<div class="ttc" id="ap__config__auto_8h_html_a64642668abdaa652e5b4c2eedfc064ec"><div class="ttname"><a href="ap__config__auto_8h.html#a64642668abdaa652e5b4c2eedfc064ec">AP_LOG_EXEC</a></div><div class="ttdeci">#define AP_LOG_EXEC</div><div class="ttdef"><b>Definition:</b> ap_config_auto.h:26</div></div>
<div class="ttc" id="group__APACHE__CORE__LISTEN_html_ga073cc653debb351b563a84ac72c49614"><div class="ttname"><a href="group__APACHE__CORE__LISTEN.html#ga073cc653debb351b563a84ac72c49614">argc</a></div><div class="ttdeci">void int argc</div><div class="ttdef"><b>Definition:</b> ap_listen.h:138</div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="suexec_8c_a0ddf1224851353fc92bfbff6f499fa97_cgraph.png" border="0" usemap="#suexec_8c_a0ddf1224851353fc92bfbff6f499fa97_cgraph" alt=""/></div>
<map name="suexec_8c_a0ddf1224851353fc92bfbff6f499fa97_cgraph" id="suexec_8c_a0ddf1224851353fc92bfbff6f499fa97_cgraph">
<area shape="rect" id="node2" href="apr__cpystrn_8c.html#a4a00fc29b96a953fed9e0107a9c4548a" title="strcasecmp" alt="" coords="104,107,195,133"/>
<area shape="rect" id="node3" href="apr__cpystrn_8c.html#a230063e3f4d6c1324129ea552e026c27" title="strstr" alt="" coords="123,157,175,184"/>
<area shape="rect" id="node4" href="apr__cpystrn_8c.html#a2c4f14c424a31db9c57fd046c3b9f0df" title="strdup" alt="" coords="120,208,179,235"/>
<area shape="rect" id="node6" href="pcregrep_8c.html#a5d6ffddd86bd0d0ead58247b1a80e486" title="strerror" alt="" coords="118,259,181,285"/>
<area shape="rect" id="node18" href="unix_2procsup_8c.html#ac7a6489ac1c0c6ac76b0122a1bfe5588" title="waitpid" alt="" coords="118,309,181,336"/>
<area shape="rect" id="node19" href="mpm__common_8c.html#a9c6178c435287e685ff3df23c5a3c0db" title="initgroups" alt="" coords="110,360,189,387"/>
<area shape="rect" id="node5" href="util__expr__parse_8c.html#a5faf6a2d99f50a4655dd390199a8db7b" title="malloc" alt="" coords="264,5,324,32"/>
<area shape="rect" id="node7" href="NON-AUTOTOOLS-BUILD_8txt.html#a02f48304b1edc74d7d9fa0698403a8d3" title="pcre_exec" alt="" coords="253,56,335,83"/>
<area shape="rect" id="node8" href="group__MOD__ISAPI.html#gacd6cdbf73df3d9eed42fa493d9b621a6" title="void" alt="" coords="271,107,317,133"/>
<area shape="rect" id="node9" href="apr__strings_8c.html#a16d6b0bd660cc3f9910924c6b6f4af8e" title="memchr" alt="" coords="259,157,329,184"/>
<area shape="rect" id="node10" href="pcregrep_8c.html#ae0ea17b58e7eed02ae438efd1847766d" title="isdirectory" alt="" coords="253,208,335,235"/>
<area shape="rect" id="node11" href="pcregrep_8c.html#a206f5b52d823b7ef25a61c2a8f092f2e" title="opendirectory" alt="" coords="244,259,344,285"/>
<area shape="rect" id="node12" href="pcregrep_8c.html#ae50cd2c42eb978cfbfbac19142552609" title="readdirectory" alt="" coords="245,309,343,336"/>
<area shape="rect" id="node13" href="pcregrep_8c.html#a61710bf82c1e84826a1c1b281a6d8bfe" title="closedirectory" alt="" coords="243,360,345,387"/>
<area shape="rect" id="node14" href="pcregrep_8c.html#a8dc96489c6c513c9640e9196b83f43ce" title="isregfile" alt="" coords="261,411,327,437"/>
<area shape="rect" id="node15" href="pcre_8txt.html#a80a34330f84c195a0f7fb290ed25b72b" title="pcre_version" alt="" coords="246,461,342,488"/>
<area shape="rect" id="node16" href="README_8txt.html#ac2d9d7d1be621b48f6bb23146a342420" title="pcre_compile" alt="" coords="245,512,343,539"/>
<area shape="rect" id="node17" href="pcretest_8txt.html#ab7f0ba87211e31d6160eef5650b39b52" title="fgets" alt="" coords="269,563,319,589"/>
</map>
</div>
</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="aa006daaf11f1e2e45a6ababaf463212b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char** environ</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
